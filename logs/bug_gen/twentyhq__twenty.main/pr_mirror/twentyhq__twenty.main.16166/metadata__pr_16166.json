{
    "cost": 0.20971,
    "rewrites": {
        "twentyhq__twenty.main/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx": {
            "output": "import { GRAPH_TYPE_INFORMATION } from '@/command-menu/pages/page-layout/constants/GraphTypeInformation';\nimport { useIsFeatureEnabled } from '@/workspace/hooks/useIsFeatureEnabled';\nimport styled from '@emotion/styled';\nimport { FeatureFlagKey, GraphType } from '~/generated-metadata/graphql';\n\nimport { t } from '@lingui/core/macro';\nimport { MenuPicker } from 'twenty-ui/navigation';\n\nconst graphTypeOptions = [\n  GraphType.VERTICAL_BAR,\n  GraphType.HORIZONTAL_BAR,\n  GraphType.AGGREGATE,\n  GraphType.PIE,\n  GraphType.LINE,\n  GraphType.GAUGE,\n];\n\nconst StyledChartTypeSelectionContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: ${({ theme }) => theme.spacing(2)};\n`;\n\ntype ChartTypeSelectionSectionProps = {\n  currentGraphType: GraphType;\n  setCurrentGraphType: (graphType: GraphType) => void;\n};\n\nexport const ChartTypeSelectionSection = ({\n  currentGraphType,\n  setCurrentGraphType,\n}: ChartTypeSelectionSectionProps) => {\n  const isDashboardV2Enabled = useIsFeatureEnabled(\n    FeatureFlagKey.IS_DASHBOARD_V2_ENABLED,\n  );\n\n  return (\n    <StyledChartTypeSelectionContainer>\n      {graphTypeOptions.map((graphType) => {\n        const isChartV2Type = [\n          GraphType.PIE,\n          GraphType.LINE,\n          GraphType.GAUGE,\n        ].includes(graphType);\n\n        const isDisabled = isChartV2Type && !isDashboardV2Enabled;\n\n        return (\n          <MenuPicker\n            id={graphType}\n            selected={currentGraphType === graphType}\n            key={graphType}\n            icon={GRAPH_TYPE_INFORMATION[graphType].icon}\n            onClick={() => {\n              setCurrentGraphType(graphType);\n            }}\n            showLabel\n            disabled={isDisabled}\n            tooltipContent={\n              isDisabled ? t`Soon` : t(GRAPH_TYPE_INFORMATION[graphType].label)\n            }\n          />\n        );\n      })}\n    </StyledChartTypeSelectionContainer>\n  );\n};",
            "output_extracted": "import { GRAPH_TYPE_INFORMATION } from '@/command-menu/pages/page-layout/constants/GraphTypeInformation';\nimport { useIsFeatureEnabled } from '@/workspace/hooks/useIsFeatureEnabled';\nimport styled from '@emotion/styled';\nimport { FeatureFlagKey, GraphType } from '~/generated-metadata/graphql';\n\nimport { t } from '@lingui/core/macro';\nimport { MenuPicker } from 'twenty-ui/navigation';\n\nconst graphTypeOptions = [\n  GraphType.VERTICAL_BAR,\n  GraphType.HORIZONTAL_BAR,\n  GraphType.AGGREGATE,\n  GraphType.PIE,\n  GraphType.LINE,\n  GraphType.GAUGE,\n];\n\nconst StyledChartTypeSelectionContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: ${({ theme }) => theme.spacing(2)};\n`;\n\ntype ChartTypeSelectionSectionProps = {\n  currentGraphType: GraphType;\n  setCurrentGraphType: (graphType: GraphType) => void;\n};\n\nexport const ChartTypeSelectionSection = ({\n  currentGraphType,\n  setCurrentGraphType,\n}: ChartTypeSelectionSectionProps) => {\n  const isDashboardV2Enabled = useIsFeatureEnabled(\n    FeatureFlagKey.IS_DASHBOARD_V2_ENABLED,\n  );\n\n  return (\n    <StyledChartTypeSelectionContainer>\n      {graphTypeOptions.map((graphType) => {\n        const isChartV2Type = [\n          GraphType.PIE,\n          GraphType.LINE,\n          GraphType.GAUGE,\n        ].includes(graphType);\n\n        const isDisabled = isChartV2Type && !isDashboardV2Enabled;\n\n        return (\n          <MenuPicker\n            id={graphType}\n            selected={currentGraphType === graphType}\n            key={graphType}\n            icon={GRAPH_TYPE_INFORMATION[graphType].icon}\n            onClick={() => {\n              setCurrentGraphType(graphType);\n            }}\n            showLabel\n            disabled={isDisabled}\n            tooltipContent={\n              isDisabled ? t`Soon` : t(GRAPH_TYPE_INFORMATION[graphType].label)\n            }\n          />\n        );\n      })}\n    </StyledChartTypeSelectionContainer>\n  );\n};",
            "cost": 0.024555
        },
        "twentyhq__twenty.main/packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts": {
            "output": "import {\n  INVALID_HORIZONTAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n  INVALID_IFRAME_CONFIG_BAD_URL,\n  INVALID_IFRAME_CONFIG_EMPTY_URL,\n  INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n  INVALID_NUMBER_CHART_CONFIG_MISSING_FIELDS,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_BODY_WRONG_TYPE,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_INVALID_SUBFIELDS,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_MISSING_BODY,\n  INVALID_VERTICAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n  TEST_GAUGE_CHART_CONFIG,\n  TEST_HORIZONTAL_BAR_CHART_CONFIG,\n  TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL,\n  TEST_IFRAME_CONFIG,\n  TEST_LINE_CHART_CONFIG,\n  TEST_NUMBER_CHART_CONFIG,\n  TEST_NUMBER_CHART_CONFIG_MINIMAL,\n  TEST_PIE_CHART_CONFIG,\n  TEST_STANDALONE_RICH_TEXT_CONFIG,\n  TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL,\n  TEST_VERTICAL_BAR_CHART_CONFIG,\n  TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL,\n} from 'test/integration/constants/widget-configuration-test-data.constants';\n\nimport { WidgetType } from 'src/engine/core-modules/page-layout/enums/widget-type.enum';\nimport { validateAndTransformWidgetConfiguration } from 'src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util';\n\njest.mock(\n  'src/engine/core-modules/record-transformer/utils/transform-rich-text-v2.util',\n  () => ({\n    transformRichTextV2Value: jest.fn((value) =>\n      Promise.resolve({\n        blocknote: value.blocknote ?? null,\n        markdown: value.markdown ?? null,\n      }),\n    ),\n  }),\n);\n\ndescribe('validateAndTransformWidgetConfiguration', () => {\n  describe('IFRAME widget', () => {\n    it('should validate and transform valid iframe configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.IFRAME,\n        configuration: TEST_IFRAME_CONFIG,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_IFRAME_CONFIG);\n    });\n\n    it('should throw error for invalid URL', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: INVALID_IFRAME_CONFIG_BAD_URL,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/url must be a URL address/);\n    });\n\n    it('should throw error for empty URL', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: INVALID_IFRAME_CONFIG_EMPTY_URL,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/url must be a URL address/);\n    });\n  });\n\n  describe('STANDALONE_RICH_TEXT widget', () => {\n    it('should validate and transform valid standalone rich text configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: TEST_STANDALONE_RICH_TEXT_CONFIG,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_STANDALONE_RICH_TEXT_CONFIG);\n    });\n\n    it('should validate minimal standalone rich text configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL);\n    });\n\n    it('should throw error for missing body', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.STANDALONE_RICH_TEXT,\n          configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_MISSING_BODY,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/body/);\n    });\n\n    it('should throw error when body is wrong type', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.STANDALONE_RICH_TEXT,\n          configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_BODY_WRONG_TYPE,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow();\n    });\n\n    it('should strip invalid subfields from body', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_INVALID_SUBFIELDS,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeDefined();\n      expect((result as any).body.blocknote).toBeDefined();\n      expect((result as any).body.markdown).toBe('valid');\n      expect((result as any).body.invalidField).toBeUndefined();\n    });\n  });\n\n  describe('GRAPH widget', () => {\n    describe('NUMBER graph', () => {\n      it('should validate full number graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_NUMBER_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_NUMBER_CHART_CONFIG);\n      });\n\n      it('should validate minimal number graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_NUMBER_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_NUMBER_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial number graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_NUMBER_CHART_CONFIG_MISSING_FIELDS,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/aggregateFieldMetadataId.*aggregateOperation/);\n      });\n\n      it('should throw error for invalid UUID', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/aggregateFieldMetadataId must be a UUID/);\n      });\n    });\n\n    describe('VERTICAL_BAR graph', () => {\n      it('should validate full vertical bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_VERTICAL_BAR_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_VERTICAL_BAR_CHART_CONFIG);\n      });\n\n      it('should validate minimal vertical bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial vertical bar graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_VERTICAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/primaryAxisGroupByFieldMetadataId/);\n      });\n    });\n\n    describe('HORIZONTAL_BAR graph', () => {\n      it('should validate full horizontal bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_HORIZONTAL_BAR_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_HORIZONTAL_BAR_CHART_CONFIG);\n      });\n\n      it('should validate minimal horizontal bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial horizontal bar graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_HORIZONTAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/primaryAxisGroupByFieldMetadataId/);\n      });\n    });\n\n    it('should return null for unsupported graph type', async () => {\n      const configuration = {\n        graphType: 'UNSUPPORTED',\n        viewId: '550e8400-e29b-41d4-a716-446655440000',\n      };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.GRAPH,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n\n    it('should return null for missing graph type', async () => {\n      const configuration = {\n        viewId: '550e8400-e29b-41d4-a716-446655440000',\n      };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.GRAPH,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('Edge cases', () => {\n    it('should throw error for null configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: null,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should throw error for undefined configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: undefined,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should throw error for non-object configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: 'string',\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should return null for unsupported widget type', async () => {\n      const configuration = { someField: 'value' };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: 'UNSUPPORTED' as WidgetType,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('Error messages', () => {\n    it('should include validation details in error message', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/aggregateFieldMetadataId must be a UUID/);\n    });\n  });\n\n  describe('Feature flags', () => {\n    it('should throw error for unsupported graph type', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_PIE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_LINE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_GAUGE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_PIE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_LINE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_GAUGE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n  });\n});",
            "output_extracted": "import {\n  INVALID_HORIZONTAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n  INVALID_IFRAME_CONFIG_BAD_URL,\n  INVALID_IFRAME_CONFIG_EMPTY_URL,\n  INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n  INVALID_NUMBER_CHART_CONFIG_MISSING_FIELDS,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_BODY_WRONG_TYPE,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_INVALID_SUBFIELDS,\n  INVALID_STANDALONE_RICH_TEXT_CONFIG_MISSING_BODY,\n  INVALID_VERTICAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n  TEST_GAUGE_CHART_CONFIG,\n  TEST_HORIZONTAL_BAR_CHART_CONFIG,\n  TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL,\n  TEST_IFRAME_CONFIG,\n  TEST_LINE_CHART_CONFIG,\n  TEST_NUMBER_CHART_CONFIG,\n  TEST_NUMBER_CHART_CONFIG_MINIMAL,\n  TEST_PIE_CHART_CONFIG,\n  TEST_STANDALONE_RICH_TEXT_CONFIG,\n  TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL,\n  TEST_VERTICAL_BAR_CHART_CONFIG,\n  TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL,\n} from 'test/integration/constants/widget-configuration-test-data.constants';\n\nimport { WidgetType } from 'src/engine/core-modules/page-layout/enums/widget-type.enum';\nimport { validateAndTransformWidgetConfiguration } from 'src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util';\n\njest.mock(\n  'src/engine/core-modules/record-transformer/utils/transform-rich-text-v2.util',\n  () => ({\n    transformRichTextV2Value: jest.fn((value) =>\n      Promise.resolve({\n        blocknote: value.blocknote ?? null,\n        markdown: value.markdown ?? null,\n      }),\n    ),\n  }),\n);\n\ndescribe('validateAndTransformWidgetConfiguration', () => {\n  describe('IFRAME widget', () => {\n    it('should validate and transform valid iframe configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.IFRAME,\n        configuration: TEST_IFRAME_CONFIG,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_IFRAME_CONFIG);\n    });\n\n    it('should throw error for invalid URL', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: INVALID_IFRAME_CONFIG_BAD_URL,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/url must be a URL address/);\n    });\n\n    it('should throw error for empty URL', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: INVALID_IFRAME_CONFIG_EMPTY_URL,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/url must be a URL address/);\n    });\n  });\n\n  describe('STANDALONE_RICH_TEXT widget', () => {\n    it('should validate and transform valid standalone rich text configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: TEST_STANDALONE_RICH_TEXT_CONFIG,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_STANDALONE_RICH_TEXT_CONFIG);\n    });\n\n    it('should validate minimal standalone rich text configuration', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toMatchObject(TEST_STANDALONE_RICH_TEXT_CONFIG_MINIMAL);\n    });\n\n    it('should throw error for missing body', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.STANDALONE_RICH_TEXT,\n          configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_MISSING_BODY,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/body/);\n    });\n\n    it('should throw error when body is wrong type', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.STANDALONE_RICH_TEXT,\n          configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_BODY_WRONG_TYPE,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow();\n    });\n\n    it('should strip invalid subfields from body', async () => {\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.STANDALONE_RICH_TEXT,\n        configuration: INVALID_STANDALONE_RICH_TEXT_CONFIG_INVALID_SUBFIELDS,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeDefined();\n      expect((result as any).body.blocknote).toBeDefined();\n      expect((result as any).body.markdown).toBe('valid');\n      expect((result as any).body.invalidField).toBeUndefined();\n    });\n  });\n\n  describe('GRAPH widget', () => {\n    describe('NUMBER graph', () => {\n      it('should validate full number graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_NUMBER_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_NUMBER_CHART_CONFIG);\n      });\n\n      it('should validate minimal number graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_NUMBER_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_NUMBER_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial number graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_NUMBER_CHART_CONFIG_MISSING_FIELDS,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/aggregateFieldMetadataId.*aggregateOperation/);\n      });\n\n      it('should throw error for invalid UUID', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/aggregateFieldMetadataId must be a UUID/);\n      });\n    });\n\n    describe('VERTICAL_BAR graph', () => {\n      it('should validate full vertical bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_VERTICAL_BAR_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_VERTICAL_BAR_CHART_CONFIG);\n      });\n\n      it('should validate minimal vertical bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_VERTICAL_BAR_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial vertical bar graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_VERTICAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/primaryAxisGroupByFieldMetadataId/);\n      });\n    });\n\n    describe('HORIZONTAL_BAR graph', () => {\n      it('should validate full horizontal bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_HORIZONTAL_BAR_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_HORIZONTAL_BAR_CHART_CONFIG);\n      });\n\n      it('should validate minimal horizontal bar graph configuration', async () => {\n        const result = await validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL,\n          isDashboardV2Enabled: false,\n        });\n\n        expect(result).toMatchObject(TEST_HORIZONTAL_BAR_CHART_CONFIG_MINIMAL);\n      });\n\n      it('should throw error for partial horizontal bar graph configuration with missing required fields', async () => {\n        await expect(\n          validateAndTransformWidgetConfiguration({\n            type: WidgetType.GRAPH,\n            configuration: INVALID_HORIZONTAL_BAR_CHART_CONFIG_MISSING_GROUP_BY,\n            isDashboardV2Enabled: false,\n          }),\n        ).rejects.toThrow(/primaryAxisGroupByFieldMetadataId/);\n      });\n    });\n\n    it('should return null for unsupported graph type', async () => {\n      const configuration = {\n        graphType: 'UNSUPPORTED',\n        viewId: '550e8400-e29b-41d4-a716-446655440000',\n      };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.GRAPH,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n\n    it('should return null for missing graph type', async () => {\n      const configuration = {\n        viewId: '550e8400-e29b-41d4-a716-446655440000',\n      };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: WidgetType.GRAPH,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('Edge cases', () => {\n    it('should throw error for null configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: null,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should throw error for undefined configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: undefined,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should throw error for non-object configuration', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.IFRAME,\n          configuration: 'string',\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow('Invalid configuration: not an object');\n    });\n\n    it('should return null for unsupported widget type', async () => {\n      const configuration = { someField: 'value' };\n\n      const result = await validateAndTransformWidgetConfiguration({\n        type: 'UNSUPPORTED' as WidgetType,\n        configuration: configuration,\n        isDashboardV2Enabled: false,\n      });\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('Error messages', () => {\n    it('should include validation details in error message', async () => {\n      await expect(\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: INVALID_NUMBER_CHART_CONFIG_BAD_UUID,\n          isDashboardV2Enabled: false,\n        }),\n      ).rejects.toThrow(/aggregateFieldMetadataId must be a UUID/);\n    });\n  });\n\n  describe('Feature flags', () => {\n    it('should throw error for unsupported graph type', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_PIE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_LINE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_GAUGE_CHART_CONFIG,\n          isDashboardV2Enabled: false,\n        }),\n      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_PIE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_LINE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n\n    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n      expect(() =>\n        validateAndTransformWidgetConfiguration({\n          type: WidgetType.GRAPH,\n          configuration: TEST_GAUGE_CHART_CONFIG,\n          isDashboardV2Enabled: true,\n        }),\n      ).not.toThrow();\n    });\n  });\n});",
            "cost": 0.12264
        },
        "twentyhq__twenty.main/packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts": {
            "output": "import { plainToInstance } from 'class-transformer';\nimport { validateSync, type ValidationError } from 'class-validator';\nimport { isDefined } from 'twenty-shared/utils';\n\nimport { AggregateChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/aggregate-chart-configuration.dto';\nimport { transformRichTextV2Value } from 'src/engine/core-modules/record-transformer/utils/transform-rich-text-v2.util';\nimport { BarChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/bar-chart-configuration.dto';\nimport { GaugeChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/gauge-chart-configuration.dto';\nimport { IframeConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/iframe-configuration.dto';\nimport { LineChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/line-chart-configuration.dto';\nimport { PieChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto';\nimport { StandaloneRichTextConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/standalone-rich-text-configuration.dto';\nimport { type WidgetConfigurationInterface } from 'src/engine/core-modules/page-layout/dtos/widget-configuration.interface';\nimport { BarChartGroupMode } from 'src/engine/core-modules/page-layout/enums/bar-chart-group-mode.enum';\nimport { GraphType } from 'src/engine/core-modules/page-layout/enums/graph-type.enum';\nimport { WidgetType } from 'src/engine/core-modules/page-layout/enums/widget-type.enum';\n\nconst formatValidationErrors = (errors: ValidationError[]): string => {\n  return errors\n    .map((err) => {\n      const constraints = err.constraints\n        ? Object.values(err.constraints).join(', ')\n        : 'Unknown error';\n\n      return `${err.property}: ${constraints}`;\n    })\n    .join('; ');\n};\n\nconst validateGraphConfiguration = ({\n  configuration,\n  isDashboardV2Enabled,\n}: {\n  configuration: Record<string, unknown>;\n  isDashboardV2Enabled: boolean;\n}): WidgetConfigurationInterface | null => {\n  const graphType = configuration.graphType as GraphType;\n\n  if (!graphType || !Object.values(GraphType).includes(graphType)) {\n    return null;\n  }\n\n  const v2ChartTypes = [GraphType.PIE, GraphType.LINE, GraphType.GAUGE];\n\n  if (v2ChartTypes.includes(graphType) && !isDashboardV2Enabled) {\n    throw new Error(\n      `Chart type ${graphType} requires IS_DASHBOARD_V2_ENABLED feature flag`,\n    );\n  }\n\n  switch (graphType) {\n    case GraphType.VERTICAL_BAR:\n    case GraphType.HORIZONTAL_BAR: {\n      const instance = plainToInstance(BarChartConfigurationDTO, configuration);\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      if (\n        isDefined(instance.secondaryAxisGroupByFieldMetadataId) &&\n        !isDefined(instance.groupMode)\n      ) {\n        instance.groupMode = BarChartGroupMode.STACKED;\n      }\n\n      return instance;\n    }\n    case GraphType.LINE: {\n      const instance = plainToInstance(\n        LineChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      if (\n        isDefined(instance.secondaryAxisGroupByFieldMetadataId) &&\n        !isDefined(instance.isStacked)\n      ) {\n        instance.isStacked = true;\n      }\n\n      return instance;\n    }\n    case GraphType.PIE: {\n      const instance = plainToInstance(PieChartConfigurationDTO, configuration);\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    case GraphType.AGGREGATE: {\n      const instance = plainToInstance(\n        AggregateChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    case GraphType.GAUGE: {\n      const instance = plainToInstance(\n        GaugeChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    default:\n      return null;\n  }\n};\n\nconst validateIframeConfiguration = (\n  configuration: unknown,\n): WidgetConfigurationInterface | null => {\n  const instance = plainToInstance(IframeConfigurationDTO, configuration);\n\n  const errors = validateSync(instance, {\n    whitelist: true,\n    forbidUnknownValues: true,\n  });\n\n  if (errors.length > 0) {\n    throw errors;\n  }\n\n  return instance;\n};\n\nconst validateStandaloneRichTextConfiguration = async (\n  configuration: unknown,\n): Promise<WidgetConfigurationInterface | null> => {\n  const instance = plainToInstance(\n    StandaloneRichTextConfigurationDTO,\n    configuration,\n  );\n\n  const errors = validateSync(instance, {\n    whitelist: true,\n    forbidUnknownValues: true,\n  });\n\n  if (errors.length > 0) {\n    throw errors;\n  }\n\n  if (instance.body) {\n    instance.body = await transformRichTextV2Value(instance.body);\n  }\n\n  return instance;\n};\n\nexport const validateAndTransformWidgetConfiguration = async ({\n  type,\n  configuration,\n  isDashboardV2Enabled,\n}: {\n  type: WidgetType;\n  configuration: unknown;\n  isDashboardV2Enabled: boolean;\n}): Promise<WidgetConfigurationInterface | null> => {\n  if (!configuration || typeof configuration !== 'object') {\n    throw new Error('Invalid configuration: not an object');\n  }\n\n  try {\n    switch (type) {\n      case WidgetType.GRAPH:\n        return validateGraphConfiguration({\n          configuration: configuration as Record<string, unknown>,\n          isDashboardV2Enabled,\n        });\n      case WidgetType.IFRAME:\n        return validateIframeConfiguration(configuration);\n      case WidgetType.STANDALONE_RICH_TEXT:\n        return await validateStandaloneRichTextConfiguration(configuration);\n      default:\n        return null;\n    }\n  } catch (error) {\n    if (Array.isArray(error)) {\n      const errorMessage = formatValidationErrors(error);\n\n      throw new Error(errorMessage);\n    }\n    throw error;\n  }\n};",
            "output_extracted": "import { plainToInstance } from 'class-transformer';\nimport { validateSync, type ValidationError } from 'class-validator';\nimport { isDefined } from 'twenty-shared/utils';\n\nimport { AggregateChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/aggregate-chart-configuration.dto';\nimport { transformRichTextV2Value } from 'src/engine/core-modules/record-transformer/utils/transform-rich-text-v2.util';\nimport { BarChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/bar-chart-configuration.dto';\nimport { GaugeChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/gauge-chart-configuration.dto';\nimport { IframeConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/iframe-configuration.dto';\nimport { LineChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/line-chart-configuration.dto';\nimport { PieChartConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto';\nimport { StandaloneRichTextConfigurationDTO } from 'src/engine/core-modules/page-layout/dtos/standalone-rich-text-configuration.dto';\nimport { type WidgetConfigurationInterface } from 'src/engine/core-modules/page-layout/dtos/widget-configuration.interface';\nimport { BarChartGroupMode } from 'src/engine/core-modules/page-layout/enums/bar-chart-group-mode.enum';\nimport { GraphType } from 'src/engine/core-modules/page-layout/enums/graph-type.enum';\nimport { WidgetType } from 'src/engine/core-modules/page-layout/enums/widget-type.enum';\n\nconst formatValidationErrors = (errors: ValidationError[]): string => {\n  return errors\n    .map((err) => {\n      const constraints = err.constraints\n        ? Object.values(err.constraints).join(', ')\n        : 'Unknown error';\n\n      return `${err.property}: ${constraints}`;\n    })\n    .join('; ');\n};\n\nconst validateGraphConfiguration = ({\n  configuration,\n  isDashboardV2Enabled,\n}: {\n  configuration: Record<string, unknown>;\n  isDashboardV2Enabled: boolean;\n}): WidgetConfigurationInterface | null => {\n  const graphType = configuration.graphType as GraphType;\n\n  if (!graphType || !Object.values(GraphType).includes(graphType)) {\n    return null;\n  }\n\n  const v2ChartTypes = [GraphType.PIE, GraphType.LINE, GraphType.GAUGE];\n\n  if (v2ChartTypes.includes(graphType) && !isDashboardV2Enabled) {\n    throw new Error(\n      `Chart type ${graphType} requires IS_DASHBOARD_V2_ENABLED feature flag`,\n    );\n  }\n\n  switch (graphType) {\n    case GraphType.VERTICAL_BAR:\n    case GraphType.HORIZONTAL_BAR: {\n      const instance = plainToInstance(BarChartConfigurationDTO, configuration);\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      if (\n        isDefined(instance.secondaryAxisGroupByFieldMetadataId) &&\n        !isDefined(instance.groupMode)\n      ) {\n        instance.groupMode = BarChartGroupMode.STACKED;\n      }\n\n      return instance;\n    }\n    case GraphType.LINE: {\n      const instance = plainToInstance(\n        LineChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      if (\n        isDefined(instance.secondaryAxisGroupByFieldMetadataId) &&\n        !isDefined(instance.isStacked)\n      ) {\n        instance.isStacked = true;\n      }\n\n      return instance;\n    }\n    case GraphType.PIE: {\n      const instance = plainToInstance(PieChartConfigurationDTO, configuration);\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    case GraphType.AGGREGATE: {\n      const instance = plainToInstance(\n        AggregateChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    case GraphType.GAUGE: {\n      const instance = plainToInstance(\n        GaugeChartConfigurationDTO,\n        configuration,\n      );\n\n      const errors = validateSync(instance, {\n        whitelist: true,\n        forbidUnknownValues: true,\n      });\n\n      if (errors.length > 0) {\n        throw errors;\n      }\n\n      return instance;\n    }\n    default:\n      return null;\n  }\n};\n\nconst validateIframeConfiguration = (\n  configuration: unknown,\n): WidgetConfigurationInterface | null => {\n  const instance = plainToInstance(IframeConfigurationDTO, configuration);\n\n  const errors = validateSync(instance, {\n    whitelist: true,\n    forbidUnknownValues: true,\n  });\n\n  if (errors.length > 0) {\n    throw errors;\n  }\n\n  return instance;\n};\n\nconst validateStandaloneRichTextConfiguration = async (\n  configuration: unknown,\n): Promise<WidgetConfigurationInterface | null> => {\n  const instance = plainToInstance(\n    StandaloneRichTextConfigurationDTO,\n    configuration,\n  );\n\n  const errors = validateSync(instance, {\n    whitelist: true,\n    forbidUnknownValues: true,\n  });\n\n  if (errors.length > 0) {\n    throw errors;\n  }\n\n  if (instance.body) {\n    instance.body = await transformRichTextV2Value(instance.body);\n  }\n\n  return instance;\n};\n\nexport const validateAndTransformWidgetConfiguration = async ({\n  type,\n  configuration,\n  isDashboardV2Enabled,\n}: {\n  type: WidgetType;\n  configuration: unknown;\n  isDashboardV2Enabled: boolean;\n}): Promise<WidgetConfigurationInterface | null> => {\n  if (!configuration || typeof configuration !== 'object') {\n    throw new Error('Invalid configuration: not an object');\n  }\n\n  try {\n    switch (type) {\n      case WidgetType.GRAPH:\n        return validateGraphConfiguration({\n          configuration: configuration as Record<string, unknown>,\n          isDashboardV2Enabled,\n        });\n      case WidgetType.IFRAME:\n        return validateIframeConfiguration(configuration);\n      case WidgetType.STANDALONE_RICH_TEXT:\n        return await validateStandaloneRichTextConfiguration(configuration);\n      default:\n        return null;\n    }\n  } catch (error) {\n    if (Array.isArray(error)) {\n      const errorMessage = formatValidationErrors(error);\n\n      throw new Error(errorMessage);\n    }\n    throw error;\n  }\n};",
            "cost": 0.062515
        }
    },
    "recover_status": "success",
    "instance_ref": {
        "instance_id": "twentyhq__twenty.main.16166",
        "repo": "twentyhq/twenty",
        "base_commit": "eb362c6d5f65eb49c726a6a2eccb2603732b8957",
        "head_commit": "a91ba6dd0aa7cb1e592bad5a9e181fe1fc62638b",
        "title": "Release line chart and pie chart",
        "merged_at": "2025-11-28T10:17:04Z",
        "html_url": "https://github.com/twentyhq/twenty/pull/16166",
        "test_files": [
            "packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts"
        ],
        "code_files": [
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx",
            "packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts"
        ],
        "total_changes": 81,
        "num_files": 3,
        "pull_number": 16166,
        "patch": "diff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx\nindex 8657148271fd9..538a5020a7d91 100644\n--- a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/ChartTypeSelectionSection.tsx\n@@ -9,9 +9,9 @@ import { MenuPicker } from 'twenty-ui/navigation';\n const graphTypeOptions = [\n   GraphType.VERTICAL_BAR,\n   GraphType.HORIZONTAL_BAR,\n-  GraphType.AGGREGATE,\n-  GraphType.PIE,\n   GraphType.LINE,\n+  GraphType.PIE,\n+  GraphType.AGGREGATE,\n   GraphType.GAUGE,\n ];\n \n@@ -36,32 +36,25 @@ export const ChartTypeSelectionSection = ({\n \n   return (\n     <StyledChartTypeSelectionContainer>\n-      {graphTypeOptions.map((graphType) => {\n-        const isChartV2Type = [\n-          GraphType.PIE,\n-          GraphType.LINE,\n-          GraphType.GAUGE,\n-        ].includes(graphType);\n-\n-        const isDisabled = isChartV2Type && !isDashboardV2Enabled;\n-\n-        return (\n-          <MenuPicker\n-            id={graphType}\n-            selected={currentGraphType === graphType}\n-            key={graphType}\n-            icon={GRAPH_TYPE_INFORMATION[graphType].icon}\n-            onClick={() => {\n-              setCurrentGraphType(graphType);\n-            }}\n-            showLabel\n-            disabled={isDisabled}\n-            tooltipContent={\n-              isDisabled ? t`Soon` : t(GRAPH_TYPE_INFORMATION[graphType].label)\n-            }\n-          />\n-        );\n-      })}\n+      {graphTypeOptions\n+        .filter(\n+          (graphType) => isDashboardV2Enabled || graphType !== GraphType.GAUGE,\n+        )\n+        .map((graphType) => {\n+          return (\n+            <MenuPicker\n+              id={graphType}\n+              selected={currentGraphType === graphType}\n+              key={graphType}\n+              icon={GRAPH_TYPE_INFORMATION[graphType].icon}\n+              onClick={() => {\n+                setCurrentGraphType(graphType);\n+              }}\n+              showLabel\n+              tooltipContent={t(GRAPH_TYPE_INFORMATION[graphType].label)}\n+            />\n+          );\n+        })}\n     </StyledChartTypeSelectionContainer>\n   );\n };\ndiff --git a/packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts b/packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts\nindex f532f54f66db5..5000aaf463489 100644\n--- a/packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts\n+++ b/packages/twenty-server/src/engine/core-modules/page-layout/utils/__tests__/validate-and-transform-widget-configuration.util.spec.ts\n@@ -247,33 +247,35 @@ describe('validateAndTransformWidgetConfiguration', () => {\n   });\n \n   describe('Feature flags', () => {\n-    it('should throw error for unsupported graph type', () => {\n+    it('should throw error for GAUGE chart type when IS_DASHBOARD_V2_ENABLED is false', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n-          configuration: TEST_PIE_CHART_CONFIG,\n+          configuration: TEST_GAUGE_CHART_CONFIG,\n           isDashboardV2Enabled: false,\n         }),\n       ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n+    });\n \n+    it('should not throw error for GAUGE chart type when IS_DASHBOARD_V2_ENABLED is true', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n-          configuration: TEST_LINE_CHART_CONFIG,\n-          isDashboardV2Enabled: false,\n+          configuration: TEST_GAUGE_CHART_CONFIG,\n+          isDashboardV2Enabled: true,\n         }),\n-      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n+      ).not.toThrow();\n+    });\n \n+    it('should not throw error for PIE chart type regardless of IS_DASHBOARD_V2_ENABLED', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n-          configuration: TEST_GAUGE_CHART_CONFIG,\n+          configuration: TEST_PIE_CHART_CONFIG,\n           isDashboardV2Enabled: false,\n         }),\n-      ).toThrow(/IS_DASHBOARD_V2_ENABLED feature flag/);\n-    });\n+      ).not.toThrow();\n \n-    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n@@ -283,21 +285,19 @@ describe('validateAndTransformWidgetConfiguration', () => {\n       ).not.toThrow();\n     });\n \n-    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n+    it('should not throw error for LINE chart type regardless of IS_DASHBOARD_V2_ENABLED', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n           configuration: TEST_LINE_CHART_CONFIG,\n-          isDashboardV2Enabled: true,\n+          isDashboardV2Enabled: false,\n         }),\n       ).not.toThrow();\n-    });\n \n-    it('should not throw error when IS_DASHBOARD_V2_ENABLED feature flag is enabled', () => {\n       expect(() =>\n         validateAndTransformWidgetConfiguration({\n           type: WidgetType.GRAPH,\n-          configuration: TEST_GAUGE_CHART_CONFIG,\n+          configuration: TEST_LINE_CHART_CONFIG,\n           isDashboardV2Enabled: true,\n         }),\n       ).not.toThrow();\ndiff --git a/packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts b/packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts\nindex c511f669d75eb..68f8b17a28389 100644\n--- a/packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts\n+++ b/packages/twenty-server/src/engine/core-modules/page-layout/utils/validate-and-transform-widget-configuration.util.ts\n@@ -38,9 +38,7 @@ const validateGraphConfiguration = ({\n     return null;\n   }\n \n-  const v2ChartTypes = [GraphType.PIE, GraphType.LINE, GraphType.GAUGE];\n-\n-  if (v2ChartTypes.includes(graphType) && !isDashboardV2Enabled) {\n+  if (graphType === GraphType.GAUGE && !isDashboardV2Enabled) {\n     throw new Error(\n       `Chart type ${graphType} requires IS_DASHBOARD_V2_ENABLED feature flag`,\n     );\n",
        "pr_mirror": "twentyhq__twenty.main"
    }
}