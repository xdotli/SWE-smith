{
    "cost": 0.09583,
    "rewrites": {
        "twentyhq__twenty.main/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx": {
            "output": "import { ChartGroupByFieldSelectionCompositeFieldView } from '@/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionCompositeFieldView';\nimport { ChartGroupByFieldSelectionRelationFieldView } from '@/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionRelationFieldView';\nimport { usePageLayoutIdFromContextStoreTargetedRecord } from '@/command-menu/pages/page-layout/hooks/usePageLayoutFromContextStoreTargetedRecord';\nimport { useUpdateCurrentWidgetConfig } from '@/command-menu/pages/page-layout/hooks/useUpdateCurrentWidgetConfig';\nimport { useWidgetInEditMode } from '@/command-menu/pages/page-layout/hooks/useWidgetInEditMode';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { useObjectMetadataItems } from '@/object-metadata/hooks/useObjectMetadataItems';\nimport { type FieldMetadataItem } from '@/object-metadata/types/FieldMetadataItem';\nimport { isCompositeFieldType } from '@/object-record/object-filter-dropdown/utils/isCompositeFieldType';\nimport { isFieldRelation } from '@/object-record/record-field/ui/types/guards/isFieldRelation';\nimport { DropdownMenuItemsContainer } from '@/ui/layout/dropdown/components/DropdownMenuItemsContainer';\nimport { DropdownMenuSearchInput } from '@/ui/layout/dropdown/components/DropdownMenuSearchInput';\nimport { DropdownMenuSeparator } from '@/ui/layout/dropdown/components/DropdownMenuSeparator';\nimport { DropdownComponentInstanceContext } from '@/ui/layout/dropdown/contexts/DropdownComponentInstanceContext';\nimport { useCloseDropdown } from '@/ui/layout/dropdown/hooks/useCloseDropdown';\nimport { SelectableList } from '@/ui/layout/selectable-list/components/SelectableList';\nimport { SelectableListItem } from '@/ui/layout/selectable-list/components/SelectableListItem';\nimport { selectedItemIdComponentState } from '@/ui/layout/selectable-list/states/selectedItemIdComponentState';\nimport { useAvailableComponentInstanceIdOrThrow } from '@/ui/utilities/state/component-state/hooks/useAvailableComponentInstanceIdOrThrow';\nimport { useRecoilComponentValue } from '@/ui/utilities/state/component-state/hooks/useRecoilComponentValue';\nimport { t } from '@lingui/core/macro';\nimport { useMemo, useState } from 'react';\nimport { isDefined } from 'twenty-shared/utils';\nimport { useIcons } from 'twenty-ui/display';\nimport { MenuItemSelect } from 'twenty-ui/navigation';\nimport { BarChartGroupMode } from '~/generated/graphql';\nimport { filterBySearchQuery } from '~/utils/filterBySearchQuery';\n\ntype ChartGroupByFieldSelectionDropdownContentBaseProps<\n  T extends ChartConfiguration,\n> = {\n  fieldMetadataIdKey: keyof T;\n  subFieldNameKey: keyof T;\n};\n\nexport const ChartGroupByFieldSelectionDropdownContentBase = <\n  T extends ChartConfiguration,\n>({\n  fieldMetadataIdKey,\n  subFieldNameKey,\n}: ChartGroupByFieldSelectionDropdownContentBaseProps<T>) => {\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const [selectedCompositeField, setSelectedCompositeField] =\n    useState<FieldMetadataItem | null>(null);\n\n  const [selectedRelationField, setSelectedRelationField] =\n    useState<FieldMetadataItem | null>(null);\n\n  const { objectMetadataItems } = useObjectMetadataItems();\n\n  const { pageLayoutId } = usePageLayoutIdFromContextStoreTargetedRecord();\n\n  const { widgetInEditMode } = useWidgetInEditMode(pageLayoutId);\n\n  const configuration = widgetInEditMode?.configuration as T;\n\n  const currentGroupByFieldMetadataId = configuration?.[fieldMetadataIdKey] as\n    | string\n    | undefined;\n  const currentSubFieldName = configuration?.[subFieldNameKey] as\n    | string\n    | undefined;\n\n  const sourceObjectMetadataItem = objectMetadataItems.find(\n    (item) => item.id === widgetInEditMode?.objectMetadataId,\n  );\n\n  const dropdownId = useAvailableComponentInstanceIdOrThrow(\n    DropdownComponentInstanceContext,\n  );\n\n  const selectedItemId = useRecoilComponentValue(\n    selectedItemIdComponentState,\n    dropdownId,\n  );\n\n  const availableFieldMetadataItems = useMemo(\n    () =>\n      filterBySearchQuery({\n        items: sourceObjectMetadataItem?.fields || [],\n        searchQuery,\n        getSearchableValues: (item) => [item.label, item.name],\n      }).filter((field) => {\n        if (field.isSystem === true) {\n          return false;\n        }\n        if (isFieldRelation(field)) {\n          return field.relation?.type === RelationType.MANY_TO_ONE;\n        }\n        return true;\n      }),\n    [sourceObjectMetadataItem?.fields, searchQuery],\n  );\n\n  const { updateCurrentWidgetConfig } =\n    useUpdateCurrentWidgetConfig(pageLayoutId);\n\n  const { closeDropdown } = useCloseDropdown();\n\n  const { getIcon } = useIcons();\n\n  if (!isDefined(sourceObjectMetadataItem)) {\n    return null;\n  }\n\n  const buildConfigUpdate = (\n    fieldId: string | null,\n    subFieldName: string | null,\n  ) => {\n    const isSecondaryAxis =\n      fieldMetadataIdKey === 'secondaryAxisGroupByFieldMetadataId';\n    const baseConfig = {\n      [fieldMetadataIdKey]: fieldId,\n      [subFieldNameKey]: subFieldName,\n    };\n\n    if (!isSecondaryAxis) {\n      return baseConfig;\n    }\n\n    if (configuration.__typename === 'BarChartConfiguration') {\n      return {\n        ...baseConfig,\n        groupMode: isDefined(fieldId)\n          ? (configuration.groupMode ?? BarChartGroupMode.STACKED)\n          : null,\n      };\n    }\n\n    if (configuration.__typename === 'LineChartConfiguration') {\n      return {\n        ...baseConfig,\n        isStacked: isDefined(fieldId)\n          ? (configuration.isStacked ?? true)\n          : null,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  const handleSelectField = (fieldMetadataItem: FieldMetadataItem) => {\n    if (isFieldRelation(fieldMetadataItem)) {\n      setSelectedRelationField(fieldMetadataItem);\n      return;\n    }\n\n    if (isCompositeFieldType(fieldMetadataItem.type)) {\n      setSelectedCompositeField(fieldMetadataItem);\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(fieldMetadataItem.id, null),\n    });\n    closeDropdown();\n  };\n\n  const handleSelectNone = () => {\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(null, null),\n    });\n    closeDropdown();\n  };\n\n  const handleBackFromComposite = () => {\n    setSelectedCompositeField(null);\n  };\n\n  const handleBackFromRelation = () => {\n    setSelectedRelationField(null);\n  };\n\n  const handleSelectCompositeSubField = (subFieldName: string) => {\n    if (!isDefined(selectedCompositeField)) {\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(\n        selectedCompositeField.id,\n        subFieldName,\n      ),\n    });\n    closeDropdown();\n  };\n\n  const handleSelectRelationSubField = (subFieldName: string) => {\n    if (!isDefined(selectedRelationField)) {\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildChartGroupByFieldConfigUpdate({\n        configuration,\n        fieldMetadataIdKey,\n        subFieldNameKey,\n        fieldId: selectedRelationField.id,\n        subFieldName,\n        objectMetadataItem: sourceObjectMetadataItem,\n        objectMetadataItems,\n      }),\n    });\n    closeDropdown();\n  };\n\n  if (isDefined(selectedRelationField)) {\n    return (\n      <ChartGroupByFieldSelectionRelationFieldView\n        relationField={selectedRelationField}\n        currentSubFieldName={currentSubFieldName}\n        onBack={handleBackFromRelation}\n        onSelectSubField={handleSelectRelationSubField}\n      />\n    );\n  }\n\n  if (isDefined(selectedCompositeField)) {\n    return (\n      <ChartGroupByFieldSelectionCompositeFieldView\n        compositeField={selectedCompositeField}\n        currentSubFieldName={currentSubFieldName}\n        onBack={handleBackFromComposite}\n        onSelectSubField={handleSelectCompositeSubField}\n      />\n    );\n  }\n\n  return (\n    <>\n      <DropdownMenuSearchInput\n        autoFocus\n        type=\"text\"\n        placeholder={t`Search fields`}\n        onChange={(event) => setSearchQuery(event.target.value)}\n        value={searchQuery}\n      />\n      <DropdownMenuSeparator />\n      <DropdownMenuItemsContainer>\n        <SelectableList\n          selectableListInstanceId={dropdownId}\n          focusId={dropdownId}\n          selectableItemIdArray={[\n            'none',\n            ...availableFieldMetadataItems.map((item) => item.id),\n          ]}\n        >\n          <SelectableListItem itemId=\"none\" onEnter={handleSelectNone}>\n            <MenuItemSelect\n              text={t`None`}\n              selected={!isDefined(currentGroupByFieldMetadataId)}\n              focused={selectedItemId === 'none'}\n              onClick={handleSelectNone}\n            />\n          </SelectableListItem>\n\n          {availableFieldMetadataItems.map((fieldMetadataItem) => (\n            <SelectableListItem\n              key={fieldMetadataItem.id}\n              itemId={fieldMetadataItem.id}\n              onEnter={() => {\n                handleSelectField(fieldMetadataItem);\n              }}\n            >\n              <MenuItemSelect\n                text={fieldMetadataItem.label}\n                selected={\n                  !isCompositeFieldType(fieldMetadataItem.type) &&\n                  !isFieldRelation(fieldMetadataItem) &&\n                  currentGroupByFieldMetadataId === fieldMetadataItem.id\n                }\n                focused={selectedItemId === fieldMetadataItem.id}\n                LeftIcon={getIcon(fieldMetadataItem.icon)}\n                hasSubMenu={\n                  isCompositeFieldType(fieldMetadataItem.type) ||\n                  isFieldRelation(fieldMetadataItem)\n                }\n                onClick={() => {\n                  handleSelectField(fieldMetadataItem);\n                }}\n              />\n            </SelectableListItem>\n          ))}\n        </SelectableList>\n      </DropdownMenuItemsContainer>\n    </>\n  );\n};",
            "output_extracted": "import { ChartGroupByFieldSelectionCompositeFieldView } from '@/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionCompositeFieldView';\nimport { ChartGroupByFieldSelectionRelationFieldView } from '@/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionRelationFieldView';\nimport { usePageLayoutIdFromContextStoreTargetedRecord } from '@/command-menu/pages/page-layout/hooks/usePageLayoutFromContextStoreTargetedRecord';\nimport { useUpdateCurrentWidgetConfig } from '@/command-menu/pages/page-layout/hooks/useUpdateCurrentWidgetConfig';\nimport { useWidgetInEditMode } from '@/command-menu/pages/page-layout/hooks/useWidgetInEditMode';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { useObjectMetadataItems } from '@/object-metadata/hooks/useObjectMetadataItems';\nimport { type FieldMetadataItem } from '@/object-metadata/types/FieldMetadataItem';\nimport { isCompositeFieldType } from '@/object-record/object-filter-dropdown/utils/isCompositeFieldType';\nimport { isFieldRelation } from '@/object-record/record-field/ui/types/guards/isFieldRelation';\nimport { DropdownMenuItemsContainer } from '@/ui/layout/dropdown/components/DropdownMenuItemsContainer';\nimport { DropdownMenuSearchInput } from '@/ui/layout/dropdown/components/DropdownMenuSearchInput';\nimport { DropdownMenuSeparator } from '@/ui/layout/dropdown/components/DropdownMenuSeparator';\nimport { DropdownComponentInstanceContext } from '@/ui/layout/dropdown/contexts/DropdownComponentInstanceContext';\nimport { useCloseDropdown } from '@/ui/layout/dropdown/hooks/useCloseDropdown';\nimport { SelectableList } from '@/ui/layout/selectable-list/components/SelectableList';\nimport { SelectableListItem } from '@/ui/layout/selectable-list/components/SelectableListItem';\nimport { selectedItemIdComponentState } from '@/ui/layout/selectable-list/states/selectedItemIdComponentState';\nimport { useAvailableComponentInstanceIdOrThrow } from '@/ui/utilities/state/component-state/hooks/useAvailableComponentInstanceIdOrThrow';\nimport { useRecoilComponentValue } from '@/ui/utilities/state/component-state/hooks/useRecoilComponentValue';\nimport { t } from '@lingui/core/macro';\nimport { useMemo, useState } from 'react';\nimport { isDefined } from 'twenty-shared/utils';\nimport { useIcons } from 'twenty-ui/display';\nimport { MenuItemSelect } from 'twenty-ui/navigation';\nimport { BarChartGroupMode } from '~/generated/graphql';\nimport { filterBySearchQuery } from '~/utils/filterBySearchQuery';\n\ntype ChartGroupByFieldSelectionDropdownContentBaseProps<\n  T extends ChartConfiguration,\n> = {\n  fieldMetadataIdKey: keyof T;\n  subFieldNameKey: keyof T;\n};\n\nexport const ChartGroupByFieldSelectionDropdownContentBase = <\n  T extends ChartConfiguration,\n>({\n  fieldMetadataIdKey,\n  subFieldNameKey,\n}: ChartGroupByFieldSelectionDropdownContentBaseProps<T>) => {\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const [selectedCompositeField, setSelectedCompositeField] =\n    useState<FieldMetadataItem | null>(null);\n\n  const [selectedRelationField, setSelectedRelationField] =\n    useState<FieldMetadataItem | null>(null);\n\n  const { objectMetadataItems } = useObjectMetadataItems();\n\n  const { pageLayoutId } = usePageLayoutIdFromContextStoreTargetedRecord();\n\n  const { widgetInEditMode } = useWidgetInEditMode(pageLayoutId);\n\n  const configuration = widgetInEditMode?.configuration as T;\n\n  const currentGroupByFieldMetadataId = configuration?.[fieldMetadataIdKey] as\n    | string\n    | undefined;\n  const currentSubFieldName = configuration?.[subFieldNameKey] as\n    | string\n    | undefined;\n\n  const sourceObjectMetadataItem = objectMetadataItems.find(\n    (item) => item.id === widgetInEditMode?.objectMetadataId,\n  );\n\n  const dropdownId = useAvailableComponentInstanceIdOrThrow(\n    DropdownComponentInstanceContext,\n  );\n\n  const selectedItemId = useRecoilComponentValue(\n    selectedItemIdComponentState,\n    dropdownId,\n  );\n\n  const availableFieldMetadataItems = useMemo(\n    () =>\n      filterBySearchQuery({\n        items: sourceObjectMetadataItem?.fields || [],\n        searchQuery,\n        getSearchableValues: (item) => [item.label, item.name],\n      }).filter((field) => {\n        if (field.isSystem === true) {\n          return false;\n        }\n        if (isFieldRelation(field)) {\n          return field.relation?.type === RelationType.MANY_TO_ONE;\n        }\n        return true;\n      }),\n    [sourceObjectMetadataItem?.fields, searchQuery],\n  );\n\n  const { updateCurrentWidgetConfig } =\n    useUpdateCurrentWidgetConfig(pageLayoutId);\n\n  const { closeDropdown } = useCloseDropdown();\n\n  const { getIcon } = useIcons();\n\n  if (!isDefined(sourceObjectMetadataItem)) {\n    return null;\n  }\n\n  const buildConfigUpdate = (\n    fieldId: string | null,\n    subFieldName: string | null,\n  ) => {\n    const isSecondaryAxis =\n      fieldMetadataIdKey === 'secondaryAxisGroupByFieldMetadataId';\n    const baseConfig = {\n      [fieldMetadataIdKey]: fieldId,\n      [subFieldNameKey]: subFieldName,\n    };\n\n    if (!isSecondaryAxis) {\n      return baseConfig;\n    }\n\n    if (configuration.__typename === 'BarChartConfiguration') {\n      return {\n        ...baseConfig,\n        groupMode: isDefined(fieldId)\n          ? (configuration.groupMode ?? BarChartGroupMode.STACKED)\n          : null,\n      };\n    }\n\n    if (configuration.__typename === 'LineChartConfiguration') {\n      return {\n        ...baseConfig,\n        isStacked: isDefined(fieldId)\n          ? (configuration.isStacked ?? true)\n          : null,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  const handleSelectField = (fieldMetadataItem: FieldMetadataItem) => {\n    if (isFieldRelation(fieldMetadataItem)) {\n      setSelectedRelationField(fieldMetadataItem);\n      return;\n    }\n\n    if (isCompositeFieldType(fieldMetadataItem.type)) {\n      setSelectedCompositeField(fieldMetadataItem);\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(fieldMetadataItem.id, null),\n    });\n    closeDropdown();\n  };\n\n  const handleSelectNone = () => {\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(null, null),\n    });\n    closeDropdown();\n  };\n\n  const handleBackFromComposite = () => {\n    setSelectedCompositeField(null);\n  };\n\n  const handleBackFromRelation = () => {\n    setSelectedRelationField(null);\n  };\n\n  const handleSelectCompositeSubField = (subFieldName: string) => {\n    if (!isDefined(selectedCompositeField)) {\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildConfigUpdate(\n        selectedCompositeField.id,\n        subFieldName,\n      ),\n    });\n    closeDropdown();\n  };\n\n  const handleSelectRelationSubField = (subFieldName: string) => {\n    if (!isDefined(selectedRelationField)) {\n      return;\n    }\n\n    updateCurrentWidgetConfig({\n      configToUpdate: buildChartGroupByFieldConfigUpdate({\n        configuration,\n        fieldMetadataIdKey,\n        subFieldNameKey,\n        fieldId: selectedRelationField.id,\n        subFieldName,\n        objectMetadataItem: sourceObjectMetadataItem,\n        objectMetadataItems,\n      }),\n    });\n    closeDropdown();\n  };\n\n  if (isDefined(selectedRelationField)) {\n    return (\n      <ChartGroupByFieldSelectionRelationFieldView\n        relationField={selectedRelationField}\n        currentSubFieldName={currentSubFieldName}\n        onBack={handleBackFromRelation}\n        onSelectSubField={handleSelectRelationSubField}\n      />\n    );\n  }\n\n  if (isDefined(selectedCompositeField)) {\n    return (\n      <ChartGroupByFieldSelectionCompositeFieldView\n        compositeField={selectedCompositeField}\n        currentSubFieldName={currentSubFieldName}\n        onBack={handleBackFromComposite}\n        onSelectSubField={handleSelectCompositeSubField}\n      />\n    );\n  }\n\n  return (\n    <>\n      <DropdownMenuSearchInput\n        autoFocus\n        type=\"text\"\n        placeholder={t`Search fields`}\n        onChange={(event) => setSearchQuery(event.target.value)}\n        value={searchQuery}\n      />\n      <DropdownMenuSeparator />\n      <DropdownMenuItemsContainer>\n        <SelectableList\n          selectableListInstanceId={dropdownId}\n          focusId={dropdownId}\n          selectableItemIdArray={[\n            'none',\n            ...availableFieldMetadataItems.map((item) => item.id),\n          ]}\n        >\n          <SelectableListItem itemId=\"none\" onEnter={handleSelectNone}>\n            <MenuItemSelect\n              text={t`None`}\n              selected={!isDefined(currentGroupByFieldMetadataId)}\n              focused={selectedItemId === 'none'}\n              onClick={handleSelectNone}\n            />\n          </SelectableListItem>\n\n          {availableFieldMetadataItems.map((fieldMetadataItem) => (\n            <SelectableListItem\n              key={fieldMetadataItem.id}\n              itemId={fieldMetadataItem.id}\n              onEnter={() => {\n                handleSelectField(fieldMetadataItem);\n              }}\n            >\n              <MenuItemSelect\n                text={fieldMetadataItem.label}\n                selected={\n                  !isCompositeFieldType(fieldMetadataItem.type) &&\n                  !isFieldRelation(fieldMetadataItem) &&\n                  currentGroupByFieldMetadataId === fieldMetadataItem.id\n                }\n                focused={selectedItemId === fieldMetadataItem.id}\n                LeftIcon={getIcon(fieldMetadataItem.icon)}\n                hasSubMenu={\n                  isCompositeFieldType(fieldMetadataItem.type) ||\n                  isFieldRelation(fieldMetadataItem)\n                }\n                onClick={() => {\n                  handleSelectField(fieldMetadataItem);\n                }}\n              />\n            </SelectableListItem>\n          ))}\n        </SelectableList>\n      </DropdownMenuItemsContainer>\n    </>\n  );\n};",
            "cost": 0.09583
        }
    },
    "recover_status": "success",
    "instance_ref": {
        "instance_id": "twentyhq__twenty.main.16143",
        "repo": "twentyhq/twenty",
        "base_commit": "65480eb49250765e3b788147fb08d4a950f15496",
        "head_commit": "7cc2cdc1fe95840d596927ed2a177108b87fb4f8",
        "title": "[DASHBOARDS] Add default order by and date granularity when choosing field",
        "merged_at": "2025-11-27T15:13:06Z",
        "html_url": "https://github.com/twentyhq/twenty/pull/16143",
        "test_files": [
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/buildChartGroupByFieldConfigUpdate.test.ts"
        ],
        "code_files": [
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx",
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/buildChartGroupByFieldConfigUpdate.ts"
        ],
        "total_changes": 251,
        "num_files": 3,
        "pull_number": 16143,
        "patch": "diff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx\nindex 95ecff89643c4..f6aa974cc6547 100644\n--- a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/dropdown-content/ChartGroupByFieldSelectionDropdownContentBase.tsx\n@@ -3,6 +3,7 @@ import { usePageLayoutIdFromContextStoreTargetedRecord } from '@/command-menu/pa\n import { useUpdateCurrentWidgetConfig } from '@/command-menu/pages/page-layout/hooks/useUpdateCurrentWidgetConfig';\n import { useWidgetInEditMode } from '@/command-menu/pages/page-layout/hooks/useWidgetInEditMode';\n import { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\n+import { buildChartGroupByFieldConfigUpdate } from '@/command-menu/pages/page-layout/utils/buildChartGroupByFieldConfigUpdate';\n import { useObjectMetadataItems } from '@/object-metadata/hooks/useObjectMetadataItems';\n import { type FieldMetadataItem } from '@/object-metadata/types/FieldMetadataItem';\n import { isCompositeFieldType } from '@/object-record/object-filter-dropdown/utils/isCompositeFieldType';\n@@ -22,7 +23,6 @@ import { useMemo, useState } from 'react';\n import { isDefined } from 'twenty-shared/utils';\n import { useIcons } from 'twenty-ui/display';\n import { MenuItemSelect } from 'twenty-ui/navigation';\n-import { BarChartGroupMode } from '~/generated/graphql';\n import { filterBySearchQuery } from '~/utils/filterBySearchQuery';\n \n type ChartGroupByFieldSelectionDropdownContentBaseProps<\n@@ -93,48 +93,18 @@ export const ChartGroupByFieldSelectionDropdownContentBase = <\n     return null;\n   }\n \n-  const buildConfigUpdate = (\n-    fieldId: string | null,\n-    subFieldName: string | null,\n-  ) => {\n-    const isSecondaryAxis =\n-      fieldMetadataIdKey === 'secondaryAxisGroupByFieldMetadataId';\n-    const baseConfig = {\n-      [fieldMetadataIdKey]: fieldId,\n-      [subFieldNameKey]: subFieldName,\n-    };\n-\n-    if (!isSecondaryAxis) {\n-      return baseConfig;\n-    }\n-\n-    if (configuration.__typename === 'BarChartConfiguration') {\n-      return {\n-        ...baseConfig,\n-        groupMode: isDefined(fieldId)\n-          ? (configuration.groupMode ?? BarChartGroupMode.STACKED)\n-          : null,\n-      };\n-    }\n-\n-    if (configuration.__typename === 'LineChartConfiguration') {\n-      return {\n-        ...baseConfig,\n-        isStacked: isDefined(fieldId)\n-          ? (configuration.isStacked ?? true)\n-          : null,\n-      };\n-    }\n-\n-    return baseConfig;\n-  };\n-\n   const handleSelectField = (fieldMetadataItem: FieldMetadataItem) => {\n     if (isCompositeFieldType(fieldMetadataItem.type)) {\n       setSelectedCompositeField(fieldMetadataItem);\n     } else {\n       updateCurrentWidgetConfig({\n-        configToUpdate: buildConfigUpdate(fieldMetadataItem.id, null),\n+        configToUpdate: buildChartGroupByFieldConfigUpdate({\n+          configuration,\n+          fieldMetadataIdKey,\n+          subFieldNameKey,\n+          fieldId: fieldMetadataItem.id,\n+          subFieldName: null,\n+        }),\n       });\n       closeDropdown();\n     }\n@@ -142,7 +112,13 @@ export const ChartGroupByFieldSelectionDropdownContentBase = <\n \n   const handleSelectNone = () => {\n     updateCurrentWidgetConfig({\n-      configToUpdate: buildConfigUpdate(null, null),\n+      configToUpdate: buildChartGroupByFieldConfigUpdate({\n+        configuration,\n+        fieldMetadataIdKey,\n+        subFieldNameKey,\n+        fieldId: null,\n+        subFieldName: null,\n+      }),\n     });\n     closeDropdown();\n   };\n@@ -157,10 +133,13 @@ export const ChartGroupByFieldSelectionDropdownContentBase = <\n     }\n \n     updateCurrentWidgetConfig({\n-      configToUpdate: buildConfigUpdate(\n-        selectedCompositeField.id,\n+      configToUpdate: buildChartGroupByFieldConfigUpdate({\n+        configuration,\n+        fieldMetadataIdKey,\n+        subFieldNameKey,\n+        fieldId: selectedCompositeField.id,\n         subFieldName,\n-      ),\n+      }),\n     });\n     closeDropdown();\n   };\ndiff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/buildChartGroupByFieldConfigUpdate.test.ts b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/buildChartGroupByFieldConfigUpdate.test.ts\nnew file mode 100644\nindex 0000000000000..4ee5811ae3743\n--- /dev/null\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/buildChartGroupByFieldConfigUpdate.test.ts\n@@ -0,0 +1,77 @@\n+import { ObjectRecordGroupByDateGranularity } from 'twenty-shared/types';\n+import {\n+  type BarChartConfiguration,\n+  BarChartGroupMode,\n+  GraphOrderBy,\n+  type PieChartConfiguration,\n+} from '~/generated/graphql';\n+import { buildChartGroupByFieldConfigUpdate } from '../buildChartGroupByFieldConfigUpdate';\n+\n+describe('buildChartGroupByFieldConfigUpdate', () => {\n+  it('sets default orderBy and dateGranularity for primary axis', () => {\n+    const result = buildChartGroupByFieldConfigUpdate({\n+      configuration: {\n+        __typename: 'BarChartConfiguration',\n+      } as BarChartConfiguration,\n+      fieldMetadataIdKey: 'primaryAxisGroupByFieldMetadataId',\n+      subFieldNameKey: 'primaryAxisGroupBySubFieldName',\n+      fieldId: 'field',\n+      subFieldName: null,\n+    });\n+\n+    expect(result).toMatchObject({\n+      primaryAxisOrderBy: GraphOrderBy.FIELD_ASC,\n+      primaryAxisDateGranularity: ObjectRecordGroupByDateGranularity.DAY,\n+    });\n+  });\n+\n+  it('clears orderBy and dateGranularity when primary axis fieldId is null', () => {\n+    const result = buildChartGroupByFieldConfigUpdate({\n+      configuration: {\n+        __typename: 'BarChartConfiguration',\n+      } as BarChartConfiguration,\n+      fieldMetadataIdKey: 'primaryAxisGroupByFieldMetadataId',\n+      subFieldNameKey: 'primaryAxisGroupBySubFieldName',\n+      fieldId: null,\n+      subFieldName: null,\n+    });\n+\n+    expect(result).toMatchObject({\n+      primaryAxisOrderBy: null,\n+      primaryAxisDateGranularity: null,\n+    });\n+  });\n+\n+  it('sets groupMode for bar chart secondary axis', () => {\n+    const result = buildChartGroupByFieldConfigUpdate({\n+      configuration: {\n+        __typename: 'BarChartConfiguration',\n+      } as BarChartConfiguration,\n+      fieldMetadataIdKey: 'secondaryAxisGroupByFieldMetadataId',\n+      subFieldNameKey: 'secondaryAxisGroupBySubFieldName',\n+      fieldId: 'field',\n+      subFieldName: null,\n+    });\n+\n+    expect(result).toMatchObject({\n+      groupMode: BarChartGroupMode.STACKED,\n+    });\n+  });\n+\n+  it('sets orderBy and dateGranularity for pie chart groupBy', () => {\n+    const result = buildChartGroupByFieldConfigUpdate({\n+      configuration: {\n+        __typename: 'PieChartConfiguration',\n+      } as PieChartConfiguration,\n+      fieldMetadataIdKey: 'groupByFieldMetadataId',\n+      subFieldNameKey: 'groupBySubFieldName',\n+      fieldId: 'field',\n+      subFieldName: null,\n+    });\n+\n+    expect(result).toMatchObject({\n+      orderBy: GraphOrderBy.FIELD_ASC,\n+      dateGranularity: ObjectRecordGroupByDateGranularity.DAY,\n+    });\n+  });\n+});\ndiff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/buildChartGroupByFieldConfigUpdate.ts b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/buildChartGroupByFieldConfigUpdate.ts\nnew file mode 100644\nindex 0000000000000..2898eb9060419\n--- /dev/null\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/buildChartGroupByFieldConfigUpdate.ts\n@@ -0,0 +1,111 @@\n+import { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\n+import { ObjectRecordGroupByDateGranularity } from 'twenty-shared/types';\n+import { isDefined } from 'twenty-shared/utils';\n+import { BarChartGroupMode, GraphOrderBy } from '~/generated/graphql';\n+\n+type BuildChartGroupByFieldConfigUpdateArgs<T extends ChartConfiguration> = {\n+  configuration: T;\n+  fieldMetadataIdKey: keyof T;\n+  subFieldNameKey: keyof T;\n+  fieldId: string | null;\n+  subFieldName: string | null;\n+};\n+\n+export const buildChartGroupByFieldConfigUpdate = <\n+  T extends ChartConfiguration,\n+>({\n+  configuration,\n+  fieldMetadataIdKey,\n+  subFieldNameKey,\n+  fieldId,\n+  subFieldName,\n+}: BuildChartGroupByFieldConfigUpdateArgs<T>) => {\n+  const isPrimaryAxis =\n+    fieldMetadataIdKey === 'primaryAxisGroupByFieldMetadataId';\n+  const isSecondaryAxis =\n+    fieldMetadataIdKey === 'secondaryAxisGroupByFieldMetadataId';\n+  const isPieChartGroupBy = fieldMetadataIdKey === 'groupByFieldMetadataId';\n+\n+  const baseConfig = {\n+    [fieldMetadataIdKey]: fieldId,\n+    [subFieldNameKey]: subFieldName,\n+  };\n+\n+  const isBarChart = configuration.__typename === 'BarChartConfiguration';\n+  const isLineChart = configuration.__typename === 'LineChartConfiguration';\n+  const isPieChart = configuration.__typename === 'PieChartConfiguration';\n+\n+  if (isPrimaryAxis) {\n+    const existingOrderBy =\n+      isBarChart || isLineChart ? configuration.primaryAxisOrderBy : null;\n+\n+    const existingDateGranularity =\n+      isBarChart || isLineChart\n+        ? configuration.primaryAxisDateGranularity\n+        : null;\n+\n+    return {\n+      ...baseConfig,\n+      primaryAxisOrderBy: isDefined(fieldId)\n+        ? (existingOrderBy ?? GraphOrderBy.FIELD_ASC)\n+        : null,\n+      primaryAxisDateGranularity: isDefined(fieldId)\n+        ? (existingDateGranularity ?? ObjectRecordGroupByDateGranularity.DAY)\n+        : null,\n+    };\n+  }\n+\n+  if (isPieChartGroupBy) {\n+    const existingOrderBy = isPieChart ? configuration.orderBy : null;\n+\n+    const existingDateGranularity = isPieChart\n+      ? configuration.dateGranularity\n+      : null;\n+\n+    return {\n+      ...baseConfig,\n+      orderBy: isDefined(fieldId)\n+        ? (existingOrderBy ?? GraphOrderBy.FIELD_ASC)\n+        : null,\n+      dateGranularity: isDefined(fieldId)\n+        ? (existingDateGranularity ?? ObjectRecordGroupByDateGranularity.DAY)\n+        : null,\n+    };\n+  }\n+\n+  if (!isSecondaryAxis) {\n+    return baseConfig;\n+  }\n+\n+  if (isBarChart) {\n+    return {\n+      ...baseConfig,\n+      secondaryAxisOrderBy: isDefined(fieldId)\n+        ? (configuration.secondaryAxisOrderBy ?? GraphOrderBy.FIELD_ASC)\n+        : null,\n+      secondaryAxisGroupByDateGranularity: isDefined(fieldId)\n+        ? (configuration.secondaryAxisGroupByDateGranularity ??\n+          ObjectRecordGroupByDateGranularity.DAY)\n+        : null,\n+      groupMode: isDefined(fieldId)\n+        ? (configuration.groupMode ?? BarChartGroupMode.STACKED)\n+        : null,\n+    };\n+  }\n+\n+  if (isLineChart) {\n+    return {\n+      ...baseConfig,\n+      secondaryAxisOrderBy: isDefined(fieldId)\n+        ? (configuration.secondaryAxisOrderBy ?? GraphOrderBy.FIELD_ASC)\n+        : null,\n+      secondaryAxisGroupByDateGranularity: isDefined(fieldId)\n+        ? (configuration.secondaryAxisGroupByDateGranularity ??\n+          ObjectRecordGroupByDateGranularity.DAY)\n+        : null,\n+      isStacked: isDefined(fieldId) ? (configuration.isStacked ?? true) : null,\n+    };\n+  }\n+\n+  return baseConfig;\n+};\n",
        "pr_mirror": "twentyhq__twenty.main"
    }
}