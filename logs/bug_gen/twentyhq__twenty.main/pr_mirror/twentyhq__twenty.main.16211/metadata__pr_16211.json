{
    "cost": 0.310645,
    "rewrites": {
        "twentyhq__twenty.main/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx": {
            "output": "import { CommandMenuItem } from '@/command-menu/components/CommandMenuItem';\nimport { CommandMenuItemDropdown } from '@/command-menu/components/CommandMenuItemDropdown';\nimport { CommandMenuItemNumberInput } from '@/command-menu/components/CommandMenuItemNumberInput';\nimport { CommandMenuItemTextInput } from '@/command-menu/components/CommandMenuItemTextInput';\nimport { CommandMenuItemToggle } from '@/command-menu/components/CommandMenuItemToggle';\nimport { COMMAND_MENU_LIST_SELECTABLE_LIST_ID } from '@/command-menu/constants/CommandMenuListSelectableListId';\nimport { useChartSettingsValues } from '@/command-menu/pages/page-layout/hooks/useChartSettingsValues';\nimport { useNavigatePageLayoutCommandMenu } from '@/command-menu/pages/page-layout/hooks/useNavigatePageLayoutCommandMenu';\nimport { usePageLayoutIdFromContextStoreTargetedRecord } from '@/command-menu/pages/page-layout/hooks/usePageLayoutFromContextStoreTargetedRecord';\nimport { useUpdateChartSettingInput } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingInput';\nimport { useUpdateChartSettingTextInput } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingTextInput';\nimport { useUpdateChartSettingToggle } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingToggle';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { CHART_CONFIGURATION_SETTING_IDS } from '@/command-menu/pages/page-layout/types/ChartConfigurationSettingIds';\nimport { type ChartSettingsItem } from '@/command-menu/pages/page-layout/types/ChartSettingsGroup';\nimport { isMinMaxRangeValid } from '@/command-menu/pages/page-layout/utils/isMinMaxRangeValid';\nimport { CommandMenuPages } from '@/command-menu/types/CommandMenuPages';\nimport { DropdownContent } from '@/ui/layout/dropdown/components/DropdownContent';\nimport { useOpenDropdown } from '@/ui/layout/dropdown/hooks/useOpenDropdown';\nimport { SelectableListItem } from '@/ui/layout/selectable-list/components/SelectableListItem';\nimport { useSelectableList } from '@/ui/layout/selectable-list/hooks/useSelectableList';\nimport { t } from '@lingui/core/macro';\nimport { isString } from '@sniptt/guards';\nimport { isDefined } from 'twenty-shared/utils';\n\ntype ChartSettingItemProps = {\n  item: ChartSettingsItem;\n  objectMetadataId: string;\n  configuration: ChartConfiguration;\n};\n\nexport const ChartSettingItem = ({\n  item,\n  objectMetadataId,\n  configuration,\n}: ChartSettingItemProps) => {\n  const { pageLayoutId } = usePageLayoutIdFromContextStoreTargetedRecord();\n  const { openDropdown } = useOpenDropdown();\n  const { setSelectedItemId } = useSelectableList(\n    COMMAND_MENU_LIST_SELECTABLE_LIST_ID,\n  );\n  const { navigatePageLayoutCommandMenu } = useNavigatePageLayoutCommandMenu();\n\n  const { getChartSettingsValues } = useChartSettingsValues({\n    objectMetadataId,\n    configuration,\n  });\n\n  const { updateChartSettingToggle } = useUpdateChartSettingToggle({\n    pageLayoutId,\n    objectMetadataId,\n    configuration,\n  });\n\n  const { updateChartSettingInput } = useUpdateChartSettingInput(pageLayoutId);\n\n  const { updateChartSettingTextInput } =\n    useUpdateChartSettingTextInput(pageLayoutId);\n\n  const handleToggleChange = () => {\n    setSelectedItemId(item.id);\n    updateChartSettingToggle(item.id);\n  };\n\n  const handleInputChange = (value: number | null) => {\n    updateChartSettingInput(item.id, value);\n  };\n\n  const handleTextInputChange = (value: string) => {\n    updateChartSettingTextInput(item.id, value);\n  };\n\n  const handleDropdownOpen = () => {\n    openDropdown({\n      dropdownComponentInstanceIdFromProps: item.id,\n    });\n  };\n\n  const handleFilterClick = () => {\n    navigatePageLayoutCommandMenu({\n      commandMenuPage: CommandMenuPages.PageLayoutGraphFilter,\n    });\n  };\n  if (item.id === CHART_CONFIGURATION_SETTING_IDS.FILTER) {\n    return (\n      <SelectableListItem\n        key={item.id}\n        itemId={item.id}\n        onEnter={handleFilterClick}\n      >\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          hasSubMenu\n          onClick={handleFilterClick}\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (isDefined(item.isNumberInput)) {\n    const settingValue = getChartSettingsValues(item.id);\n    const stringValue = isString(settingValue) ? settingValue : '';\n\n    return (\n      <SelectableListItem key={item.id} itemId={item.id}>\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          RightComponent={\n            <CommandMenuItemNumberInput\n              value={stringValue}\n              onChange={handleInputChange}\n              onValidate={(value) =>\n                !isDefined(value) ||\n                isMinMaxRangeValid(\n                  item.id as\n                    | CHART_CONFIGURATION_SETTING_IDS.MIN_RANGE\n                    | CHART_CONFIGURATION_SETTING_IDS.MAX_RANGE,\n                  value,\n                  configuration,\n                )\n              }\n              placeholder={\n                item.inputPlaceholder ? t(item.inputPlaceholder) : undefined\n              }\n            />\n          }\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (isDefined(item.isTextInput)) {\n    const settingValue = getChartSettingsValues(item.id);\n    const stringValue = isString(settingValue) ? settingValue : '';\n\n    return (\n      <SelectableListItem key={item.id} itemId={item.id}>\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          RightComponent={\n            <CommandMenuItemTextInput\n              value={stringValue}\n              onChange={handleTextInputChange}\n              placeholder={\n                item.inputPlaceholder ? t(item.inputPlaceholder) : undefined\n              }\n            />\n          }\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (item.isBoolean) {\n    return (\n      <SelectableListItem\n        key={item.id}\n        itemId={item.id}\n        onEnter={handleToggleChange}\n      >\n        <CommandMenuItemToggle\n          LeftIcon={item.Icon}\n          text={t(item.label)}\n          id={item.id}\n          toggled={getChartSettingsValues(item.id) as boolean}\n          onToggleChange={handleToggleChange}\n        />\n      </SelectableListItem>\n    );\n  }\n\n  return (\n    <SelectableListItem\n      key={item.id}\n      itemId={item.id}\n      onEnter={handleDropdownOpen}\n    >\n      <CommandMenuItemDropdown\n        Icon={item.Icon}\n        label={t(item.label)}\n        id={item.id}\n        dropdownId={item.id}\n        dropdownComponents={\n          <DropdownContent widthInPixels={item.dropdownWidth}>\n            {item.DropdownContent && <item.DropdownContent />}\n          </DropdownContent>\n        }\n        dropdownPlacement=\"bottom-end\"\n        description={getChartSettingsValues(item.id) as string}\n        contextualTextPosition={'right'}\n        hasSubMenu\n      />\n    </SelectableListItem>\n  );\n};",
            "output_extracted": "import { CommandMenuItem } from '@/command-menu/components/CommandMenuItem';\nimport { CommandMenuItemDropdown } from '@/command-menu/components/CommandMenuItemDropdown';\nimport { CommandMenuItemNumberInput } from '@/command-menu/components/CommandMenuItemNumberInput';\nimport { CommandMenuItemTextInput } from '@/command-menu/components/CommandMenuItemTextInput';\nimport { CommandMenuItemToggle } from '@/command-menu/components/CommandMenuItemToggle';\nimport { COMMAND_MENU_LIST_SELECTABLE_LIST_ID } from '@/command-menu/constants/CommandMenuListSelectableListId';\nimport { useChartSettingsValues } from '@/command-menu/pages/page-layout/hooks/useChartSettingsValues';\nimport { useNavigatePageLayoutCommandMenu } from '@/command-menu/pages/page-layout/hooks/useNavigatePageLayoutCommandMenu';\nimport { usePageLayoutIdFromContextStoreTargetedRecord } from '@/command-menu/pages/page-layout/hooks/usePageLayoutFromContextStoreTargetedRecord';\nimport { useUpdateChartSettingInput } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingInput';\nimport { useUpdateChartSettingTextInput } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingTextInput';\nimport { useUpdateChartSettingToggle } from '@/command-menu/pages/page-layout/hooks/useUpdateChartSettingToggle';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { CHART_CONFIGURATION_SETTING_IDS } from '@/command-menu/pages/page-layout/types/ChartConfigurationSettingIds';\nimport { type ChartSettingsItem } from '@/command-menu/pages/page-layout/types/ChartSettingsGroup';\nimport { isMinMaxRangeValid } from '@/command-menu/pages/page-layout/utils/isMinMaxRangeValid';\nimport { CommandMenuPages } from '@/command-menu/types/CommandMenuPages';\nimport { DropdownContent } from '@/ui/layout/dropdown/components/DropdownContent';\nimport { useOpenDropdown } from '@/ui/layout/dropdown/hooks/useOpenDropdown';\nimport { SelectableListItem } from '@/ui/layout/selectable-list/components/SelectableListItem';\nimport { useSelectableList } from '@/ui/layout/selectable-list/hooks/useSelectableList';\nimport { t } from '@lingui/core/macro';\nimport { isString } from '@sniptt/guards';\nimport { isDefined } from 'twenty-shared/utils';\n\ntype ChartSettingItemProps = {\n  item: ChartSettingsItem;\n  objectMetadataId: string;\n  configuration: ChartConfiguration;\n};\n\nexport const ChartSettingItem = ({\n  item,\n  objectMetadataId,\n  configuration,\n}: ChartSettingItemProps) => {\n  const { pageLayoutId } = usePageLayoutIdFromContextStoreTargetedRecord();\n  const { openDropdown } = useOpenDropdown();\n  const { setSelectedItemId } = useSelectableList(\n    COMMAND_MENU_LIST_SELECTABLE_LIST_ID,\n  );\n  const { navigatePageLayoutCommandMenu } = useNavigatePageLayoutCommandMenu();\n\n  const { getChartSettingsValues } = useChartSettingsValues({\n    objectMetadataId,\n    configuration,\n  });\n\n  const { updateChartSettingToggle } = useUpdateChartSettingToggle({\n    pageLayoutId,\n    objectMetadataId,\n    configuration,\n  });\n\n  const { updateChartSettingInput } = useUpdateChartSettingInput(pageLayoutId);\n\n  const { updateChartSettingTextInput } =\n    useUpdateChartSettingTextInput(pageLayoutId);\n\n  const handleToggleChange = () => {\n    setSelectedItemId(item.id);\n    updateChartSettingToggle(item.id);\n  };\n\n  const handleInputChange = (value: number | null) => {\n    updateChartSettingInput(item.id, value);\n  };\n\n  const handleTextInputChange = (value: string) => {\n    updateChartSettingTextInput(item.id, value);\n  };\n\n  const handleDropdownOpen = () => {\n    openDropdown({\n      dropdownComponentInstanceIdFromProps: item.id,\n    });\n  };\n\n  const handleFilterClick = () => {\n    navigatePageLayoutCommandMenu({\n      commandMenuPage: CommandMenuPages.PageLayoutGraphFilter,\n    });\n  };\n  if (item.id === CHART_CONFIGURATION_SETTING_IDS.FILTER) {\n    return (\n      <SelectableListItem\n        key={item.id}\n        itemId={item.id}\n        onEnter={handleFilterClick}\n      >\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          hasSubMenu\n          onClick={handleFilterClick}\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (isDefined(item.isNumberInput)) {\n    const settingValue = getChartSettingsValues(item.id);\n    const stringValue = isString(settingValue) ? settingValue : '';\n\n    return (\n      <SelectableListItem key={item.id} itemId={item.id}>\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          RightComponent={\n            <CommandMenuItemNumberInput\n              value={stringValue}\n              onChange={handleInputChange}\n              onValidate={(value) =>\n                !isDefined(value) ||\n                isMinMaxRangeValid(\n                  item.id as\n                    | CHART_CONFIGURATION_SETTING_IDS.MIN_RANGE\n                    | CHART_CONFIGURATION_SETTING_IDS.MAX_RANGE,\n                  value,\n                  configuration,\n                )\n              }\n              placeholder={\n                item.inputPlaceholder ? t(item.inputPlaceholder) : undefined\n              }\n            />\n          }\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (isDefined(item.isTextInput)) {\n    const settingValue = getChartSettingsValues(item.id);\n    const stringValue = isString(settingValue) ? settingValue : '';\n\n    return (\n      <SelectableListItem key={item.id} itemId={item.id}>\n        <CommandMenuItem\n          id={item.id}\n          label={t(item.label)}\n          Icon={item.Icon}\n          RightComponent={\n            <CommandMenuItemTextInput\n              value={stringValue}\n              onChange={handleTextInputChange}\n              placeholder={\n                item.inputPlaceholder ? t(item.inputPlaceholder) : undefined\n              }\n            />\n          }\n        />\n      </SelectableListItem>\n    );\n  }\n\n  if (item.isBoolean) {\n    return (\n      <SelectableListItem\n        key={item.id}\n        itemId={item.id}\n        onEnter={handleToggleChange}\n      >\n        <CommandMenuItemToggle\n          LeftIcon={item.Icon}\n          text={t(item.label)}\n          id={item.id}\n          toggled={getChartSettingsValues(item.id) as boolean}\n          onToggleChange={handleToggleChange}\n        />\n      </SelectableListItem>\n    );\n  }\n\n  return (\n    <SelectableListItem\n      key={item.id}\n      itemId={item.id}\n      onEnter={handleDropdownOpen}\n    >\n      <CommandMenuItemDropdown\n        Icon={item.Icon}\n        label={t(item.label)}\n        id={item.id}\n        dropdownId={item.id}\n        dropdownComponents={\n          <DropdownContent widthInPixels={item.dropdownWidth}>\n            {item.DropdownContent && <item.DropdownContent />}\n          </DropdownContent>\n        }\n        dropdownPlacement=\"bottom-end\"\n        description={getChartSettingsValues(item.id) as string}\n        contextualTextPosition={'right'}\n        hasSubMenu\n      />\n    </SelectableListItem>\n  );\n};",
            "cost": 0.06781500000000001
        },
        "twentyhq__twenty.main/packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts": {
            "output": "import { useGraphGroupBySortOptionLabels } from '@/command-menu/pages/page-layout/hooks/useGraphGroupBySortOptionLabels';\nimport { useGraphXSortOptionLabels } from '@/command-menu/pages/page-layout/hooks/useGraphXSortOptionLabels';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { CHART_CONFIGURATION_SETTING_IDS } from '@/command-menu/pages/page-layout/types/ChartConfigurationSettingIds';\nimport { getChartAxisNameDisplayOptions } from '@/command-menu/pages/page-layout/utils/getChartAxisNameDisplayOptions';\nimport { getDateGranularityLabel } from '@/command-menu/pages/page-layout/utils/getDateGranularityLabel';\nimport { getFieldLabelWithSubField } from '@/command-menu/pages/page-layout/utils/getFieldLabelWithSubField';\nimport { objectMetadataItemsState } from '@/object-metadata/states/objectMetadataItemsState';\nimport { getAggregateOperationLabel } from '@/object-record/record-board/record-board-column/utils/getAggregateOperationLabel';\nimport { convertAggregateOperationToExtendedAggregateOperation } from '@/object-record/utils/convertAggregateOperationToExtendedAggregateOperation';\nimport { useRecoilValue } from 'recoil';\nimport { type CompositeFieldSubFieldName } from 'twenty-shared/types';\nimport { capitalize, isDefined } from 'twenty-shared/utils';\nimport { type GraphOrderBy } from '~/generated-metadata/graphql';\n\nexport const useChartSettingsValues = ({\n  objectMetadataId,\n  configuration,\n}: {\n  objectMetadataId: string;\n  configuration?: ChartConfiguration;\n}) => {\n  const objectMetadataItems = useRecoilValue(objectMetadataItemsState);\n\n  const objectMetadataItem = objectMetadataItems.find(\n    (objectMetadataItem) => objectMetadataItem.id === objectMetadataId,\n  );\n\n  const { getXSortOptionLabel } = useGraphXSortOptionLabels({\n    objectMetadataId,\n  });\n\n  const { getGroupBySortOptionLabel } = useGraphGroupBySortOptionLabels({\n    objectMetadataId,\n  });\n\n  if (!configuration) {\n    return {\n      getChartSettingsValues: () => undefined,\n    };\n  }\n\n  const isBarOrLineChart =\n    configuration.__typename === 'BarChartConfiguration' ||\n    configuration.__typename === 'LineChartConfiguration';\n\n  const hasColorProperty =\n    isBarOrLineChart ||\n    configuration.__typename === 'GaugeChartConfiguration' ||\n    configuration.__typename === 'PieChartConfiguration';\n\n  const isPieChart = configuration.__typename === 'PieChartConfiguration';\n\n  let groupByFieldXId: string | undefined;\n  let groupByFieldYId: string | undefined;\n  let groupBySubFieldNameX: CompositeFieldSubFieldName | undefined;\n  let groupBySubFieldNameY: CompositeFieldSubFieldName | undefined;\n  let xAxisOrderBy: GraphOrderBy | undefined | null;\n  let groupByOrderBy: GraphOrderBy | undefined | null;\n\n  if (isBarOrLineChart) {\n    groupByFieldXId = configuration.primaryAxisGroupByFieldMetadataId;\n    groupByFieldYId = configuration.secondaryAxisGroupByFieldMetadataId;\n    groupBySubFieldNameX = configuration.primaryAxisGroupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n    groupBySubFieldNameY = configuration.secondaryAxisGroupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n    xAxisOrderBy = configuration.primaryAxisOrderBy;\n    groupByOrderBy = configuration.secondaryAxisOrderBy;\n  }\n\n  const groupByFieldX = isDefined(groupByFieldXId)\n    ? objectMetadataItem?.fields.find((field) => field.id === groupByFieldXId)\n    : undefined;\n\n  const groupByFieldY = isDefined(groupByFieldYId)\n    ? objectMetadataItem?.fields.find((field) => field.id === groupByFieldYId)\n    : undefined;\n\n  const groupBySubFieldNameXLabel =\n    isDefined(groupBySubFieldNameX) && isDefined(groupByFieldX)\n      ? getFieldLabelWithSubField({\n          field: groupByFieldX,\n          subFieldName: groupBySubFieldNameX,\n          objectMetadataItems,\n        })\n      : undefined;\n\n  const aggregateField = objectMetadataItem?.fields.find(\n    (fieldMetadataItem) =>\n      fieldMetadataItem.id === configuration.aggregateFieldMetadataId,\n  );\n\n  const aggregateOperation =\n    convertAggregateOperationToExtendedAggregateOperation(\n      configuration.aggregateOperation,\n      aggregateField?.type,\n    );\n\n  const xAxisOrderByLabel =\n    isDefined(xAxisOrderBy) && isDefined(groupByFieldXId)\n      ? getXSortOptionLabel({\n          graphOrderBy: xAxisOrderBy,\n          groupByFieldMetadataIdX: groupByFieldXId,\n          groupBySubFieldNameX: groupBySubFieldNameX,\n          aggregateFieldMetadataId: configuration.aggregateFieldMetadataId,\n          aggregateOperation: configuration.aggregateOperation ?? undefined,\n        })\n      : undefined;\n\n  let pieChartSortByLabel: string | undefined;\n\n  if (configuration.__typename === 'PieChartConfiguration') {\n    groupByOrderBy = configuration.orderBy;\n    groupByFieldYId = configuration.groupByFieldMetadataId;\n    groupBySubFieldNameY = configuration.groupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n\n    pieChartSortByLabel =\n      isDefined(configuration.orderBy) &&\n      isDefined(configuration.groupByFieldMetadataId)\n        ? getXSortOptionLabel({\n            graphOrderBy: configuration.orderBy,\n            groupByFieldMetadataIdX: configuration.groupByFieldMetadataId,\n            groupBySubFieldNameX: configuration.groupBySubFieldName as\n              | CompositeFieldSubFieldName\n              | undefined,\n            aggregateFieldMetadataId: configuration.aggregateFieldMetadataId,\n            aggregateOperation: configuration.aggregateOperation ?? undefined,\n          })\n        : undefined;\n  }\n\n  const finalGroupByFieldYId = groupByFieldYId;\n  const finalGroupBySubFieldNameY = groupBySubFieldNameY;\n\n  const groupByOrderByLabel =\n    isDefined(groupByOrderBy) && isDefined(finalGroupByFieldYId)\n      ? getGroupBySortOptionLabel({\n          graphOrderBy: groupByOrderBy,\n          groupByFieldMetadataId: finalGroupByFieldYId,\n          groupBySubFieldName: finalGroupBySubFieldNameY,\n        })\n      : undefined;\n\n  const getChartSettingsValues = (\n    itemId: CHART_CONFIGURATION_SETTING_IDS,\n  ): boolean | string | undefined => {\n    switch (itemId) {\n      case CHART_CONFIGURATION_SETTING_IDS.SOURCE:\n        return objectMetadataItem?.labelPlural;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_X:\n        return groupBySubFieldNameXLabel ?? groupByFieldX?.label;\n      case CHART_CONFIGURATION_SETTING_IDS.COLORS:\n        return hasColorProperty && isDefined(configuration.color)\n          ? capitalize(configuration.color)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_Y:\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_AGGREGATE:\n      case CHART_CONFIGURATION_SETTING_IDS.EACH_SLICE_REPRESENTS: {\n        const hasAggregateLabel = isDefined(aggregateField?.label);\n        const hasAggregateOperation = isDefined(aggregateOperation);\n\n        return `${aggregateField?.label ?? ''}${\n          hasAggregateLabel && hasAggregateOperation\n            ? ` (${getAggregateOperationLabel(aggregateOperation)})`\n            : ''\n        }`;\n      }\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_PIE_CHART: {\n        const pieChartGroupByField = isDefined(finalGroupByFieldYId)\n          ? objectMetadataItem?.fields.find(\n              (field) => field.id === finalGroupByFieldYId,\n            )\n          : undefined;\n        const pieChartGroupBySubFieldNameLabel =\n          isDefined(finalGroupBySubFieldNameY) &&\n          isDefined(pieChartGroupByField)\n            ? getFieldLabelWithSubField({\n                field: pieChartGroupByField,\n                subFieldName: finalGroupBySubFieldNameY,\n                objectMetadataItems,\n              })\n            : undefined;\n\n        return pieChartGroupBySubFieldNameLabel ?? pieChartGroupByField?.label;\n      }\n\n      case CHART_CONFIGURATION_SETTING_IDS.GROUP_BY:\n        return groupByFieldY?.label;\n      case CHART_CONFIGURATION_SETTING_IDS.AXIS_NAME:\n        return isBarOrLineChart && isDefined(configuration.axisNameDisplay)\n          ? getChartAxisNameDisplayOptions(configuration.axisNameDisplay)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.PRIMARY_SORT_BY:\n        return pieChartSortByLabel ?? xAxisOrderByLabel;\n      case CHART_CONFIGURATION_SETTING_IDS.SORT_BY_GROUP_BY_FIELD:\n        return groupByOrderByLabel;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_LABELS:\n        return configuration.displayDataLabel ?? undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.CENTER_METRIC:\n        return isPieChart\n          ? (configuration.showCenterMetric ?? undefined)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.STACKED_BARS:\n        return configuration.__typename === 'BarChartConfiguration'\n          ? configuration.groupMode !== 'GROUPED'\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.STACKED_LINES:\n        return configuration.__typename === 'LineChartConfiguration'\n          ? configuration.isStacked !== false\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.CUMULATIVE:\n        return isBarOrLineChart ? (configuration.isCumulative ?? false) : false;\n      case CHART_CONFIGURATION_SETTING_IDS.OMIT_NULL_VALUES:\n        return isBarOrLineChart\n          ? (configuration.omitNullValues ?? false)\n          : false;\n      case CHART_CONFIGURATION_SETTING_IDS.MIN_RANGE:\n        return isBarOrLineChart\n          ? (configuration.rangeMin?.toString() ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.MAX_RANGE:\n        return isBarOrLineChart\n          ? (configuration.rangeMax?.toString() ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY_X:\n        return isBarOrLineChart &&\n          isDefined(configuration.primaryAxisDateGranularity)\n          ? getDateGranularityLabel(configuration.primaryAxisDateGranularity)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY_Y:\n        return isBarOrLineChart &&\n          isDefined(configuration.secondaryAxisGroupByDateGranularity)\n          ? getDateGranularityLabel(\n              configuration.secondaryAxisGroupByDateGranularity,\n            )\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY:\n        return isPieChart && isDefined(configuration.dateGranularity)\n          ? getDateGranularityLabel(configuration.dateGranularity)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.SHOW_LEGEND:\n        return isBarOrLineChart || isPieChart\n          ? (configuration.displayLegend ?? true)\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.PREFIX:\n        return configuration.__typename === 'AggregateChartConfiguration'\n          ? (configuration.prefix ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.SUFFIX:\n        return configuration.__typename === 'AggregateChartConfiguration'\n          ? (configuration.suffix ?? '')\n          : '';\n      default:\n        return '';\n    }\n  };\n\n  return {\n    getChartSettingsValues,\n  };\n};",
            "output_extracted": "import { useGraphGroupBySortOptionLabels } from '@/command-menu/pages/page-layout/hooks/useGraphGroupBySortOptionLabels';\nimport { useGraphXSortOptionLabels } from '@/command-menu/pages/page-layout/hooks/useGraphXSortOptionLabels';\nimport { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\nimport { CHART_CONFIGURATION_SETTING_IDS } from '@/command-menu/pages/page-layout/types/ChartConfigurationSettingIds';\nimport { getChartAxisNameDisplayOptions } from '@/command-menu/pages/page-layout/utils/getChartAxisNameDisplayOptions';\nimport { getDateGranularityLabel } from '@/command-menu/pages/page-layout/utils/getDateGranularityLabel';\nimport { getFieldLabelWithSubField } from '@/command-menu/pages/page-layout/utils/getFieldLabelWithSubField';\nimport { objectMetadataItemsState } from '@/object-metadata/states/objectMetadataItemsState';\nimport { getAggregateOperationLabel } from '@/object-record/record-board/record-board-column/utils/getAggregateOperationLabel';\nimport { convertAggregateOperationToExtendedAggregateOperation } from '@/object-record/utils/convertAggregateOperationToExtendedAggregateOperation';\nimport { useRecoilValue } from 'recoil';\nimport { type CompositeFieldSubFieldName } from 'twenty-shared/types';\nimport { capitalize, isDefined } from 'twenty-shared/utils';\nimport { type GraphOrderBy } from '~/generated-metadata/graphql';\n\nexport const useChartSettingsValues = ({\n  objectMetadataId,\n  configuration,\n}: {\n  objectMetadataId: string;\n  configuration?: ChartConfiguration;\n}) => {\n  const objectMetadataItems = useRecoilValue(objectMetadataItemsState);\n\n  const objectMetadataItem = objectMetadataItems.find(\n    (objectMetadataItem) => objectMetadataItem.id === objectMetadataId,\n  );\n\n  const { getXSortOptionLabel } = useGraphXSortOptionLabels({\n    objectMetadataId,\n  });\n\n  const { getGroupBySortOptionLabel } = useGraphGroupBySortOptionLabels({\n    objectMetadataId,\n  });\n\n  if (!configuration) {\n    return {\n      getChartSettingsValues: () => undefined,\n    };\n  }\n\n  const isBarOrLineChart =\n    configuration.__typename === 'BarChartConfiguration' ||\n    configuration.__typename === 'LineChartConfiguration';\n\n  const hasColorProperty =\n    isBarOrLineChart ||\n    configuration.__typename === 'GaugeChartConfiguration' ||\n    configuration.__typename === 'PieChartConfiguration';\n\n  const isPieChart = configuration.__typename === 'PieChartConfiguration';\n\n  let groupByFieldXId: string | undefined;\n  let groupByFieldYId: string | undefined;\n  let groupBySubFieldNameX: CompositeFieldSubFieldName | undefined;\n  let groupBySubFieldNameY: CompositeFieldSubFieldName | undefined;\n  let xAxisOrderBy: GraphOrderBy | undefined | null;\n  let groupByOrderBy: GraphOrderBy | undefined | null;\n\n  if (isBarOrLineChart) {\n    groupByFieldXId = configuration.primaryAxisGroupByFieldMetadataId;\n    groupByFieldYId = configuration.secondaryAxisGroupByFieldMetadataId;\n    groupBySubFieldNameX = configuration.primaryAxisGroupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n    groupBySubFieldNameY = configuration.secondaryAxisGroupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n    xAxisOrderBy = configuration.primaryAxisOrderBy;\n    groupByOrderBy = configuration.secondaryAxisOrderBy;\n  }\n\n  const groupByFieldX = isDefined(groupByFieldXId)\n    ? objectMetadataItem?.fields.find((field) => field.id === groupByFieldXId)\n    : undefined;\n\n  const groupByFieldY = isDefined(groupByFieldYId)\n    ? objectMetadataItem?.fields.find((field) => field.id === groupByFieldYId)\n    : undefined;\n\n  const groupBySubFieldNameXLabel =\n    isDefined(groupBySubFieldNameX) && isDefined(groupByFieldX)\n      ? getFieldLabelWithSubField({\n          field: groupByFieldX,\n          subFieldName: groupBySubFieldNameX,\n          objectMetadataItems,\n        })\n      : undefined;\n\n  const aggregateField = objectMetadataItem?.fields.find(\n    (fieldMetadataItem) =>\n      fieldMetadataItem.id === configuration.aggregateFieldMetadataId,\n  );\n\n  const aggregateOperation =\n    convertAggregateOperationToExtendedAggregateOperation(\n      configuration.aggregateOperation,\n      aggregateField?.type,\n    );\n\n  const xAxisOrderByLabel =\n    isDefined(xAxisOrderBy) && isDefined(groupByFieldXId)\n      ? getXSortOptionLabel({\n          graphOrderBy: xAxisOrderBy,\n          groupByFieldMetadataIdX: groupByFieldXId,\n          groupBySubFieldNameX: groupBySubFieldNameX,\n          aggregateFieldMetadataId: configuration.aggregateFieldMetadataId,\n          aggregateOperation: configuration.aggregateOperation ?? undefined,\n        })\n      : undefined;\n\n  let pieChartSortByLabel: string | undefined;\n\n  if (configuration.__typename === 'PieChartConfiguration') {\n    groupByOrderBy = configuration.orderBy;\n    groupByFieldYId = configuration.groupByFieldMetadataId;\n    groupBySubFieldNameY = configuration.groupBySubFieldName as\n      | CompositeFieldSubFieldName\n      | undefined;\n\n    pieChartSortByLabel =\n      isDefined(configuration.orderBy) &&\n      isDefined(configuration.groupByFieldMetadataId)\n        ? getXSortOptionLabel({\n            graphOrderBy: configuration.orderBy,\n            groupByFieldMetadataIdX: configuration.groupByFieldMetadataId,\n            groupBySubFieldNameX: configuration.groupBySubFieldName as\n              | CompositeFieldSubFieldName\n              | undefined,\n            aggregateFieldMetadataId: configuration.aggregateFieldMetadataId,\n            aggregateOperation: configuration.aggregateOperation ?? undefined,\n          })\n        : undefined;\n  }\n\n  const finalGroupByFieldYId = groupByFieldYId;\n  const finalGroupBySubFieldNameY = groupBySubFieldNameY;\n\n  const groupByOrderByLabel =\n    isDefined(groupByOrderBy) && isDefined(finalGroupByFieldYId)\n      ? getGroupBySortOptionLabel({\n          graphOrderBy: groupByOrderBy,\n          groupByFieldMetadataId: finalGroupByFieldYId,\n          groupBySubFieldName: finalGroupBySubFieldNameY,\n        })\n      : undefined;\n\n  const getChartSettingsValues = (\n    itemId: CHART_CONFIGURATION_SETTING_IDS,\n  ): boolean | string | undefined => {\n    switch (itemId) {\n      case CHART_CONFIGURATION_SETTING_IDS.SOURCE:\n        return objectMetadataItem?.labelPlural;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_X:\n        return groupBySubFieldNameXLabel ?? groupByFieldX?.label;\n      case CHART_CONFIGURATION_SETTING_IDS.COLORS:\n        return hasColorProperty && isDefined(configuration.color)\n          ? capitalize(configuration.color)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_Y:\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_AGGREGATE:\n      case CHART_CONFIGURATION_SETTING_IDS.EACH_SLICE_REPRESENTS: {\n        const hasAggregateLabel = isDefined(aggregateField?.label);\n        const hasAggregateOperation = isDefined(aggregateOperation);\n\n        return `${aggregateField?.label ?? ''}${\n          hasAggregateLabel && hasAggregateOperation\n            ? ` (${getAggregateOperationLabel(aggregateOperation)})`\n            : ''\n        }`;\n      }\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_ON_DISPLAY_PIE_CHART: {\n        const pieChartGroupByField = isDefined(finalGroupByFieldYId)\n          ? objectMetadataItem?.fields.find(\n              (field) => field.id === finalGroupByFieldYId,\n            )\n          : undefined;\n        const pieChartGroupBySubFieldNameLabel =\n          isDefined(finalGroupBySubFieldNameY) &&\n          isDefined(pieChartGroupByField)\n            ? getFieldLabelWithSubField({\n                field: pieChartGroupByField,\n                subFieldName: finalGroupBySubFieldNameY,\n                objectMetadataItems,\n              })\n            : undefined;\n\n        return pieChartGroupBySubFieldNameLabel ?? pieChartGroupByField?.label;\n      }\n\n      case CHART_CONFIGURATION_SETTING_IDS.GROUP_BY:\n        return groupByFieldY?.label;\n      case CHART_CONFIGURATION_SETTING_IDS.AXIS_NAME:\n        return isBarOrLineChart && isDefined(configuration.axisNameDisplay)\n          ? getChartAxisNameDisplayOptions(configuration.axisNameDisplay)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.PRIMARY_SORT_BY:\n        return pieChartSortByLabel ?? xAxisOrderByLabel;\n      case CHART_CONFIGURATION_SETTING_IDS.SORT_BY_GROUP_BY_FIELD:\n        return groupByOrderByLabel;\n      case CHART_CONFIGURATION_SETTING_IDS.DATA_LABELS:\n        return configuration.displayDataLabel ?? undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.CENTER_METRIC:\n        return isPieChart\n          ? (configuration.showCenterMetric ?? undefined)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.STACKED_BARS:\n        return configuration.__typename === 'BarChartConfiguration'\n          ? configuration.groupMode !== 'GROUPED'\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.STACKED_LINES:\n        return configuration.__typename === 'LineChartConfiguration'\n          ? configuration.isStacked !== false\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.CUMULATIVE:\n        return isBarOrLineChart ? (configuration.isCumulative ?? false) : false;\n      case CHART_CONFIGURATION_SETTING_IDS.OMIT_NULL_VALUES:\n        return isBarOrLineChart\n          ? (configuration.omitNullValues ?? false)\n          : false;\n      case CHART_CONFIGURATION_SETTING_IDS.MIN_RANGE:\n        return isBarOrLineChart\n          ? (configuration.rangeMin?.toString() ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.MAX_RANGE:\n        return isBarOrLineChart\n          ? (configuration.rangeMax?.toString() ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY_X:\n        return isBarOrLineChart &&\n          isDefined(configuration.primaryAxisDateGranularity)\n          ? getDateGranularityLabel(configuration.primaryAxisDateGranularity)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY_Y:\n        return isBarOrLineChart &&\n          isDefined(configuration.secondaryAxisGroupByDateGranularity)\n          ? getDateGranularityLabel(\n              configuration.secondaryAxisGroupByDateGranularity,\n            )\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.DATE_GRANULARITY:\n        return isPieChart && isDefined(configuration.dateGranularity)\n          ? getDateGranularityLabel(configuration.dateGranularity)\n          : undefined;\n      case CHART_CONFIGURATION_SETTING_IDS.SHOW_LEGEND:\n        return isBarOrLineChart || isPieChart\n          ? (configuration.displayLegend ?? true)\n          : true;\n      case CHART_CONFIGURATION_SETTING_IDS.PREFIX:\n        return configuration.__typename === 'AggregateChartConfiguration'\n          ? (configuration.prefix ?? '')\n          : '';\n      case CHART_CONFIGURATION_SETTING_IDS.SUFFIX:\n        return configuration.__typename === 'AggregateChartConfiguration'\n          ? (configuration.suffix ?? '')\n          : '';\n      default:\n        return '';\n    }\n  };\n\n  return {\n    getChartSettingsValues,\n  };\n};",
            "cost": 0.10577500000000001
        },
        "twentyhq__twenty.main/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx": {
            "output": "import { GraphWidgetChartContainer } from '@/page-layout/widgets/graph/components/GraphWidgetChartContainer';\nimport { GraphWidgetLegend } from '@/page-layout/widgets/graph/components/GraphWidgetLegend';\nimport { GraphPieChartTooltip } from '@/page-layout/widgets/graph/graphWidgetPieChart/components/GraphPieChartTooltip';\nimport { PieChartCenterMetric } from '@/page-layout/widgets/graph/graphWidgetPieChart/components/PieChartCenterMetricLayer';\nimport { PIE_CHART_HOVER_BRIGHTNESS } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartHoverBrightness';\nimport { PIE_CHART_MARGINS } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartMargins';\nimport { usePieChartData } from '@/page-layout/widgets/graph/graphWidgetPieChart/hooks/usePieChartData';\nimport { graphWidgetPieTooltipComponentState } from '@/page-layout/widgets/graph/graphWidgetPieChart/states/graphWidgetPieTooltipComponentState';\nimport { type PieChartDataItem } from '@/page-layout/widgets/graph/graphWidgetPieChart/types/PieChartDataItem';\nimport { getPieChartFormattedValue } from '@/page-layout/widgets/graph/graphWidgetPieChart/utils/getPieChartFormattedValue';\nimport { createGraphColorRegistry } from '@/page-layout/widgets/graph/utils/createGraphColorRegistry';\nimport { type GraphValueFormatOptions } from '@/page-layout/widgets/graph/utils/graphFormatters';\nimport { useSetRecoilComponentState } from '@/ui/utilities/state/component-state/hooks/useSetRecoilComponentState';\nimport { useTheme } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { ResponsivePie, type ComputedDatum } from '@nivo/pie';\nimport { useMemo, useRef, type MouseEvent as ReactMouseEvent } from 'react';\nimport { isDefined } from 'twenty-shared/utils';\nimport { type PieChartConfiguration } from '~/generated/graphql';\n\ntype GraphWidgetPieChartProps = {\n  data: PieChartDataItem[];\n  showLegend?: boolean;\n  id: string;\n  objectMetadataItemId: string;\n  configuration: PieChartConfiguration;\n  onSliceClick?: (datum: PieChartDataItem) => void;\n  showDataLabels?: boolean;\n  showCenterMetric?: boolean;\n} & GraphValueFormatOptions;\n\nconst emptyStateData: PieChartDataItem[] = [{ id: 'empty', value: 1 }];\n\nconst StyledContainer = styled.div`\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  justify-content: center;\n  width: 100%;\n`;\n\nconst StyledPieChartWrapper = styled.div<{ preventHover: boolean }>`\n  container-type: size;\n  height: 100%;\n  position: relative;\n  width: 100%;\n\n  svg g path {\n    transition: filter 0.15s ease-in-out;\n\n    &:hover {\n      filter: ${({ preventHover }) =>\n        preventHover ? 'none' : `brightness(${PIE_CHART_HOVER_BRIGHTNESS})`};\n    }\n  }\n`;\n\nexport const GraphWidgetPieChart = ({\n  data,\n  showLegend = true,\n  id,\n  objectMetadataItemId,\n  configuration,\n  displayType,\n  decimals,\n  prefix,\n  suffix,\n  customFormatter,\n  onSliceClick,\n  showDataLabels = false,\n  showCenterMetric = false,\n}: GraphWidgetPieChartProps) => {\n  const theme = useTheme();\n  const colorRegistry = createGraphColorRegistry(theme);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const setActivePieTooltip = useSetRecoilComponentState(\n    graphWidgetPieTooltipComponentState,\n  );\n\n  const formatOptions: GraphValueFormatOptions = {\n    displayType,\n    decimals,\n    prefix,\n    suffix,\n    customFormatter,\n  };\n\n  const { enrichedData } = usePieChartData({\n    data,\n    colorRegistry,\n  });\n\n  const handleSliceClick = (datum: ComputedDatum<PieChartDataItem>) => {\n    if (isDefined(onSliceClick)) {\n      onSliceClick(datum.data);\n    }\n  };\n\n  const handleSliceMove = (\n    datum: ComputedDatum<PieChartDataItem>,\n    event: ReactMouseEvent<SVGPathElement>,\n  ) => {\n    if (!isDefined(containerRef.current)) return;\n\n    const containerRect = containerRef.current.getBoundingClientRect();\n    setActivePieTooltip({\n      datum,\n      offsetLeft: event.clientX - containerRect.left,\n      offsetTop: event.clientY - containerRect.top,\n    });\n  };\n\n  const handleSliceLeave = () => {\n    setActivePieTooltip(null);\n  };\n\n  const hasNoData = useMemo(\n    () => data.length === 0 || data.every((item) => item.value === 0),\n    [data],\n  );\n\n  const chartData = hasNoData ? emptyStateData : data;\n  const chartColors = hasNoData\n    ? [theme.background.tertiary]\n    : enrichedData.map((item) => item.colorScheme.solid);\n\n  return (\n    <StyledContainer id={id}>\n      <GraphWidgetChartContainer\n        ref={containerRef}\n        $isClickable={!hasNoData && isDefined(onSliceClick)}\n        $cursorSelector=\"svg g path\"\n        onMouseLeave={handleSliceLeave}\n      >\n        <StyledPieChartWrapper preventHover={hasNoData}>\n          <ResponsivePie\n            data={chartData}\n            margin={showDataLabels && !hasNoData ? PIE_CHART_MARGINS : {}}\n            innerRadius={0.8}\n            padAngle={hasNoData ? 0 : 0.4}\n            colors={chartColors}\n            borderWidth={0}\n            enableArcLinkLabels={showDataLabels && !hasNoData}\n            enableArcLabels={false}\n            tooltip={() => null}\n            onClick={hasNoData ? undefined : (datum) => handleSliceClick(datum)}\n            onMouseMove={hasNoData ? undefined : handleSliceMove}\n            onMouseLeave={hasNoData ? undefined : handleSliceLeave}\n            layers={['arcs', 'arcLinkLabels']}\n            arcLinkLabel={(datum: ComputedDatum<PieChartDataItem>) => {\n              const formattedValue = getPieChartFormattedValue({\n                datum,\n                enrichedData,\n                formatOptions,\n                displayType,\n              });\n              return formattedValue ?? datum.data.value.toString();\n            }}\n            arcLinkLabelsDiagonalLength={10}\n            arcLinkLabelsStraightLength={10}\n            arcLinkLabelsTextColor={theme.font.color.light}\n            arcLinkLabelsColor={theme.font.color.extraLight}\n            theme={{\n              labels: {\n                text: {\n                  fontSize: theme.font.size.sm,\n                  fontWeight: theme.font.weight.medium,\n                },\n              },\n            }}\n          />\n          <PieChartCenterMetric\n            objectMetadataItemId={objectMetadataItemId}\n            configuration={configuration}\n            show={showCenterMetric && !hasNoData}\n          />\n        </StyledPieChartWrapper>\n      </GraphWidgetChartContainer>\n      <GraphPieChartTooltip\n        containerId={id}\n        enrichedData={enrichedData}\n        formatOptions={formatOptions}\n        displayType={displayType}\n        onSliceClick={onSliceClick}\n      />\n      <GraphWidgetLegend\n        show={showLegend && !hasNoData}\n        items={enrichedData.map((item) => ({\n          id: item.id,\n          label: item.id,\n          color: item.colorScheme.solid,\n        }))}\n      />\n    </StyledContainer>\n  );\n};",
            "output_extracted": "import { GraphWidgetChartContainer } from '@/page-layout/widgets/graph/components/GraphWidgetChartContainer';\nimport { GraphWidgetLegend } from '@/page-layout/widgets/graph/components/GraphWidgetLegend';\nimport { GraphPieChartTooltip } from '@/page-layout/widgets/graph/graphWidgetPieChart/components/GraphPieChartTooltip';\nimport { PieChartCenterMetric } from '@/page-layout/widgets/graph/graphWidgetPieChart/components/PieChartCenterMetricLayer';\nimport { PIE_CHART_HOVER_BRIGHTNESS } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartHoverBrightness';\nimport { PIE_CHART_MARGINS } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartMargins';\nimport { usePieChartData } from '@/page-layout/widgets/graph/graphWidgetPieChart/hooks/usePieChartData';\nimport { graphWidgetPieTooltipComponentState } from '@/page-layout/widgets/graph/graphWidgetPieChart/states/graphWidgetPieTooltipComponentState';\nimport { type PieChartDataItem } from '@/page-layout/widgets/graph/graphWidgetPieChart/types/PieChartDataItem';\nimport { getPieChartFormattedValue } from '@/page-layout/widgets/graph/graphWidgetPieChart/utils/getPieChartFormattedValue';\nimport { createGraphColorRegistry } from '@/page-layout/widgets/graph/utils/createGraphColorRegistry';\nimport { type GraphValueFormatOptions } from '@/page-layout/widgets/graph/utils/graphFormatters';\nimport { useSetRecoilComponentState } from '@/ui/utilities/state/component-state/hooks/useSetRecoilComponentState';\nimport { useTheme } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport { ResponsivePie, type ComputedDatum } from '@nivo/pie';\nimport { useMemo, useRef, type MouseEvent as ReactMouseEvent } from 'react';\nimport { isDefined } from 'twenty-shared/utils';\nimport { type PieChartConfiguration } from '~/generated/graphql';\n\ntype GraphWidgetPieChartProps = {\n  data: PieChartDataItem[];\n  showLegend?: boolean;\n  id: string;\n  objectMetadataItemId: string;\n  configuration: PieChartConfiguration;\n  onSliceClick?: (datum: PieChartDataItem) => void;\n  showDataLabels?: boolean;\n  showCenterMetric?: boolean;\n} & GraphValueFormatOptions;\n\nconst emptyStateData: PieChartDataItem[] = [{ id: 'empty', value: 1 }];\n\nconst StyledContainer = styled.div`\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  justify-content: center;\n  width: 100%;\n`;\n\nconst StyledPieChartWrapper = styled.div<{ preventHover: boolean }>`\n  container-type: size;\n  height: 100%;\n  position: relative;\n  width: 100%;\n\n  svg g path {\n    transition: filter 0.15s ease-in-out;\n\n    &:hover {\n      filter: ${({ preventHover }) =>\n        preventHover ? 'none' : `brightness(${PIE_CHART_HOVER_BRIGHTNESS})`};\n    }\n  }\n`;\n\nexport const GraphWidgetPieChart = ({\n  data,\n  showLegend = true,\n  id,\n  objectMetadataItemId,\n  configuration,\n  displayType,\n  decimals,\n  prefix,\n  suffix,\n  customFormatter,\n  onSliceClick,\n  showDataLabels = false,\n  showCenterMetric = false,\n}: GraphWidgetPieChartProps) => {\n  const theme = useTheme();\n  const colorRegistry = createGraphColorRegistry(theme);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const setActivePieTooltip = useSetRecoilComponentState(\n    graphWidgetPieTooltipComponentState,\n  );\n\n  const formatOptions: GraphValueFormatOptions = {\n    displayType,\n    decimals,\n    prefix,\n    suffix,\n    customFormatter,\n  };\n\n  const { enrichedData } = usePieChartData({\n    data,\n    colorRegistry,\n  });\n\n  const handleSliceClick = (datum: ComputedDatum<PieChartDataItem>) => {\n    if (isDefined(onSliceClick)) {\n      onSliceClick(datum.data);\n    }\n  };\n\n  const handleSliceMove = (\n    datum: ComputedDatum<PieChartDataItem>,\n    event: ReactMouseEvent<SVGPathElement>,\n  ) => {\n    if (!isDefined(containerRef.current)) return;\n\n    const containerRect = containerRef.current.getBoundingClientRect();\n    setActivePieTooltip({\n      datum,\n      offsetLeft: event.clientX - containerRect.left,\n      offsetTop: event.clientY - containerRect.top,\n    });\n  };\n\n  const handleSliceLeave = () => {\n    setActivePieTooltip(null);\n  };\n\n  const hasNoData = useMemo(\n    () => data.length === 0 || data.every((item) => item.value === 0),\n    [data],\n  );\n\n  const chartData = hasNoData ? emptyStateData : data;\n  const chartColors = hasNoData\n    ? [theme.background.tertiary]\n    : enrichedData.map((item) => item.colorScheme.solid);\n\n  return (\n    <StyledContainer id={id}>\n      <GraphWidgetChartContainer\n        ref={containerRef}\n        $isClickable={!hasNoData && isDefined(onSliceClick)}\n        $cursorSelector=\"svg g path\"\n        onMouseLeave={handleSliceLeave}\n      >\n        <StyledPieChartWrapper preventHover={hasNoData}>\n          <ResponsivePie\n            data={chartData}\n            margin={showDataLabels && !hasNoData ? PIE_CHART_MARGINS : {}}\n            innerRadius={0.8}\n            padAngle={hasNoData ? 0 : 0.4}\n            colors={chartColors}\n            borderWidth={0}\n            enableArcLinkLabels={showDataLabels && !hasNoData}\n            enableArcLabels={false}\n            tooltip={() => null}\n            onClick={hasNoData ? undefined : (datum) => handleSliceClick(datum)}\n            onMouseMove={hasNoData ? undefined : handleSliceMove}\n            onMouseLeave={hasNoData ? undefined : handleSliceLeave}\n            layers={['arcs', 'arcLinkLabels']}\n            arcLinkLabel={(datum: ComputedDatum<PieChartDataItem>) => {\n              const formattedValue = getPieChartFormattedValue({\n                datum,\n                enrichedData,\n                formatOptions,\n                displayType,\n              });\n              return formattedValue ?? datum.data.value.toString();\n            }}\n            arcLinkLabelsDiagonalLength={10}\n            arcLinkLabelsStraightLength={10}\n            arcLinkLabelsTextColor={theme.font.color.light}\n            arcLinkLabelsColor={theme.font.color.extraLight}\n            theme={{\n              labels: {\n                text: {\n                  fontSize: theme.font.size.sm,\n                  fontWeight: theme.font.weight.medium,\n                },\n              },\n            }}\n          />\n          <PieChartCenterMetric\n            objectMetadataItemId={objectMetadataItemId}\n            configuration={configuration}\n            show={showCenterMetric && !hasNoData}\n          />\n        </StyledPieChartWrapper>\n      </GraphWidgetChartContainer>\n      <GraphPieChartTooltip\n        containerId={id}\n        enrichedData={enrichedData}\n        formatOptions={formatOptions}\n        displayType={displayType}\n        onSliceClick={onSliceClick}\n      />\n      <GraphWidgetLegend\n        show={showLegend && !hasNoData}\n        items={enrichedData.map((item) => ({\n          id: item.id,\n          label: item.id,\n          color: item.colorScheme.solid,\n        }))}\n      />\n    </StyledContainer>\n  );\n};",
            "cost": 0.069675
        },
        "twentyhq__twenty.main/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts": {
            "output": "import { useObjectMetadataItemById } from '@/object-metadata/hooks/useObjectMetadataItemById';\nimport { useObjectMetadataItems } from '@/object-metadata/hooks/useObjectMetadataItems';\nimport { type ObjectMetadataItem } from '@/object-metadata/types/ObjectMetadataItem';\nimport { EXTRA_ITEM_TO_DETECT_TOO_MANY_GROUPS } from '@/page-layout/widgets/graph/constants/ExtraItemToDetectTooManyGroups.constant';\nimport { PIE_CHART_MAXIMUM_NUMBER_OF_SLICES } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartMaximumNumberOfSlices.constant';\nimport { type PieChartDataItem } from '@/page-layout/widgets/graph/graphWidgetPieChart/types/PieChartDataItem';\nimport { transformGroupByDataToPieChartData } from '@/page-layout/widgets/graph/graphWidgetPieChart/utils/transformGroupByDataToPieChartData';\nimport { useGraphWidgetGroupByQuery } from '@/page-layout/widgets/graph/hooks/useGraphWidgetGroupByQuery';\nimport { type RawDimensionValue } from '@/page-layout/widgets/graph/types/RawDimensionValue';\nimport { useMemo } from 'react';\nimport { type PieChartConfiguration } from '~/generated/graphql';\n\ntype UseGraphPieChartWidgetDataProps = {\n  objectMetadataItemId: string;\n  configuration: PieChartConfiguration;\n};\n\ntype UseGraphPieChartWidgetDataResult = {\n  data: PieChartDataItem[];\n  showLegend: boolean;\n  loading: boolean;\n  error?: Error;\n  hasTooManyGroups: boolean;\n  objectMetadataItem: ObjectMetadataItem;\n  formattedToRawLookup: Map<string, RawDimensionValue>;\n  showDataLabels: boolean;\n  showCenterMetric: boolean;\n};\n\nexport const useGraphPieChartWidgetData = ({\n  objectMetadataItemId,\n  configuration,\n}: UseGraphPieChartWidgetDataProps): UseGraphPieChartWidgetDataResult => {\n  const { objectMetadataItem } = useObjectMetadataItemById({\n    objectId: objectMetadataItemId,\n  });\n  const { objectMetadataItems } = useObjectMetadataItems();\n\n  const {\n    data: groupByData,\n    loading,\n    error,\n    aggregateOperation,\n  } = useGraphWidgetGroupByQuery({\n    objectMetadataItemId,\n    configuration,\n    limit:\n      PIE_CHART_MAXIMUM_NUMBER_OF_SLICES + EXTRA_ITEM_TO_DETECT_TOO_MANY_GROUPS,\n  });\n\n  const transformedData = useMemo(\n    () =>\n      transformGroupByDataToPieChartData({\n        groupByData,\n        objectMetadataItem,\n        objectMetadataItems: objectMetadataItems ?? [],\n        configuration,\n        aggregateOperation,\n      }),\n    [\n      groupByData,\n      objectMetadataItem,\n      objectMetadataItems,\n      configuration,\n      aggregateOperation,\n    ],\n  );\n\n  return {\n    ...transformedData,\n    objectMetadataItem,\n    showDataLabels: configuration.displayDataLabel ?? false,\n    showCenterMetric: configuration.showCenterMetric ?? false,\n    loading,\n    error,\n  };\n};",
            "output_extracted": "import { useObjectMetadataItemById } from '@/object-metadata/hooks/useObjectMetadataItemById';\nimport { useObjectMetadataItems } from '@/object-metadata/hooks/useObjectMetadataItems';\nimport { type ObjectMetadataItem } from '@/object-metadata/types/ObjectMetadataItem';\nimport { EXTRA_ITEM_TO_DETECT_TOO_MANY_GROUPS } from '@/page-layout/widgets/graph/constants/ExtraItemToDetectTooManyGroups.constant';\nimport { PIE_CHART_MAXIMUM_NUMBER_OF_SLICES } from '@/page-layout/widgets/graph/graphWidgetPieChart/constants/PieChartMaximumNumberOfSlices.constant';\nimport { type PieChartDataItem } from '@/page-layout/widgets/graph/graphWidgetPieChart/types/PieChartDataItem';\nimport { transformGroupByDataToPieChartData } from '@/page-layout/widgets/graph/graphWidgetPieChart/utils/transformGroupByDataToPieChartData';\nimport { useGraphWidgetGroupByQuery } from '@/page-layout/widgets/graph/hooks/useGraphWidgetGroupByQuery';\nimport { type RawDimensionValue } from '@/page-layout/widgets/graph/types/RawDimensionValue';\nimport { useMemo } from 'react';\nimport { type PieChartConfiguration } from '~/generated/graphql';\n\ntype UseGraphPieChartWidgetDataProps = {\n  objectMetadataItemId: string;\n  configuration: PieChartConfiguration;\n};\n\ntype UseGraphPieChartWidgetDataResult = {\n  data: PieChartDataItem[];\n  showLegend: boolean;\n  loading: boolean;\n  error?: Error;\n  hasTooManyGroups: boolean;\n  objectMetadataItem: ObjectMetadataItem;\n  formattedToRawLookup: Map<string, RawDimensionValue>;\n  showDataLabels: boolean;\n  showCenterMetric: boolean;\n};\n\nexport const useGraphPieChartWidgetData = ({\n  objectMetadataItemId,\n  configuration,\n}: UseGraphPieChartWidgetDataProps): UseGraphPieChartWidgetDataResult => {\n  const { objectMetadataItem } = useObjectMetadataItemById({\n    objectId: objectMetadataItemId,\n  });\n  const { objectMetadataItems } = useObjectMetadataItems();\n\n  const {\n    data: groupByData,\n    loading,\n    error,\n    aggregateOperation,\n  } = useGraphWidgetGroupByQuery({\n    objectMetadataItemId,\n    configuration,\n    limit:\n      PIE_CHART_MAXIMUM_NUMBER_OF_SLICES + EXTRA_ITEM_TO_DETECT_TOO_MANY_GROUPS,\n  });\n\n  const transformedData = useMemo(\n    () =>\n      transformGroupByDataToPieChartData({\n        groupByData,\n        objectMetadataItem,\n        objectMetadataItems: objectMetadataItems ?? [],\n        configuration,\n        aggregateOperation,\n      }),\n    [\n      groupByData,\n      objectMetadataItem,\n      objectMetadataItems,\n      configuration,\n      aggregateOperation,\n    ],\n  );\n\n  return {\n    ...transformedData,\n    objectMetadataItem,\n    showDataLabels: configuration.displayDataLabel ?? false,\n    showCenterMetric: configuration.showCenterMetric ?? false,\n    loading,\n    error,\n  };\n};",
            "cost": 0.031835
        },
        "twentyhq__twenty.main/packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts": {
            "output": "import { Field, Int, ObjectType } from '@nestjs/graphql';\n\nimport {\n  IsBoolean,\n  IsEnum,\n  IsNotEmpty,\n  IsObject,\n  IsOptional,\n  IsString,\n  IsTimeZone,\n  IsUUID,\n  Max,\n  Min,\n} from 'class-validator';\nimport { GraphQLJSON } from 'graphql-type-json';\nimport { CalendarStartDay } from 'twenty-shared/constants';\n\nimport { ObjectRecordFilter } from 'src/engine/api/graphql/workspace-query-builder/interfaces/object-record.interface';\n\nimport { AggregateOperations } from 'src/engine/api/graphql/graphql-query-runner/constants/aggregate-operations.constant';\nimport { UUIDScalarType } from 'src/engine/api/graphql/workspace-schema-builder/graphql-types/scalars';\nimport { ObjectRecordGroupByDateGranularity } from 'src/engine/core-modules/page-layout/enums/date-granularity.enum';\nimport { GraphOrderBy } from 'src/engine/core-modules/page-layout/enums/graph-order-by.enum';\nimport { GraphType } from 'src/engine/core-modules/page-layout/enums/graph-type.enum';\n\n@ObjectType('PieChartConfiguration')\nexport class PieChartConfigurationDTO {\n  @Field(() => GraphType)\n  @IsEnum(GraphType)\n  @IsNotEmpty()\n  graphType: GraphType.PIE;\n\n  @Field(() => UUIDScalarType)\n  @IsUUID()\n  @IsNotEmpty()\n  aggregateFieldMetadataId: string;\n\n  @Field(() => AggregateOperations)\n  @IsEnum(AggregateOperations)\n  @IsNotEmpty()\n  aggregateOperation: AggregateOperations;\n\n  @Field(() => UUIDScalarType)\n  @IsUUID()\n  @IsNotEmpty()\n  groupByFieldMetadataId: string;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  groupBySubFieldName?: string;\n\n  @Field(() => ObjectRecordGroupByDateGranularity, {\n    nullable: true,\n    defaultValue: ObjectRecordGroupByDateGranularity.DAY,\n  })\n  @IsEnum(ObjectRecordGroupByDateGranularity)\n  @IsOptional()\n  dateGranularity?: ObjectRecordGroupByDateGranularity;\n\n  @Field(() => GraphOrderBy, {\n    nullable: true,\n    defaultValue: GraphOrderBy.VALUE_DESC,\n  })\n  @IsEnum(GraphOrderBy)\n  @IsOptional()\n  orderBy?: GraphOrderBy;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: false })\n  @IsBoolean()\n  @IsOptional()\n  displayDataLabel?: boolean;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: false })\n  @IsBoolean()\n  @IsOptional()\n  showCenterMetric?: boolean;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: true })\n  @IsBoolean()\n  @IsOptional()\n  displayLegend?: boolean;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  description?: string;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  color?: string;\n\n  @Field(() => GraphQLJSON, { nullable: true })\n  @IsObject()\n  @IsOptional()\n  filter?: ObjectRecordFilter;\n\n  @Field(() => String, { nullable: true, defaultValue: 'UTC' })\n  @IsTimeZone()\n  @IsOptional()\n  timezone?: string;\n\n  @Field(() => Int, { nullable: true, defaultValue: CalendarStartDay.MONDAY })\n  @IsOptional()\n  @Min(0)\n  @Max(7)\n  firstDayOfTheWeek?: number;\n}",
            "output_extracted": "import { Field, Int, ObjectType } from '@nestjs/graphql';\n\nimport {\n  IsBoolean,\n  IsEnum,\n  IsNotEmpty,\n  IsObject,\n  IsOptional,\n  IsString,\n  IsTimeZone,\n  IsUUID,\n  Max,\n  Min,\n} from 'class-validator';\nimport { GraphQLJSON } from 'graphql-type-json';\nimport { CalendarStartDay } from 'twenty-shared/constants';\n\nimport { ObjectRecordFilter } from 'src/engine/api/graphql/workspace-query-builder/interfaces/object-record.interface';\n\nimport { AggregateOperations } from 'src/engine/api/graphql/graphql-query-runner/constants/aggregate-operations.constant';\nimport { UUIDScalarType } from 'src/engine/api/graphql/workspace-schema-builder/graphql-types/scalars';\nimport { ObjectRecordGroupByDateGranularity } from 'src/engine/core-modules/page-layout/enums/date-granularity.enum';\nimport { GraphOrderBy } from 'src/engine/core-modules/page-layout/enums/graph-order-by.enum';\nimport { GraphType } from 'src/engine/core-modules/page-layout/enums/graph-type.enum';\n\n@ObjectType('PieChartConfiguration')\nexport class PieChartConfigurationDTO {\n  @Field(() => GraphType)\n  @IsEnum(GraphType)\n  @IsNotEmpty()\n  graphType: GraphType.PIE;\n\n  @Field(() => UUIDScalarType)\n  @IsUUID()\n  @IsNotEmpty()\n  aggregateFieldMetadataId: string;\n\n  @Field(() => AggregateOperations)\n  @IsEnum(AggregateOperations)\n  @IsNotEmpty()\n  aggregateOperation: AggregateOperations;\n\n  @Field(() => UUIDScalarType)\n  @IsUUID()\n  @IsNotEmpty()\n  groupByFieldMetadataId: string;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  groupBySubFieldName?: string;\n\n  @Field(() => ObjectRecordGroupByDateGranularity, {\n    nullable: true,\n    defaultValue: ObjectRecordGroupByDateGranularity.DAY,\n  })\n  @IsEnum(ObjectRecordGroupByDateGranularity)\n  @IsOptional()\n  dateGranularity?: ObjectRecordGroupByDateGranularity;\n\n  @Field(() => GraphOrderBy, {\n    nullable: true,\n    defaultValue: GraphOrderBy.VALUE_DESC,\n  })\n  @IsEnum(GraphOrderBy)\n  @IsOptional()\n  orderBy?: GraphOrderBy;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: false })\n  @IsBoolean()\n  @IsOptional()\n  displayDataLabel?: boolean;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: false })\n  @IsBoolean()\n  @IsOptional()\n  showCenterMetric?: boolean;\n\n  @Field(() => Boolean, { nullable: true, defaultValue: true })\n  @IsBoolean()\n  @IsOptional()\n  displayLegend?: boolean;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  description?: string;\n\n  @Field(() => String, { nullable: true })\n  @IsString()\n  @IsOptional()\n  color?: string;\n\n  @Field(() => GraphQLJSON, { nullable: true })\n  @IsObject()\n  @IsOptional()\n  filter?: ObjectRecordFilter;\n\n  @Field(() => String, { nullable: true, defaultValue: 'UTC' })\n  @IsTimeZone()\n  @IsOptional()\n  timezone?: string;\n\n  @Field(() => Int, { nullable: true, defaultValue: CalendarStartDay.MONDAY })\n  @IsOptional()\n  @Min(0)\n  @Max(7)\n  firstDayOfTheWeek?: number;\n}",
            "cost": 0.03554500000000001
        }
    },
    "recover_status": "success",
    "instance_ref": {
        "instance_id": "twentyhq__twenty.main.16211",
        "repo": "twentyhq/twenty",
        "base_commit": "f489bbdbab893278ec8b808a71cc01f1ad29e2a1",
        "head_commit": "23b4adc033174bb3f4326176c2aeee7cefb460b8",
        "title": "[Dashboards] - fast follows - inverse default value for centre metric and filter count on chart settings",
        "merged_at": "2025-12-01T16:19:57Z",
        "html_url": "https://github.com/twentyhq/twenty/pull/16211",
        "test_files": [
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/getChartFilterRulesCount.test.ts"
        ],
        "code_files": [
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx",
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts",
            "packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/getChartFilterRulesCount.ts",
            "packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx",
            "packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts",
            "packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts"
        ],
        "total_changes": 101,
        "num_files": 7,
        "pull_number": 16211,
        "patch": "diff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx\nindex 8f8e795cd7dbc..45f2291deb7ef 100644\n--- a/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/components/chart-settings/ChartSettingItem.tsx\n@@ -34,6 +34,9 @@ export const ChartSettingItem = ({\n   onFilterClick,\n }: ChartSettingItemProps) => {\n   if (item.id === CHART_CONFIGURATION_SETTING_IDS.FILTER) {\n+    const filterValue = getChartSettingsValues(item.id);\n+    const filterDescription = isString(filterValue) ? filterValue : undefined;\n+\n     return (\n       <SelectableListItem\n         key={item.id}\n@@ -46,6 +49,8 @@ export const ChartSettingItem = ({\n           Icon={item.Icon}\n           hasSubMenu\n           onClick={onFilterClick}\n+          description={filterDescription}\n+          contextualTextPosition=\"right\"\n         />\n       </SelectableListItem>\n     );\ndiff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts b/packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts\nindex aa760e8de6711..7798663623ab2 100644\n--- a/packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/hooks/useChartSettingsValues.ts\n@@ -3,11 +3,13 @@ import { useGraphXSortOptionLabels } from '@/command-menu/pages/page-layout/hook\n import { type ChartConfiguration } from '@/command-menu/pages/page-layout/types/ChartConfiguration';\n import { CHART_CONFIGURATION_SETTING_IDS } from '@/command-menu/pages/page-layout/types/ChartConfigurationSettingIds';\n import { getChartAxisNameDisplayOptions } from '@/command-menu/pages/page-layout/utils/getChartAxisNameDisplayOptions';\n+import { getChartFilterRulesCount } from '@/command-menu/pages/page-layout/utils/getChartFilterRulesCount';\n import { getDateGranularityLabel } from '@/command-menu/pages/page-layout/utils/getDateGranularityLabel';\n import { getFieldLabelWithSubField } from '@/command-menu/pages/page-layout/utils/getFieldLabelWithSubField';\n import { objectMetadataItemsState } from '@/object-metadata/states/objectMetadataItemsState';\n import { getAggregateOperationLabel } from '@/object-record/record-board/record-board-column/utils/getAggregateOperationLabel';\n import { convertAggregateOperationToExtendedAggregateOperation } from '@/object-record/utils/convertAggregateOperationToExtendedAggregateOperation';\n+import { plural } from '@lingui/core/macro';\n import { useRecoilValue } from 'recoil';\n import { type CompositeFieldSubFieldName } from 'twenty-shared/types';\n import { capitalize, isDefined } from 'twenty-shared/utils';\n@@ -201,9 +203,18 @@ export const useChartSettingsValues = ({\n         return groupByOrderByLabel;\n       case CHART_CONFIGURATION_SETTING_IDS.DATA_LABELS:\n         return configuration.displayDataLabel ?? undefined;\n+      case CHART_CONFIGURATION_SETTING_IDS.FILTER: {\n+        const filterRulesCount = getChartFilterRulesCount(configuration.filter);\n+        return filterRulesCount > 0\n+          ? plural(filterRulesCount, {\n+              one: `${filterRulesCount} rule`,\n+              other: `${filterRulesCount} rules`,\n+            })\n+          : undefined;\n+      }\n       case CHART_CONFIGURATION_SETTING_IDS.CENTER_METRIC:\n         return isPieChart\n-          ? (configuration.showCenterMetric ?? undefined)\n+          ? (configuration.showCenterMetric ?? true)\n           : undefined;\n       case CHART_CONFIGURATION_SETTING_IDS.STACKED_BARS:\n         return configuration.__typename === 'BarChartConfiguration'\ndiff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/getChartFilterRulesCount.test.ts b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/getChartFilterRulesCount.test.ts\nnew file mode 100644\nindex 0000000000000..1cec14447a7fd\n--- /dev/null\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/__tests__/getChartFilterRulesCount.test.ts\n@@ -0,0 +1,46 @@\n+import { type ChartFilters } from '@/command-menu/pages/page-layout/types/ChartFilters';\n+import { getChartFilterRulesCount } from '@/command-menu/pages/page-layout/utils/getChartFilterRulesCount';\n+\n+describe('getChartFilterRulesCount', () => {\n+  it('should return 0 for undefined filter', () => {\n+    expect(getChartFilterRulesCount(undefined)).toBe(0);\n+  });\n+\n+  it('should return 0 when no root group exists', () => {\n+    const filter: ChartFilters = {\n+      recordFilters: [],\n+      recordFilterGroups: [],\n+    };\n+\n+    expect(getChartFilterRulesCount(filter)).toBe(0);\n+  });\n+\n+  it('should return count of filters in root group', () => {\n+    const filter: ChartFilters = {\n+      recordFilterGroups: [\n+        { id: 'root', parentRecordFilterGroupId: undefined },\n+      ],\n+      recordFilters: [\n+        { id: 'filter-1', recordFilterGroupId: 'root' },\n+        { id: 'filter-2', recordFilterGroupId: 'root' },\n+      ],\n+    } as ChartFilters;\n+\n+    expect(getChartFilterRulesCount(filter)).toBe(2);\n+  });\n+\n+  it('should count both direct filters and nested groups as children', () => {\n+    const filter: ChartFilters = {\n+      recordFilterGroups: [\n+        { id: 'root', parentRecordFilterGroupId: undefined },\n+        { id: 'nested-group', parentRecordFilterGroupId: 'root' },\n+      ],\n+      recordFilters: [\n+        { id: 'filter-1', recordFilterGroupId: 'root' },\n+        { id: 'filter-2', recordFilterGroupId: 'nested-group' },\n+      ],\n+    } as ChartFilters;\n+\n+    expect(getChartFilterRulesCount(filter)).toBe(2);\n+  });\n+});\ndiff --git a/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/getChartFilterRulesCount.ts b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/getChartFilterRulesCount.ts\nnew file mode 100644\nindex 0000000000000..da231a1a04574\n--- /dev/null\n+++ b/packages/twenty-front/src/modules/command-menu/pages/page-layout/utils/getChartFilterRulesCount.ts\n@@ -0,0 +1,31 @@\n+import { type ChartFilters } from '@/command-menu/pages/page-layout/types/ChartFilters';\n+import { isDefined } from 'twenty-shared/utils';\n+\n+export const getChartFilterRulesCount = (\n+  filter: ChartFilters | undefined,\n+): number => {\n+  if (!isDefined(filter)) {\n+    return 0;\n+  }\n+\n+  const recordFilters = filter.recordFilters ?? [];\n+  const recordFilterGroups = filter.recordFilterGroups ?? [];\n+\n+  const rootGroup = recordFilterGroups.find(\n+    (group) => !isDefined(group.parentRecordFilterGroupId),\n+  );\n+\n+  if (!isDefined(rootGroup)) {\n+    return 0;\n+  }\n+\n+  const childFiltersCount = recordFilters.filter(\n+    (recordFilter) => recordFilter.recordFilterGroupId === rootGroup.id,\n+  ).length;\n+\n+  const childGroupsCount = recordFilterGroups.filter(\n+    (group) => group.parentRecordFilterGroupId === rootGroup.id,\n+  ).length;\n+\n+  return childFiltersCount + childGroupsCount;\n+};\ndiff --git a/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx b/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx\nindex 190bbc878dc0f..ae063d786ef84 100644\n--- a/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx\n+++ b/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/components/GraphWidgetPieChart.tsx\n@@ -71,7 +71,7 @@ export const GraphWidgetPieChart = ({\n   customFormatter,\n   onSliceClick,\n   showDataLabels = false,\n-  showCenterMetric = false,\n+  showCenterMetric = true,\n }: GraphWidgetPieChartProps) => {\n   const theme = useTheme();\n   const colorRegistry = createGraphColorRegistry(theme);\ndiff --git a/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts b/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts\nindex cdbc279ad5909..bceac7a8ba3f2 100644\n--- a/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts\n+++ b/packages/twenty-front/src/modules/page-layout/widgets/graph/graphWidgetPieChart/hooks/useGraphPieChartWidgetData.ts\n@@ -61,7 +61,7 @@ export const useGraphPieChartWidgetData = ({\n     ...transformedData,\n     objectMetadataItem,\n     showDataLabels: configuration.displayDataLabel ?? false,\n-    showCenterMetric: configuration.showCenterMetric ?? false,\n+    showCenterMetric: configuration.showCenterMetric ?? true,\n     loading,\n     error,\n   };\ndiff --git a/packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts b/packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts\nindex 13014c268d5d1..3abdd1db3a6c8 100644\n--- a/packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts\n+++ b/packages/twenty-server/src/engine/core-modules/page-layout/dtos/pie-chart-configuration.dto.ts\n@@ -71,7 +71,7 @@ export class PieChartConfigurationDTO {\n   @IsOptional()\n   displayDataLabel?: boolean;\n \n-  @Field(() => Boolean, { nullable: true, defaultValue: false })\n+  @Field(() => Boolean, { nullable: true, defaultValue: true })\n   @IsBoolean()\n   @IsOptional()\n   showCenterMetric?: boolean;\n",
        "pr_mirror": "twentyhq__twenty.main"
    }
}