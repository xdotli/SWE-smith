{
    "cost": 0.14071999999999998,
    "rewrites": {
        "appsmithorg__appsmith.7046aeb3/app/client/src/PluginActionEditor/types/PluginActionTypes.ts": {
            "output": "import { EditorTheme } from \"components/editorComponents/CodeEditor/EditorConfig\";\n\nexport const THEME = EditorTheme.LIGHT;\n\nexport enum ActionRunBehaviour {\n  ON_PAGE_LOAD = \"ON_PAGE_LOAD\",\n  MANUAL = \"MANUAL\",\n  AUTOMATIC = \"AUTOMATIC\",\n}\n\nexport type ActionRunBehaviourType = `${ActionRunBehaviour}`;\n\nexport interface ActionSettingsConfigChildren {\n  label: string;\n  configProperty: string;\n  controlType: string;\n  initialValue?: string | boolean;\n  options?: Array<{ label: string; value: string }>;\n  tooltipText?: string;\n  placeholder?: string;\n  dataType?: string;\n  subtitle?: string;\n  name?: string;\n}\n\nexport interface ActionSettingsConfig {\n  sectionName: string;\n  id: number;\n  children: ActionSettingsConfigChildren[];\n}",
            "output_extracted": "import { EditorTheme } from \"components/editorComponents/CodeEditor/EditorConfig\";\n\nexport const THEME = EditorTheme.LIGHT;\n\nexport enum ActionRunBehaviour {\n  ON_PAGE_LOAD = \"ON_PAGE_LOAD\",\n  MANUAL = \"MANUAL\",\n  AUTOMATIC = \"AUTOMATIC\",\n}\n\nexport type ActionRunBehaviourType = `${ActionRunBehaviour}`;\n\nexport interface ActionSettingsConfigChildren {\n  label: string;\n  configProperty: string;\n  controlType: string;\n  initialValue?: string | boolean;\n  options?: Array<{ label: string; value: string }>;\n  tooltipText?: string;\n  placeholder?: string;\n  dataType?: string;\n  subtitle?: string;\n  name?: string;\n}\n\nexport interface ActionSettingsConfig {\n  sectionName: string;\n  id: number;\n  children: ActionSettingsConfigChildren[];\n}",
            "cost": 0.01157
        },
        "appsmithorg__appsmith.7046aeb3/app/client/src/ce/entities/FeatureFlag.ts": {
            "output": "// Please follow naming convention : https://www.notion.so/appsmith/Using-Feature-Flags-in-Appsmith-d362fe7acc7d4ef0aa12e1f5f9b83b5f?pvs=4#f6d4242e56284e84af25cadef71b7aeb to create feature flags.\nexport const FEATURE_FLAG = {\n  TEST_FLAG: \"TEST_FLAG\",\n  release_datasource_environments_enabled:\n    \"release_datasource_environments_enabled\",\n  release_appnavigationlogoupload_enabled:\n    \"release_appnavigationlogoupload_enabled\",\n  release_embed_hide_share_settings_enabled:\n    \"release_embed_hide_share_settings_enabled\",\n  release_table_serverside_filtering_enabled:\n    \"release_table_serverside_filtering_enabled\",\n  license_branding_enabled: \"license_branding_enabled\",\n  license_sso_saml_enabled: \"license_sso_saml_enabled\",\n  license_sso_oidc_enabled: \"license_sso_oidc_enabled\",\n  license_private_embeds_enabled: \"license_private_embeds_enabled\",\n  release_show_publish_app_to_community_enabled:\n    \"release_show_publish_app_to_community_enabled\",\n  license_gac_enabled: \"license_gac_enabled\",\n  release_anvil_enabled: \"release_anvil_enabled\",\n  license_ai_agent_enabled: \"license_ai_agent_enabled\",\n  license_git_branch_protection_enabled:\n    \"license_git_branch_protection_enabled\",\n  license_git_continuous_delivery_enabled:\n    \"license_git_continuous_delivery_enabled\",\n  license_widget_rtl_support_enabled: \"license_widget_rtl_support_enabled\",\n  ab_one_click_learning_popover_enabled:\n    \"ab_one_click_learning_popover_enabled\",\n  ab_appsmith_ai_query: \"ab_appsmith_ai_query\",\n  rollout_remove_feature_walkthrough_enabled:\n    \"rollout_remove_feature_walkthrough_enabled\",\n  rollout_eslint_enabled: \"rollout_eslint_enabled\",\n  release_drag_drop_building_blocks_enabled:\n    \"release_drag_drop_building_blocks_enabled\",\n  release_layout_conversion_enabled: \"release_layout_conversion_enabled\",\n  release_git_persist_branch_enabled: \"release_git_persist_branch_enabled\",\n  release_ide_animations_enabled: \"release_ide_animations_enabled\",\n  release_ide_datasource_selector_enabled:\n    \"release_ide_datasource_selector_enabled\",\n  release_custom_widget_ai_builder: \"release_custom_widget_ai_builder\",\n  release_evaluation_scope_cache: \"release_evaluation_scope_cache\",\n  release_gs_all_sheets_options_enabled:\n    \"release_gs_all_sheets_options_enabled\",\n  release_git_modularisation_enabled: \"release_git_modularisation_enabled\",\n  release_git_api_contracts_enabled: \"release_git_api_contracts_enabled\",\n  kill_session_recordings_enabled: \"kill_session_recordings_enabled\",\n  config_mask_session_recordings_enabled:\n    \"config_mask_session_recordings_enabled\",\n  config_user_session_recordings_enabled:\n    \"config_user_session_recordings_enabled\",\n  release_external_saas_plugins_enabled:\n    \"release_external_saas_plugins_enabled\",\n  release_table_infinitescroll_enabled: \"release_table_infinitescroll_enabled\",\n  license_multi_org_enabled: \"license_multi_org_enabled\",\n  release_table_custom_sort_function_enabled:\n    \"release_table_custom_sort_function_enabled\",\n  release_git_package_enabled: \"release_git_package_enabled\",\n  license_external_saas_plugins_enabled:\n    \"license_external_saas_plugins_enabled\",\n  release_computation_cache_enabled: \"release_computation_cache_enabled\",\n  release_ai_chat_integrations_enabled: \"release_ai_chat_integrations_enabled\",\n  release_reactive_actions_enabled: \"release_reactive_actions_enabled\",\n  license_ai_agent_instance_enabled: \"license_ai_agent_instance_enabled\",\n  configure_block_event_tracking_for_anonymous_users:\n    \"configure_block_event_tracking_for_anonymous_users\",\n  release_static_url_enabled: \"release_static_url_enabled\",\n  release_window_dimensions_enabled: \"release_window_dimensions_enabled\",\n} as const;\n\nexport type FeatureFlag = keyof typeof FEATURE_FLAG;\n\nexport type FeatureFlags = Record<FeatureFlag, boolean>;\n\nexport const DEFAULT_FEATURE_FLAG_VALUE: FeatureFlags = {\n  TEST_FLAG: true,\n  release_datasource_environments_enabled: false,\n  release_appnavigationlogoupload_enabled: false,\n  release_embed_hide_share_settings_enabled: false,\n  release_table_serverside_filtering_enabled: false,\n  license_branding_enabled: false,\n  license_sso_saml_enabled: false,\n  license_sso_oidc_enabled: false,\n  license_private_embeds_enabled: false,\n  release_show_publish_app_to_community_enabled: false,\n  license_gac_enabled: false,\n  release_anvil_enabled: false,\n  license_ai_agent_enabled: false,\n  release_drag_drop_building_blocks_enabled: false,\n  license_git_branch_protection_enabled: false,\n  license_git_continuous_delivery_enabled: false,\n  license_widget_rtl_support_enabled: false,\n  ab_one_click_learning_popover_enabled: false,\n  ab_appsmith_ai_query: false,\n  rollout_remove_feature_walkthrough_enabled: true,\n  rollout_eslint_enabled: false,\n  release_layout_conversion_enabled: false,\n  release_git_persist_branch_enabled: false,\n  release_ide_animations_enabled: false,\n  release_ide_datasource_selector_enabled: false,\n  release_custom_widget_ai_builder: false,\n  release_evaluation_scope_cache: false,\n  release_gs_all_sheets_options_enabled: false,\n  release_git_modularisation_enabled: false,\n  release_git_api_contracts_enabled: false,\n  kill_session_recordings_enabled: false,\n  config_user_session_recordings_enabled: true,\n  config_mask_session_recordings_enabled: true,\n  release_external_saas_plugins_enabled: false,\n  release_table_infinitescroll_enabled: false,\n  license_multi_org_enabled: false,\n  release_table_custom_sort_function_enabled: false,\n  release_git_package_enabled: false,\n  license_external_saas_plugins_enabled: false,\n  release_computation_cache_enabled: false,\n  release_ai_chat_integrations_enabled: false,\n  release_reactive_actions_enabled: false,\n  license_ai_agent_instance_enabled: false,\n  configure_block_event_tracking_for_anonymous_users: false,\n  release_static_url_enabled: false,\n  release_window_dimensions_enabled: false,\n};\n\nexport const AB_TESTING_EVENT_KEYS = {\n  abTestingFlagLabel: \"abTestingFlagLabel\",\n  abTestingFlagValue: \"abTestingFlagValue\",\n};",
            "output_extracted": "// Please follow naming convention : https://www.notion.so/appsmith/Using-Feature-Flags-in-Appsmith-d362fe7acc7d4ef0aa12e1f5f9b83b5f?pvs=4#f6d4242e56284e84af25cadef71b7aeb to create feature flags.\nexport const FEATURE_FLAG = {\n  TEST_FLAG: \"TEST_FLAG\",\n  release_datasource_environments_enabled:\n    \"release_datasource_environments_enabled\",\n  release_appnavigationlogoupload_enabled:\n    \"release_appnavigationlogoupload_enabled\",\n  release_embed_hide_share_settings_enabled:\n    \"release_embed_hide_share_settings_enabled\",\n  release_table_serverside_filtering_enabled:\n    \"release_table_serverside_filtering_enabled\",\n  license_branding_enabled: \"license_branding_enabled\",\n  license_sso_saml_enabled: \"license_sso_saml_enabled\",\n  license_sso_oidc_enabled: \"license_sso_oidc_enabled\",\n  license_private_embeds_enabled: \"license_private_embeds_enabled\",\n  release_show_publish_app_to_community_enabled:\n    \"release_show_publish_app_to_community_enabled\",\n  license_gac_enabled: \"license_gac_enabled\",\n  release_anvil_enabled: \"release_anvil_enabled\",\n  license_ai_agent_enabled: \"license_ai_agent_enabled\",\n  license_git_branch_protection_enabled:\n    \"license_git_branch_protection_enabled\",\n  license_git_continuous_delivery_enabled:\n    \"license_git_continuous_delivery_enabled\",\n  license_widget_rtl_support_enabled: \"license_widget_rtl_support_enabled\",\n  ab_one_click_learning_popover_enabled:\n    \"ab_one_click_learning_popover_enabled\",\n  ab_appsmith_ai_query: \"ab_appsmith_ai_query\",\n  rollout_remove_feature_walkthrough_enabled:\n    \"rollout_remove_feature_walkthrough_enabled\",\n  rollout_eslint_enabled: \"rollout_eslint_enabled\",\n  release_drag_drop_building_blocks_enabled:\n    \"release_drag_drop_building_blocks_enabled\",\n  release_layout_conversion_enabled: \"release_layout_conversion_enabled\",\n  release_git_persist_branch_enabled: \"release_git_persist_branch_enabled\",\n  release_ide_animations_enabled: \"release_ide_animations_enabled\",\n  release_ide_datasource_selector_enabled:\n    \"release_ide_datasource_selector_enabled\",\n  release_custom_widget_ai_builder: \"release_custom_widget_ai_builder\",\n  release_evaluation_scope_cache: \"release_evaluation_scope_cache\",\n  release_gs_all_sheets_options_enabled:\n    \"release_gs_all_sheets_options_enabled\",\n  release_git_modularisation_enabled: \"release_git_modularisation_enabled\",\n  release_git_api_contracts_enabled: \"release_git_api_contracts_enabled\",\n  kill_session_recordings_enabled: \"kill_session_recordings_enabled\",\n  config_mask_session_recordings_enabled:\n    \"config_mask_session_recordings_enabled\",\n  config_user_session_recordings_enabled:\n    \"config_user_session_recordings_enabled\",\n  release_external_saas_plugins_enabled:\n    \"release_external_saas_plugins_enabled\",\n  release_table_infinitescroll_enabled: \"release_table_infinitescroll_enabled\",\n  license_multi_org_enabled: \"license_multi_org_enabled\",\n  release_table_custom_sort_function_enabled:\n    \"release_table_custom_sort_function_enabled\",\n  release_git_package_enabled: \"release_git_package_enabled\",\n  license_external_saas_plugins_enabled:\n    \"license_external_saas_plugins_enabled\",\n  release_computation_cache_enabled: \"release_computation_cache_enabled\",\n  release_ai_chat_integrations_enabled: \"release_ai_chat_integrations_enabled\",\n  release_reactive_actions_enabled: \"release_reactive_actions_enabled\",\n  license_ai_agent_instance_enabled: \"license_ai_agent_instance_enabled\",\n  configure_block_event_tracking_for_anonymous_users:\n    \"configure_block_event_tracking_for_anonymous_users\",\n  release_static_url_enabled: \"release_static_url_enabled\",\n  release_window_dimensions_enabled: \"release_window_dimensions_enabled\",\n} as const;\n\nexport type FeatureFlag = keyof typeof FEATURE_FLAG;\n\nexport type FeatureFlags = Record<FeatureFlag, boolean>;\n\nexport const DEFAULT_FEATURE_FLAG_VALUE: FeatureFlags = {\n  TEST_FLAG: true,\n  release_datasource_environments_enabled: false,\n  release_appnavigationlogoupload_enabled: false,\n  release_embed_hide_share_settings_enabled: false,\n  release_table_serverside_filtering_enabled: false,\n  license_branding_enabled: false,\n  license_sso_saml_enabled: false,\n  license_sso_oidc_enabled: false,\n  license_private_embeds_enabled: false,\n  release_show_publish_app_to_community_enabled: false,\n  license_gac_enabled: false,\n  release_anvil_enabled: false,\n  license_ai_agent_enabled: false,\n  release_drag_drop_building_blocks_enabled: false,\n  license_git_branch_protection_enabled: false,\n  license_git_continuous_delivery_enabled: false,\n  license_widget_rtl_support_enabled: false,\n  ab_one_click_learning_popover_enabled: false,\n  ab_appsmith_ai_query: false,\n  rollout_remove_feature_walkthrough_enabled: true,\n  rollout_eslint_enabled: false,\n  release_layout_conversion_enabled: false,\n  release_git_persist_branch_enabled: false,\n  release_ide_animations_enabled: false,\n  release_ide_datasource_selector_enabled: false,\n  release_custom_widget_ai_builder: false,\n  release_evaluation_scope_cache: false,\n  release_gs_all_sheets_options_enabled: false,\n  release_git_modularisation_enabled: false,\n  release_git_api_contracts_enabled: false,\n  kill_session_recordings_enabled: false,\n  config_user_session_recordings_enabled: true,\n  config_mask_session_recordings_enabled: true,\n  release_external_saas_plugins_enabled: false,\n  release_table_infinitescroll_enabled: false,\n  license_multi_org_enabled: false,\n  release_table_custom_sort_function_enabled: false,\n  release_git_package_enabled: false,\n  license_external_saas_plugins_enabled: false,\n  release_computation_cache_enabled: false,\n  release_ai_chat_integrations_enabled: false,\n  release_reactive_actions_enabled: false,\n  license_ai_agent_instance_enabled: false,\n  configure_block_event_tracking_for_anonymous_users: false,\n  release_static_url_enabled: false,\n  release_window_dimensions_enabled: false,\n};\n\nexport const AB_TESTING_EVENT_KEYS = {\n  abTestingFlagLabel: \"abTestingFlagLabel\",\n  abTestingFlagValue: \"abTestingFlagValue\",\n};",
            "cost": 0.062925
        },
        "appsmithorg__appsmith.7046aeb3/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts": {
            "output": "import { ActionRunBehaviour } from \"PluginActionEditor/types/PluginActionTypes\";\n\nexport const RUN_BEHAVIOR_CONFIG_PROPERTY = \"runBehaviour\";\n\nexport const RUN_BEHAVIOR_VALUES = [\n  {\n    label: \"Automatic\",\n    subText: \"Query runs on page load or when a variable it depends on changes\",\n    value: ActionRunBehaviour.AUTOMATIC,\n    children: \"Automatic\",\n  },\n  {\n    label: \"On page load\",\n    subText: \"Query runs when the page loads or when manually triggered\",\n    value: ActionRunBehaviour.ON_PAGE_LOAD,\n    children: \"On page load\",\n  },\n  {\n    label: \"Manual\",\n    subText: \"Query only runs when called in an event or JS with .run()\",\n    value: ActionRunBehaviour.MANUAL,\n    children: \"Manual\",\n  },\n];",
            "output_extracted": "import { ActionRunBehaviour } from \"PluginActionEditor/types/PluginActionTypes\";\n\nexport const RUN_BEHAVIOR_CONFIG_PROPERTY = \"runBehaviour\";\n\nexport const RUN_BEHAVIOR_VALUES = [\n  {\n    label: \"Automatic\",\n    subText: \"Query runs on page load or when a variable it depends on changes\",\n    value: ActionRunBehaviour.AUTOMATIC,\n    children: \"Automatic\",\n  },\n  {\n    label: \"On page load\",\n    subText: \"Query runs when the page loads or when manually triggered\",\n    value: ActionRunBehaviour.ON_PAGE_LOAD,\n    children: \"On page load\",\n  },\n  {\n    label: \"Manual\",\n    subText: \"Query only runs when called in an event or JS with .run()\",\n    value: ActionRunBehaviour.MANUAL,\n    children: \"Manual\",\n  },\n];",
            "cost": 0.012885
        },
        "appsmithorg__appsmith.7046aeb3/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx": {
            "output": "import React, { useCallback, useState } from \"react\";\nimport {\n  Flex,\n  Option,\n  Select,\n  Text,\n  type SelectOptionProps,\n} from \"@appsmith/ads\";\nimport type { JSAction } from \"entities/JSCollection\";\nimport {\n  createMessage,\n  JS_EDITOR_SETTINGS,\n  NO_JS_FUNCTIONS,\n} from \"ee/constants/messages\";\nimport AnalyticsUtil from \"ee/utils/AnalyticsUtil\";\nimport type { OnUpdateSettingsProps } from \"../types\";\nimport {\n  ActionRunBehaviour,\n  type ActionRunBehaviourType,\n} from \"PluginActionEditor/types/PluginActionTypes\";\nimport styled from \"styled-components\";\nimport { RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\nimport { useFeatureFlag } from \"utils/hooks/useFeatureFlag\";\nimport { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n\nconst OptionLabel = styled(Text)`\n  color: var(--ads-v2-color-fg);\n  font-size: 14px;\n  font-weight: 500;\n`;\n\nconst OptionSubText = styled(Text)`\n  color: var(--ads-v2-color-fg-muted);\n  font-size: 12px;\n`;\n\nconst StyledSelect = styled(Select)`\n  width: fit-content;\n\n  .rc-select-selector {\n    min-width: 110px;\n  }\n`;\n\nconst FunctionName = styled(Text)`\n  word-break: break-all;\n`;\n\ninterface Props {\n  disabled: boolean;\n  actions: JSAction[];\n  onUpdateSettings: (props: OnUpdateSettingsProps) => void;\n}\n\ninterface FunctionSettingsRowProps extends Omit<Props, \"actions\"> {\n  action: JSAction;\n}\n\nconst FunctionSettingRow = (props: FunctionSettingsRowProps) => {\n  const [runBehaviour, setRunBehaviour] = useState(props.action.runBehaviour);\n  const isReactiveActionsEnabled = useFeatureFlag(\n    FEATURE_FLAG.release_reactive_actions_enabled,\n  );\n  const options = RUN_BEHAVIOR_VALUES.filter(\n    (option) =>\n      isReactiveActionsEnabled || option.value !== ActionRunBehaviour.AUTOMATIC,\n  ) as SelectOptionProps[];\n  let selectedValue = options.find((opt) => opt.value === runBehaviour);\n\n  /* temporary check added to switch from automatic to page load as the run behaviour when feature flag is turned off */\n  if (\n    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n    !isReactiveActionsEnabled\n  ) {\n    selectedValue = options.find(\n      (opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD,\n    );\n  }\n\n  const onSelectOptions = useCallback(\n    (newRunBehaviour: ActionRunBehaviourType) => {\n      setRunBehaviour(newRunBehaviour);\n      props.onUpdateSettings?.({\n        value: newRunBehaviour,\n        propertyName: \"runBehaviour\",\n        action: props.action,\n      });\n\n      AnalyticsUtil.logEvent(\"JS_OBJECT_SETTINGS_CHANGED\", {\n        toggleSetting: \"ON_PAGE_LOAD\",\n        toggleValue: newRunBehaviour,\n      });\n    },\n    [props],\n  );\n\n  return (\n    <Flex\n      alignItems=\"center\"\n      className={`t--async-js-function-settings ${props.action.name}-run-behavior-setting`}\n      gap=\"spaces-3\"\n      id={`${props.action.name}-settings`}\n      justifyContent=\"space-between\"\n      key={props.action.id}\n      w=\"100%\"\n    >\n      <FunctionName htmlFor={props.action.id} renderAs=\"label\">\n        {props.action.name}\n      </FunctionName>\n      <StyledSelect\n        data-testid={`t--dropdown-runBehaviour`}\n        dropdownMatchSelectWidth={256}\n        id={props.action.id}\n        isDisabled={props.disabled}\n        listHeight={240}\n        onSelect={onSelectOptions}\n        size=\"sm\"\n        value={selectedValue}\n      >\n        {options.map((option) => (\n          <Option\n            aria-label={option.label}\n            disabled={option.disabled}\n            key={option.value}\n            label={option.label}\n            value={option.value}\n          >\n            <Flex flexDirection=\"column\">\n              <OptionLabel data-testid={`t--label-${option.label}`}>\n                {option.label}\n              </OptionLabel>\n              <OptionSubText>{option.subText}</OptionSubText>\n            </Flex>\n          </Option>\n        ))}\n      </StyledSelect>\n    </Flex>\n  );\n};\n\n/**\n * JSFunctionSettings component renders a button and a popover for configuring JS function settings.\n * It conditionally renders the old or new version of the component based on a feature flag.\n */\nexport const JSFunctionSettings = (props: Props) => {\n  return (\n    <Flex flexDirection=\"column\" gap=\"spaces-4\" w=\"100%\">\n      <Text kind=\"heading-xs\">\n        {createMessage(JS_EDITOR_SETTINGS.ON_LOAD_TITLE)}\n      </Text>\n      {props.actions.map((action) => (\n        <FunctionSettingRow\n          action={action}\n          disabled={props.disabled}\n          key={action.id}\n          onUpdateSettings={props.onUpdateSettings}\n        />\n      ))}\n      {props.actions.length === 0 && (\n        <Text kind=\"body-s\">{createMessage(NO_JS_FUNCTIONS)}</Text>\n      )}\n    </Flex>\n  );\n};",
            "output_extracted": "import React, { useCallback, useState } from \"react\";\nimport {\n  Flex,\n  Option,\n  Select,\n  Text,\n  type SelectOptionProps,\n} from \"@appsmith/ads\";\nimport type { JSAction } from \"entities/JSCollection\";\nimport {\n  createMessage,\n  JS_EDITOR_SETTINGS,\n  NO_JS_FUNCTIONS,\n} from \"ee/constants/messages\";\nimport AnalyticsUtil from \"ee/utils/AnalyticsUtil\";\nimport type { OnUpdateSettingsProps } from \"../types\";\nimport {\n  ActionRunBehaviour,\n  type ActionRunBehaviourType,\n} from \"PluginActionEditor/types/PluginActionTypes\";\nimport styled from \"styled-components\";\nimport { RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\nimport { useFeatureFlag } from \"utils/hooks/useFeatureFlag\";\nimport { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n\nconst OptionLabel = styled(Text)`\n  color: var(--ads-v2-color-fg);\n  font-size: 14px;\n  font-weight: 500;\n`;\n\nconst OptionSubText = styled(Text)`\n  color: var(--ads-v2-color-fg-muted);\n  font-size: 12px;\n`;\n\nconst StyledSelect = styled(Select)`\n  width: fit-content;\n\n  .rc-select-selector {\n    min-width: 110px;\n  }\n`;\n\nconst FunctionName = styled(Text)`\n  word-break: break-all;\n`;\n\ninterface Props {\n  disabled: boolean;\n  actions: JSAction[];\n  onUpdateSettings: (props: OnUpdateSettingsProps) => void;\n}\n\ninterface FunctionSettingsRowProps extends Omit<Props, \"actions\"> {\n  action: JSAction;\n}\n\nconst FunctionSettingRow = (props: FunctionSettingsRowProps) => {\n  const [runBehaviour, setRunBehaviour] = useState(props.action.runBehaviour);\n  const isReactiveActionsEnabled = useFeatureFlag(\n    FEATURE_FLAG.release_reactive_actions_enabled,\n  );\n  const options = RUN_BEHAVIOR_VALUES.filter(\n    (option) =>\n      isReactiveActionsEnabled || option.value !== ActionRunBehaviour.AUTOMATIC,\n  ) as SelectOptionProps[];\n  let selectedValue = options.find((opt) => opt.value === runBehaviour);\n\n  /* temporary check added to switch from automatic to page load as the run behaviour when feature flag is turned off */\n  if (\n    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n    !isReactiveActionsEnabled\n  ) {\n    selectedValue = options.find(\n      (opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD,\n    );\n  }\n\n  const onSelectOptions = useCallback(\n    (newRunBehaviour: ActionRunBehaviourType) => {\n      setRunBehaviour(newRunBehaviour);\n      props.onUpdateSettings?.({\n        value: newRunBehaviour,\n        propertyName: \"runBehaviour\",\n        action: props.action,\n      });\n\n      AnalyticsUtil.logEvent(\"JS_OBJECT_SETTINGS_CHANGED\", {\n        toggleSetting: \"ON_PAGE_LOAD\",\n        toggleValue: newRunBehaviour,\n      });\n    },\n    [props],\n  );\n\n  return (\n    <Flex\n      alignItems=\"center\"\n      className={`t--async-js-function-settings ${props.action.name}-run-behavior-setting`}\n      gap=\"spaces-3\"\n      id={`${props.action.name}-settings`}\n      justifyContent=\"space-between\"\n      key={props.action.id}\n      w=\"100%\"\n    >\n      <FunctionName htmlFor={props.action.id} renderAs=\"label\">\n        {props.action.name}\n      </FunctionName>\n      <StyledSelect\n        data-testid={`t--dropdown-runBehaviour`}\n        dropdownMatchSelectWidth={256}\n        id={props.action.id}\n        isDisabled={props.disabled}\n        listHeight={240}\n        onSelect={onSelectOptions}\n        size=\"sm\"\n        value={selectedValue}\n      >\n        {options.map((option) => (\n          <Option\n            aria-label={option.label}\n            disabled={option.disabled}\n            key={option.value}\n            label={option.label}\n            value={option.value}\n          >\n            <Flex flexDirection=\"column\">\n              <OptionLabel data-testid={`t--label-${option.label}`}>\n                {option.label}\n              </OptionLabel>\n              <OptionSubText>{option.subText}</OptionSubText>\n            </Flex>\n          </Option>\n        ))}\n      </StyledSelect>\n    </Flex>\n  );\n};\n\n/**\n * JSFunctionSettings component renders a button and a popover for configuring JS function settings.\n * It conditionally renders the old or new version of the component based on a feature flag.\n */\nexport const JSFunctionSettings = (props: Props) => {\n  return (\n    <Flex flexDirection=\"column\" gap=\"spaces-4\" w=\"100%\">\n      <Text kind=\"heading-xs\">\n        {createMessage(JS_EDITOR_SETTINGS.ON_LOAD_TITLE)}\n      </Text>\n      {props.actions.map((action) => (\n        <FunctionSettingRow\n          action={action}\n          disabled={props.disabled}\n          key={action.id}\n          onUpdateSettings={props.onUpdateSettings}\n        />\n      ))}\n      {props.actions.length === 0 && (\n        <Text kind=\"body-s\">{createMessage(NO_JS_FUNCTIONS)}</Text>\n      )}\n    </Flex>\n  );\n};",
            "cost": 0.05334
        }
    },
    "recover_status": "success",
    "instance_ref": {
        "instance_id": "appsmithorg__appsmith.main.41008",
        "repo": "appsmithorg/appsmith",
        "base_commit": "1789339e27785386a79722c7550d7f560e04093f",
        "head_commit": "fe0b50052e7e8a0d1f74f75016657ca78ea25c7d",
        "title": "feat: add onPageUnload option in UI behind feature flag.",
        "merged_at": "2025-06-23T08:46:22Z",
        "html_url": "https://github.com/appsmithorg/appsmith/pull/41008",
        "test_files": [
            "app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts"
        ],
        "code_files": [
            "app/client/src/PluginActionEditor/types/PluginActionTypes.ts",
            "app/client/src/ce/entities/FeatureFlag.ts",
            "app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts",
            "app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx",
            "app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts"
        ],
        "total_changes": 280,
        "num_files": 6,
        "pull_number": 41008,
        "patch": "diff --git a/app/client/src/PluginActionEditor/types/PluginActionTypes.ts b/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\nindex f81d82a2485..735c9652dce 100644\n--- a/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\n+++ b/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\n@@ -6,6 +6,7 @@ export enum ActionRunBehaviour {\n   ON_PAGE_LOAD = \"ON_PAGE_LOAD\",\n   MANUAL = \"MANUAL\",\n   AUTOMATIC = \"AUTOMATIC\",\n+  ON_PAGE_UNLOAD = \"ON_PAGE_UNLOAD\",\n }\n \n export type ActionRunBehaviourType = `${ActionRunBehaviour}`;\ndiff --git a/app/client/src/ce/entities/FeatureFlag.ts b/app/client/src/ce/entities/FeatureFlag.ts\nindex a6d84c60537..120af37c6d6 100644\n--- a/app/client/src/ce/entities/FeatureFlag.ts\n+++ b/app/client/src/ce/entities/FeatureFlag.ts\n@@ -60,6 +60,8 @@ export const FEATURE_FLAG = {\n   release_ai_chat_integrations_enabled: \"release_ai_chat_integrations_enabled\",\n   release_reactive_actions_enabled: \"release_reactive_actions_enabled\",\n   license_ai_agent_instance_enabled: \"license_ai_agent_instance_enabled\",\n+  release_jsobjects_onpageunloadactions_enabled:\n+    \"release_jsobjects_onpageunloadactions_enabled\",\n } as const;\n \n export type FeatureFlag = keyof typeof FEATURE_FLAG;\n@@ -110,6 +112,7 @@ export const DEFAULT_FEATURE_FLAG_VALUE: FeatureFlags = {\n   release_ai_chat_integrations_enabled: false,\n   release_reactive_actions_enabled: false,\n   license_ai_agent_instance_enabled: false,\n+  release_jsobjects_onpageunloadactions_enabled: false,\n };\n \n export const AB_TESTING_EVENT_KEYS = {\ndiff --git a/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts b/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\nindex ff0dfc07892..fb530fa2a7f 100644\n--- a/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\n+++ b/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\n@@ -22,3 +22,13 @@ export const RUN_BEHAVIOR_VALUES = [\n     children: \"Manual\",\n   },\n ];\n+\n+export const JS_OBJECT_RUN_BEHAVIOR_VALUES = [\n+  ...RUN_BEHAVIOR_VALUES,\n+  {\n+    label: \"On page unload\",\n+    subText: \"Query runs when the page unloads or when manually triggered\",\n+    value: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+    children: \"On page unload\",\n+  },\n+];\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\nindex d537ae3cbc7..4f228569896 100644\n--- a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\n@@ -1,27 +1,21 @@\n-import React, { useCallback, useState } from \"react\";\n-import {\n-  Flex,\n-  Option,\n-  Select,\n-  Text,\n-  type SelectOptionProps,\n-} from \"@appsmith/ads\";\n-import type { JSAction } from \"entities/JSCollection\";\n+import { Flex, Option, Select, Text } from \"@appsmith/ads\";\n import {\n   createMessage,\n   JS_EDITOR_SETTINGS,\n   NO_JS_FUNCTIONS,\n } from \"ee/constants/messages\";\n+import { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n import AnalyticsUtil from \"ee/utils/AnalyticsUtil\";\n-import type { OnUpdateSettingsProps } from \"../types\";\n-import {\n-  ActionRunBehaviour,\n-  type ActionRunBehaviourType,\n-} from \"PluginActionEditor/types/PluginActionTypes\";\n+import type { JSAction } from \"entities/JSCollection\";\n+import { type ActionRunBehaviourType } from \"PluginActionEditor/types/PluginActionTypes\";\n+import React, { useCallback, useMemo, useState } from \"react\";\n import styled from \"styled-components\";\n-import { RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n import { useFeatureFlag } from \"utils/hooks/useFeatureFlag\";\n-import { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n+import type { OnUpdateSettingsProps } from \"../types\";\n+import {\n+  getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled,\n+  getRunBehaviorOptionsBasedOnFeatureFlags,\n+} from \"./utils\";\n \n const OptionLabel = styled(Text)`\n   color: var(--ads-v2-color-fg);\n@@ -61,20 +55,31 @@ const FunctionSettingRow = (props: FunctionSettingsRowProps) => {\n   const isReactiveActionsEnabled = useFeatureFlag(\n     FEATURE_FLAG.release_reactive_actions_enabled,\n   );\n-  const options = RUN_BEHAVIOR_VALUES.filter(\n-    (option) =>\n-      isReactiveActionsEnabled || option.value !== ActionRunBehaviour.AUTOMATIC,\n-  ) as SelectOptionProps[];\n+  const isOnPageUnloadEnabled = useFeatureFlag(\n+    FEATURE_FLAG.release_jsobjects_onpageunloadactions_enabled,\n+  );\n+\n+  const options = useMemo(\n+    () =>\n+      getRunBehaviorOptionsBasedOnFeatureFlags(\n+        isReactiveActionsEnabled,\n+        isOnPageUnloadEnabled,\n+      ),\n+    [isReactiveActionsEnabled, isOnPageUnloadEnabled],\n+  );\n+\n   let selectedValue = options.find((opt) => opt.value === runBehaviour);\n \n-  /* temporary check added to switch from automatic to page load as the run behaviour when feature flag is turned off */\n-  if (\n-    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n-    !isReactiveActionsEnabled\n-  ) {\n-    selectedValue = options.find(\n-      (opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD,\n+  const defaultRunBehaviourOption =\n+    getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled(\n+      runBehaviour,\n+      isReactiveActionsEnabled,\n+      isOnPageUnloadEnabled,\n+      options,\n     );\n+\n+  if (defaultRunBehaviourOption) {\n+    selectedValue = defaultRunBehaviourOption;\n   }\n \n   const onSelectOptions = useCallback(\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts\nnew file mode 100644\nindex 00000000000..3887fa94eb1\n--- /dev/null\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts\n@@ -0,0 +1,151 @@\n+import {\n+  ActionRunBehaviour,\n+  type ActionRunBehaviourType,\n+} from \"PluginActionEditor/types/PluginActionTypes\";\n+import {\n+  getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled,\n+  getRunBehaviorOptionsBasedOnFeatureFlags,\n+} from \"./utils\";\n+import { JS_OBJECT_RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n+import type { SelectOptionProps } from \"@appsmith/ads\";\n+\n+describe(\"getRunBehaviorOptions\", () => {\n+  it(\"should return the correct options\", () => {\n+    const flagsOutputMatrix: {\n+      isReactiveActionsEnabled: boolean;\n+      isOnPageUnloadEnabled: boolean;\n+      expectedOptions: SelectOptionProps[];\n+    }[] = [\n+      {\n+        isReactiveActionsEnabled: true,\n+        isOnPageUnloadEnabled: true,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES,\n+      },\n+      {\n+        isReactiveActionsEnabled: false,\n+        isOnPageUnloadEnabled: true,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) => option.value !== ActionRunBehaviour.AUTOMATIC,\n+        ),\n+      },\n+      {\n+        isReactiveActionsEnabled: true,\n+        isOnPageUnloadEnabled: false,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) => option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD,\n+        ),\n+      },\n+      {\n+        isReactiveActionsEnabled: false,\n+        isOnPageUnloadEnabled: false,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) =>\n+            option.value !== ActionRunBehaviour.AUTOMATIC &&\n+            option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD,\n+        ),\n+      },\n+    ];\n+\n+    flagsOutputMatrix.forEach(\n+      ({\n+        expectedOptions,\n+        isOnPageUnloadEnabled,\n+        isReactiveActionsEnabled,\n+      }) => {\n+        const options = getRunBehaviorOptionsBasedOnFeatureFlags(\n+          isReactiveActionsEnabled,\n+          isOnPageUnloadEnabled,\n+        );\n+\n+        expect(options).toEqual(expectedOptions);\n+      },\n+    );\n+  });\n+});\n+\n+describe(\"getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled\", () => {\n+  const onPageLoadOption =\n+    JS_OBJECT_RUN_BEHAVIOR_VALUES.find(\n+      (option) => option.value === ActionRunBehaviour.ON_PAGE_LOAD,\n+    ) ?? null;\n+  const manualOption =\n+    JS_OBJECT_RUN_BEHAVIOR_VALUES.find(\n+      (option) => option.value === ActionRunBehaviour.MANUAL,\n+    ) ?? null;\n+\n+  const flagsOutputMatrix: {\n+    runBehaviour: ActionRunBehaviourType;\n+    isReactiveActionsEnabled: boolean;\n+    isOnPageUnloadEnabled: boolean;\n+    expectedOption: SelectOptionProps | null;\n+  }[] = [\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: onPageLoadOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: onPageLoadOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: manualOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: manualOption,\n+    },\n+  ];\n+\n+  it(\"should return the correct options\", () => {\n+    flagsOutputMatrix.forEach(\n+      ({\n+        expectedOption,\n+        isOnPageUnloadEnabled,\n+        isReactiveActionsEnabled,\n+        runBehaviour,\n+      }) => {\n+        const option = getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled(\n+          runBehaviour,\n+          isReactiveActionsEnabled,\n+          isOnPageUnloadEnabled,\n+          JS_OBJECT_RUN_BEHAVIOR_VALUES,\n+        );\n+\n+        expect(option).toEqual(expectedOption);\n+      },\n+    );\n+  });\n+});\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts\nnew file mode 100644\nindex 00000000000..08a449a86ff\n--- /dev/null\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts\n@@ -0,0 +1,56 @@\n+import {\n+  ActionRunBehaviour,\n+  type ActionRunBehaviourType,\n+} from \"PluginActionEditor/types/PluginActionTypes\";\n+import { JS_OBJECT_RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n+\n+import { type SelectOptionProps } from \"@appsmith/ads\";\n+/**\n+ * Returns the list of run behavior options based on the current feature flags.\n+ * - If reactive actions are disabled, removes AUTOMATIC.\n+ * - If onPageUnload is disabled, removes ON_PAGE_UNLOAD.\n+ */\n+export const getRunBehaviorOptionsBasedOnFeatureFlags = (\n+  isReactiveActionsEnabled: boolean,\n+  isOnPageUnloadEnabled: boolean,\n+) =>\n+  JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+    (option) =>\n+      (isReactiveActionsEnabled ||\n+        option.value !== ActionRunBehaviour.AUTOMATIC) &&\n+      (isOnPageUnloadEnabled ||\n+        option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD),\n+  ) as SelectOptionProps[];\n+\n+/**\n+ * Returns the default run behavior option if the current one is no longer available due to feature flag changes.\n+ * - AUTOMATIC falls back to ON_PAGE_LOAD if reactive actions are disabled.\n+ * - ON_PAGE_UNLOAD falls back to MANUAL if onPageUnload is disabled.\n+ */\n+export const getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled = (\n+  runBehaviour: ActionRunBehaviourType,\n+  isReactiveActionsEnabled: boolean,\n+  isOnPageUnloadEnabled: boolean,\n+  options: SelectOptionProps[],\n+): SelectOptionProps | null => {\n+  if (\n+    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n+    !isReactiveActionsEnabled\n+  ) {\n+    return (\n+      options.find((opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD) ??\n+      null\n+    );\n+  }\n+\n+  if (\n+    runBehaviour === ActionRunBehaviour.ON_PAGE_UNLOAD &&\n+    !isOnPageUnloadEnabled\n+  ) {\n+    return (\n+      options.find((opt) => opt.value === ActionRunBehaviour.MANUAL) ?? null\n+    );\n+  }\n+\n+  return null;\n+};\n",
        "pr_mirror": "appsmithorg__appsmith.7046aeb3"
    }
}