[
  {
    "instance_id": "sanity-io__sanity.615e6c01.11410",
    "repo": "sanity-io__sanity.615e6c01",
    "base_commit": "615e6c01",
    "patch": "diff --git a/packages/@sanity/cli/src/commands/blueprints/configBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/configBlueprintsCommand.ts\nindex a4d1ad0..f35cb05 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/configBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/configBlueprintsCommand.ts\n@@ -2,10 +2,9 @@ import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n Options\n-  --edit, -e           Modify the configuration interactively, or directly when combined with ID flags.\n-  --project-id <id>    Directly set the Project ID in the configuration. Requires --edit flag\n-  --stack-id <id>      Directly set the Stack ID in the configuration. Requires --edit flag\n-  --verbose            Output verbose logs\n+  --edit, -e           Edit the configuration\n+  --test, -t           Test the configuration\n+  --project-id <id>    Project ID to use\n \n Examples:\n   # View current configuration\n@@ -13,9 +12,18 @@ Examples:\n \n   # Edit configuration\n   sanity blueprints config --edit\n+\n+  # Test configuration\n+  sanity blueprints config --test\n+\n+  # Edit and test configuration\n+  sanity blueprints config -et\n `\n \n export interface BlueprintsConfigFlags {\n+  'test-config'?: boolean\n+  'test'?: boolean\n+  't'?: boolean\n   'edit'?: boolean\n   'e'?: boolean\n   'project-id'?: string\n@@ -24,7 +32,6 @@ export interface BlueprintsConfigFlags {\n   'stack-id'?: string\n   'stackId'?: string\n   'stack'?: string\n-  'verbose'?: boolean\n }\n \n const defaultFlags: BlueprintsConfigFlags = {\n@@ -35,7 +42,7 @@ const configBlueprintsCommand: CliCommandDefinition<BlueprintsConfigFlags> = {\n   name: 'config',\n   group: 'blueprints',\n   helpText,\n-  signature: '[--edit] [--project-id <id>] [--stack-id <id>] [--verbose]',\n+  signature: '[--edit] [-e] [--test] [-t] [--project-id <id>]',\n   description: 'View or edit local Blueprints configuration',\n \n   async action(args, context) {\n@@ -67,8 +74,8 @@ const configBlueprintsCommand: CliCommandDefinition<BlueprintsConfigFlags> = {\n       flags: {\n         'project-id': flags['project-id'] ?? flags.projectId ?? flags.project,\n         'stack-id': flags['stack-id'] ?? flags.stackId ?? flags.stack,\n+        'test-config': flags['test-config'] ?? flags.test ?? flags.t,\n         'edit': flags.edit ?? flags.e,\n-        'verbose': flags.verbose,\n       },\n     })\n \n@@ -76,4 +83,4 @@ const configBlueprintsCommand: CliCommandDefinition<BlueprintsConfigFlags> = {\n   },\n }\n \n-export default configBlueprintsCommand\n+export default configBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/deployBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/deployBlueprintsCommand.ts\nindex 68b84c3..a0d6627 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/deployBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/deployBlueprintsCommand.ts\n@@ -2,7 +2,7 @@ import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n Options\n-  --no-wait    Do not wait for Stack deployment to complete\n+  --no-wait    Do not wait for deployment to complete\n \n Examples:\n   # Deploy the current blueprint\n@@ -25,7 +25,7 @@ const deployBlueprintsCommand: CliCommandDefinition<BlueprintsDeployFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '[--no-wait]',\n-  description: 'Deploy a Blueprint',\n+  description: 'Deploy a Blueprint to create or update a Stack',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -60,4 +60,4 @@ const deployBlueprintsCommand: CliCommandDefinition<BlueprintsDeployFlags> = {\n   },\n }\n \n-export default deployBlueprintsCommand\n+export default deployBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/destroyBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/destroyBlueprintsCommand.ts\nindex 16f5371..b4ed600 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/destroyBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/destroyBlueprintsCommand.ts\n@@ -2,8 +2,6 @@ import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n Options\n-  --project-id   Project associated with the Stack\n-  --stack-id     Stack ID to destroy (defaults to current Stack)\n   --force, -f    Force destroy without confirmation\n   --no-wait      Do not wait for destroy to complete\n \n@@ -38,9 +36,8 @@ const destroyBlueprintsCommand: CliCommandDefinition<BlueprintsDestroyFlags> = {\n   name: 'destroy',\n   group: 'blueprints',\n   helpText,\n-  signature: '[--project-id <value> --stack-id <value> --force] [--no-wait]',\n-  description:\n-    'Destroy a Blueprint Stack deployment and its resources (will not delete local files)',\n+  signature: '[--force] [-f] [--no-wait]',\n+  description: 'Destroy a Blueprint deployment',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -78,4 +75,4 @@ const destroyBlueprintsCommand: CliCommandDefinition<BlueprintsDestroyFlags> = {\n   },\n }\n \n-export default destroyBlueprintsCommand\n+export default destroyBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/doctorBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/doctorBlueprintsCommand.ts\nindex 8769bdc..d2e5da0 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/doctorBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/doctorBlueprintsCommand.ts\n@@ -1,9 +1,6 @@\n import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n-Options\n-  --verbose  Provide detailed information about issues\n-\n Examples:\n   # Check the health of the current Blueprint project\n   sanity blueprints doctor --verbose\n@@ -23,7 +20,7 @@ const doctorBlueprintsCommand: CliCommandDefinition<BlueprintsDoctorFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '[--verbose]',\n-  description: 'Diagnose potential issues with Blueprint configuration',\n+  description: 'Check the health of a Blueprint project',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -56,4 +53,4 @@ const doctorBlueprintsCommand: CliCommandDefinition<BlueprintsDoctorFlags> = {\n   },\n }\n \n-export default doctorBlueprintsCommand\n+export default doctorBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/infoBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/infoBlueprintsCommand.ts\nindex c07546e..64fc178 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/infoBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/infoBlueprintsCommand.ts\n@@ -19,7 +19,7 @@ const infoBlueprintsCommand: CliCommandDefinition<BlueprintsInfoFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '',\n-  description: 'Show information about a Blueprint Stack deployment',\n+  description: 'Retrieve information about a Blueprint Stack',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -52,4 +52,4 @@ const infoBlueprintsCommand: CliCommandDefinition<BlueprintsInfoFlags> = {\n   },\n }\n \n-export default infoBlueprintsCommand\n+export default infoBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/initBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/initBlueprintsCommand.ts\nindex 04f301b..df02de3 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/initBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/initBlueprintsCommand.ts\n@@ -5,11 +5,8 @@ Arguments\n   [dir]  Path to initialize the Blueprint in\n \n Options\n-  --blueprint-type, --type <json>    Blueprint manifest type to use for the Blueprint (json|js|ts)\n-  --project-id <id>                  Sanity Project ID to use for the Blueprint\n-  --stack-id <id>                    Existing Stack ID to use for the Blueprint\n-  --stack-name <id>                  Name to use for a NEW Stack\n-  --verbose                          Verbose output\n+  --blueprint-type, --type <json>    Type of Blueprint to create\n+  --project-id <id>                  Project ID to use\n \n Examples:\n   # Create a new Blueprint project in the current directory\n@@ -35,7 +32,6 @@ export interface BlueprintsInitFlags {\n   'stack'?: string\n   'stack-name'?: string\n   'name'?: string\n-  'verbose'?: boolean\n }\n \n const defaultFlags: BlueprintsInitFlags = {\n@@ -47,7 +43,7 @@ const initBlueprintsCommand: CliCommandDefinition<BlueprintsInitFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '[dir] [--blueprint-type <type>] [--project-id <id>]',\n-  description: 'Initialize a new Blueprint',\n+  description: 'Initialize a new Blueprint manifest file',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -93,7 +89,6 @@ const initBlueprintsCommand: CliCommandDefinition<BlueprintsInitFlags> = {\n         'project-id': flags['project-id'] ?? flags.projectId ?? flags.project,\n         'stack-id': flags['stack-id'] ?? flags.stackId ?? flags.stack,\n         'stack-name': flags['stack-name'] ?? flags.name,\n-        'verbose': flags.verbose,\n       },\n     })\n \n@@ -101,4 +96,4 @@ const initBlueprintsCommand: CliCommandDefinition<BlueprintsInitFlags> = {\n   },\n }\n \n-export default initBlueprintsCommand\n+export default initBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/logsBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/logsBlueprintsCommand.ts\nindex 7fc865a..5c96693 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/logsBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/logsBlueprintsCommand.ts\n@@ -2,7 +2,7 @@ import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n Options\n-  --watch, -w    Watch for new Stack logs (streaming mode)\n+  --watch, -w    Watch for new logs (streaming mode)\n \n Examples:\n   # Show logs for the current Stack\n@@ -26,7 +26,7 @@ const logsBlueprintsCommand: CliCommandDefinition<BlueprintsLogsFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '[--watch] [-w]',\n-  description: 'Display logs for a Blueprint Stack deployment',\n+  description: 'Display logs for the current Blueprint Stack',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -63,4 +63,4 @@ const logsBlueprintsCommand: CliCommandDefinition<BlueprintsLogsFlags> = {\n   },\n }\n \n-export default logsBlueprintsCommand\n+export default logsBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/planBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/planBlueprintsCommand.ts\nindex 3ba2a0e..78920b1 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/planBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/planBlueprintsCommand.ts\n@@ -3,19 +3,12 @@ import {type CliCommandDefinition} from '../../types'\n const helpText = `\n Safe to run at any time. Will not modify any Resources.\n \n-Options\n-  --version Verbose output\n-\n Examples:\n   # Show deployment plan for the current Blueprint\n   sanity blueprints plan\n `\n \n export interface BlueprintsPlanFlags {\n-  verbose?: boolean\n-}\n-\n-const defaultFlags: BlueprintsPlanFlags = {\n   //\n }\n \n@@ -24,11 +17,10 @@ const planBlueprintsCommand: CliCommandDefinition<BlueprintsPlanFlags> = {\n   group: 'blueprints',\n   helpText,\n   signature: '',\n-  description: 'Enumerate resources to be deployed - will not modify any resources',\n+  description: 'Enumerate Resources to be deployed',\n \n   async action(args, context) {\n     const {apiClient, output} = context\n-    const flags = {...defaultFlags, ...args.extOptions}\n \n     const client = apiClient({\n       requireUser: true,\n@@ -50,13 +42,10 @@ const planBlueprintsCommand: CliCommandDefinition<BlueprintsPlanFlags> = {\n \n     const {success, error} = await blueprintPlanCore({\n       ...cmdConfig.value,\n-      flags: {\n-        verbose: flags.verbose,\n-      },\n     })\n \n     if (!success) throw new Error(error)\n   },\n }\n \n-export default planBlueprintsCommand\n+export default planBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/blueprints/stacksBlueprintsCommand.ts b/packages/@sanity/cli/src/commands/blueprints/stacksBlueprintsCommand.ts\nindex 1320264..c9d238b 100644\n--- a/packages/@sanity/cli/src/commands/blueprints/stacksBlueprintsCommand.ts\n+++ b/packages/@sanity/cli/src/commands/blueprints/stacksBlueprintsCommand.ts\n@@ -2,7 +2,7 @@ import {type CliCommandDefinition} from '../../types'\n \n const helpText = `\n Options\n-  --project-id <id>       Project ID to use\n+  --project-id <id>    Project ID to use\n \n Examples:\n   # List all Stacks for the current Project\n@@ -16,7 +16,6 @@ export interface BlueprintsStacksFlags {\n   'project-id'?: string\n   'projectId'?: string\n   'project'?: string\n-  'verbose'?: boolean\n }\n \n const defaultFlags: BlueprintsStacksFlags = {\n@@ -27,9 +26,9 @@ const stacksBlueprintsCommand: CliCommandDefinition<BlueprintsStacksFlags> = {\n   name: 'stacks',\n   group: 'blueprints',\n   helpText,\n-  signature: '[--project-id <value>]',\n-  description: 'List all Blueprint Stacks',\n-  hideFromHelp: false,\n+  signature: '[--project-id <id>]',\n+  description: 'List all Blueprint Stacks for the current Project',\n+  hideFromHelp: true,\n \n   async action(args, context) {\n     const {apiClient, output} = context\n@@ -57,7 +56,6 @@ const stacksBlueprintsCommand: CliCommandDefinition<BlueprintsStacksFlags> = {\n       ...cmdConfig.value,\n       flags: {\n         'project-id': flags['project-id'] ?? flags.projectId ?? flags.project,\n-        'verbose': flags.verbose,\n       },\n     })\n \n@@ -65,4 +63,4 @@ const stacksBlueprintsCommand: CliCommandDefinition<BlueprintsStacksFlags> = {\n   },\n }\n \n-export default stacksBlueprintsCommand\n+export default stacksBlueprintsCommand\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/src/commands/index.ts b/packages/@sanity/cli/src/commands/index.ts\nindex 771600d..6ea4ccc 100644\n--- a/packages/@sanity/cli/src/commands/index.ts\n+++ b/packages/@sanity/cli/src/commands/index.ts\n@@ -9,7 +9,7 @@ import infoBlueprintsCommand from './blueprints/infoBlueprintsCommand'\n import initBlueprintsCommand from './blueprints/initBlueprintsCommand'\n import logsBlueprintsCommand from './blueprints/logsBlueprintsCommand'\n import planBlueprintsCommand from './blueprints/planBlueprintsCommand'\n-import stacksBlueprintsCommand from './blueprints/stacksBlueprintsCommand'\n+import listBlueprintsCommand from './blueprints/stacksBlueprintsCommand'\n import codemodCommand from './codemod/codemodCommand'\n import debugCommand from './debug/debugCommand'\n import browseCommand from './docs/browseCommand'\n@@ -82,7 +82,7 @@ export const baseCommands: (CliCommandDefinition | CliCommandGroupDefinition)[]\n   doctorBlueprintsCommand,\n   infoBlueprintsCommand,\n   initBlueprintsCommand,\n+  listBlueprintsCommand,\n   logsBlueprintsCommand,\n   planBlueprintsCommand,\n-  stacksBlueprintsCommand,\n-]\n+]\n\\ No newline at end of file\ndiff --git a/packages/@sanity/cli/test/blueprints.test.ts b/packages/@sanity/cli/test/blueprints.test.ts\nindex 3728707..6c68025 100644\n--- a/packages/@sanity/cli/test/blueprints.test.ts\n+++ b/packages/@sanity/cli/test/blueprints.test.ts\n@@ -300,17 +300,11 @@ describe('blueprints commands with mocked cores', () => {\n \n   describe('plan command', () => {\n     it('should call blueprintPlanCore with blueprint', async () => {\n-      const args: CliCommandArguments = {\n-        ...emptyArgs,\n-        extOptions: {verbose: true},\n-      }\n-\n-      // sanity blueprints plan --verbose\n-      await planBlueprintsCommand.action(args, mockContext)\n+      // sanity blueprints plan\n+      await planBlueprintsCommand.action(emptyArgs, mockContext)\n \n       expect(mockCores.blueprintPlanCore).toHaveBeenCalledWith({\n         ...config,\n-        flags: {verbose: true},\n       })\n     })\n   })\n@@ -333,4 +327,4 @@ describe('blueprints commands with mocked cores', () => {\n       })\n     })\n   })\n-})\n+})\n\\ No newline at end of file\n",
    "problem_statement": "",
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": []
  },
  {
    "instance_id": "sanity-io__sanity.615e6c01.11358",
    "repo": "sanity-io__sanity.615e6c01",
    "base_commit": "615e6c01",
    "patch": "diff --git a/dev/test-studio/schema/debug/customEnhancedObjectField.tsx b/dev/test-studio/schema/debug/customEnhancedObjectField.tsx\ndeleted file mode 100644\nindex 1ffda66..0000000\n--- a/dev/test-studio/schema/debug/customEnhancedObjectField.tsx\n+++ /dev/null\n@@ -1,10 +0,0 @@\n-export const CustomEnhancedObjectField = (props: any) => {\n-  return (\n-    <div style={{border: '1px solid palegreen', borderRadius: 4}}>\n-      {props.renderDefault({\n-        ...props,\n-        title: undefined,\n-      })}\n-    </div>\n-  )\n-}\ndiff --git a/dev/test-studio/schema/debug/customEnhancedObjectInput.tsx b/dev/test-studio/schema/debug/customEnhancedObjectInput.tsx\ndeleted file mode 100644\nindex 07c355e..0000000\n--- a/dev/test-studio/schema/debug/customEnhancedObjectInput.tsx\n+++ /dev/null\n@@ -1,3 +0,0 @@\n-export const CustomEnhancedObjectInput = (props: any) => {\n-  return <div style={{border: '1px solid red', borderRadius: 4}}>{props.renderDefault(props)}</div>\n-}\ndiff --git a/dev/test-studio/schema/debug/objectsDebug.ts b/dev/test-studio/schema/debug/objectsDebug.ts\nindex a3f66fc..508537b 100644\n--- a/dev/test-studio/schema/debug/objectsDebug.ts\n+++ b/dev/test-studio/schema/debug/objectsDebug.ts\n@@ -7,8 +7,6 @@ import {\n } from 'sanity'\n \n import {SideBySideObjectInput, SideBySideObjectItem} from './components/SideBySideObjectInput'\n-import {CustomEnhancedObjectField} from './customEnhancedObjectField'\n-import {CustomEnhancedObjectInput} from './customEnhancedObjectInput'\n import {PageBlockAnchor} from './PageBlockAnchor'\n \n const animal = defineField({\n@@ -21,17 +19,6 @@ const animal = defineField({\n       type: 'string',\n       title: 'Animal name',\n     },\n-    {\n-      name: 'arrayOfNumbersAnimals',\n-      type: 'array',\n-      title: 'Array of numbers animals',\n-      of: [\n-        {\n-          type: 'number',\n-          title: 'Number',\n-        },\n-      ],\n-    },\n     {\n       type: 'array',\n       name: 'description',\n@@ -261,32 +248,6 @@ const animal = defineField({\n         },\n       ],\n     },\n-    {\n-      name: 'arrayWithNoTitle',\n-      title: 'Array with custom field',\n-      type: 'array',\n-      components: {\n-        field: CustomEnhancedObjectField,\n-        input: CustomEnhancedObjectInput,\n-      },\n-      of: [\n-        {\n-          type: 'object',\n-          name: 'obj',\n-          title: 'Some object',\n-          fields: [\n-            {\n-              name: 'title',\n-              type: 'string',\n-            },\n-            {\n-              name: 'description',\n-              type: 'string',\n-            },\n-          ],\n-        },\n-      ],\n-    },\n     {\n       type: 'array',\n       name: 'children',\n@@ -638,423 +599,4 @@ const arrayOfAnonymousObjects = defineField({\n \n const objectWithArray = defineField({\n   type: 'object',\n-  name: 'objectWithArray',\n-  title: 'Object with array',\n-  fields: [\n-    {\n-      type: 'array',\n-      name: 'animalss',\n-      title: 'Animals',\n-      of: [animal],\n-    },\n-  ],\n-})\n-\n-const arrayOfMixedTypes = defineField({\n-  type: 'array',\n-  name: 'arrayOfMixedTypes',\n-  title: 'Array of mixed types',\n-  of: [\n-    pte,\n-    {\n-      type: 'object',\n-      name: 'myObject',\n-      fields: [\n-        {\n-          name: 'string',\n-          type: 'string',\n-          title: 'String',\n-        },\n-        // Array of objects\n-        {\n-          name: 'arrayOfObjects',\n-          type: 'array',\n-          title: 'Array of objects',\n-          of: [\n-            {\n-              type: 'object',\n-              name: 'myObject',\n-              fields: [\n-                {\n-                  name: 'string',\n-                  type: 'string',\n-                  title: 'String',\n-                },\n-              ],\n-            },\n-            {\n-              type: 'reference',\n-              name: 'author',\n-              title: 'Author',\n-              to: [{type: 'author'}],\n-            },\n-          ],\n-        },\n-      ],\n-    },\n-    {\n-      type: 'image',\n-      name: 'image',\n-      title: 'Image',\n-    },\n-    {\n-      name: 'author',\n-      type: 'reference',\n-      title: 'Author',\n-      to: [{type: 'author'}],\n-    },\n-    {\n-      type: 'object',\n-      name: 'mixedObject',\n-      title: 'Mixed object',\n-      fields: [\n-        {\n-          name: 'author',\n-          type: 'reference',\n-          title: 'Author',\n-          to: [{type: 'author'}],\n-        },\n-      ],\n-      preview: {\n-        select: {\n-          title: 'author.name',\n-        },\n-        prepare({title}) {\n-          return {\n-            title,\n-          }\n-        },\n-      },\n-    },\n-  ],\n-})\n-\n-const arrayWithArrayInNestedObjects = defineField({\n-  type: 'object',\n-  name: 'rootObject',\n-  fields: [\n-    {\n-      type: 'array',\n-      name: 'level1Array',\n-      title: 'Level 1 Array',\n-      of: [\n-        {\n-          type: 'object',\n-          name: 'level1Object',\n-          fields: [\n-            {\n-              type: 'string',\n-              name: 'title',\n-              title: 'Title',\n-            },\n-            {\n-              type: 'object',\n-              name: 'level2Object',\n-              fields: [\n-                {\n-                  type: 'string',\n-                  name: 'title',\n-                  title: 'Title',\n-                },\n-                {\n-                  type: 'array',\n-                  name: 'level2Array',\n-                  title: 'Level 2 Array',\n-                  of: [\n-                    {\n-                      type: 'object',\n-                      name: 'level2ArrayObject',\n-                      fields: [\n-                        {\n-                          type: 'string',\n-                          name: 'title',\n-                          title: 'Title',\n-                        },\n-                        {\n-                          type: 'object',\n-                          name: 'level3Object',\n-                          fields: [\n-                            {\n-                              type: 'string',\n-                              name: 'title',\n-                              title: 'Title',\n-                            },\n-                            {\n-                              type: 'object',\n-                              name: 'level3NestedObject',\n-                              title: 'Level 3 Nested Object',\n-                              fields: [\n-                                {\n-                                  type: 'string',\n-                                  name: 'title',\n-                                  title: 'Title',\n-                                },\n-                                {\n-                                  type: 'object',\n-                                  name: 'level3NestedNestedObject',\n-                                  title: 'Level 3 Nested Nested Object',\n-                                  fields: [\n-                                    {\n-                                      type: 'string',\n-                                      name: 'title',\n-                                      title: 'Title',\n-                                    },\n-                                    {\n-                                      type: 'object',\n-                                      name: 'level3DeepNestedObject',\n-                                      title: 'Level 3 Deep Nested Object',\n-                                      fields: [\n-                                        {\n-                                          type: 'string',\n-                                          name: 'title',\n-                                          title: 'Title',\n-                                        },\n-                                        {\n-                                          type: 'array',\n-                                          name: 'level3DeepNestedArray1',\n-                                          title: 'Level 3 Array 1',\n-                                          of: [\n-                                            {\n-                                              type: 'object',\n-                                              name: 'level3DeepNestedArrayObject1',\n-                                              fields: [\n-                                                {\n-                                                  type: 'string',\n-                                                  name: 'title',\n-                                                  title: 'Title',\n-                                                },\n-                                                {\n-                                                  type: 'array',\n-                                                  name: 'level3DeepNestedArray1',\n-                                                  title: 'Level 3 Nested Array 1',\n-                                                  of: [\n-                                                    {\n-                                                      type: 'object',\n-                                                      name: 'level3DeepNestedArrayObject1',\n-                                                      fields: [\n-                                                        {\n-                                                          type: 'string',\n-                                                          name: 'title',\n-                                                          title: 'Title',\n-                                                        },\n-                                                      ],\n-                                                    },\n-                                                  ],\n-                                                },\n-                                                {\n-                                                  type: 'array',\n-                                                  name: 'level3DeepNestedArray2',\n-                                                  title: 'Level 3 Nested Array 2',\n-                                                  of: [\n-                                                    {\n-                                                      type: 'object',\n-                                                      name: 'level3DeepNestedArrayObject2',\n-                                                      fields: [\n-                                                        {\n-                                                          type: 'string',\n-                                                          name: 'title',\n-                                                          title: 'Title',\n-                                                        },\n-                                                      ],\n-                                                    },\n-                                                  ],\n-                                                },\n-                                              ],\n-                                            },\n-                                          ],\n-                                        },\n-                                        {\n-                                          type: 'array',\n-                                          name: 'level3DeepNestedArray2',\n-                                          title: 'Level 3 Array 2',\n-                                          of: [\n-                                            {\n-                                              type: 'object',\n-                                              name: 'level3DeepNestedArrayObject2',\n-                                              fields: [\n-                                                {\n-                                                  type: 'string',\n-                                                  name: 'title',\n-                                                  title: 'Title',\n-                                                },\n-                                              ],\n-                                            },\n-                                          ],\n-                                        },\n-                                      ],\n-                                    },\n-                                  ],\n-                                },\n-                              ],\n-                            },\n-                          ],\n-                        },\n-                      ],\n-                    },\n-                  ],\n-                },\n-              ],\n-            },\n-            {\n-              name: 'level2AnotherArray',\n-              type: 'array',\n-              title: 'Level 2 Another Array',\n-              of: [\n-                {\n-                  type: 'object',\n-                  name: 'level2AnotherObject',\n-                  fields: [\n-                    {\n-                      type: 'string',\n-                      name: 'level2AnotherObjectString',\n-                      title: 'Level 2 Another Object String',\n-                    },\n-                  ],\n-                },\n-              ],\n-            },\n-          ],\n-        },\n-      ],\n-    },\n-  ],\n-})\n-\n-const arrayWithNestedObjectsWithArray = defineField({\n-  name: 'arrayWithNestedObjectsWithArray',\n-  type: 'array',\n-  title: 'Array with nested objects with array',\n-  of: [\n-    {\n-      type: 'object',\n-      name: 'firstObject',\n-      title: 'First object',\n-      fields: [\n-        {\n-          type: 'object',\n-          name: 'secondObject',\n-          title: 'Second object',\n-          fields: [\n-            {\n-              type: 'array',\n-              name: 'nestedArray',\n-              title: 'Nested array',\n-              of: [\n-                {\n-                  type: 'object',\n-                  name: 'nestedObject',\n-                  title: 'Nested object',\n-                  fields: [\n-                    {\n-                      type: 'string',\n-                      name: 'nestedString',\n-                      title: 'Nested string',\n-                    },\n-                  ],\n-                },\n-              ],\n-            },\n-          ],\n-        },\n-      ],\n-    },\n-  ],\n-})\n-\n-export const objectsDebug = defineType({\n-  type: 'document',\n-  name: 'objectsDebug',\n-\n-  fieldsets: [\n-    {\n-      name: 'fieldset',\n-      title: 'Fieldset',\n-    },\n-  ],\n-\n-  fields: [\n-    {\n-      name: 'title',\n-      type: 'string',\n-    },\n-    {\n-      name: 'arrayOfNumbers',\n-      type: 'array',\n-      title: 'Array of numbers',\n-      of: [\n-        {\n-          type: 'number',\n-          title: 'Number',\n-        },\n-      ],\n-    },\n-    /** Internationalized array string */\n-    defineField({\n-      name: 'greeting',\n-      type: 'internationalizedArrayString',\n-    }),\n-    /** Internationalized array string value */\n-    defineField({\n-      name: 'internationalizedArrayStringValue',\n-      type: 'internationalizedArrayStringValue',\n-      title: 'Internationalized array string value',\n-    }),\n-    defineField({\n-      name: 'arrayofObjectsWithItem',\n-      type: 'array',\n-      title: 'Array of objects with custom item',\n-      of: [\n-        {\n-          type: 'object',\n-          name: 'item',\n-          fields: [\n-            {\n-              name: 'object1',\n-              type: 'string',\n-              title: 'String 1',\n-            },\n-          ],\n-          components: {\n-            item: PageBlockAnchor,\n-          },\n-        },\n-      ],\n-    }),\n-    animals,\n-    {\n-      name: 'arrayWithNoTitle_2',\n-      title: 'Array with custom field 2',\n-      type: 'array',\n-      components: {\n-        field: CustomEnhancedObjectField,\n-        input: CustomEnhancedObjectInput,\n-      },\n-      of: [\n-        {\n-          type: 'object',\n-          name: 'obj_2',\n-          title: 'Some object',\n-          fields: [\n-            {\n-              name: 'title',\n-              type: 'string',\n-            },\n-            {\n-              name: 'description',\n-              type: 'string',\n-            },\n-          ],\n-        },\n-      ],\n-    },\n-    arrayOfMixedTypes,\n-    body,\n-    fieldsetArray,\n-    objectWithArray,\n-    arrayOfAnonymousObjects,\n-    arrayOfImages,\n-    arrayOfFiles,\n-    arrayWithNestedObjectsWithArray,\n-    arrayWithArrayInNestedObjects,\n-  ],\n-})\n+  name: 'objectWithArray\n\\ No newline at end of file\ndiff --git a/e2e/tests/enhanced-object-dialog/componentItemSmoke.spec.ts b/e2e/tests/enhanced-object-dialog/componentItemSmoke.spec.ts\nindex 68fb6e3..e1a430d 100644\n--- a/e2e/tests/enhanced-object-dialog/componentItemSmoke.spec.ts\n+++ b/e2e/tests/enhanced-object-dialog/componentItemSmoke.spec.ts\n@@ -6,7 +6,6 @@ test.describe('Enhanced Object Dialog - schema with component item and input smo\n   test.beforeEach(async ({createDraftDocument}) => {\n     // wait for form to be attached\n     await createDraftDocument('/content/input-debug;objectsDebug')\n-    test.slow()\n   })\n \n   test(`opening - when creating new item with custom components.item, the modal should open`, async ({\n@@ -27,59 +26,8 @@ test.describe('Enhanced Object Dialog - schema with component item and input smo\n     const input = page.getByTestId('field-greeting[_key==\"en\"].value').getByTestId('string-input')\n     await expect(input).toBeEnabled()\n     await input.click()\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-\n     await input.fill('Test')\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-  })\n-\n-  test(`opening - when clicking the internationalized array string field, and click the next one, the modal should not open`, async ({\n-    page,\n-  }) => {\n-    const input = page.getByTestId('field-greeting[_key==\"en\"].value').getByTestId('string-input')\n-    await expect(input).toBeVisible()\n-    await expect(input).toBeEnabled()\n-    await input.click()\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-    await input.fill('Test')\n-\n-    await page.getByRole('button', {name: 'FR'}).click()\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-\n-    const inputFr = page.getByTestId('field-greeting[_key==\"fr\"].value').getByTestId('string-input')\n-    await expect(inputFr).toBeVisible()\n-    await expect(inputFr).toBeEnabled()\n-    await inputFr.click()\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-\n-    await inputFr.fill('Test but in french')\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-  })\n-\n-  test(`opening - when clicking a component?.field and component?.input it will open the dialog`, async ({\n-    page,\n-  }) => {\n-    const field = page\n-      .getByTestId('field-arrayWithNoTitle_2')\n-      .getByTestId('add-single-object-button')\n-    await expect(field).toBeEnabled()\n-    await field.click()\n-\n-    await expect(page.getByTestId('nested-object-dialog')).toBeVisible()\n-  })\n-\n-  test('should not open - when clicking an string input with the inline changes, it should not open the dialog', async ({\n-    page,\n-  }) => {\n-    // as string inputs become pte\n-\n-    await expect(page.getByTestId('pane-context-menu-button')).toBeVisible()\n-    await page.getByTestId('pane-context-menu-button').click()\n-    await expect(page.getByTestId('action-inlinechanges')).toBeVisible()\n-    await page.getByTestId('action-inlinechanges').click()\n \n-    await page.getByTestId('field-title').getByTestId('string-input-portable-text').click()\n-    await page.getByTestId('field-title').getByTestId('string-input-portable-text').fill('Test')\n     await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n   })\n-})\n+})\n\\ No newline at end of file\ndiff --git a/e2e/tests/enhanced-object-dialog/smoke.spec.ts b/e2e/tests/enhanced-object-dialog/smoke.spec.ts\nindex f5a8076..098f3d5 100644\n--- a/e2e/tests/enhanced-object-dialog/smoke.spec.ts\n+++ b/e2e/tests/enhanced-object-dialog/smoke.spec.ts\n@@ -27,12 +27,8 @@ test.describe('Enhanced Object Dialog - open and close', () => {\n     const modal = page.getByTestId('nested-object-dialog')\n \n     await expect(modal).toBeVisible()\n-    await page\n-      .getByTestId(/^field-animals\\[_key==\"[^\"]+\"\\]\\.name$/)\n-      .getByTestId('string-input')\n-      .fill('Blue, the whale')\n-\n     await page.getByRole('button', {name: 'Close dialog'}).click()\n+\n     await expect(modal).not.toBeVisible()\n   })\n })\n@@ -62,44 +58,4 @@ test.describe('Enhanced Object Dialog - when disabled', () => {\n     // The enhanced dialog should not be visible\n     await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n   })\n-})\n-\n-test.describe('Enhanced Object Dialog - when tab focusing on an array item', () => {\n-  test.beforeEach(async ({createDraftDocument, page}) => {\n-    // wait for form to be attached\n-    await createDraftDocument('/content/input-debug;objectsDebug')\n-\n-    await page.getByTestId('field-animals').getByRole('button', {name: 'Add item'}).click()\n-    const modal = page.getByTestId('nested-object-dialog')\n-\n-    await expect(modal).toBeVisible()\n-    await page\n-      .getByTestId(/^field-animals\\[_key==\"[^\"]+\"\\]\\.name$/)\n-      .getByTestId('string-input')\n-      .fill('Blue, the whale')\n-\n-    await page.getByRole('button', {name: 'Close dialog'}).click()\n-    await expect(modal).not.toBeVisible()\n-\n-    await page.getByTestId('field-animals').focus()\n-  })\n-\n-  test(`when tab focusing on an array item, the tree editing modal should not open`, async ({\n-    page,\n-  }) => {\n-    await page.keyboard.press('Tab')\n-    await page.keyboard.press('Tab')\n-\n-    await expect(page.getByTestId('nested-object-dialog')).not.toBeVisible()\n-  })\n-\n-  test(`When pressing enter on an array item, the tree editing modal should open`, async ({\n-    page,\n-  }) => {\n-    await page.keyboard.press('Tab')\n-    await page.keyboard.press('Tab')\n-    await page.keyboard.press('Enter')\n-\n-    await expect(page.getByTestId('nested-object-dialog')).toBeVisible()\n-  })\n-})\n+})\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayState.ts b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayState.ts\nindex 1633b77..e95619a 100644\n--- a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayState.ts\n+++ b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayState.ts\n@@ -18,6 +18,7 @@ import {getItemType} from '../../../../store/utils/getItemType'\n import {type DialogItem} from '../../types'\n import {findArrayTypePaths} from '../findArrayTypePaths'\n import {getSchemaField} from '../getSchemaField'\n+import {hasCustomInputComponent} from '../hasCustomInputComponent'\n import {isPathTextInPTEField} from '../isPathTextInPTEField'\n import {buildArrayStatePTE} from './buildArrayStatePTE'\n import {buildBreadcrumbsState} from './buildBreadcrumbsState'\n@@ -115,7 +116,10 @@ export function buildArrayState(props: BuildArrayState): TreeEditingState {\n     const childrenFields = itemSchemaField?.fields || []\n     const childrenMenuItems: DialogItem[] = []\n \n-    if (shouldBeInBreadcrumb(itemPath, openPath, documentValue)) {\n+    if (\n+      shouldBeInBreadcrumb(itemPath, openPath, documentValue) &&\n+      !hasCustomInputComponent(rootSchemaType.fields, itemPath)\n+    ) {\n       const breadcrumbsResult = buildBreadcrumbsState({\n         arraySchemaType,\n         arrayValue,\n@@ -245,7 +249,10 @@ export function buildArrayState(props: BuildArrayState): TreeEditingState {\n         }\n         childArray.forEach(updateChildArrayIndex)\n \n-        if (shouldBeInBreadcrumb(childPath, openPath, documentValue)) {\n+        if (\n+          shouldBeInBreadcrumb(childPath, openPath, documentValue) &&\n+          !hasCustomInputComponent(rootSchemaType.fields, childPath)\n+        ) {\n           const breadcrumbsResult = buildBreadcrumbsState({\n             arraySchemaType: childField.type as ArraySchemaType,\n             arrayValue: childValue as Record<string, unknown>[],\n@@ -346,4 +353,4 @@ export function buildArrayState(props: BuildArrayState): TreeEditingState {\n     rootTitle: '',\n     siblings,\n   }\n-}\n+}\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayStatePTE.ts b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayStatePTE.ts\nindex c9e7ca3..98902ee 100644\n--- a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayStatePTE.ts\n+++ b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildArrayStatePTE.ts\n@@ -16,6 +16,7 @@ import {getValueAtPath, pathToString} from '../../../../../field/paths/helpers'\n import {EMPTY_ARRAY} from '../../../../../util/empty'\n import {getItemType} from '../../../../store/utils/getItemType'\n import {type DialogItem} from '../../types'\n+import {hasCustomInputComponent} from '../hasCustomInputComponent'\n import {isPathTextInPTEField} from '../isPathTextInPTEField'\n import {buildBreadcrumbsState} from './buildBreadcrumbsState'\n import {type RecursiveProps, type TreeEditingState} from './buildTreeEditingState'\n@@ -123,7 +124,11 @@ export function buildArrayStatePTE(props: BuildArrayStatePTEProps): {\n     // This handles both direct block selection and nested paths within the block\n     const openPathStartsWithBlock = startsWith(blockPath, openPath)\n \n-    if (openPathStartsWithBlock && shouldBeInBreadcrumb(blockPath, openPath, documentValue)) {\n+    if (\n+      openPathStartsWithBlock &&\n+      shouldBeInBreadcrumb(blockPath, openPath, documentValue) &&\n+      !hasCustomInputComponent(rootSchemaType.fields, blockPath)\n+    ) {\n       const blockBreadcrumb: DialogItem = {\n         children: EMPTY_ARRAY,\n         parentSchemaType: childField.type as ArraySchemaType,\n@@ -183,7 +188,10 @@ export function buildArrayStatePTE(props: BuildArrayStatePTEProps): {\n           // But ensure the value is at least an empty array for processing\n           const arrayFieldValue = Array.isArray(blockFieldValue) ? blockFieldValue : []\n \n-          if (shouldBeInBreadcrumb(blockFieldPath, openPath, documentValue)) {\n+          if (\n+            shouldBeInBreadcrumb(blockFieldPath, openPath, documentValue) &&\n+            !hasCustomInputComponent(rootSchemaType.fields, blockFieldPath)\n+          ) {\n             const breadcrumbsResult = buildBreadcrumbsState({\n               arraySchemaType: blockField.type as ArraySchemaType,\n               arrayValue: arrayFieldValue as Record<string, unknown>[],\n@@ -249,4 +257,4 @@ export function buildArrayStatePTE(props: BuildArrayStatePTEProps): {\n     childrenMenuItems,\n     siblings,\n   }\n-}\n+}\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildTreeEditingState.ts b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildTreeEditingState.ts\nindex 5a796fe..67e3b1e 100644\n--- a/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildTreeEditingState.ts\n+++ b/packages/sanity/src/core/form/studio/tree-editing/utils/build-tree-editing-state/buildTreeEditingState.ts\n@@ -11,6 +11,7 @@ import {getSchemaTypeTitle} from '../../../../../schema/helpers'\n import {type DialogItem} from '../../types'\n import {getRootPath} from '../getRootPath'\n import {getSchemaField} from '../getSchemaField'\n+import {hasCustomInputComponent} from '../hasCustomInputComponent'\n import {buildArrayState} from './buildArrayState'\n \n const EMPTY_ARRAY: [] = []\n@@ -77,6 +78,19 @@ export function buildTreeEditingState(props: BuildTreeEditingStateProps): TreeEd\n     path: rootPath,\n   })\n \n+  // If the child array field has custom components.input, skip building dialog\n+  // but preserve breadcrumbs, menuItems, and siblings\n+  if (hasCustomInputComponent((props.schemaType as ObjectSchemaType).fields || [], openPath)) {\n+    const {menuItems, siblings} = result\n+    return {\n+      relativePath: EMPTY_ARRAY,\n+      breadcrumbs,\n+      menuItems: menuItems,\n+      rootTitle,\n+      siblings: siblings,\n+    }\n+  }\n+\n   function recursive(recursiveProps: RecursiveProps): TreeEditingState {\n     const {schemaType, path, documentValue} = recursiveProps\n \n@@ -113,4 +127,4 @@ export function buildTreeEditingState(props: BuildTreeEditingStateProps): TreeEd\n     rootTitle,\n     siblings: result.siblings,\n   }\n-}\n+}\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/core/form/useDocumentForm.ts b/packages/sanity/src/core/form/useDocumentForm.ts\nindex 8fb4175..5b980a3 100644\n--- a/packages/sanity/src/core/form/useDocumentForm.ts\n+++ b/packages/sanity/src/core/form/useDocumentForm.ts\n@@ -16,7 +16,6 @@ import deepEquals from 'react-fast-compare'\n \n import {useCanvasCompanionDoc} from '../canvas/actions/useCanvasCompanionDoc'\n import {isSanityCreateLinkedDocument} from '../create/createUtils'\n-import {pathToString} from '../field/paths/helpers'\n import {useReconnectingToast} from '../hooks'\n import {type ConnectionState, useConnectionState} from '../hooks/useConnectionState'\n import {useDocumentIdStack} from '../hooks/useDocumentIdStack'\n@@ -362,252 +361,4 @@ export function useDocumentForm(options: DocumentFormOptions): DocumentFormValue\n     //\n     // If the user is viewing a new document (a document that exists locally, but has not yet been\n     // created in the dataset), they are permitted to edit it, regardless of which perspective was\n-    // selected when they created it. This will cause it to be created in the dataset, attached to\n-    // the currently selected perspective.\n-    if (\n-      releaseId &&\n-      getVersionFromId(value._id) !== releaseId &&\n-      isNewDocument(editState) === false\n-    ) {\n-      return true\n-    }\n-\n-    const isReadOnly =\n-      !ready ||\n-      isLinked ||\n-      hasNoPermission ||\n-      updateActionDisabled ||\n-      createActionDisabled ||\n-      reconnecting ||\n-      isLocked ||\n-      isCreateLinked ||\n-      willBeUnpublished ||\n-      isReleaseLocked\n-\n-    if (isReadOnly) return true\n-    if (typeof readOnlyProp === 'function') return readOnlyProp(editState)\n-    return Boolean(readOnlyProp)\n-  }, [\n-    isPermissionsLoading,\n-    isLinked,\n-    permissions?.granted,\n-    schemaType,\n-    isNonExistent,\n-    connectionState,\n-    editState,\n-    value,\n-    onlyHasVersions,\n-    selectedPerspectiveName,\n-    liveEdit,\n-    releaseId,\n-    ready,\n-    isCreateLinked,\n-    isReleaseLocked,\n-    readOnlyProp,\n-  ])\n-\n-  const {patch} = useDocumentOperation(documentId, documentType, releaseId)\n-\n-  const patchRef = useRef<(event: PatchEvent) => void>(() => {\n-    throw new Error(\n-      'Attempted to patch the Sanity document during initial render or in an `useInsertionEffect`. Input components should only call `onChange()` in a useEffect or an event handler.',\n-    )\n-  })\n-  const handleChange = (event: PatchEvent) => patchRef.current(event)\n-\n-  useInsertionEffect(() => {\n-    // Create-linked documents enter a read-only state in Studio. However, unlinking a Create-linked\n-    // document necessitates patching it. This renders it impossible to unlink a Create-linked\n-    // document.\n-    //\n-    // Excluding Create-linked documents from this check is a simple way to ensure they can be\n-    // unlinked.\n-    //\n-    // This does mean `handleChange` can be used to patch any part of a Create-linked document,\n-    // which would otherwise be read-only.\n-    if (readOnly && !isCreateLinked) {\n-      patchRef.current = () => {\n-        throw new Error('Attempted to patch a read-only document')\n-      }\n-    } else {\n-      // note: this needs to happen in an insertion effect to make sure we're ready to receive patches from child components when they run their effects initially\n-      // in case they do e.g. `useEffect(() => props.onChange(set(\"foo\")), [])`\n-      // Note: although we discourage patch-on-mount, we still support it.\n-      patchRef.current = (event: PatchEvent) => {\n-        // when creating a new draft\n-        if (!editState.draft && !editState.published) {\n-          telemetry.log(CreatedDraft)\n-        }\n-\n-        patch.execute(toMutationPatches(event.patches), initialValue?.value)\n-      }\n-    }\n-  }, [\n-    editState.draft,\n-    editState.published,\n-    initialValue,\n-    patch,\n-    telemetry,\n-    readOnly,\n-    isCreateLinked,\n-  ])\n-\n-  const formDocumentValue = useMemo(() => {\n-    if (getFormDocumentValue) return getFormDocumentValue(value)\n-    return value\n-  }, [getFormDocumentValue, value])\n-\n-  const hasUpstreamVersion = selectUpstreamVersion(upstreamEditState) !== null\n-\n-  const formState = useFormState({\n-    schemaType,\n-    documentValue: formDocumentValue,\n-    readOnly,\n-    comparisonValue: comparisonValue || value,\n-    focusPath,\n-    openPath,\n-    perspective: selectedPerspective,\n-    collapsedPaths,\n-    presence,\n-    validation,\n-    collapsedFieldSets,\n-    fieldGroupState,\n-    changesOpen,\n-    hasUpstreamVersion,\n-    displayInlineChanges,\n-  })!\n-\n-  const formStateRef = useRef(formState)\n-  useEffect(() => {\n-    formStateRef.current = formState\n-  }, [formState])\n-\n-  useComlinkViewHistory({editState})\n-\n-  const handleSetOpenPath = (path: Path) => {\n-    const ops = getExpandOperations(formStateRef.current!, path)\n-    ops.forEach((op) => {\n-      if (op.type === 'expandPath') {\n-        onSetCollapsedPath((prevState) => setAtPath(prevState, op.path, false))\n-      }\n-      if (op.type === 'expandFieldSet') {\n-        onSetCollapsedFieldSets((prevState) => setAtPath(prevState, op.path, false))\n-      }\n-      if (op.type === 'setSelectedGroup') {\n-        onSetFieldGroupState((prevState) => setAtPath(prevState, op.path, op.groupName))\n-      }\n-    })\n-    onSetOpenPath(path)\n-  }\n-\n-  const updatePresence = (nextFocusPath: Path, payload?: OnPathFocusPayload) => {\n-    presenceStore.setLocation([\n-      {\n-        type: 'document',\n-        documentId: value._id,\n-        path: nextFocusPath,\n-        lastActiveAt: new Date().toISOString(),\n-        selection: payload?.selection,\n-      },\n-    ])\n-  }\n-\n-  const updatePresenceThrottled = throttle(updatePresence, 1000, {leading: true, trailing: true})\n-  const focusPathRef = useRef<Path>([])\n-\n-  const handleFocus = (_nextFocusPath: Path, payload?: OnPathFocusPayload) => {\n-    const nextFocusPath = pathFor(_nextFocusPath)\n-    if (nextFocusPath !== focusPathRef.current) {\n-      setFocusPath(pathFor(nextFocusPath))\n-\n-      if (enhancedObjectDialogEnabled) {\n-        // When focusing on an object field, set openPath to the field's parent.\n-        // Exception: if focusing directly on an array item (so it has a key),\n-        // it should skip updating openPath - let explicit onPathOpen calls handle it.\n-        const lastSegment = nextFocusPath[nextFocusPath.length - 1]\n-\n-        if (!isKeySegment(lastSegment)) {\n-          // For fields inside array items, find the last key segment to preserve context\n-          const lastKeyIndex = nextFocusPath.findLastIndex((seg) => isKeySegment(seg))\n-          // We must preserve the context of the array item when focusing on an object field\n-          // As if we don't, then the open path will open the dialog when the object is simply focused,\n-          // Which is not what we want.\n-          const newOpenPath =\n-            lastKeyIndex >= 0\n-              ? nextFocusPath.slice(0, lastKeyIndex + 1)\n-              : nextFocusPath.slice(0, -1)\n-\n-          /*\n-           * This checks if an element exists in the dom with the updated path.\n-           * There are situations where the element doesn't exist in the dom yet, for example:\n-           * (think internationalizedArrayString where clicking a button creates an input with the path \"en.value\")\n-           * And, in those cases, the open path will open the dialog when the button is pressed.\n-           * So, if an element exists in the dom with the updated path then it means\n-           * then we shouldn't update the open path\n-           */\n-          const elementExists = document.getElementById(`${pathToString(nextFocusPath)}`)\n-          if (!elementExists) {\n-            handleSetOpenPath(pathFor(newOpenPath))\n-          }\n-        }\n-      } else {\n-        handleSetOpenPath(pathFor(nextFocusPath.slice(0, -1)))\n-      }\n-\n-      focusPathRef.current = nextFocusPath\n-      onFocusPath?.(nextFocusPath)\n-    }\n-    updatePresenceThrottled(nextFocusPath, payload)\n-  }\n-\n-  const handleBlur = (_blurredPath: Path) => {\n-    setFocusPath(EMPTY_ARRAY)\n-\n-    if (focusPathRef.current !== EMPTY_ARRAY) {\n-      focusPathRef.current = EMPTY_ARRAY\n-      onFocusPath?.(EMPTY_ARRAY)\n-    }\n-\n-    // note: we're deliberately not syncing presence here since it would make the user avatar disappear when a\n-    // user clicks outside a field without focusing another one\n-  }\n-\n-  const handleProgrammaticFocus = (nextPath: Path) => {\n-    // Supports changing the focus path not by a user interaction, but by a programmatic change, e.g. the url path changes.\n-\n-    if (!deepEquals(focusPathRef.current, nextPath)) {\n-      setFocusPath(nextPath)\n-      handleSetOpenPath(nextPath)\n-      onFocusPath?.(nextPath)\n-\n-      focusPathRef.current = nextPath\n-    }\n-  }\n-  return {\n-    editState,\n-    upstreamEditState,\n-    connectionState,\n-    focusPath,\n-    validation,\n-    ready,\n-    value,\n-    formState,\n-    permissions,\n-    isPermissionsLoading,\n-    formStateRef,\n-    hasUpstreamVersion,\n-\n-    collapsedFieldSets,\n-    collapsedPaths,\n-    openPath,\n-    schemaType,\n-    onChange: handleChange,\n-    onPathOpen: handleSetOpenPath,\n-    onProgrammaticFocus: handleProgrammaticFocus,\n-    onBlur: handleBlur,\n-    onFocus: handleFocus,\n-    onSetActiveFieldGroup: handleSetActiveFieldGroup,\n-    onSetCollapsedPath: handleOnSetCollapsedPath,\n-    onSetCollapsedFieldSet: handleOnSetCollapsedFieldSet,\n-  }\n-}\n+    //\n\\ No newline at end of file\n",
    "problem_statement": "",
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": []
  },
  {
    "instance_id": "sanity-io__sanity.615e6c01.11383",
    "repo": "sanity-io__sanity.615e6c01",
    "base_commit": "615e6c01",
    "patch": "diff --git a/dev/strict-studio/CHANGELOG.md b/dev/strict-studio/CHANGELOG.md\nindex ea41cad..ba09f89 100644\n--- a/dev/strict-studio/CHANGELOG.md\n+++ b/dev/strict-studio/CHANGELOG.md\n@@ -3,18 +3,6 @@\n All notable changes to this project will be documented in this file.\n See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.\n \n-## [4.20.3](https://github.com/sanity-io/sanity/compare/v4.20.2...v4.20.3) (2025-12-04)\n-\n-**Note:** Version bump only for package sanity-strict-studio\n-\n-## [4.20.2](https://github.com/sanity-io/sanity/compare/v4.20.1...v4.20.2) (2025-12-04)\n-\n-**Note:** Version bump only for package sanity-strict-studio\n-\n-## [4.20.1](https://github.com/sanity-io/sanity/compare/v4.20.0...v4.20.1) (2025-12-03)\n-\n-**Note:** Version bump only for package sanity-strict-studio\n-\n ## [4.20.0](https://github.com/sanity-io/sanity/compare/v4.19.0...v4.20.0) (2025-12-02)\n \n **Note:** Version bump only for package sanity-strict-studio\ndiff --git a/dev/strict-studio/package.json b/dev/strict-studio/package.json\nindex 398df16..10aabce 100644\n--- a/dev/strict-studio/package.json\n+++ b/dev/strict-studio/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"sanity-strict-studio\",\n-  \"version\": \"4.20.3\",\n+  \"version\": \"4.20.0\",\n   \"private\": true,\n   \"license\": \"MIT\",\n   \"author\": \"Sanity.io <hello@sanity.io>\",\ndiff --git a/packages/sanity/src/_internal/cli/server/__tests__/buildVendorDependencies.test.ts b/packages/sanity/src/_internal/cli/server/__tests__/buildVendorDependencies.test.ts\nindex 19a1c09..3700ddf 100644\n--- a/packages/sanity/src/_internal/cli/server/__tests__/buildVendorDependencies.test.ts\n+++ b/packages/sanity/src/_internal/cli/server/__tests__/buildVendorDependencies.test.ts\n@@ -273,4 +273,4 @@ describe('buildVendorDependencies', async () => {\n       expect(resolvedEntries.every(fs.existsSync)).toBe(true)\n     })\n   })\n-})\n+})\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/_internal/cli/server/buildVendorDependencies.ts b/packages/sanity/src/_internal/cli/server/buildVendorDependencies.ts\nindex 285ca04..7ce6348 100644\n--- a/packages/sanity/src/_internal/cli/server/buildVendorDependencies.ts\n+++ b/packages/sanity/src/_internal/cli/server/buildVendorDependencies.ts\n@@ -258,4 +258,4 @@ export async function buildVendorDependencies({\n   }\n \n   return hashedImports\n-}\n+}\n\\ No newline at end of file\ndiff --git a/packages/sanity/src/_internal/cli/util/checkStudioDependencyVersions.ts b/packages/sanity/src/_internal/cli/util/checkStudioDependencyVersions.ts\nindex 90886b5..bbf9071 100644\n--- a/packages/sanity/src/_internal/cli/util/checkStudioDependencyVersions.ts\n+++ b/packages/sanity/src/_internal/cli/util/checkStudioDependencyVersions.ts\n@@ -174,4 +174,4 @@ function getDowngradeInstructions(pkgs: PackageInfo[]) {\n   or\n \n   pnpm install ${inst}`\n-}\n+}\n\\ No newline at end of file\n",
    "problem_statement": "",
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": []
  }
]