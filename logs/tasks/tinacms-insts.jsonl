{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.6208", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 6208, "merge_commit": "f717193aa4a1d3205df42d120fd1f6192b5e41e5", "problem_statement": "React color to react colorful migration", "patch": "diff --git a/.changeset/quiet-icons-switch.md b/.changeset/quiet-icons-switch.md\nnew file mode 100644\nindex 0000000000..8a1accb93b\n--- /dev/null\n+++ b/.changeset/quiet-icons-switch.md\n@@ -0,0 +1,5 @@\n+---\n+\"tinacms\": patch\n+---\n+\n+`react-color` to `react-colorful` migration\ndiff --git a/package.json b/package.json\nindex b3e3c7b1db..d904bcd093 100644\n--- a/package.json\n+++ b/package.json\n@@ -44,6 +44,7 @@\n \t},\n \t\"packageManager\": \"pnpm@9.15.5\",\n \t\"dependencies\": {\n-\t\t\"highlight.js\": \"catalog:\"\n+\t\t\"highlight.js\": \"catalog:\",\n+\t\t\"react-colorful\": \"catalog:\"\n \t}\n }\ndiff --git a/packages/@tinacms/schema-tools/src/types/index.ts b/packages/@tinacms/schema-tools/src/types/index.ts\nindex e7f8842d1e..f3ebb445ee 100644\n--- a/packages/@tinacms/schema-tools/src/types/index.ts\n+++ b/packages/@tinacms/schema-tools/src/types/index.ts\n@@ -152,6 +152,26 @@ export type UIField<Type, List extends boolean> = {\n    * @deprecated use `defaultItem` at the collection level instead\n    */\n   defaultValue?: List extends true ? Type[] : Type;\n+  /**\n+   * The color format for the color picker component.\n+   * Can be 'hex' or 'rgb'.\n+   */\n+  colorFormat?: 'hex' | 'rgb';\n+  /**\n+   * The widget style for the color picker component.\n+   * Can be 'sketch' or 'block'.\n+   */\n+  widget?: 'sketch' | 'block';\n+  /**\n+   * The width of the color picker component.\n+   * Accepts CSS width values (e.g., '350px').\n+   */\n+  width?: string;\n+  /**\n+   * Preset colors for the color picker component.\n+   * An array of color strings (e.g., ['#D0021B', '#F5A623']).\n+   */\n+  colors?: string[];\n };\n \n type FieldGeneric<\ndiff --git a/packages/tinacms/package.json b/packages/tinacms/package.json\nindex b35bc68727..61ba122406 100644\n--- a/packages/tinacms/package.json\n+++ b/packages/tinacms/package.json\n@@ -114,7 +114,7 @@\n \t\t\"monaco-editor\": \"catalog:\",\n \t\t\"prism-react-renderer\": \"catalog:\",\n \t\t\"prop-types\": \"catalog:\",\n-\t\t\"react-color\": \"catalog:\",\n+\t\t\"react-colorful\": \"catalog:\",\n \t\t\"react-datetime\": \"catalog:\",\n \t\t\"react-day-picker\": \"^9.11.1\",\n \t\t\"react-dropzone\": \"catalog:\",\n@@ -140,7 +140,6 @@\n \t\t\"@types/node\": \"^22.13.1\",\n \t\t\"@types/prop-types\": \"catalog:\",\n \t\t\"@types/react\": \"^18.3.18\",\n-\t\t\"@types/react-color\": \"catalog:\",\n \t\t\"@types/react-dom\": \"catalog:\",\n \t\t\"happy-dom\": \"catalog:\",\n \t\t\"identity-obj-proxy\": \"catalog:\",\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.test.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.test.tsx\nnew file mode 100644\nindex 0000000000..e62a05e95f\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.test.tsx\n@@ -0,0 +1,90 @@\n+import { fireEvent, render } from '@testing-library/react';\n+import * as React from 'react';\n+import { describe, expect, it, vi } from 'vitest';\n+import { BlockWidget } from './block-widget';\n+\n+describe('BlockWidget', () => {\n+  const defaultProps = {\n+    presetColors: ['#FF0000', '#00FF00', '#0000FF', 'transparent'],\n+    color: '#FF0000',\n+    onChange: vi.fn(),\n+    width: '240px',\n+  };\n+\n+  it('renders without crashing', () => {\n+    const { container } = render(<BlockWidget {...defaultProps} />);\n+    expect(container.firstChild).toBeTruthy();\n+  });\n+\n+  it('displays the hex input with current color', () => {\n+    const { getByDisplayValue } = render(<BlockWidget {...defaultProps} />);\n+    expect(getByDisplayValue('#FF0000')).toBeTruthy();\n+  });\n+\n+  it('displays color preview', () => {\n+    const { getByLabelText } = render(<BlockWidget {...defaultProps} />);\n+    expect(getByLabelText('Current color preview')).toBeTruthy();\n+  });\n+\n+  it('renders preset color swatches', () => {\n+    const { getAllByRole } = render(<BlockWidget {...defaultProps} />);\n+    const buttons = getAllByRole('button');\n+\n+    expect(buttons.length).toBe(defaultProps.presetColors.length);\n+  });\n+\n+  it('calls onChange when swatch is clicked', () => {\n+    const onChange = vi.fn();\n+    const { getByLabelText } = render(\n+      <BlockWidget {...defaultProps} onChange={onChange} />\n+    );\n+\n+    fireEvent.click(getByLabelText('Select color #00FF00'));\n+\n+    expect(onChange).toHaveBeenCalledWith('#00FF00');\n+  });\n+\n+  it('calls onChange with null when transparent swatch is clicked', () => {\n+    const onChange = vi.fn();\n+    const { getByLabelText } = render(\n+      <BlockWidget {...defaultProps} onChange={onChange} />\n+    );\n+\n+    fireEvent.click(getByLabelText('Clear color'));\n+\n+    expect(onChange).toHaveBeenCalledWith(null);\n+  });\n+\n+  it('updates color when valid hex is entered', () => {\n+    const onChange = vi.fn();\n+    const { getByDisplayValue } = render(\n+      <BlockWidget {...defaultProps} onChange={onChange} />\n+    );\n+\n+    const input = getByDisplayValue('#FF0000');\n+    fireEvent.change(input, { target: { value: '#00FF00' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#00FF00');\n+  });\n+\n+  it('accepts named colors in input', () => {\n+    const onChange = vi.fn();\n+    const { getByDisplayValue } = render(\n+      <BlockWidget {...defaultProps} onChange={onChange} />\n+    );\n+\n+    const input = getByDisplayValue('#FF0000');\n+    fireEvent.change(input, { target: { value: 'blue' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#0000FF');\n+  });\n+\n+  it('respects the provided width', () => {\n+    const { container } = render(\n+      <BlockWidget {...defaultProps} width='300px' />\n+    );\n+    const wrapper = container.firstChild as HTMLElement;\n+\n+    expect(wrapper.style.width).toBe('300px');\n+  });\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.tsx\nnew file mode 100644\nindex 0000000000..485f1f8acf\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.tsx\n@@ -0,0 +1,46 @@\n+import * as React from 'react';\n+import {\n+  ColorPreview,\n+  HexInput,\n+  SwatchGrid,\n+  WidgetProps,\n+  useHexInput,\n+} from './color-input';\n+\n+export const BlockWidget: React.FC<WidgetProps> = ({\n+  presetColors,\n+  color,\n+  onChange,\n+  width,\n+}) => {\n+  const {\n+    inputValue,\n+    handleChange,\n+    handleFocus,\n+    handleBlur,\n+    handleSwatchClick,\n+  } = useHexInput(color, onChange);\n+\n+  return (\n+    <div\n+      className='bg-white rounded-lg shadow-lg overflow-hidden'\n+      style={{ width }}\n+    >\n+      <div className='p-3'>\n+        <ColorPreview color={color} size='lg' />\n+        <HexInput\n+          value={inputValue}\n+          onChange={handleChange}\n+          onFocus={handleFocus}\n+          onBlur={handleBlur}\n+          fullWidth\n+        />\n+        <SwatchGrid\n+          colors={presetColors}\n+          selectedColor={color}\n+          onSelect={handleSwatchClick}\n+        />\n+      </div>\n+    </div>\n+  );\n+};\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.test.ts b/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.test.ts\nnew file mode 100644\nindex 0000000000..0672f0879b\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.test.ts\n@@ -0,0 +1,87 @@\n+import { describe, expect, it } from 'vitest';\n+import { ColorFormat, ColorFormatter, ColorRGBA } from './color-formatter';\n+\n+describe('ColorFormatter', () => {\n+  const redRGBA: ColorRGBA = { r: 255, g: 0, b: 0, a: 1 };\n+  const greenRGBA: ColorRGBA = { r: 0, g: 255, b: 0, a: 1 };\n+  const blueRGBA: ColorRGBA = { r: 0, g: 0, b: 255, a: 1 };\n+\n+  describe('hex format', () => {\n+    const hexFormatter = ColorFormatter[ColorFormat.Hex];\n+\n+    describe('getLabel', () => {\n+      it('returns hex string for color', () => {\n+        expect(hexFormatter.getLabel(redRGBA)).toBe('#FF0000');\n+        expect(hexFormatter.getLabel(greenRGBA)).toBe('#00FF00');\n+        expect(hexFormatter.getLabel(blueRGBA)).toBe('#0000FF');\n+      });\n+    });\n+\n+    describe('getValue', () => {\n+      it('returns hex value for color', () => {\n+        expect(hexFormatter.getValue(redRGBA)).toBe('#FF0000');\n+      });\n+    });\n+\n+    describe('parse', () => {\n+      it('parses hex string to RGBA', () => {\n+        expect(hexFormatter.parse('#FF0000')).toEqual(redRGBA);\n+        expect(hexFormatter.parse('#00FF00')).toEqual(greenRGBA);\n+      });\n+\n+      it('parses uppercase hex', () => {\n+        expect(hexFormatter.parse('#FF0000')).toEqual(redRGBA);\n+      });\n+\n+      it('parses lowercase hex', () => {\n+        expect(hexFormatter.parse('#ff0000')).toEqual(redRGBA);\n+      });\n+\n+      it('parses mixed case hex', () => {\n+        expect(hexFormatter.parse('#Ff0000')).toEqual(redRGBA);\n+      });\n+\n+      it('returns null for undefined or empty', () => {\n+        expect(hexFormatter.parse(undefined)).toBeNull();\n+        expect(hexFormatter.parse('')).toBeNull();\n+      });\n+\n+      it('returns null for invalid color string', () => {\n+        expect(hexFormatter.parse('invalid')).toBeNull();\n+      });\n+    });\n+  });\n+\n+  describe('rgb format', () => {\n+    const rgbFormatter = ColorFormatter[ColorFormat.RGB];\n+\n+    describe('getLabel', () => {\n+      it('returns rgb label string', () => {\n+        expect(rgbFormatter.getLabel(redRGBA)).toBe('R255 G0 B0');\n+        expect(rgbFormatter.getLabel(greenRGBA)).toBe('R0 G255 B0');\n+      });\n+    });\n+\n+    describe('getValue', () => {\n+      it('returns rgb value string', () => {\n+        expect(rgbFormatter.getValue(redRGBA)).toBe('rgb(255, 0, 0)');\n+      });\n+    });\n+\n+    describe('parse', () => {\n+      it('parses rgb string to RGBA', () => {\n+        expect(rgbFormatter.parse('rgb(255, 0, 0)')).toEqual(redRGBA);\n+      });\n+\n+      it('parses rgba string', () => {\n+        const result = rgbFormatter.parse('rgba(255, 0, 0, 0.5)');\n+        expect(result).toEqual({ r: 255, g: 0, b: 0, a: 0.5 });\n+      });\n+\n+      it('returns null for undefined or empty', () => {\n+        expect(rgbFormatter.parse(undefined)).toBeNull();\n+        expect(rgbFormatter.parse('')).toBeNull();\n+      });\n+    });\n+  });\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.tsx\nindex 16e1783ee6..e4f65b220f 100644\n--- a/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.tsx\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.tsx\n@@ -1,5 +1,5 @@\n-import * as pkg from 'color-string';\n-const { get: getColor, to: toColor } = pkg;\n+import { get as getColor, to as toColor } from 'color-string';\n+import { rgbToHex } from './color-utils';\n \n export interface ColorRGBA {\n   r: number;\n@@ -23,15 +23,6 @@ interface ColorFormatHandlers {\n   [key: string]: ColorFormatHandler;\n }\n \n-const rgbToHex = function (color: { r: number; g: number; b: number }) {\n-  return (\n-    '#' +\n-    ((1 << 24) + (color.r << 16) + (color.g << 8) + color.b)\n-      .toString(16)\n-      .slice(1)\n-  );\n-};\n-\n function ParseColorStr(color?: string): ColorRGBA | null {\n   if (!color) {\n     return null;\n@@ -58,11 +49,11 @@ export const ColorFormatter: ColorFormatHandlers = {\n   },\n   [ColorFormat.Hex]: {\n     getLabel(color: ColorRGBA) {\n-      return rgbToHex(color);\n+      return rgbToHex(color.r, color.g, color.b);\n     },\n     getValue(color: ColorRGBA) {\n       const colorVals = [color.r, color.g, color.b, color.a];\n-      return toColor.hex(colorVals);\n+      return toColor.hex(colorVals).toUpperCase();\n     },\n     parse: ParseColorStr,\n   },\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.test.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.test.tsx\nnew file mode 100644\nindex 0000000000..9bdc4697f7\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.test.tsx\n@@ -0,0 +1,217 @@\n+import { act, renderHook } from '@testing-library/react';\n+import { describe, expect, it, vi } from 'vitest';\n+import { useHexInput } from './color-input';\n+import { TRANSPARENT } from './color-utils';\n+\n+describe('useHexInput', () => {\n+  it('initializes with the provided color', () => {\n+    const { result } = renderHook(() => useHexInput('#FF0000', vi.fn()));\n+    expect(result.current.inputValue).toBe('#FF0000');\n+  });\n+\n+  it('updates inputValue on valid hex input', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: '#00FF00' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('#00FF00');\n+    expect(onChange).toHaveBeenCalledWith('#00FF00');\n+  });\n+\n+  it('updates inputValue but does not call onChange for invalid hex', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: '#invalid' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('#invalid');\n+    expect(onChange).not.toHaveBeenCalled();\n+  });\n+\n+  it('reverts to original color on blur if invalid', () => {\n+    const { result } = renderHook(() => useHexInput('#FF0000', vi.fn()));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'invalid' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    act(() => {\n+      result.current.handleBlur();\n+    });\n+\n+    expect(result.current.inputValue).toBe('#FF0000');\n+  });\n+\n+  it('normalizes valid hex on blur', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: '#00FF00' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    act(() => {\n+      result.current.handleBlur();\n+    });\n+\n+    expect(result.current.inputValue).toBe('#00FF00');\n+    expect(onChange).toHaveBeenLastCalledWith('#00FF00');\n+  });\n+\n+  it('handleSwatchClick calls onChange with color', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleSwatchClick('#0000FF');\n+    });\n+\n+    expect(onChange).toHaveBeenCalledWith('#0000FF');\n+  });\n+\n+  it('handleSwatchClick calls onChange with null for transparent', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleSwatchClick(TRANSPARENT);\n+    });\n+\n+    expect(onChange).toHaveBeenCalledWith(null);\n+  });\n+\n+  it('syncs inputValue when color prop changes', () => {\n+    const { result, rerender } = renderHook(\n+      ({ color }) => useHexInput(color, vi.fn()),\n+      { initialProps: { color: '#FF0000' } }\n+    );\n+\n+    expect(result.current.inputValue).toBe('#FF0000');\n+\n+    rerender({ color: '#00FF00' });\n+\n+    expect(result.current.inputValue).toBe('#00FF00');\n+  });\n+\n+  it('keeps input value but sends normalized color on change', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'red' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('red');\n+    expect(onChange).toHaveBeenCalledWith('#FF0000');\n+  });\n+\n+  it('normalizes CSS named colors for preview', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#000000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'tomato' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('tomato');\n+    expect(onChange).toHaveBeenCalledWith('#FF6347');\n+  });\n+\n+  it('normalizes named colors in any case for preview', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#000000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'RED' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+    expect(result.current.inputValue).toBe('RED');\n+    expect(onChange).toHaveBeenCalledWith('#FF0000');\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'DarkBlue' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+    expect(result.current.inputValue).toBe('DarkBlue');\n+    expect(onChange).toHaveBeenCalledWith('#00008B');\n+  });\n+\n+  it('normalizes named color to hex on blur', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#FF0000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: 'blue' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    act(() => {\n+      result.current.handleBlur();\n+    });\n+\n+    expect(result.current.inputValue).toBe('#0000FF');\n+    expect(onChange).toHaveBeenLastCalledWith('#0000FF');\n+  });\n+\n+  it('normalizes shorthand hex on blur', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#000000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: '#F00' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('#F00');\n+    expect(onChange).toHaveBeenCalledWith('#FF0000');\n+\n+    act(() => {\n+      result.current.handleBlur();\n+    });\n+\n+    expect(result.current.inputValue).toBe('#FF0000');\n+    expect(onChange).toHaveBeenLastCalledWith('#FF0000');\n+  });\n+\n+  it('normalizes hex case on blur', () => {\n+    const onChange = vi.fn();\n+    const { result } = renderHook(() => useHexInput('#000000', onChange));\n+\n+    act(() => {\n+      result.current.handleChange({\n+        target: { value: '#FF0000' },\n+      } as React.ChangeEvent<HTMLInputElement>);\n+    });\n+\n+    expect(result.current.inputValue).toBe('#FF0000');\n+    expect(onChange).toHaveBeenCalledWith('#FF0000');\n+\n+    act(() => {\n+      result.current.handleBlur();\n+    });\n+\n+    expect(result.current.inputValue).toBe('#FF0000');\n+    expect(onChange).toHaveBeenLastCalledWith('#FF0000');\n+  });\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.tsx\nnew file mode 100644\nindex 0000000000..2b296f6d0a\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-input.tsx\n@@ -0,0 +1,156 @@\n+import { get as getColor } from 'color-string';\n+import * as React from 'react';\n+import {\n+  TRANSPARENT,\n+  checkerboardStyle,\n+  expandHex,\n+  isValidHex,\n+  rgbToHex,\n+} from './color-utils';\n+\n+export interface WidgetProps {\n+  presetColors: string[];\n+  color: string;\n+  onChange: (color: string | null) => void;\n+  width: string;\n+}\n+\n+const normalizeColorValue = (value: string): string | null => {\n+  if (isValidHex(value)) {\n+    return expandHex(value);\n+  }\n+  const parsed = getColor(value.toLowerCase());\n+  if (parsed)\n+    return rgbToHex(parsed.value[0], parsed.value[1], parsed.value[2]);\n+  return null;\n+};\n+\n+export const useHexInput = (\n+  color: string,\n+  onChange: (color: string | null) => void\n+) => {\n+  const [inputValue, setInputValue] = React.useState(color);\n+  const [isFocused, setIsFocused] = React.useState(false);\n+\n+  React.useEffect(() => {\n+    if (!isFocused) {\n+      setInputValue(color);\n+    }\n+  }, [color, isFocused]);\n+\n+  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const value = e.target.value;\n+    setInputValue(value);\n+    const normalized = normalizeColorValue(value);\n+    if (normalized) onChange(normalized);\n+  };\n+\n+  const handleFocus = () => {\n+    setIsFocused(true);\n+  };\n+\n+  const handleBlur = () => {\n+    setIsFocused(false);\n+    const normalized = normalizeColorValue(inputValue);\n+    if (normalized) {\n+      setInputValue(normalized);\n+      onChange(normalized);\n+    } else {\n+      setInputValue(color);\n+    }\n+  };\n+\n+  const handleSwatchClick = React.useCallback(\n+    (c: string) => {\n+      if (c === TRANSPARENT) {\n+        onChange(null);\n+      } else {\n+        const normalized = normalizeColorValue(c);\n+        onChange(normalized || c);\n+      }\n+    },\n+    [onChange]\n+  );\n+\n+  return {\n+    inputValue,\n+    handleChange,\n+    handleFocus,\n+    handleBlur,\n+    handleSwatchClick,\n+  };\n+};\n+\n+export const SwatchButton: React.FC<{\n+  color: string;\n+  isSelected: boolean;\n+  onClick: () => void;\n+}> = ({ color, isSelected, onClick }) => (\n+  <div className='relative w-full pb-[100%]'>\n+    <button\n+      type='button'\n+      onClick={onClick}\n+      className={`absolute inset-0 rounded-sm border cursor-pointer transition-all ${isSelected ? 'border-blue-500 border-2 scale-110' : 'border-gray-200 hover:scale-105'}`}\n+      style={{\n+        backgroundColor: color === TRANSPARENT ? '#FFF' : color,\n+        ...(color === TRANSPARENT ? checkerboardStyle() : {}),\n+      }}\n+      aria-label={\n+        color === TRANSPARENT ? 'Clear color' : `Select color ${color}`\n+      }\n+    />\n+  </div>\n+);\n+\n+export const ColorPreview: React.FC<{ color: string; size?: 'sm' | 'lg' }> = ({\n+  color,\n+  size = 'sm',\n+}) => (\n+  <div\n+    className={\n+      size === 'lg'\n+        ? 'h-16 w-full rounded border border-gray-200 mb-2'\n+        : 'w-8 h-8 rounded border border-gray-200 flex-shrink-0'\n+    }\n+    style={{\n+      backgroundColor: color || TRANSPARENT,\n+      ...(!color ? checkerboardStyle(size === 'lg' ? 16 : 8) : {}),\n+    }}\n+    aria-label='Current color preview'\n+  />\n+);\n+\n+export const HexInput: React.FC<{\n+  value: string;\n+  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n+  onFocus: () => void;\n+  onBlur: () => void;\n+  fullWidth?: boolean;\n+}> = ({ value, onChange, onFocus, onBlur, fullWidth }) => (\n+  <input\n+    type='text'\n+    value={value || ''}\n+    onChange={onChange}\n+    onFocus={onFocus}\n+    onBlur={onBlur}\n+    placeholder='#000000 or color name'\n+    className={`shadow-inner px-2 py-1 text-sm border border-gray-200 rounded focus:shadow-outline focus:border-blue-500 focus:outline-none ${fullWidth ? 'w-full' : 'flex-1 min-w-0'}`}\n+  />\n+);\n+\n+export const SwatchGrid: React.FC<{\n+  colors: string[];\n+  selectedColor: string;\n+  onSelect: (color: string) => void;\n+}> = ({ colors, selectedColor, onSelect }) => (\n+  <div className='mt-2 grid grid-cols-8 gap-1.5'>\n+    {colors.map((c) => (\n+      <SwatchButton\n+        key={c}\n+        color={c}\n+        isSelected={selectedColor?.toLowerCase() === c.toLowerCase()}\n+        onClick={() => onSelect(c)}\n+      />\n+    ))}\n+  </div>\n+);\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-picker.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/color-picker.tsx\nindex a37bfc8938..8b834c5b6f 100644\n--- a/packages/tinacms/src/toolkit/fields/components/color-picker/color-picker.tsx\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-picker.tsx\n@@ -1,47 +1,51 @@\n-import * as React from 'react';\n-import { useState } from 'react';\n-import { Dismissible } from '@toolkit/react-dismissible';\n-import * as pkg from 'react-color';\n-const { SketchPicker, BlockPicker } = pkg;\n-import { ColorRGBA, ColorFormat, ColorFormatter } from './color-formatter';\n import { useFormPortal } from '@toolkit/form-builder';\n+import { Dismissible } from '@toolkit/react-dismissible';\n+import * as React from 'react';\n+import { useCallback, useState } from 'react';\n+import { BlockWidget } from './block-widget';\n+import { ColorFormat, ColorFormatter, ColorRGBA } from './color-formatter';\n+import { TRANSPARENT, hexToRgb, rgbToHex } from './color-utils';\n+import { SketchWidget } from './sketch-widget';\n+\n+interface FieldInput {\n+  value: string | null;\n+  onChange: (value: string | null) => void;\n+}\n \n-type DivProps = any;\n-type WrappedFieldProps = any;\n-interface SwatchProps extends DivProps {\n+interface SwatchProps extends React.HTMLAttributes<HTMLDivElement> {\n   colorRGBA?: ColorRGBA;\n   onClick: (_event: React.SyntheticEvent) => void;\n   colorFormat: ColorFormat;\n+  width?: string;\n }\n \n-const GetTextColorForBackground = function (backgroundColor?: ColorRGBA) {\n-  //fudgy rgb values found on the internets\n-  return !backgroundColor ||\n+const isLightBackground = function (backgroundColor?: ColorRGBA) {\n+  return (\n+    !backgroundColor ||\n     backgroundColor.r * 0.299 +\n       backgroundColor.g * 0.587 +\n       backgroundColor.b * 0.114 >\n       186\n-    ? '#000000'\n-    : '#ffffff';\n+  );\n };\n \n-const Swatch = ({\n-  colorRGBA,\n-  colorFormat,\n-  unselectable,\n-  ...props\n-}: SwatchProps) => (\n+const getTextColorForBackground = function (backgroundColor?: ColorRGBA) {\n+  return isLightBackground(backgroundColor) ? '#000000' : '#FFFFFF';\n+};\n+\n+const Swatch = ({ colorRGBA, colorFormat, width, ...props }: SwatchProps) => (\n   <div\n-    className='bg-gray-100 rounded-3xl shadow-[0_2px_3px_rgba(0,0,0,0.12)] cursor-pointer w-full m-0'\n+    className='bg-gray-100 rounded shadow-[0_2px_3px_rgba(0,0,0,0.12)] cursor-pointer m-0'\n+    style={{ width }}\n     {...props}\n   >\n     <div\n-      className='swatch-inner flex items-center justify-center text-[13px] font-bold w-full h-10 rounded-3xl hover:opacity-[.6]'\n+      className='swatch-inner flex items-center justify-center text-[13px] font-bold w-full h-10 rounded hover:opacity-[.6]'\n       style={{\n         background: colorRGBA\n           ? `rgba(${colorRGBA.r}, ${colorRGBA.g}, ${colorRGBA.b}, ${colorRGBA.a})`\n           : `#fff`,\n-        color: GetTextColorForBackground(colorRGBA),\n+        color: getTextColorForBackground(colorRGBA),\n         transition: 'all var(--tina-timing-short) ease-out',\n       }}\n     >\n@@ -60,7 +64,7 @@ const Popover = ({\n   ...props\n }) => (\n   <div\n-    className={`fixed z-50 before:content-[\"\"] before:absolute before:left-1/2 before:-translate-x-1/2 before:w-[18px] before:h-[14px] before:bg-gray-200 before:z-10 after:content-[\"\"] after:absolute after:left-1/2 after:-translate-x-1/2 after:w-4 after:h-[13px] after:bg-white after:z-20 ${\n+    className={`fixed z-50 before:content-[\"\"] before:absolute before:left-1/2 before:-translate-x-1/2 before:w-[18px] before:h-[14px] before:bg-white before:z-10 after:content-[\"\"] after:absolute after:left-1/2 after:-translate-x-1/2 after:w-4 after:h-[13px] after:bg-white after:z-20 ${\n       openTop\n         ? 'before:bottom-0 before:mt-[1px] before:translate-y-full color-picker-on-top-clip-path after:bottom-0 after:mb-0.5 after:translate-y-full'\n         : 'before:top-0 before:mb-[1px] before:-translate-y-full color-picker-clip-path after:top-0 after:mt-0.5 after:-translate-y-full'\n@@ -77,9 +81,7 @@ const Popover = ({\n       transform: openTop\n         ? 'translate3d(-50%, calc(-100% - 8px), 0) scale3d(1, 1, 1)'\n         : 'translate3d(-50%, 8px, 0) scale3d(1, 1, 1)',\n-      animation: `${\n-        openTop ? 'color-popup-open-top-keyframes' : 'color-popup-keyframes'\n-      } 85ms ease-out both 1`,\n+      animation: `${openTop ? 'color-popup-open-top-keyframes' : 'color-popup-keyframes'} 85ms ease-out both 1`,\n       transformOrigin: `50% ${openTop ? '100%' : '0'}`,\n       ...style,\n     }}\n@@ -91,11 +93,10 @@ interface Props {\n   colorFormat: ColorFormat;\n   userColors: string[];\n   widget?: 'sketch' | 'block';\n-  input: WrappedFieldProps['input'];\n+  width?: string;\n+  input: FieldInput;\n }\n \n-const nullColor = 'transparent';\n-\n const presetColors = [\n   '#D0021B',\n   '#F5A623',\n@@ -114,88 +115,41 @@ const presetColors = [\n   '#FFFFFF',\n ];\n \n-interface WidgetProps {\n-  presetColors: string[];\n-  color: ColorRGBA;\n-  onChange: (_pickerColor: any) => void;\n-  disableAlpha?: boolean;\n-  width: string;\n-}\n-\n-const SketchWidget: React.FC<WidgetProps> = (props) => (\n-  <SketchPicker\n-    presetColors={props.presetColors}\n-    color={props.color}\n-    onChange={props.onChange}\n-    disableAlpha={props.disableAlpha}\n-    width={props.width}\n-  />\n-);\n-const BlockWidget: React.FC<WidgetProps> = (props) => (\n-  <BlockPicker\n-    colors={props.presetColors}\n-    color={props.color}\n-    onChange={props.onChange}\n-    width={props.width}\n-  />\n-);\n-\n const WIDGETS = { sketch: SketchWidget, block: BlockWidget };\n \n export const ColorPicker: React.FC<Props> = ({\n   colorFormat,\n   userColors = presetColors,\n   widget = 'sketch',\n+  width,\n   input,\n }) => {\n   const FormPortal = useFormPortal();\n   const triggerRef = React.useRef<HTMLDivElement | null>(null);\n   const [triggerBoundingBox, setTriggerBoundingBox] = useState<any>(null);\n-  const [openTop, setOpenTop] = useState<boolean>(false);\n+  const [displayColorPicker, setDisplayColorPicker] = useState(false);\n \n   const updateTriggerBoundingBox = () => {\n-    if (triggerRef.current) {\n+    if (triggerRef.current)\n       setTriggerBoundingBox(triggerRef.current.getBoundingClientRect());\n-    }\n   };\n \n-  React.useEffect(() => {\n-    if (triggerBoundingBox) {\n-      const triggerOffsetTop =\n-        triggerBoundingBox.top + triggerBoundingBox.height / 2;\n-      const windowHeight = window.innerHeight;\n-      if (triggerOffsetTop > windowHeight / 2) {\n-        setOpenTop(true);\n-      } else {\n-        setOpenTop(false);\n-      }\n-    }\n-  }, [triggerBoundingBox]);\n+  const openTop = triggerBoundingBox\n+    ? triggerBoundingBox.top + triggerBoundingBox.height / 2 >\n+      window.innerHeight / 2\n+    : false;\n \n   React.useEffect(() => {\n     const delay = 100;\n-    let timeout: any = false;\n-\n-    setTimeout(() => {\n-      updateTriggerBoundingBox();\n-    }, delay);\n-\n+    let timeout: ReturnType<typeof setTimeout> | null = null;\n+    timeout = setTimeout(updateTriggerBoundingBox, delay);\n     const handleResize = () => {\n-      clearTimeout(timeout);\n+      if (timeout) clearTimeout(timeout);\n       timeout = setTimeout(updateTriggerBoundingBox, delay);\n     };\n-\n     window.addEventListener('resize', handleResize);\n-\n-    return () => {\n-      window.removeEventListener('resize', handleResize);\n-    };\n-  }, [triggerRef.current]);\n-\n-  const Widget = WIDGETS[widget];\n-  if (!Widget) throw new Error('You must specify a widget type.');\n-\n-  const [displayColorPicker, setDisplayColorPicker] = useState(false);\n+    return () => window.removeEventListener('resize', handleResize);\n+  }, []);\n \n   const getColorFormat = (\n     colorFormat || ColorFormat.Hex\n@@ -203,31 +157,42 @@ export const ColorPicker: React.FC<Props> = ({\n   const getColorRGBA = input.value\n     ? ColorFormatter[getColorFormat].parse(input.value)\n     : null;\n-\n-  const handleChange = (pickerColor: any) => {\n-    const color = (\n-      pickerColor.hex === nullColor ? null : { ...pickerColor.rgb, a: 1 }\n-    ) as ColorRGBA | null;\n-    input.onChange(\n-      color ? ColorFormatter[getColorFormat].getValue(color) : null\n-    );\n-  };\n+  const currentHexColor = getColorRGBA\n+    ? rgbToHex(getColorRGBA.r, getColorRGBA.g, getColorRGBA.b)\n+    : '';\n+\n+  const handleChange = useCallback(\n+    (hexColor: string | null) => {\n+      if (!hexColor) {\n+        input.onChange(null);\n+        return;\n+      }\n+      const rgb = hexToRgb(hexColor);\n+      if (rgb)\n+        input.onChange(\n+          ColorFormatter[getColorFormat].getValue({ ...rgb, a: 1 })\n+        );\n+    },\n+    [getColorFormat, input]\n+  );\n \n   const toggleColorPicker = (event: React.SyntheticEvent) => {\n     event.stopPropagation();\n     const display = !displayColorPicker;\n     setDisplayColorPicker(display);\n-    if (display) {\n-      updateTriggerBoundingBox();\n-    }\n+    if (display) updateTriggerBoundingBox();\n   };\n \n+  const Widget = WIDGETS[widget];\n+  if (!Widget) throw new Error('You must specify a widget type.');\n+\n   return (\n-    <div className='relative' ref={triggerRef}>\n+    <div className='relative' ref={triggerRef} style={{ width }}>\n       <Swatch\n         onClick={toggleColorPicker}\n         colorRGBA={getColorRGBA}\n         colorFormat={getColorFormat}\n+        width={width}\n       />\n       {displayColorPicker && (\n         <FormPortal>\n@@ -244,11 +209,10 @@ export const ColorPicker: React.FC<Props> = ({\n                 onDismiss={toggleColorPicker}\n               >\n                 <Widget\n-                  presetColors={[...userColors, nullColor]}\n-                  color={getColorRGBA || { r: 0, g: 0, b: 0, a: 0 }}\n+                  presetColors={[...userColors, TRANSPARENT]}\n+                  color={currentHexColor}\n                   onChange={handleChange}\n-                  disableAlpha={true}\n-                  width={'240px'}\n+                  width={width || '240px'}\n                 />\n               </Dismissible>\n             </Popover>\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.test.ts b/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.test.ts\nnew file mode 100644\nindex 0000000000..aa7c59f0ac\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.test.ts\n@@ -0,0 +1,120 @@\n+import { describe, expect, it } from 'vitest';\n+import {\n+  checkerboardStyle,\n+  expandHex,\n+  hexToRgb,\n+  isValidHex,\n+  rgbToHex,\n+} from './color-utils';\n+\n+describe('color-utils', () => {\n+  describe('isValidHex', () => {\n+    it('returns true for valid hex colors', () => {\n+      expect(isValidHex('#FF0000')).toBe(true);\n+      expect(isValidHex('#00FF00')).toBe(true);\n+      expect(isValidHex('#000000')).toBe(true);\n+    });\n+\n+    it('returns true for shorthand hex colors', () => {\n+      expect(isValidHex('#F00')).toBe(true);\n+      expect(isValidHex('#abc')).toBe(true);\n+    });\n+\n+    it('returns false for invalid hex colors', () => {\n+      expect(isValidHex('')).toBe(false);\n+      expect(isValidHex('FF0000')).toBe(false);\n+      expect(isValidHex('#GGGGGG')).toBe(false);\n+      expect(isValidHex('#GGG')).toBe(false);\n+      expect(isValidHex('red')).toBe(false);\n+    });\n+  });\n+\n+  describe('expandHex', () => {\n+    it('expands shorthand hex to full uppercase', () => {\n+      expect(expandHex('#F00')).toBe('#FF0000');\n+      expect(expandHex('#0F0')).toBe('#00FF00');\n+      expect(expandHex('#00F')).toBe('#0000FF');\n+      expect(expandHex('#abc')).toBe('#AABBCC');\n+    });\n+\n+    it('normalizes full hex to uppercase', () => {\n+      expect(expandHex('#ff0000')).toBe('#FF0000');\n+      expect(expandHex('#ABC123')).toBe('#ABC123');\n+    });\n+  });\n+\n+  describe('hexToRgb', () => {\n+    it('converts valid hex to rgb', () => {\n+      expect(hexToRgb('#FF0000')).toEqual({ r: 255, g: 0, b: 0 });\n+      expect(hexToRgb('#00FF00')).toEqual({ r: 0, g: 255, b: 0 });\n+      expect(hexToRgb('#0000FF')).toEqual({ r: 0, g: 0, b: 255 });\n+    });\n+\n+    it('handles hex in any case', () => {\n+      expect(hexToRgb('#FF0000')).toEqual({ r: 255, g: 0, b: 0 });\n+      expect(hexToRgb('#ff0000')).toEqual({ r: 255, g: 0, b: 0 });\n+      expect(hexToRgb('#Ff0000')).toEqual({ r: 255, g: 0, b: 0 });\n+    });\n+\n+    it('converts black and white', () => {\n+      expect(hexToRgb('#000000')).toEqual({ r: 0, g: 0, b: 0 });\n+      expect(hexToRgb('#FFFFFF')).toEqual({ r: 255, g: 255, b: 255 });\n+    });\n+\n+    it('converts shorthand hex to rgb', () => {\n+      expect(hexToRgb('#F00')).toEqual({ r: 255, g: 0, b: 0 });\n+      expect(hexToRgb('#0F0')).toEqual({ r: 0, g: 255, b: 0 });\n+      expect(hexToRgb('#00F')).toEqual({ r: 0, g: 0, b: 255 });\n+      expect(hexToRgb('#abc')).toEqual({ r: 170, g: 187, b: 204 });\n+    });\n+\n+    it('returns null for invalid hex', () => {\n+      expect(hexToRgb('')).toBeNull();\n+      expect(hexToRgb('invalid')).toBeNull();\n+      expect(hexToRgb('#GGG')).toBeNull();\n+      expect(hexToRgb('#12345')).toBeNull();\n+      expect(hexToRgb('FF0000')).toBeNull();\n+    });\n+  });\n+\n+  describe('rgbToHex', () => {\n+    it('converts rgb to hex', () => {\n+      expect(rgbToHex(255, 0, 0)).toBe('#FF0000');\n+      expect(rgbToHex(0, 255, 0)).toBe('#00FF00');\n+      expect(rgbToHex(0, 0, 255)).toBe('#0000FF');\n+    });\n+\n+    it('converts black and white', () => {\n+      expect(rgbToHex(0, 0, 0)).toBe('#000000');\n+      expect(rgbToHex(255, 255, 255)).toBe('#FFFFFF');\n+    });\n+\n+    it('pads single digit hex values', () => {\n+      expect(rgbToHex(1, 2, 3)).toBe('#010203');\n+    });\n+  });\n+\n+  describe('hexToRgb and rgbToHex round-trip', () => {\n+    it('converts hex to rgb and back', () => {\n+      const originalHex = '#ABC123';\n+      const rgb = hexToRgb(originalHex);\n+      expect(rgb).not.toBeNull();\n+      const resultHex = rgbToHex(rgb!.r, rgb!.g, rgb!.b);\n+      expect(resultHex).toBe(originalHex);\n+    });\n+  });\n+\n+  describe('checkerboardStyle', () => {\n+    it('returns an object with background properties', () => {\n+      const style = checkerboardStyle();\n+      expect(style).toHaveProperty('backgroundImage');\n+      expect(style).toHaveProperty('backgroundSize');\n+      expect(style).toHaveProperty('backgroundPosition');\n+    });\n+\n+    it('uses custom size parameter', () => {\n+      const style = checkerboardStyle(16);\n+      expect(style.backgroundSize).toContain('16px');\n+    });\n+  });\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.ts b/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.ts\nnew file mode 100644\nindex 0000000000..d1efb83d4f\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.ts\n@@ -0,0 +1,57 @@\n+export const TRANSPARENT = 'transparent';\n+\n+export const isValidHex = (value: string): boolean =>\n+  /^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(value);\n+\n+export const expandHex = (hex: string): string => {\n+  const h = hex.replace('#', '');\n+  if (h.length === 3) {\n+    return `#${h[0]}${h[0]}${h[1]}${h[1]}${h[2]}${h[2]}`.toUpperCase();\n+  }\n+  return `#${h.toUpperCase()}`;\n+};\n+\n+export const hexToRgb = (\n+  hex: string\n+): { r: number; g: number; b: number } | null => {\n+  if (!hex || !isValidHex(hex)) return null;\n+  const expanded = expandHex(hex).replace('#', '');\n+  return {\n+    r: parseInt(expanded.substring(0, 2), 16),\n+    g: parseInt(expanded.substring(2, 4), 16),\n+    b: parseInt(expanded.substring(4, 6), 16),\n+  };\n+};\n+\n+/**\n+ * Converts RGB color values to a hex color string (e.g., \"#FF0000\" for red).\n+ *\n+ * How it works:\n+ * We need to convert three numbers (r, g, b) each ranging 0-255 into a 6-digit hex string.\n+ * For example: rgb(255, 128, 0) should become \"#FF8000\"\n+ *\n+ * The bit-shifting approach combines all three values into one number:\n+ * - (1 << 24) = 16777216 (0x1000000) - This adds a leading '1' to guarantee we always\n+ *   get 7 hex digits, which we later remove. Without this, rgb(0, 0, 255) would give\n+ *   us \"FF\" instead of \"0000FF\".\n+ * - (r << 16) shifts red left by 16 bits, placing it in positions for the first two hex digits\n+ * - (g << 8) shifts green left by 8 bits, placing it in positions for the middle two hex digits\n+ * - b stays as-is, occupying the last two hex digits\n+ *\n+ * Example with rgb(255, 128, 0):\n+ *   16777216 + (255 << 16) + (128 << 8) + 0\n+ *   = 16777216 + 16711680 + 32768 + 0\n+ *   = 33521664\n+ *   = 0x1FF8000 (as hex string: \"1FF8000\")\n+ *   After slice(1): \"FF8000\"\n+ *   Final result: \"#FF8000\"\n+ */\n+export const rgbToHex = (r: number, g: number, b: number): string =>\n+  `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase()}`;\n+\n+export const checkerboardStyle = (size = 8) => ({\n+  backgroundImage:\n+    'linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)',\n+  backgroundSize: `${size}px ${size}px`,\n+  backgroundPosition: `0 0, 0 ${size / 2}px, ${size / 2}px -${size / 2}px, -${size / 2}px 0px`,\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.test.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.test.tsx\nnew file mode 100644\nindex 0000000000..c5a99e7407\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.test.tsx\n@@ -0,0 +1,97 @@\n+import { fireEvent, render } from '@testing-library/react';\n+import * as React from 'react';\n+import { describe, expect, it, vi } from 'vitest';\n+import { SketchWidget } from './sketch-widget';\n+\n+describe('SketchWidget', () => {\n+  const defaultProps = {\n+    presetColors: ['#FF0000', '#00FF00', '#0000FF', 'transparent'],\n+    color: '#FF0000',\n+    onChange: vi.fn(),\n+    width: '240px',\n+  };\n+\n+  it('renders without crashing', () => {\n+    const { container } = render(<SketchWidget {...defaultProps} />);\n+    expect(container.firstChild).toBeTruthy();\n+  });\n+\n+  it('displays the hex input with current color', () => {\n+    const { getByDisplayValue } = render(<SketchWidget {...defaultProps} />);\n+    expect(getByDisplayValue('#FF0000')).toBeTruthy();\n+  });\n+\n+  it('displays RGB inputs with correct values', () => {\n+    const { container } = render(<SketchWidget {...defaultProps} />);\n+    const numberInputs = container.querySelectorAll('input[type=\"number\"]');\n+\n+    expect(numberInputs).toHaveLength(3);\n+    expect((numberInputs[0] as HTMLInputElement).value).toBe('255'); // R\n+    expect((numberInputs[1] as HTMLInputElement).value).toBe('0'); // G\n+    expect((numberInputs[2] as HTMLInputElement).value).toBe('0'); // B\n+  });\n+\n+  it('calls onChange when R input changes', () => {\n+    const onChange = vi.fn();\n+    const { container } = render(\n+      <SketchWidget {...defaultProps} onChange={onChange} />\n+    );\n+    const rInput = container.querySelectorAll('input[type=\"number\"]')[0];\n+\n+    fireEvent.change(rInput, { target: { value: '128' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#800000');\n+  });\n+\n+  it('calls onChange when G input changes', () => {\n+    const onChange = vi.fn();\n+    const { container } = render(\n+      <SketchWidget {...defaultProps} color='#000000' onChange={onChange} />\n+    );\n+    const gInput = container.querySelectorAll('input[type=\"number\"]')[1];\n+\n+    fireEvent.change(gInput, { target: { value: '255' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#00FF00');\n+  });\n+\n+  it('calls onChange when B input changes', () => {\n+    const onChange = vi.fn();\n+    const { container } = render(\n+      <SketchWidget {...defaultProps} color='#000000' onChange={onChange} />\n+    );\n+    const bInput = container.querySelectorAll('input[type=\"number\"]')[2];\n+\n+    fireEvent.change(bInput, { target: { value: '255' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#0000FF');\n+  });\n+\n+  it('clamps RGB values to 0-255 range', () => {\n+    const onChange = vi.fn();\n+    const { container } = render(\n+      <SketchWidget {...defaultProps} color='#000000' onChange={onChange} />\n+    );\n+    const rInput = container.querySelectorAll('input[type=\"number\"]')[0];\n+\n+    fireEvent.change(rInput, { target: { value: '300' } });\n+\n+    expect(onChange).toHaveBeenCalledWith('#FF0000');\n+  });\n+\n+  it('renders preset color swatches', () => {\n+    const { getAllByRole } = render(<SketchWidget {...defaultProps} />);\n+    const buttons = getAllByRole('button');\n+\n+    expect(buttons.length).toBe(defaultProps.presetColors.length);\n+  });\n+\n+  it('respects the provided width', () => {\n+    const { container } = render(\n+      <SketchWidget {...defaultProps} width='300px' />\n+    );\n+    const wrapper = container.firstChild as HTMLElement;\n+\n+    expect(wrapper.style.width).toBe('300px');\n+  });\n+});\ndiff --git a/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.tsx b/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.tsx\nnew file mode 100644\nindex 0000000000..1cd7fb8500\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.tsx\n@@ -0,0 +1,73 @@\n+import * as React from 'react';\n+import { HexColorPicker } from 'react-colorful';\n+import {\n+  ColorPreview,\n+  HexInput,\n+  SwatchGrid,\n+  WidgetProps,\n+  useHexInput,\n+} from './color-input';\n+import { hexToRgb, rgbToHex } from './color-utils';\n+\n+export const SketchWidget: React.FC<WidgetProps> = ({\n+  presetColors,\n+  color,\n+  onChange,\n+  width,\n+}) => {\n+  const {\n+    inputValue,\n+    handleChange,\n+    handleFocus,\n+    handleBlur,\n+    handleSwatchClick,\n+  } = useHexInput(color, onChange);\n+  const currentRgb = hexToRgb(color) || { r: 0, g: 0, b: 0 };\n+\n+  const handleRgbChange = (channel: 'r' | 'g' | 'b', value: string) => {\n+    const num = Math.max(0, Math.min(255, parseInt(value, 10) || 0));\n+    const updated = { ...currentRgb, [channel]: num };\n+    onChange(rgbToHex(updated.r, updated.g, updated.b));\n+  };\n+\n+  return (\n+    <div className='bg-white rounded-lg shadow-lg p-3' style={{ width }}>\n+      <HexColorPicker\n+        color={color || '#000000'}\n+        onChange={onChange}\n+        className='!w-full !h-[150px]'\n+      />\n+      <div className='mt-2 flex gap-2 items-center'>\n+        <ColorPreview color={color} />\n+        <HexInput\n+          value={inputValue}\n+          onChange={handleChange}\n+          onFocus={handleFocus}\n+          onBlur={handleBlur}\n+        />\n+      </div>\n+      <div className='mt-2 flex gap-2'>\n+        {(['r', 'g', 'b'] as const).map((channel) => (\n+          <div key={channel} className='flex-1'>\n+            <label className='block text-xs text-gray-500 mb-0.5'>\n+              {channel.toUpperCase()}\n+            </label>\n+            <input\n+              type='number'\n+              min={0}\n+              max={255}\n+              value={currentRgb[channel]}\n+              onChange={(e) => handleRgbChange(channel, e.target.value)}\n+              className='shadow-inner w-full px-2 py-1 text-sm border border-gray-200 rounded focus:shadow-outline focus:border-blue-500 focus:outline-none'\n+            />\n+          </div>\n+        ))}\n+      </div>\n+      <SwatchGrid\n+        colors={presetColors}\n+        selectedColor={color}\n+        onSelect={handleSwatchClick}\n+      />\n+    </div>\n+  );\n+};\ndiff --git a/packages/tinacms/src/toolkit/fields/plugins/color-field-plugin.tsx b/packages/tinacms/src/toolkit/fields/plugins/color-field-plugin.tsx\nindex 585ade8411..00a042de40 100644\n--- a/packages/tinacms/src/toolkit/fields/plugins/color-field-plugin.tsx\n+++ b/packages/tinacms/src/toolkit/fields/plugins/color-field-plugin.tsx\n@@ -7,6 +7,7 @@ export interface ColorFieldProps {\n   colorFormat: string;\n   colors: string[];\n   widget?: 'sketch' | 'block';\n+  width?: string;\n }\n export const ColorField = wrapFieldsWithMeta<InputProps, ColorFieldProps>(\n   ({ input, field }) => {\n@@ -15,6 +16,7 @@ export const ColorField = wrapFieldsWithMeta<InputProps, ColorFieldProps>(\n         colorFormat={(field as any).colorFormat}\n         userColors={(field as any).colors}\n         widget={(field as any).widget}\n+        width={(field as any).width}\n         input={input}\n       />\n     );\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 7dcadcbb04..c181c3de03 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -216,9 +216,6 @@ catalogs:\n     '@types/prop-types':\n       specifier: ^15.7.14\n       version: 15.7.14\n-    '@types/react-color':\n-      specifier: ^3.0.13\n-      version: 3.0.13\n     '@types/react-dom':\n       specifier: ^18.3.5\n       version: 18.3.5\n@@ -579,9 +576,9 @@ catalogs:\n     puppeteer:\n       specifier: ^23.11.1\n       version: 23.11.1\n-    react-color:\n-      specifier: ^2.19.3\n-      version: 2.19.3\n+    react-colorful:\n+      specifier: ^5.6.1\n+      version: 5.6.1\n     react-datetime:\n       specifier: ^3.3.1\n       version: 3.3.1\n@@ -698,6 +695,9 @@ importers:\n       highlight.js:\n         specifier: 'catalog:'\n         version: 11.11.1\n+      react-colorful:\n+        specifier: 'catalog:'\n+        version: 5.6.1(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n     devDependencies:\n       '@biomejs/biome':\n         specifier: 'catalog:'\n@@ -1106,7 +1106,7 @@ importers:\n         version: 0.0.3\n       next:\n         specifier: ^14.2.24\n-        version: 14.2.24(@babel/core@7.28.5)(@playwright/test@1.50.1)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)(sass@1.89.2)\n+        version: 14.2.24(@babel/core@7.26.9)(@playwright/test@1.50.1)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)(sass@1.89.2)\n       react:\n         specifier: ^18.3.1\n         version: 18.3.1\n@@ -2356,9 +2356,9 @@ importers:\n       prop-types:\n         specifier: 'catalog:'\n         version: 15.7.2\n-      react-color:\n+      react-colorful:\n         specifier: 'catalog:'\n-        version: 2.19.3(react@18.3.1)\n+        version: 5.6.1(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       react-datetime:\n         specifier: 'catalog:'\n         version: 3.3.1(moment@2.29.4)(react@18.3.1)\n@@ -2429,9 +2429,6 @@ importers:\n       '@types/react':\n         specifier: ^18.3.18\n         version: 18.3.18\n-      '@types/react-color':\n-        specifier: 'catalog:'\n-        version: 3.0.13(@types/react@18.3.18)\n       '@types/react-dom':\n         specifier: 'catalog:'\n         version: 18.3.5(@types/react@18.3.18)\n@@ -4838,11 +4835,6 @@ packages:\n   '@iconify/utils@3.1.0':\n     resolution: {integrity: sha512-Zlzem1ZXhI1iHeeERabLNzBHdOa4VhQbqAcOQaMKuTuyZCpwKbC2R4Dd0Zo3g9EAc+Y4fiarO8HIHRAth7+skw==}\n \n-  '@icons/material@0.2.4':\n-    resolution: {integrity: sha512-QPcGmICAPbGLGb6F/yNf/KzKqvFx8z5qx3D1yFqVAjoFmXK35EgyW+cJ57Te3CNsmzblwtzakLGFqHPqrfb4Tw==}\n-    peerDependencies:\n-      react: '*'\n-\n   '@img/sharp-darwin-arm64@0.33.5':\n     resolution: {integrity: sha512-UT4p+iz/2H4twwAoLCqfA9UH5pI6DggwKEGuaPy7nCVQ8ZsiY5PIcrRvD1DzuY3qYL07NtIQcWnBSY/heikIFQ==}\n     engines: {node: ^18.17.0 || ^20.3.0 || >=21.0.0}\n@@ -7374,11 +7366,6 @@ packages:\n   '@types/range-parser@1.2.7':\n     resolution: {integrity: sha512-hKormJbkJqzQGhziax5PItDUTMAM9uE2XXQmM37dyd4hVM+5aVl7oVxMVUiVQn2oCQFN/LKCZdvSM0pFRqbSmQ==}\n \n-  '@types/react-color@3.0.13':\n-    resolution: {integrity: sha512-2c/9FZ4ixC5T3JzN0LP5Cke2Mf0MKOP2Eh0NPDPWmuVH3NjPyhEjqNMQpN1Phr5m74egAy+p2lYNAFrX1z9Yrg==}\n-    peerDependencies:\n-      '@types/react': '*'\n-\n   '@types/react-dom@18.3.5':\n     resolution: {integrity: sha512-P4t6saawp+b/dFrUr2cvkVsfvPguwsxtH6dNIYRllMsefqFzkZk5UIjzyDOv5g1dXIPdG4Sp1yCR4Z6RCUsG/Q==}\n     peerDependencies:\n@@ -7390,11 +7377,6 @@ packages:\n   '@types/react@18.3.26':\n     resolution: {integrity: sha512-RFA/bURkcKzx/X9oumPG9Vp3D3JUgus/d0b67KB0t5S/raciymilkOa66olh78MUI92QLbEJevO7rvqU/kjwKA==}\n \n-  '@types/reactcss@1.2.13':\n-    resolution: {integrity: sha512-gi3S+aUi6kpkF5vdhUsnkwbiSEIU/BEJyD7kBy2SudWBUuKmJk8AQKE0OVcQQeEy40Azh0lV6uynxlikYIJuwg==}\n-    peerDependencies:\n-      '@types/react': '*'\n-\n   '@types/search-index@3.2.4':\n     resolution: {integrity: sha512-LcEeFWp5a2XB2Mjh/nPt4aCHfTGUP+nYMg7wbrvARhy4lHxskDGbwlWkdPj3TXaP/wZbkMp09Ldz9SvrBp2ezA==}\n \n@@ -11634,9 +11616,6 @@ packages:\n     engines: {node: '>= 20'}\n     hasBin: true\n \n-  material-colors@1.2.6:\n-    resolution: {integrity: sha512-6qE4B9deFBIa9YSpOc9O0Sgc43zTeVYbgDT5veRKSlB2+ZuHNoVVxA1L/ckMUayV9Ay9y7Z/SZCLcGteW9i7bg==}\n-\n   math-intrinsics@1.1.0:\n     resolution: {integrity: sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==}\n     engines: {node: '>= 0.4'}\n@@ -12894,10 +12873,11 @@ packages:\n     resolution: {integrity: sha512-y3bGgqKj3QBdxLbLkomlohkvsA8gdAiUQlSBJnBhfn+BPxg4bc62d8TcBW15wavDfgexCgccckhcZvywyQYPOw==}\n     hasBin: true\n \n-  react-color@2.19.3:\n-    resolution: {integrity: sha512-LEeGE/ZzNLIsFWa1TMe8y5VYqr7bibneWmvJwm1pCn/eNmrabWDh659JSPn9BuaMpEfU83WTOJfnCcjDZwNQTA==}\n+  react-colorful@5.6.1:\n+    resolution: {integrity: sha512-1exovf0uGTGyq5mXQT0zgQ80uvj2PCwvF8zY1RN9/vbJVSjSo3fsB/4L3ObbF7u70NduSiK4xu4Y6q1MHoUGEw==}\n     peerDependencies:\n-      react: '*'\n+      react: '>=16.8.0'\n+      react-dom: '>=16.8.0'\n \n   react-datetime@3.3.1:\n     resolution: {integrity: sha512-CMgQFLGidYu6CAlY6S2Om2UZiTfZsjC6j4foXcZ0kb4cSmPomdJ2S1PhK0v3fwflGGVuVARGxwkEUWtccHapJA==}\n@@ -13039,11 +13019,6 @@ packages:\n     resolution: {integrity: sha512-wS+hAgJShR0KhEvPJArfuPVN1+Hz1t0Y6n5jLrGQbkb4urgPE/0Rve+1kMB1v/oWgHgm4WIcV+i7F2pTVj+2iQ==}\n     engines: {node: '>=0.10.0'}\n \n-  reactcss@1.2.3:\n-    resolution: {integrity: sha512-KiwVUcFu1RErkI97ywr8nvx8dNOpT03rbnma0SSalTYjkrPYaEajR4a/MRt6DZ46K6arDRbWMNHF+xH7G7n/8A==}\n-    peerDependencies:\n-      react: '*'\n-\n   read-cache@1.0.0:\n     resolution: {integrity: sha512-Owdv/Ft7IjOgm/i0xvNDZ1LrRANRfew4b2prF3OWMQLxLfu3bS8FVhCsrSCMK4lR56Y9ya+AThoTpDCTxCmpRA==}\n \n@@ -13887,9 +13862,6 @@ packages:\n   tinybench@2.9.0:\n     resolution: {integrity: sha512-0+DUvqWMValLmha6lr4kD8iAMK1HzV0/aKnCtWb9v9641TnP/MFb7Pc2bxoxQjTXAErryXVgUOfv2YqNllqGeg==}\n \n-  tinycolor2@1.6.0:\n-    resolution: {integrity: sha512-XPaBkWQJdsf3pLKJV9p4qN/S+fm2Oj8AIPo1BTUhg5oxkvm9+SVEGFdhyOz7tTdUTfvxMiAs4sp6/eZO2Ew+pw==}\n-\n   tinyexec@0.3.2:\n     resolution: {integrity: sha512-KQQR9yN7R5+OSwaK0XQoj22pwHoTlgYqmUscPYoknOoWCWfj/5/ABTMRi69FrKU5ffPVh5QcFikpWJI/P1ocHA==}\n \n@@ -18147,10 +18119,6 @@ snapshots:\n       '@iconify/types': 2.0.0\n       mlly: 1.8.0\n \n-  '@icons/material@0.2.4(react@18.3.1)':\n-    dependencies:\n-      react: 18.3.1\n-\n   '@img/sharp-darwin-arm64@0.33.5':\n     optionalDependencies:\n       '@img/sharp-libvips-darwin-arm64': 1.0.4\n@@ -18697,8 +18665,8 @@ snapshots:\n \n   '@jridgewell/source-map@0.3.6':\n     dependencies:\n-      '@jridgewell/gen-mapping': 0.3.8\n-      '@jridgewell/trace-mapping': 0.3.25\n+      '@jridgewell/gen-mapping': 0.3.13\n+      '@jridgewell/trace-mapping': 0.3.31\n     optional: true\n \n   '@jridgewell/sourcemap-codec@1.5.0': {}\n@@ -21222,11 +21190,6 @@ snapshots:\n \n   '@types/range-parser@1.2.7': {}\n \n-  '@types/react-color@3.0.13(@types/react@18.3.18)':\n-    dependencies:\n-      '@types/react': 18.3.18\n-      '@types/reactcss': 1.2.13(@types/react@18.3.18)\n-\n   '@types/react-dom@18.3.5(@types/react@18.3.18)':\n     dependencies:\n       '@types/react': 18.3.18\n@@ -21241,10 +21204,6 @@ snapshots:\n       '@types/prop-types': 15.7.14\n       csstype: 3.1.3\n \n-  '@types/reactcss@1.2.13(@types/react@18.3.18)':\n-    dependencies:\n-      '@types/react': 18.3.18\n-\n   '@types/search-index@3.2.4':\n     dependencies:\n       '@types/abstract-leveldown': 7.2.5\n@@ -23959,7 +23918,7 @@ snapshots:\n       eslint: 7.32.0\n       eslint-import-resolver-node: 0.3.9\n       eslint-import-resolver-typescript: 2.7.1(eslint-plugin-import@2.31.0(eslint@7.32.0))(eslint@7.32.0)\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1(eslint-plugin-import@2.31.0(eslint@7.32.0))(eslint@7.32.0))(eslint@7.32.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1)(eslint@7.32.0)\n       eslint-plugin-jsx-a11y: 6.10.2(eslint@7.32.0)\n       eslint-plugin-react: 7.37.4(eslint@7.32.0)\n       eslint-plugin-react-hooks: 4.6.2(eslint@7.32.0)\n@@ -23978,7 +23937,7 @@ snapshots:\n       eslint: 8.24.0\n       eslint-import-resolver-node: 0.3.9\n       eslint-import-resolver-typescript: 3.10.1(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0)\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1)(eslint@8.24.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0)\n       eslint-plugin-jsx-a11y: 6.10.2(eslint@8.24.0)\n       eslint-plugin-react: 7.37.4(eslint@8.24.0)\n       eslint-plugin-react-hooks: 4.6.2(eslint@8.24.0)\n@@ -24021,7 +23980,7 @@ snapshots:\n     dependencies:\n       debug: 4.4.0\n       eslint: 7.32.0\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1(eslint-plugin-import@2.31.0(eslint@7.32.0))(eslint@7.32.0))(eslint@7.32.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1)(eslint@7.32.0)\n       glob: 7.2.3\n       is-glob: 4.0.3\n       resolve: 1.22.10\n@@ -24040,7 +23999,7 @@ snapshots:\n       tinyglobby: 0.2.15\n       unrs-resolver: 1.11.1\n     optionalDependencies:\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1)(eslint@8.24.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0)\n     transitivePeerDependencies:\n       - supports-color\n \n@@ -24092,7 +24051,7 @@ snapshots:\n     transitivePeerDependencies:\n       - supports-color\n \n-  eslint-plugin-import@2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1(eslint-plugin-import@2.31.0(eslint@7.32.0))(eslint@7.32.0))(eslint@7.32.0):\n+  eslint-plugin-import@2.31.0(@typescript-eslint/parser@4.33.0(eslint@7.32.0)(typescript@5.9.3))(eslint-import-resolver-typescript@2.7.1)(eslint@7.32.0):\n     dependencies:\n       '@rtsao/scc': 1.1.0\n       array-includes: 3.1.8\n@@ -24121,7 +24080,7 @@ snapshots:\n       - eslint-import-resolver-webpack\n       - supports-color\n \n-  eslint-plugin-import@2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1)(eslint@8.24.0):\n+  eslint-plugin-import@2.31.0(@typescript-eslint/parser@6.21.0(eslint@8.24.0)(typescript@5.9.3))(eslint-import-resolver-typescript@3.10.1(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0):\n     dependencies:\n       '@rtsao/scc': 1.1.0\n       array-includes: 3.1.8\n@@ -26965,8 +26924,6 @@ snapshots:\n \n   marked@16.4.2: {}\n \n-  material-colors@1.2.6: {}\n-\n   math-intrinsics@1.1.0: {}\n \n   mdast-util-compact@4.1.1:\n@@ -27932,33 +27889,6 @@ snapshots:\n       - '@babel/core'\n       - babel-plugin-macros\n \n-  next@14.2.24(@babel/core@7.28.5)(@playwright/test@1.50.1)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)(sass@1.89.2):\n-    dependencies:\n-      '@next/env': 14.2.24\n-      '@swc/helpers': 0.5.5\n-      busboy: 1.6.0\n-      caniuse-lite: 1.0.30001701\n-      graceful-fs: 4.2.11\n-      postcss: 8.4.31\n-      react: 18.3.1\n-      react-dom: 18.3.1(react@18.3.1)\n-      styled-jsx: 5.1.1(@babel/core@7.28.5)(react@18.3.1)\n-    optionalDependencies:\n-      '@next/swc-darwin-arm64': 14.2.24\n-      '@next/swc-darwin-x64': 14.2.24\n-      '@next/swc-linux-arm64-gnu': 14.2.24\n-      '@next/swc-linux-arm64-musl': 14.2.24\n-      '@next/swc-linux-x64-gnu': 14.2.24\n-      '@next/swc-linux-x64-musl': 14.2.24\n-      '@next/swc-win32-arm64-msvc': 14.2.24\n-      '@next/swc-win32-ia32-msvc': 14.2.24\n-      '@next/swc-win32-x64-msvc': 14.2.24\n-      '@playwright/test': 1.50.1\n-      sass: 1.89.2\n-    transitivePeerDependencies:\n-      - '@babel/core'\n-      - babel-plugin-macros\n-\n   ngraminator@3.0.2: {}\n \n   no-case@3.0.4:\n@@ -28702,16 +28632,10 @@ snapshots:\n       minimist: 1.2.8\n       strip-json-comments: 2.0.1\n \n-  react-color@2.19.3(react@18.3.1):\n+  react-colorful@5.6.1(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n     dependencies:\n-      '@icons/material': 0.2.4(react@18.3.1)\n-      lodash: 4.17.21\n-      lodash-es: 4.17.21\n-      material-colors: 1.2.6\n-      prop-types: 15.8.1\n       react: 18.3.1\n-      reactcss: 1.2.3(react@18.3.1)\n-      tinycolor2: 1.6.0\n+      react-dom: 18.3.1(react@18.3.1)\n \n   react-datetime@3.3.1(moment@2.29.4)(react@18.3.1):\n     dependencies:\n@@ -28854,11 +28778,6 @@ snapshots:\n     dependencies:\n       loose-envify: 1.4.0\n \n-  reactcss@1.2.3(react@18.3.1):\n-    dependencies:\n-      lodash: 4.17.21\n-      react: 18.3.1\n-\n   read-cache@1.0.0:\n     dependencies:\n       pify: 2.3.0\n@@ -29806,13 +29725,6 @@ snapshots:\n       '@babel/core': 7.26.9\n       babel-plugin-macros: 3.1.0\n \n-  styled-jsx@5.1.1(@babel/core@7.28.5)(react@18.3.1):\n-    dependencies:\n-      client-only: 0.0.1\n-      react: 18.3.1\n-    optionalDependencies:\n-      '@babel/core': 7.28.5\n-\n   stylis@4.1.3: {}\n \n   stylis@4.2.0: {}\n@@ -30018,7 +29930,7 @@ snapshots:\n   terser@5.39.0:\n     dependencies:\n       '@jridgewell/source-map': 0.3.6\n-      acorn: 8.14.0\n+      acorn: 8.15.0\n       commander: 2.20.3\n       source-map-support: 0.5.21\n     optional: true\n@@ -30055,8 +29967,6 @@ snapshots:\n \n   tinybench@2.9.0: {}\n \n-  tinycolor2@1.6.0: {}\n-\n   tinyexec@0.3.2: {}\n \n   tinyexec@1.0.2: {}\ndiff --git a/pnpm-workspace.yaml b/pnpm-workspace.yaml\nindex b0e9a08e35..37baf9572d 100644\n--- a/pnpm-workspace.yaml\n+++ b/pnpm-workspace.yaml\n@@ -79,7 +79,6 @@ catalog:\n   \"@types/prompts\": ^2.4.9\n   \"@types/prop-types\": ^15.7.14\n   \"@types/react-beautiful-dnd\": ^13.1.8\n-  \"@types/react-color\": ^3.0.13\n   \"@types/react-dom\": ^18.3.5\n   \"@types/search-index\": ^3.2.4\n   \"@types/styled-components\": ^5.1.34\n@@ -203,7 +202,7 @@ catalog:\n   puppeteer: ^23.11.1\n   query-string: ^9.0.0\n   react-beautiful-dnd: ^13.1.1\n-  react-color: ^2.19.3\n+  react-colorful: ^5.6.1\n   react-datetime: ^3.3.1\n   react-dnd: ^16.0.1\n   react-dnd-html5-backend: ^16.0.1\n", "test_files": ["packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.test.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.test.ts", "packages/tinacms/src/toolkit/fields/components/color-picker/color-input.test.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.test.ts", "packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.test.tsx"], "code_files": ["packages/@tinacms/schema-tools/src/types/index.ts", "packages/tinacms/src/toolkit/fields/components/color-picker/block-widget.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-formatter.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-input.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-picker.tsx", "packages/tinacms/src/toolkit/fields/components/color-picker/color-utils.ts", "packages/tinacms/src/toolkit/fields/components/color-picker/sketch-widget.tsx", "packages/tinacms/src/toolkit/fields/plugins/color-field-plugin.tsx"]}
{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.6131", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 6131, "merge_commit": "d900f4e6c6f0a86c94bba5f0925bbaa54eeb90db", "problem_statement": "\u23ea Revert - Sonner alert notifications", "patch": "diff --git a/.changeset/strong-pants-drop.md b/.changeset/strong-pants-drop.md\nnew file mode 100644\nindex 0000000000..a9c31df82d\n--- /dev/null\n+++ b/.changeset/strong-pants-drop.md\n@@ -0,0 +1,5 @@\n+---\n+\"tinacms\": patch\n+---\n+\n+Revert Sonner alert notifications\ndiff --git a/packages/tinacms/package.json b/packages/tinacms/package.json\nindex 7c09321857..a5537824ca 100644\n--- a/packages/tinacms/package.json\n+++ b/packages/tinacms/package.json\n@@ -146,12 +146,10 @@\n \t\t\"react-icons\": \"^5.4.0\",\n \t\t\"react-router-dom\": \"catalog:\",\n \t\t\"react-use\": \"catalog:\",\n-\t\t\"sonner\": \"^2.0.7\",\n \t\t\"tailwind-merge\": \"^2.6.0\",\n \t\t\"webfontloader\": \"catalog:\",\n \t\t\"yup\": \"^1.6.1\",\n-\t\t\"zod\": \"^3.24.2\",\n-\t\t\"dompurify\": \"^3.3.0\"\n+\t\t\"zod\": \"^3.24.2\"\n \t},\n \t\"devDependencies\": {\n \t\t\"@graphql-tools/utils\": \"catalog:\",\n@@ -172,11 +170,11 @@\n \t\t\"@types/react-color\": \"catalog:\",\n \t\t\"@types/react-dom\": \"^18.3.5\",\n \t\t\"@types/yup\": \"^0.32.0\",\n+\t\t\"lowlight\": \"^3.3.0\",\n \t\t\"happy-dom\": \"catalog:\",\n \t\t\"identity-obj-proxy\": \"catalog:\",\n \t\t\"isomorphic-fetch\": \"catalog:\",\n \t\t\"jest-file-snapshot\": \"^0.7.0\",\n-\t\t\"lowlight\": \"^3.3.0\",\n \t\t\"next\": \"14.2.10\",\n \t\t\"react\": \"^18.3.1\",\n \t\t\"react-dom\": \"^18.3.1\",\ndiff --git a/packages/tinacms/src/toolkit/alerts/alerts.test.ts b/packages/tinacms/src/toolkit/alerts/alerts.test.ts\nindex 1d12c3b5b0..c839e79d0b 100644\n--- a/packages/tinacms/src/toolkit/alerts/alerts.test.ts\n+++ b/packages/tinacms/src/toolkit/alerts/alerts.test.ts\n@@ -1,19 +1,6 @@\n import { EventBus } from '@toolkit/core';\n-import { describe, it, vi, beforeEach } from 'vitest';\n+import { describe, it, vi } from 'vitest';\n import { Alerts } from './alerts';\n-import { toast } from '../components/ui/sonner';\n-\n-// Mock the toast module\n-vi.mock('../components/ui/sonner', () => ({\n-  toast: {\n-    success: vi.fn(() => 'success-toast-id'),\n-    error: vi.fn(() => 'error-toast-id'),\n-    warning: vi.fn(() => 'warning-toast-id'),\n-    info: vi.fn(() => 'info-toast-id'),\n-    dismiss: vi.fn(),\n-  },\n-  Toaster: () => null,\n-}));\n \n // biome-ignore lint/correctness/useHookAtTopLevel: not ready to fix these yet\n vi.useFakeTimers();\n@@ -21,111 +8,27 @@ vi.useFakeTimers();\n const events = new EventBus();\n \n describe('Alerts', () => {\n-  beforeEach(() => {\n-    vi.clearAllMocks();\n-  });\n-\n   it('is empty by default', () => {\n     const alerts = new Alerts(events);\n \n     expect(alerts.all).toHaveLength(0);\n   });\n-\n-  describe('Toast Notifications', () => {\n-    it('triggers toast.info when info alert is added', () => {\n-      const alerts = new Alerts(events);\n-\n-      alerts.info('Info message', 5000);\n-\n-      expect(toast.info).toHaveBeenCalledWith('Info message', {\n-        duration: 5000,\n-      });\n-    });\n-\n-    it('triggers toast.success when success alert is added', () => {\n-      const alerts = new Alerts(events);\n-\n-      alerts.success('Success message', 3000);\n-\n-      expect(toast.success).toHaveBeenCalledWith('Success message', {\n-        duration: 3000,\n-      });\n-    });\n-\n-    it('triggers toast.warning when warn alert is added', () => {\n-      const alerts = new Alerts(events);\n-\n-      alerts.warn('Warning message', 4000);\n-\n-      expect(toast.warning).toHaveBeenCalledWith('Warning message', {\n-        duration: 4000,\n-      });\n-    });\n-\n-    it('does not trigger toast for error alerts', () => {\n-      const alerts = new Alerts(events);\n-\n-      alerts.error('Error message');\n-\n-      // Error alerts don't trigger toasts - they're shown in modals\n-      expect(toast.error).not.toHaveBeenCalled();\n-    });\n-\n-    it('calls toast.dismiss when non-error alert is dismissed', () => {\n-      const alerts = new Alerts(events);\n-      const dismiss = alerts.info('Info message');\n-\n-      dismiss();\n-\n-      expect(toast.dismiss).toHaveBeenCalledWith('info-toast-id');\n-    });\n-\n-    it('does not call toast.dismiss when error alert is dismissed', () => {\n-      const alerts = new Alerts(events);\n-      const dismiss = alerts.error('Error message');\n-\n-      dismiss();\n-\n-      // Error alerts don't dismiss the toast, only remove from collection\n-      expect(toast.dismiss).not.toHaveBeenCalled();\n-    });\n-  });\n-\n-  describe('Alert Storage', () => {\n-    it('stores all alerts in the collection', () => {\n-      const alerts = new Alerts(events);\n-\n-      alerts.info('Info');\n-      alerts.success('Success');\n-      alerts.warn('Warning');\n-      alerts.error('Error');\n-\n-      // All alerts are stored\n-      expect(alerts.all).toHaveLength(4);\n-    });\n-\n-    it('stores error alerts with custom ID', () => {\n+  describe('calling alerts.add(\"info\", \"Test\")', () => {\n+    it('creates alert with message: \"Test\"', () => {\n       const alerts = new Alerts(events);\n \n-      alerts.error('Error message');\n+      alerts.info('Test');\n \n-      const errorAlert = alerts.all[0];\n-      expect(errorAlert?.level).toBe('error');\n-      expect(errorAlert?.message).toBe('Error message');\n-      // Error alerts get a custom timestamp-based ID\n-      expect(errorAlert?.id).toContain('Error message|');\n+      const testAlert = alerts.all.pop();\n+      expect(testAlert?.message).toBe('Test');\n     });\n-  });\n-\n-  describe('calling alerts.add(\"info\", \"Test\")', () => {\n-    it('stores info alerts in the collection', () => {\n+    it('creates alert with level: \"info\"', () => {\n       const alerts = new Alerts(events);\n \n       alerts.info('Test');\n \n-      expect(alerts.all).toHaveLength(1);\n-      expect(alerts.all[0]?.message).toBe('Test');\n-      expect(alerts.all[0]?.level).toBe('info');\n+      const testAlert = alerts.all.pop();\n+      expect(testAlert?.level).toBe('info');\n     });\n     it.skip('will remove the message after 3000ms', async () => {\n       const alerts = new Alerts(events);\ndiff --git a/packages/tinacms/src/toolkit/alerts/alerts.ts b/packages/tinacms/src/toolkit/alerts/alerts.ts\nindex edcbfedb4d..a9fec25245 100644\n--- a/packages/tinacms/src/toolkit/alerts/alerts.ts\n+++ b/packages/tinacms/src/toolkit/alerts/alerts.ts\n@@ -1,6 +1,5 @@\n import React from 'react';\n import type { EventBus, Callback, CMSEvent } from '@toolkit/core';\n-import { toast } from '@toolkit/components/ui/sonner';\n \n export interface EventsToAlerts {\n   [key: string]: ToAlert | AlertArgs;\n@@ -52,55 +51,26 @@ export class Alerts {\n     message: string | React.FunctionComponent,\n     timeout = 8000\n   ): () => void {\n-    let id: string | number;\n-\n-    // Use sonner's toast methods based on level\n-    // For FunctionComponent messages, render them directly\n-    // For string messages, use them as-is (URL parsing happens in component)\n-    const toastMessage =\n-      typeof message === 'string' ? message : React.createElement(message);\n-\n-    switch (level) {\n-      case 'success':\n-        id = toast.success(toastMessage, {\n-          duration: timeout,\n-        });\n-        break;\n-      case 'error':\n-        id = `${message}|${Date.now()}`;\n-        break;\n-      case 'warn':\n-        id = toast.warning(toastMessage, {\n-          duration: timeout,\n-        });\n-        break;\n-      case 'info':\n-      default:\n-        id = toast.info(toastMessage, {\n-          duration: timeout,\n-        });\n-        break;\n-    }\n-\n     const alert = {\n       level,\n       message,\n       timeout,\n-      id: String(id),\n+      id: `${message}|${Date.now()}`,\n     };\n \n     this.alerts.set(alert.id, alert);\n \n     this.events.dispatch({ type: 'alerts:add', alert });\n \n-    const dismiss = () => {\n-      if (level !== 'error') {\n-        toast.dismiss(id);\n-      }\n+    let timeoutId: any = null;\n \n+    const dismiss = () => {\n+      clearTimeout(timeoutId);\n       this.dismiss(alert);\n     };\n \n+    timeoutId = level !== 'error' ? setTimeout(dismiss, alert.timeout) : null;\n+\n     return dismiss;\n   }\n \ndiff --git a/packages/tinacms/src/toolkit/components/ui/sonner.tsx b/packages/tinacms/src/toolkit/components/ui/sonner.tsx\ndeleted file mode 100644\nindex aee581d202..0000000000\n--- a/packages/tinacms/src/toolkit/components/ui/sonner.tsx\n+++ /dev/null\n@@ -1,122 +0,0 @@\n-import React from 'react';\n-import DOMPurify from 'dompurify';\n-import { toast as sonnerToast, Toaster as Sonner } from 'sonner';\n-\n-type ToasterProps = React.ComponentProps<typeof Sonner>;\n-\n-// Helper to parse URLs in text and make them clickable\n-// Ensures only links with allowed protocols get rendered as clickable links to avoid XSS.\n-const isSafeHref = (href: string) => {\n-  // Only allow http, https links -- can be expanded as needed\n-  return (\n-    /^https?:\\/\\//.test(href) &&\n-    !/^javascript:/i.test(href) &&\n-    !/^data:/i.test(href) &&\n-    !/^vbscript:/i.test(href)\n-  );\n-};\n-\n-const parseUrlsInText = (text: string): React.ReactNode => {\n-  const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n-  const parts = text.split(urlRegex);\n-\n-  return parts.map((part, index) => {\n-    if (part.match(urlRegex)) {\n-      let href = part.startsWith('http') ? part : `https://${part}`;\n-      // Sanitize href using DOMPurify\n-      href = DOMPurify.sanitize(href, {\n-        ALLOWED_URI_REGEXP: /^https?:\\/\\/.*/i,\n-      });\n-      if (isSafeHref(href)) {\n-        // Also sanitize the visible link text\n-        const safeText = DOMPurify.sanitize(part, {\n-          ALLOWED_TAGS: [],\n-          ALLOWED_ATTR: [],\n-        });\n-        return (\n-          <a\n-            key={index}\n-            href={href}\n-            target='_blank'\n-            rel='noopener noreferrer'\n-            className='underline hover:opacity-80'\n-            onClick={(e) => e.stopPropagation()}\n-          >\n-            {safeText}\n-          </a>\n-        );\n-      } else {\n-        // Render as plain text (not a link) if not safe\n-        const safeText = DOMPurify.sanitize(part, {\n-          ALLOWED_TAGS: [],\n-          ALLOWED_ATTR: [],\n-        });\n-        return <span key={index}>{safeText}</span>;\n-      }\n-    }\n-    // For plain text, always sanitize\n-    const safeText = DOMPurify.sanitize(part, {\n-      ALLOWED_TAGS: [],\n-      ALLOWED_ATTR: [],\n-    });\n-    return safeText;\n-  });\n-};\n-\n-// Wrapper around sonner toast that handles URL parsing\n-const toast = {\n-  success: (message: string | React.ReactNode, options?: any) => {\n-    const content =\n-      typeof message === 'string' ? parseUrlsInText(message) : message;\n-    return sonnerToast.success(content, options);\n-  },\n-  error: (message: string | React.ReactNode, options?: any) => {\n-    const content =\n-      typeof message === 'string' ? parseUrlsInText(message) : message;\n-    return sonnerToast.error(content, options);\n-  },\n-  warning: (message: string | React.ReactNode, options?: any) => {\n-    const content =\n-      typeof message === 'string' ? parseUrlsInText(message) : message;\n-    return sonnerToast.warning(content, options);\n-  },\n-  info: (message: string | React.ReactNode, options?: any) => {\n-    const content =\n-      typeof message === 'string' ? parseUrlsInText(message) : message;\n-    return sonnerToast.info(content, options);\n-  },\n-  dismiss: sonnerToast.dismiss,\n-};\n-\n-const Toaster = ({ ...props }: ToasterProps) => {\n-  return (\n-    <Sonner\n-      className='toaster group'\n-      position='top-left'\n-      closeButton\n-      toastOptions={{\n-        classNames: {\n-          toast:\n-            'group toast group-[.toaster]:bg-white group-[.toaster]:shadow-lg',\n-          description: 'group-[.toast]:text-gray-700',\n-          actionButton:\n-            'group-[.toast]:bg-primary group-[.toast]:text-primary-foreground',\n-          cancelButton:\n-            'group-[.toast]:bg-muted group-[.toast]:text-muted-foreground',\n-          closeButton:\n-            'group-[.toast]:bg-white group-[.toast]:text-current group-[.toast]:border-0',\n-          success:\n-            'group-[.toaster]:border-green-500 [&_[data-icon]]:text-green-500 [&_[data-content]]:text-gray-700',\n-          error:\n-            'group-[.toaster]:border-red-500 [&_[data-icon]]:text-red-500 [&_[data-content]]:text-gray-700',\n-          warning:\n-            'group-[.toaster]:border-yellow-500 [&_[data-icon]]:text-yellow-500 [&_[data-content]]:text-gray-700',\n-          info: 'group-[.toaster]:border-blue-500 [&_[data-icon]]:text-blue-500 [&_[data-content]]:text-gray-700',\n-        },\n-      }}\n-      {...props}\n-    />\n-  );\n-};\n-\n-export { toast, Toaster };\ndiff --git a/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx b/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\nindex 6b6b83349c..df366daaab 100644\n--- a/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\n+++ b/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\n@@ -2,13 +2,9 @@ import { render } from '@testing-library/react';\n import React from 'react';\n import { Alerts } from './alerts';\n import { Alert } from '../alerts';\n-import { ModalProvider } from '../react-modals';\n-import { describe, it, vi, beforeEach } from 'vitest';\n+import { describe, it, vi } from 'vitest';\n \n describe('Alerts', () => {\n-  beforeEach(() => {\n-    vi.clearAllMocks();\n-  });\n   it('subscribes to the `alerts`', () => {\n     const alerts = createMockAlerts();\n \n@@ -25,43 +21,35 @@ describe('Alerts', () => {\n       expect(container.children).toHaveLength(0);\n     });\n   });\n-  describe('when there are error alerts', () => {\n-    it('renders one error alert in a modal', () => {\n+  describe('when there are alerts', () => {\n+    it('renders one alert', () => {\n       const alert: Alert = {\n-        id: 'error-1',\n-        level: 'error',\n-        message: 'Error message',\n+        id: '',\n+        level: 'success',\n+        message: 'Hello World',\n         timeout: 1000,\n       };\n       const alerts = createMockAlerts([alert]);\n \n-      const output = render(\n-        <ModalProvider>\n-          <Alerts alerts={alerts} />\n-        </ModalProvider>\n-      );\n+      const output = render(<Alerts alerts={alerts} />);\n \n-      // Should render error message in modal\n-      output.getByText('Error message');\n-      output.getByText('Error');\n+      const alertMessage = alert.message;\n+      if (typeof alertMessage === 'string') {\n+        output.getByText(alertMessage);\n+      }\n     });\n-\n-    describe('clicking close on an error alert', () => {\n+    describe('clicking an alert', () => {\n       it('calls dismiss on the collection', () => {\n         const alert: Alert = {\n-          id: 'error-1',\n-          level: 'error',\n-          message: 'Error message',\n+          id: '',\n+          level: 'success',\n+          message: 'Hello World',\n           timeout: 1000,\n         };\n         const alerts = createMockAlerts([alert]);\n-        const output = render(\n-          <ModalProvider>\n-            <Alerts alerts={alerts} />\n-          </ModalProvider>\n-        );\n+        const output = render(<Alerts alerts={alerts} />);\n \n-        output.getByRole('button', { name: /close/i }).click();\n+        output.getByRole('button').click();\n \n         expect(alerts.dismiss).toHaveBeenCalledWith(alert);\n       });\ndiff --git a/packages/tinacms/src/toolkit/react-alerts/alerts.tsx b/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\nindex 172eacf8b4..e05229b170 100644\n--- a/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\n+++ b/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\n@@ -1,5 +1,4 @@\n-import type { Alerts as AlertsCollection } from '@toolkit/alerts';\n-import { Toaster } from '@toolkit/components/ui/sonner';\n+import type { AlertLevel, Alerts as AlertsCollection } from '@toolkit/alerts';\n import { useSubscribable } from '@toolkit/react-core';\n import {\n   Modal,\n@@ -10,7 +9,8 @@ import {\n } from '@toolkit/react-modals';\n import { Button } from '@toolkit/styles';\n import React from 'react';\n-import { MdError } from 'react-icons/md';\n+import { BiX } from 'react-icons/bi';\n+import { MdCheckCircle, MdError, MdInfo, MdWarning } from 'react-icons/md';\n \n const parseUrlsInText = (text: string): React.ReactNode => {\n   const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n@@ -42,16 +42,41 @@ export interface AlertsProps {\n export function Alerts({ alerts }: AlertsProps) {\n   useSubscribable(alerts);\n \n-  if (alerts.all.length === 0) {\n+  if (!alerts.all.length) {\n     return null;\n   }\n \n   return (\n     <>\n-      {/* Sonner toaster for non-error alerts */}\n-      <Toaster />\n-\n-      {/* Modal for error alerts */}\n+      <div className='fixed top-0 left-0 p-6 flex flex-col items-center z-[999999]'>\n+        {alerts.all\n+          .filter((alert) => {\n+            return alert.level !== 'error';\n+          })\n+          .map((alert) => {\n+            return (\n+              <Alert key={alert.id} level={alert.level}>\n+                {alert.level === 'info' && (\n+                  <MdInfo className='w-5 h-auto opacity-70' />\n+                )}\n+                {alert.level === 'success' && (\n+                  <MdCheckCircle className='w-5 h-auto opacity-70' />\n+                )}\n+                {alert.level === 'warn' && (\n+                  <MdWarning className='w-5 h-auto opacity-70' />\n+                )}\n+                <p className='m-0 flex-1 max-w-[680px] text-left'>\n+                  {parseUrlsInText(alert.message.toString())}\n+                </p>\n+                <CloseAlert\n+                  onClick={() => {\n+                    alerts.dismiss(alert);\n+                  }}\n+                />\n+              </Alert>\n+            );\n+          })}\n+      </div>\n       {alerts.all\n         .filter((alert) => {\n           return alert.level === 'error';\n@@ -102,3 +127,49 @@ export function Alerts({ alerts }: AlertsProps) {\n     </>\n   );\n }\n+\n+const Alert: React.FC<{ level: AlertLevel; children: React.ReactNode }> = ({\n+  level,\n+  ...props\n+}) => {\n+  const colorClasses = {\n+    info: 'bg-white border-blue-500 text-blue-600 fill-blue-500',\n+    success: 'bg-white border-green-500 text-green-600 fill-green-500',\n+    warn: 'bg-white border-yellow-500 text-yellow-600 fill-yellow-500',\n+    error: 'bg-white border-red-500 text-red-600 fill-red-500',\n+  };\n+\n+  const borderClasses = {\n+    info: 'border-blue-200',\n+    success: 'border-green-200',\n+    warn: 'border-yellow-200',\n+    error: 'border-red-200',\n+  };\n+\n+  return (\n+    <div\n+      className={`rounded shadow-lg font-normal cursor-pointer pointer-events-all text-sm transition-all duration-100 ease-out mb-4 max-w-full ${colorClasses[level]}}`}\n+      style={{\n+        animationName: 'fly-in-up, fade-in',\n+        animationTimingFunction: 'ease-out',\n+        animationIterationCount: 1,\n+        animationFillMode: 'both',\n+        animationDuration: '150ms',\n+      }}\n+    >\n+      <div\n+        className={`flex items-center gap-1.5 w-[350px] rounded-md border p-2 ${borderClasses[level]}`}\n+        {...props}\n+      />\n+    </div>\n+  );\n+};\n+\n+const CloseAlert = ({ ...styleProps }) => (\n+  <button\n+    className='border-none bg-transparent p-0 outline-none flex items-center'\n+    {...styleProps}\n+  >\n+    <BiX className='w-5 auto flex-grow-0 flex-shrink-0 text-gray-700' />\n+  </button>\n+);\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 97ca641a94..5328df945d 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -1240,7 +1240,7 @@ importers:\n         version: 2.6.8(graphql@15.8.0)\n       '@graphql-codegen/plugin-helpers':\n         specifier: latest\n-        version: 6.0.0(graphql@15.8.0)\n+        version: 5.1.1(graphql@15.8.0)\n       '@graphql-codegen/typescript':\n         specifier: 'catalog:'\n         version: 4.1.5(graphql@15.8.0)\n@@ -2323,9 +2323,6 @@ importers:\n       date-fns:\n         specifier: 2.30.0\n         version: 2.30.0\n-      dompurify:\n-        specifier: ^3.3.0\n-        version: 3.3.0\n       final-form:\n         specifier: 'catalog:'\n         version: 4.20.10\n@@ -2398,9 +2395,6 @@ importers:\n       react-use:\n         specifier: 'catalog:'\n         version: 17.6.0(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n-      sonner:\n-        specifier: ^2.0.7\n-        version: 2.0.7(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       tailwind-merge:\n         specifier: ^2.6.0\n         version: 2.6.0\n@@ -4471,12 +4465,6 @@ packages:\n     peerDependencies:\n       graphql: ^0.8.0 || ^0.9.0 || ^0.10.0 || ^0.11.0 || ^0.12.0 || ^0.13.0 || ^14.0.0 || ^15.0.0 || ^16.0.0\n \n-  '@graphql-codegen/plugin-helpers@6.0.0':\n-    resolution: {integrity: sha512-Z7P89vViJvQakRyMbq/JF2iPLruRFOwOB6IXsuSvV/BptuuEd7fsGPuEf8bdjjDxUY0pJZnFN8oC7jIQ8p9GKA==}\n-    engines: {node: '>=16'}\n-    peerDependencies:\n-      graphql: ^0.8.0 || ^0.9.0 || ^0.10.0 || ^0.11.0 || ^0.12.0 || ^0.13.0 || ^14.0.0 || ^15.0.0 || ^16.0.0\n-\n   '@graphql-codegen/schema-ast@4.1.0':\n     resolution: {integrity: sha512-kZVn0z+th9SvqxfKYgztA6PM7mhnSZaj4fiuBWvMTqA+QqQ9BBed6Pz41KuD/jr0gJtnlr2A4++/0VlpVbCTmQ==}\n     peerDependencies:\n@@ -8684,9 +8672,6 @@ packages:\n   dompurify@3.2.6:\n     resolution: {integrity: sha512-/2GogDQlohXPZe6D6NOgQvXLPSYBqIWMnZ8zzOhn09REE4eyAzb+Hed3jhoM9OkuaJ8P6ZGTTVWQKAi8ieIzfQ==}\n \n-  dompurify@3.3.0:\n-    resolution: {integrity: sha512-r+f6MYR1gGN1eJv0TVQbhA7if/U7P87cdPl3HN5rikqaBSBxLiCb/b9O+2eG0cxz0ghyU+mU1QkbsOwERMYlWQ==}\n-\n   domutils@2.8.0:\n     resolution: {integrity: sha512-w96Cjofp72M5IIhpjgobBimYEfoPjx1Vx0BSX9P30WBdZW2WIKU0T1Bd0kz2eNZ9ikjKgHbEyKx8BB6H1L3h3A==}\n \n@@ -11906,7 +11891,6 @@ packages:\n   puppeteer@23.11.1:\n     resolution: {integrity: sha512-53uIX3KR5en8l7Vd8n5DUv90Ae9QDQsyIthaUFVzwV6yU750RjqRznEtNMBT20VthqAdemnJN+hxVdmMHKt7Zw==}\n     engines: {node: '>=18'}\n-    deprecated: < 24.15.0 is no longer supported\n     hasBin: true\n \n   pure-rand@6.1.0:\n@@ -12604,12 +12588,6 @@ packages:\n     resolution: {integrity: sha512-D3YaD0aRxR3mEcqnidIs7ReYJFVzWdd6fXJYUM8ixcQcJRGTka/b3saV0KflYhyVJXKhb947GndU35SxYNResQ==}\n     engines: {node: '>= 10.0.0', npm: '>= 3.0.0'}\n \n-  sonner@2.0.7:\n-    resolution: {integrity: sha512-W6ZN4p58k8aDKA4XPcx2hpIQXBRAgyiWVkYhT7CvK6D3iAu7xjvVyhQHg2/iaKJZ1XVJ4r7XuwGL+WGEK37i9w==}\n-    peerDependencies:\n-      react: ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n-      react-dom: ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n-\n   source-map-js@1.2.1:\n     resolution: {integrity: sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==}\n     engines: {node: '>=0.10.0'}\n@@ -16391,16 +16369,6 @@ snapshots:\n       lodash: 4.17.21\n       tslib: 2.6.3\n \n-  '@graphql-codegen/plugin-helpers@6.0.0(graphql@15.8.0)':\n-    dependencies:\n-      '@graphql-tools/utils': 10.8.3(graphql@15.8.0)\n-      change-case-all: 1.0.15\n-      common-tags: 1.8.2\n-      graphql: 15.8.0\n-      import-from: 4.0.0\n-      lodash: 4.17.21\n-      tslib: 2.6.3\n-\n   '@graphql-codegen/schema-ast@4.1.0(graphql@15.8.0)':\n     dependencies:\n       '@graphql-codegen/plugin-helpers': 5.1.1(graphql@15.8.0)\n@@ -21263,10 +21231,6 @@ snapshots:\n     optionalDependencies:\n       '@types/trusted-types': 2.0.7\n \n-  dompurify@3.3.0:\n-    optionalDependencies:\n-      '@types/trusted-types': 2.0.7\n-\n   domutils@2.8.0:\n     dependencies:\n       dom-serializer: 1.4.1\n@@ -26751,11 +26715,6 @@ snapshots:\n       ip-address: 9.0.5\n       smart-buffer: 4.2.0\n \n-  sonner@2.0.7(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n-    dependencies:\n-      react: 18.3.1\n-      react-dom: 18.3.1(react@18.3.1)\n-\n   source-map-js@1.2.1: {}\n \n   source-map-support@0.5.13:\n", "test_files": ["packages/tinacms/src/toolkit/alerts/alerts.test.ts", "packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx"], "code_files": ["packages/tinacms/src/toolkit/alerts/alerts.ts", "packages/tinacms/src/toolkit/components/ui/sonner.tsx", "packages/tinacms/src/toolkit/react-alerts/alerts.tsx"]}
{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.6126", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 6126, "merge_commit": "4ee0dd95913392b0da12dd5c9344909e5292e911", "problem_statement": "\u267b\ufe0f Refactor: Integrate Sonner for alert notifications", "patch": "diff --git a/.changeset/slimy-bananas-reply.md b/.changeset/slimy-bananas-reply.md\nnew file mode 100644\nindex 0000000000..da63889a83\n--- /dev/null\n+++ b/.changeset/slimy-bananas-reply.md\n@@ -0,0 +1,5 @@\n+---\n+\"tinacms\": patch\n+---\n+\n+feat: Integrate Sonner for alert notifications\ndiff --git a/packages/tinacms/package.json b/packages/tinacms/package.json\nindex 6f50a8b265..a920973ebe 100644\n--- a/packages/tinacms/package.json\n+++ b/packages/tinacms/package.json\n@@ -146,10 +146,12 @@\n \t\t\"react-icons\": \"^5.4.0\",\n \t\t\"react-router-dom\": \"catalog:\",\n \t\t\"react-use\": \"catalog:\",\n+\t\t\"sonner\": \"^2.0.7\",\n \t\t\"tailwind-merge\": \"^2.6.0\",\n \t\t\"webfontloader\": \"catalog:\",\n \t\t\"yup\": \"^1.6.1\",\n-\t\t\"zod\": \"^3.24.2\"\n+\t\t\"zod\": \"^3.24.2\",\n+\t\t\"dompurify\": \"^3.3.0\"\n \t},\n \t\"devDependencies\": {\n \t\t\"@graphql-tools/utils\": \"catalog:\",\n@@ -170,11 +172,11 @@\n \t\t\"@types/react-color\": \"catalog:\",\n \t\t\"@types/react-dom\": \"^18.3.5\",\n \t\t\"@types/yup\": \"^0.32.0\",\n-\t\t\"lowlight\": \"^3.3.0\",\n \t\t\"happy-dom\": \"catalog:\",\n \t\t\"identity-obj-proxy\": \"catalog:\",\n \t\t\"isomorphic-fetch\": \"catalog:\",\n \t\t\"jest-file-snapshot\": \"^0.7.0\",\n+\t\t\"lowlight\": \"^3.3.0\",\n \t\t\"next\": \"14.2.10\",\n \t\t\"react\": \"^18.3.1\",\n \t\t\"react-dom\": \"^18.3.1\",\ndiff --git a/packages/tinacms/src/toolkit/alerts/alerts.test.ts b/packages/tinacms/src/toolkit/alerts/alerts.test.ts\nindex c839e79d0b..1d12c3b5b0 100644\n--- a/packages/tinacms/src/toolkit/alerts/alerts.test.ts\n+++ b/packages/tinacms/src/toolkit/alerts/alerts.test.ts\n@@ -1,6 +1,19 @@\n import { EventBus } from '@toolkit/core';\n-import { describe, it, vi } from 'vitest';\n+import { describe, it, vi, beforeEach } from 'vitest';\n import { Alerts } from './alerts';\n+import { toast } from '../components/ui/sonner';\n+\n+// Mock the toast module\n+vi.mock('../components/ui/sonner', () => ({\n+  toast: {\n+    success: vi.fn(() => 'success-toast-id'),\n+    error: vi.fn(() => 'error-toast-id'),\n+    warning: vi.fn(() => 'warning-toast-id'),\n+    info: vi.fn(() => 'info-toast-id'),\n+    dismiss: vi.fn(),\n+  },\n+  Toaster: () => null,\n+}));\n \n // biome-ignore lint/correctness/useHookAtTopLevel: not ready to fix these yet\n vi.useFakeTimers();\n@@ -8,27 +21,111 @@ vi.useFakeTimers();\n const events = new EventBus();\n \n describe('Alerts', () => {\n+  beforeEach(() => {\n+    vi.clearAllMocks();\n+  });\n+\n   it('is empty by default', () => {\n     const alerts = new Alerts(events);\n \n     expect(alerts.all).toHaveLength(0);\n   });\n-  describe('calling alerts.add(\"info\", \"Test\")', () => {\n-    it('creates alert with message: \"Test\"', () => {\n+\n+  describe('Toast Notifications', () => {\n+    it('triggers toast.info when info alert is added', () => {\n       const alerts = new Alerts(events);\n \n-      alerts.info('Test');\n+      alerts.info('Info message', 5000);\n \n-      const testAlert = alerts.all.pop();\n-      expect(testAlert?.message).toBe('Test');\n+      expect(toast.info).toHaveBeenCalledWith('Info message', {\n+        duration: 5000,\n+      });\n     });\n-    it('creates alert with level: \"info\"', () => {\n+\n+    it('triggers toast.success when success alert is added', () => {\n+      const alerts = new Alerts(events);\n+\n+      alerts.success('Success message', 3000);\n+\n+      expect(toast.success).toHaveBeenCalledWith('Success message', {\n+        duration: 3000,\n+      });\n+    });\n+\n+    it('triggers toast.warning when warn alert is added', () => {\n+      const alerts = new Alerts(events);\n+\n+      alerts.warn('Warning message', 4000);\n+\n+      expect(toast.warning).toHaveBeenCalledWith('Warning message', {\n+        duration: 4000,\n+      });\n+    });\n+\n+    it('does not trigger toast for error alerts', () => {\n+      const alerts = new Alerts(events);\n+\n+      alerts.error('Error message');\n+\n+      // Error alerts don't trigger toasts - they're shown in modals\n+      expect(toast.error).not.toHaveBeenCalled();\n+    });\n+\n+    it('calls toast.dismiss when non-error alert is dismissed', () => {\n+      const alerts = new Alerts(events);\n+      const dismiss = alerts.info('Info message');\n+\n+      dismiss();\n+\n+      expect(toast.dismiss).toHaveBeenCalledWith('info-toast-id');\n+    });\n+\n+    it('does not call toast.dismiss when error alert is dismissed', () => {\n+      const alerts = new Alerts(events);\n+      const dismiss = alerts.error('Error message');\n+\n+      dismiss();\n+\n+      // Error alerts don't dismiss the toast, only remove from collection\n+      expect(toast.dismiss).not.toHaveBeenCalled();\n+    });\n+  });\n+\n+  describe('Alert Storage', () => {\n+    it('stores all alerts in the collection', () => {\n+      const alerts = new Alerts(events);\n+\n+      alerts.info('Info');\n+      alerts.success('Success');\n+      alerts.warn('Warning');\n+      alerts.error('Error');\n+\n+      // All alerts are stored\n+      expect(alerts.all).toHaveLength(4);\n+    });\n+\n+    it('stores error alerts with custom ID', () => {\n+      const alerts = new Alerts(events);\n+\n+      alerts.error('Error message');\n+\n+      const errorAlert = alerts.all[0];\n+      expect(errorAlert?.level).toBe('error');\n+      expect(errorAlert?.message).toBe('Error message');\n+      // Error alerts get a custom timestamp-based ID\n+      expect(errorAlert?.id).toContain('Error message|');\n+    });\n+  });\n+\n+  describe('calling alerts.add(\"info\", \"Test\")', () => {\n+    it('stores info alerts in the collection', () => {\n       const alerts = new Alerts(events);\n \n       alerts.info('Test');\n \n-      const testAlert = alerts.all.pop();\n-      expect(testAlert?.level).toBe('info');\n+      expect(alerts.all).toHaveLength(1);\n+      expect(alerts.all[0]?.message).toBe('Test');\n+      expect(alerts.all[0]?.level).toBe('info');\n     });\n     it.skip('will remove the message after 3000ms', async () => {\n       const alerts = new Alerts(events);\ndiff --git a/packages/tinacms/src/toolkit/alerts/alerts.ts b/packages/tinacms/src/toolkit/alerts/alerts.ts\nindex a9fec25245..edcbfedb4d 100644\n--- a/packages/tinacms/src/toolkit/alerts/alerts.ts\n+++ b/packages/tinacms/src/toolkit/alerts/alerts.ts\n@@ -1,5 +1,6 @@\n import React from 'react';\n import type { EventBus, Callback, CMSEvent } from '@toolkit/core';\n+import { toast } from '@toolkit/components/ui/sonner';\n \n export interface EventsToAlerts {\n   [key: string]: ToAlert | AlertArgs;\n@@ -51,26 +52,55 @@ export class Alerts {\n     message: string | React.FunctionComponent,\n     timeout = 8000\n   ): () => void {\n+    let id: string | number;\n+\n+    // Use sonner's toast methods based on level\n+    // For FunctionComponent messages, render them directly\n+    // For string messages, use them as-is (URL parsing happens in component)\n+    const toastMessage =\n+      typeof message === 'string' ? message : React.createElement(message);\n+\n+    switch (level) {\n+      case 'success':\n+        id = toast.success(toastMessage, {\n+          duration: timeout,\n+        });\n+        break;\n+      case 'error':\n+        id = `${message}|${Date.now()}`;\n+        break;\n+      case 'warn':\n+        id = toast.warning(toastMessage, {\n+          duration: timeout,\n+        });\n+        break;\n+      case 'info':\n+      default:\n+        id = toast.info(toastMessage, {\n+          duration: timeout,\n+        });\n+        break;\n+    }\n+\n     const alert = {\n       level,\n       message,\n       timeout,\n-      id: `${message}|${Date.now()}`,\n+      id: String(id),\n     };\n \n     this.alerts.set(alert.id, alert);\n \n     this.events.dispatch({ type: 'alerts:add', alert });\n \n-    let timeoutId: any = null;\n-\n     const dismiss = () => {\n-      clearTimeout(timeoutId);\n+      if (level !== 'error') {\n+        toast.dismiss(id);\n+      }\n+\n       this.dismiss(alert);\n     };\n \n-    timeoutId = level !== 'error' ? setTimeout(dismiss, alert.timeout) : null;\n-\n     return dismiss;\n   }\n \ndiff --git a/packages/tinacms/src/toolkit/components/ui/sonner.tsx b/packages/tinacms/src/toolkit/components/ui/sonner.tsx\nnew file mode 100644\nindex 0000000000..aee581d202\n--- /dev/null\n+++ b/packages/tinacms/src/toolkit/components/ui/sonner.tsx\n@@ -0,0 +1,122 @@\n+import React from 'react';\n+import DOMPurify from 'dompurify';\n+import { toast as sonnerToast, Toaster as Sonner } from 'sonner';\n+\n+type ToasterProps = React.ComponentProps<typeof Sonner>;\n+\n+// Helper to parse URLs in text and make them clickable\n+// Ensures only links with allowed protocols get rendered as clickable links to avoid XSS.\n+const isSafeHref = (href: string) => {\n+  // Only allow http, https links -- can be expanded as needed\n+  return (\n+    /^https?:\\/\\//.test(href) &&\n+    !/^javascript:/i.test(href) &&\n+    !/^data:/i.test(href) &&\n+    !/^vbscript:/i.test(href)\n+  );\n+};\n+\n+const parseUrlsInText = (text: string): React.ReactNode => {\n+  const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n+  const parts = text.split(urlRegex);\n+\n+  return parts.map((part, index) => {\n+    if (part.match(urlRegex)) {\n+      let href = part.startsWith('http') ? part : `https://${part}`;\n+      // Sanitize href using DOMPurify\n+      href = DOMPurify.sanitize(href, {\n+        ALLOWED_URI_REGEXP: /^https?:\\/\\/.*/i,\n+      });\n+      if (isSafeHref(href)) {\n+        // Also sanitize the visible link text\n+        const safeText = DOMPurify.sanitize(part, {\n+          ALLOWED_TAGS: [],\n+          ALLOWED_ATTR: [],\n+        });\n+        return (\n+          <a\n+            key={index}\n+            href={href}\n+            target='_blank'\n+            rel='noopener noreferrer'\n+            className='underline hover:opacity-80'\n+            onClick={(e) => e.stopPropagation()}\n+          >\n+            {safeText}\n+          </a>\n+        );\n+      } else {\n+        // Render as plain text (not a link) if not safe\n+        const safeText = DOMPurify.sanitize(part, {\n+          ALLOWED_TAGS: [],\n+          ALLOWED_ATTR: [],\n+        });\n+        return <span key={index}>{safeText}</span>;\n+      }\n+    }\n+    // For plain text, always sanitize\n+    const safeText = DOMPurify.sanitize(part, {\n+      ALLOWED_TAGS: [],\n+      ALLOWED_ATTR: [],\n+    });\n+    return safeText;\n+  });\n+};\n+\n+// Wrapper around sonner toast that handles URL parsing\n+const toast = {\n+  success: (message: string | React.ReactNode, options?: any) => {\n+    const content =\n+      typeof message === 'string' ? parseUrlsInText(message) : message;\n+    return sonnerToast.success(content, options);\n+  },\n+  error: (message: string | React.ReactNode, options?: any) => {\n+    const content =\n+      typeof message === 'string' ? parseUrlsInText(message) : message;\n+    return sonnerToast.error(content, options);\n+  },\n+  warning: (message: string | React.ReactNode, options?: any) => {\n+    const content =\n+      typeof message === 'string' ? parseUrlsInText(message) : message;\n+    return sonnerToast.warning(content, options);\n+  },\n+  info: (message: string | React.ReactNode, options?: any) => {\n+    const content =\n+      typeof message === 'string' ? parseUrlsInText(message) : message;\n+    return sonnerToast.info(content, options);\n+  },\n+  dismiss: sonnerToast.dismiss,\n+};\n+\n+const Toaster = ({ ...props }: ToasterProps) => {\n+  return (\n+    <Sonner\n+      className='toaster group'\n+      position='top-left'\n+      closeButton\n+      toastOptions={{\n+        classNames: {\n+          toast:\n+            'group toast group-[.toaster]:bg-white group-[.toaster]:shadow-lg',\n+          description: 'group-[.toast]:text-gray-700',\n+          actionButton:\n+            'group-[.toast]:bg-primary group-[.toast]:text-primary-foreground',\n+          cancelButton:\n+            'group-[.toast]:bg-muted group-[.toast]:text-muted-foreground',\n+          closeButton:\n+            'group-[.toast]:bg-white group-[.toast]:text-current group-[.toast]:border-0',\n+          success:\n+            'group-[.toaster]:border-green-500 [&_[data-icon]]:text-green-500 [&_[data-content]]:text-gray-700',\n+          error:\n+            'group-[.toaster]:border-red-500 [&_[data-icon]]:text-red-500 [&_[data-content]]:text-gray-700',\n+          warning:\n+            'group-[.toaster]:border-yellow-500 [&_[data-icon]]:text-yellow-500 [&_[data-content]]:text-gray-700',\n+          info: 'group-[.toaster]:border-blue-500 [&_[data-icon]]:text-blue-500 [&_[data-content]]:text-gray-700',\n+        },\n+      }}\n+      {...props}\n+    />\n+  );\n+};\n+\n+export { toast, Toaster };\ndiff --git a/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx b/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\nindex df366daaab..6b6b83349c 100644\n--- a/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\n+++ b/packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx\n@@ -2,9 +2,13 @@ import { render } from '@testing-library/react';\n import React from 'react';\n import { Alerts } from './alerts';\n import { Alert } from '../alerts';\n-import { describe, it, vi } from 'vitest';\n+import { ModalProvider } from '../react-modals';\n+import { describe, it, vi, beforeEach } from 'vitest';\n \n describe('Alerts', () => {\n+  beforeEach(() => {\n+    vi.clearAllMocks();\n+  });\n   it('subscribes to the `alerts`', () => {\n     const alerts = createMockAlerts();\n \n@@ -21,35 +25,43 @@ describe('Alerts', () => {\n       expect(container.children).toHaveLength(0);\n     });\n   });\n-  describe('when there are alerts', () => {\n-    it('renders one alert', () => {\n+  describe('when there are error alerts', () => {\n+    it('renders one error alert in a modal', () => {\n       const alert: Alert = {\n-        id: '',\n-        level: 'success',\n-        message: 'Hello World',\n+        id: 'error-1',\n+        level: 'error',\n+        message: 'Error message',\n         timeout: 1000,\n       };\n       const alerts = createMockAlerts([alert]);\n \n-      const output = render(<Alerts alerts={alerts} />);\n+      const output = render(\n+        <ModalProvider>\n+          <Alerts alerts={alerts} />\n+        </ModalProvider>\n+      );\n \n-      const alertMessage = alert.message;\n-      if (typeof alertMessage === 'string') {\n-        output.getByText(alertMessage);\n-      }\n+      // Should render error message in modal\n+      output.getByText('Error message');\n+      output.getByText('Error');\n     });\n-    describe('clicking an alert', () => {\n+\n+    describe('clicking close on an error alert', () => {\n       it('calls dismiss on the collection', () => {\n         const alert: Alert = {\n-          id: '',\n-          level: 'success',\n-          message: 'Hello World',\n+          id: 'error-1',\n+          level: 'error',\n+          message: 'Error message',\n           timeout: 1000,\n         };\n         const alerts = createMockAlerts([alert]);\n-        const output = render(<Alerts alerts={alerts} />);\n+        const output = render(\n+          <ModalProvider>\n+            <Alerts alerts={alerts} />\n+          </ModalProvider>\n+        );\n \n-        output.getByRole('button').click();\n+        output.getByRole('button', { name: /close/i }).click();\n \n         expect(alerts.dismiss).toHaveBeenCalledWith(alert);\n       });\ndiff --git a/packages/tinacms/src/toolkit/react-alerts/alerts.tsx b/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\nindex b38aa6d690..172eacf8b4 100644\n--- a/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\n+++ b/packages/tinacms/src/toolkit/react-alerts/alerts.tsx\n@@ -1,4 +1,5 @@\n-import type { AlertLevel, Alerts as AlertsCollection } from '@toolkit/alerts';\n+import type { Alerts as AlertsCollection } from '@toolkit/alerts';\n+import { Toaster } from '@toolkit/components/ui/sonner';\n import { useSubscribable } from '@toolkit/react-core';\n import {\n   Modal,\n@@ -9,8 +10,7 @@ import {\n } from '@toolkit/react-modals';\n import { Button } from '@toolkit/styles';\n import React from 'react';\n-import { BiX } from 'react-icons/bi';\n-import { MdCheckCircle, MdError, MdInfo, MdWarning } from 'react-icons/md';\n+import { MdError } from 'react-icons/md';\n \n const parseUrlsInText = (text: string): React.ReactNode => {\n   const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n@@ -42,41 +42,16 @@ export interface AlertsProps {\n export function Alerts({ alerts }: AlertsProps) {\n   useSubscribable(alerts);\n \n-  if (!alerts.all.length) {\n+  if (alerts.all.length === 0) {\n     return null;\n   }\n \n   return (\n     <>\n-      <div className='fixed bottom-0 left-0 right-0 p-6 flex flex-col items-center z-[999999]'>\n-        {alerts.all\n-          .filter((alert) => {\n-            return alert.level !== 'error';\n-          })\n-          .map((alert) => {\n-            return (\n-              <Alert key={alert.id} level={alert.level}>\n-                {alert.level === 'info' && (\n-                  <MdInfo className='w-5 h-auto opacity-70' />\n-                )}\n-                {alert.level === 'success' && (\n-                  <MdCheckCircle className='w-5 h-auto opacity-70' />\n-                )}\n-                {alert.level === 'warn' && (\n-                  <MdWarning className='w-5 h-auto opacity-70' />\n-                )}\n-                <p className='m-0 flex-1 max-w-[680px] text-left'>\n-                  {parseUrlsInText(alert.message.toString())}\n-                </p>\n-                <CloseAlert\n-                  onClick={() => {\n-                    alerts.dismiss(alert);\n-                  }}\n-                />\n-              </Alert>\n-            );\n-          })}\n-      </div>\n+      {/* Sonner toaster for non-error alerts */}\n+      <Toaster />\n+\n+      {/* Modal for error alerts */}\n       {alerts.all\n         .filter((alert) => {\n           return alert.level === 'error';\n@@ -127,49 +102,3 @@ export function Alerts({ alerts }: AlertsProps) {\n     </>\n   );\n }\n-\n-const Alert: React.FC<{ level: AlertLevel; children: React.ReactNode }> = ({\n-  level,\n-  ...props\n-}) => {\n-  const colorClasses = {\n-    info: 'bg-blue-100 border-blue-500 text-blue-600 fill-blue-500',\n-    success: 'bg-green-100 border-green-500 text-green-600 fill-green-500',\n-    warn: 'bg-yellow-100 border-yellow-500 text-yellow-600 fill-yellow-500',\n-    error: 'bg-red-100 border-red-500 text-red-600 fill-red-500',\n-  };\n-\n-  const borderClasses = {\n-    info: 'border-blue-200',\n-    success: 'border-green-200',\n-    warn: 'border-yellow-200',\n-    error: 'border-red-200',\n-  };\n-\n-  return (\n-    <div\n-      className={`rounded shadow-lg font-normal cursor-pointer pointer-events-all text-sm transition-all duration-100 ease-out mb-4 max-w-full ${colorClasses[level]}}`}\n-      style={{\n-        animationName: 'fly-in-up, fade-in',\n-        animationTimingFunction: 'ease-out',\n-        animationIterationCount: 1,\n-        animationFillMode: 'both',\n-        animationDuration: '150ms',\n-      }}\n-    >\n-      <div\n-        className={`flex items-center gap-1.5 min-w-[350px] rounded-md border p-2 ${borderClasses[level]}`}\n-        {...props}\n-      />\n-    </div>\n-  );\n-};\n-\n-const CloseAlert = ({ ...styleProps }) => (\n-  <button\n-    className='border-none bg-transparent p-0 outline-none flex items-center'\n-    {...styleProps}\n-  >\n-    <BiX className='w-5 auto flex-grow-0 flex-shrink-0' />\n-  </button>\n-);\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 5328df945d..97ca641a94 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -1240,7 +1240,7 @@ importers:\n         version: 2.6.8(graphql@15.8.0)\n       '@graphql-codegen/plugin-helpers':\n         specifier: latest\n-        version: 5.1.1(graphql@15.8.0)\n+        version: 6.0.0(graphql@15.8.0)\n       '@graphql-codegen/typescript':\n         specifier: 'catalog:'\n         version: 4.1.5(graphql@15.8.0)\n@@ -2323,6 +2323,9 @@ importers:\n       date-fns:\n         specifier: 2.30.0\n         version: 2.30.0\n+      dompurify:\n+        specifier: ^3.3.0\n+        version: 3.3.0\n       final-form:\n         specifier: 'catalog:'\n         version: 4.20.10\n@@ -2395,6 +2398,9 @@ importers:\n       react-use:\n         specifier: 'catalog:'\n         version: 17.6.0(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n+      sonner:\n+        specifier: ^2.0.7\n+        version: 2.0.7(react-dom@18.3.1(react@18.3.1))(react@18.3.1)\n       tailwind-merge:\n         specifier: ^2.6.0\n         version: 2.6.0\n@@ -4465,6 +4471,12 @@ packages:\n     peerDependencies:\n       graphql: ^0.8.0 || ^0.9.0 || ^0.10.0 || ^0.11.0 || ^0.12.0 || ^0.13.0 || ^14.0.0 || ^15.0.0 || ^16.0.0\n \n+  '@graphql-codegen/plugin-helpers@6.0.0':\n+    resolution: {integrity: sha512-Z7P89vViJvQakRyMbq/JF2iPLruRFOwOB6IXsuSvV/BptuuEd7fsGPuEf8bdjjDxUY0pJZnFN8oC7jIQ8p9GKA==}\n+    engines: {node: '>=16'}\n+    peerDependencies:\n+      graphql: ^0.8.0 || ^0.9.0 || ^0.10.0 || ^0.11.0 || ^0.12.0 || ^0.13.0 || ^14.0.0 || ^15.0.0 || ^16.0.0\n+\n   '@graphql-codegen/schema-ast@4.1.0':\n     resolution: {integrity: sha512-kZVn0z+th9SvqxfKYgztA6PM7mhnSZaj4fiuBWvMTqA+QqQ9BBed6Pz41KuD/jr0gJtnlr2A4++/0VlpVbCTmQ==}\n     peerDependencies:\n@@ -8672,6 +8684,9 @@ packages:\n   dompurify@3.2.6:\n     resolution: {integrity: sha512-/2GogDQlohXPZe6D6NOgQvXLPSYBqIWMnZ8zzOhn09REE4eyAzb+Hed3jhoM9OkuaJ8P6ZGTTVWQKAi8ieIzfQ==}\n \n+  dompurify@3.3.0:\n+    resolution: {integrity: sha512-r+f6MYR1gGN1eJv0TVQbhA7if/U7P87cdPl3HN5rikqaBSBxLiCb/b9O+2eG0cxz0ghyU+mU1QkbsOwERMYlWQ==}\n+\n   domutils@2.8.0:\n     resolution: {integrity: sha512-w96Cjofp72M5IIhpjgobBimYEfoPjx1Vx0BSX9P30WBdZW2WIKU0T1Bd0kz2eNZ9ikjKgHbEyKx8BB6H1L3h3A==}\n \n@@ -11891,6 +11906,7 @@ packages:\n   puppeteer@23.11.1:\n     resolution: {integrity: sha512-53uIX3KR5en8l7Vd8n5DUv90Ae9QDQsyIthaUFVzwV6yU750RjqRznEtNMBT20VthqAdemnJN+hxVdmMHKt7Zw==}\n     engines: {node: '>=18'}\n+    deprecated: < 24.15.0 is no longer supported\n     hasBin: true\n \n   pure-rand@6.1.0:\n@@ -12588,6 +12604,12 @@ packages:\n     resolution: {integrity: sha512-D3YaD0aRxR3mEcqnidIs7ReYJFVzWdd6fXJYUM8ixcQcJRGTka/b3saV0KflYhyVJXKhb947GndU35SxYNResQ==}\n     engines: {node: '>= 10.0.0', npm: '>= 3.0.0'}\n \n+  sonner@2.0.7:\n+    resolution: {integrity: sha512-W6ZN4p58k8aDKA4XPcx2hpIQXBRAgyiWVkYhT7CvK6D3iAu7xjvVyhQHg2/iaKJZ1XVJ4r7XuwGL+WGEK37i9w==}\n+    peerDependencies:\n+      react: ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n+      react-dom: ^18.0.0 || ^19.0.0 || ^19.0.0-rc\n+\n   source-map-js@1.2.1:\n     resolution: {integrity: sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==}\n     engines: {node: '>=0.10.0'}\n@@ -16369,6 +16391,16 @@ snapshots:\n       lodash: 4.17.21\n       tslib: 2.6.3\n \n+  '@graphql-codegen/plugin-helpers@6.0.0(graphql@15.8.0)':\n+    dependencies:\n+      '@graphql-tools/utils': 10.8.3(graphql@15.8.0)\n+      change-case-all: 1.0.15\n+      common-tags: 1.8.2\n+      graphql: 15.8.0\n+      import-from: 4.0.0\n+      lodash: 4.17.21\n+      tslib: 2.6.3\n+\n   '@graphql-codegen/schema-ast@4.1.0(graphql@15.8.0)':\n     dependencies:\n       '@graphql-codegen/plugin-helpers': 5.1.1(graphql@15.8.0)\n@@ -21231,6 +21263,10 @@ snapshots:\n     optionalDependencies:\n       '@types/trusted-types': 2.0.7\n \n+  dompurify@3.3.0:\n+    optionalDependencies:\n+      '@types/trusted-types': 2.0.7\n+\n   domutils@2.8.0:\n     dependencies:\n       dom-serializer: 1.4.1\n@@ -26715,6 +26751,11 @@ snapshots:\n       ip-address: 9.0.5\n       smart-buffer: 4.2.0\n \n+  sonner@2.0.7(react-dom@18.3.1(react@18.3.1))(react@18.3.1):\n+    dependencies:\n+      react: 18.3.1\n+      react-dom: 18.3.1(react@18.3.1)\n+\n   source-map-js@1.2.1: {}\n \n   source-map-support@0.5.13:\n", "test_files": ["packages/tinacms/src/toolkit/alerts/alerts.test.ts", "packages/tinacms/src/toolkit/react-alerts/alerts.test.tsx"], "code_files": ["packages/tinacms/src/toolkit/alerts/alerts.ts", "packages/tinacms/src/toolkit/components/ui/sonner.tsx", "packages/tinacms/src/toolkit/react-alerts/alerts.tsx"]}
{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.6020", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 6020, "merge_commit": "2956600190d9c8b3d5c4f21b383ca520355c95d5", "problem_statement": "GraphQL Test - Renaming documents", "patch": "diff --git a/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-content.md b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-content.md\nnew file mode 100644\nindex 0000000000..804ee8ae49\n--- /dev/null\n+++ b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-content.md\n@@ -0,0 +1,10 @@\n+---\n+title: Original Title\n+genre: drama\n+rating: 7\n+---\n+\n+\n+This is the original content for Mr Bob Northwind's post about his company Northwind.\n+\n+The post talks about the company's growth and success in the market.\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-node.json b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-node.json\nnew file mode 100644\nindex 0000000000..9c817c6d86\n--- /dev/null\n+++ b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/rename-document-node.json\n@@ -0,0 +1,39 @@\n+{\n+  \"data\": {\n+    \"updateDocument\": {\n+      \"_values\": {\n+        \"_collection\": \"post\",\n+        \"_template\": \"post\",\n+        \"title\": \"Original Title\",\n+        \"genre\": \"drama\",\n+        \"rating\": 7,\n+        \"body\": {\n+          \"type\": \"root\",\n+          \"children\": [\n+            {\n+              \"type\": \"p\",\n+              \"children\": [\n+                {\n+                  \"type\": \"text\",\n+                  \"text\": \"This is the original content for Mr Bob Northwind's post about his company Northwind.\"\n+                }\n+              ]\n+            },\n+            {\n+              \"type\": \"p\",\n+              \"children\": [\n+                {\n+                  \"type\": \"text\",\n+                  \"text\": \"The post talks about the company's growth and success in the market.\"\n+                }\n+              ]\n+            }\n+          ]\n+        }\n+      },\n+      \"_sys\": {\n+        \"title\": \"\"\n+      }\n+    }\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/update-document-content.md b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-document-content.md\nsimilarity index 100%\nrename from packages/@tinacms/graphql/tests/document-update-mutation/update-document-content.md\nrename to packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-document-content.md\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/update-document-node.json b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-document-node.json\nsimilarity index 100%\nrename from packages/@tinacms/graphql/tests/document-update-mutation/update-document-node.json\nrename to packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-document-node.json\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/update-post-content.md b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-post-content.md\nsimilarity index 100%\nrename from packages/@tinacms/graphql/tests/document-update-mutation/update-post-content.md\nrename to packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-post-content.md\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/update-post-node.json b/packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-post-node.json\nsimilarity index 100%\nrename from packages/@tinacms/graphql/tests/document-update-mutation/update-post-node.json\nrename to packages/@tinacms/graphql/tests/document-update-mutation/expected-snapshots/update-post-node.json\ndiff --git a/packages/@tinacms/graphql/tests/document-update-mutation/index.test.ts b/packages/@tinacms/graphql/tests/document-update-mutation/index.test.ts\nindex fba816a152..19eb75e1e3 100644\n--- a/packages/@tinacms/graphql/tests/document-update-mutation/index.test.ts\n+++ b/packages/@tinacms/graphql/tests/document-update-mutation/index.test.ts\n@@ -44,14 +44,56 @@ it('updates document and validates bridge writes', async () => {\n   });\n \n   // Validate GraphQL response\n-  expect(format(result)).toMatchFileSnapshot('update-document-node.json');\n+  expect(format(result)).toMatchFileSnapshot(\n+    'expected-snapshots/update-document-node.json'\n+  );\n \n   // Validate Bridge write operations\n   const writes = bridge.getWrites();\n   expect(writes.size).toBeGreaterThan(0);\n   expect(bridge.getWrite('posts/in.md')).toMatchFileSnapshot(\n-    'update-document-content.md'\n+    'expected-snapshots/update-document-content.md'\n+  );\n+});\n+\n+const renameDocumentMutation = `\n+  mutation {\n+    updateDocument(\n+      collection: \"post\",\n+      relativePath: \"in.md\",\n+      params: {\n+        relativePath: \"renamed-by-bob.md\"\n+      }\n+    ) {\n+      ...on Document { _values, _sys { title } }\n+    }\n+  }\n+`;\n+\n+it('renames document using updateDocument mutation', async () => {\n+  const { query, bridge } = await setupMutation(__dirname, config);\n+\n+  // Execute mutation to rename the document\n+  const result = await query({\n+    query: renameDocumentMutation,\n+    variables: {},\n+  });\n+\n+  // Validate GraphQL response\n+  expect(format(result)).toMatchFileSnapshot(\n+    'expected-snapshots/rename-document-node.json'\n   );\n+\n+  // Validate Bridge write operations\n+  const writes = bridge.getWrites();\n+  expect(writes.size).toBeGreaterThan(0);\n+  expect(bridge.getWrite('posts/renamed-by-bob.md')).toMatchFileSnapshot(\n+    'expected-snapshots/rename-document-content.md'\n+  );\n+\n+  // Validate that original file was deleted\n+  const deletes = bridge.getDeletes();\n+  expect(deletes).toContain('posts/in.md');\n });\n \n const updatePostMutation = `\n@@ -94,12 +136,14 @@ it('updates document using updatePost mutation', async () => {\n   });\n \n   // Validate GraphQL response\n-  expect(format(result)).toMatchFileSnapshot('update-post-node.json');\n+  expect(format(result)).toMatchFileSnapshot(\n+    'expected-snapshots/update-post-node.json'\n+  );\n \n   // Validate Bridge write operations\n   const writes = bridge.getWrites();\n   expect(writes.size).toBeGreaterThan(0);\n   expect(bridge.getWrite('posts/in.md')).toMatchFileSnapshot(\n-    'update-post-content.md'\n+    'expected-snapshots/update-post-content.md'\n   );\n });\ndiff --git a/packages/@tinacms/graphql/tests/util.ts b/packages/@tinacms/graphql/tests/util.ts\nindex 4f9651df02..0be935f589 100644\n--- a/packages/@tinacms/graphql/tests/util.ts\n+++ b/packages/@tinacms/graphql/tests/util.ts\n@@ -18,6 +18,8 @@ class OutputBridge extends FilesystemBridge {\n class MemoryCaptureBridge extends FilesystemBridge {\n   private writes: Map<string, string> = new Map();\n \n+  private deletes: string[] = [];\n+\n   // Read operations continue to use filesystem\n   async get(filepath: string): Promise<string> {\n     return super.get(filepath);\n@@ -36,6 +38,15 @@ class MemoryCaptureBridge extends FilesystemBridge {\n   getWrite(filepath: string): string | undefined {\n     return this.writes.get(filepath);\n   }\n+\n+  // Intercept delete operations, prevent them as they will prevent running tests twice.\n+  async delete(filepath: string) {\n+    this.deletes.push(filepath);\n+  }\n+\n+  getDeletes(): string[] {\n+    return [...this.deletes];\n+  }\n }\n \n const dataSchema = z.object({\n", "test_files": ["packages/@tinacms/graphql/tests/document-update-mutation/index.test.ts"], "code_files": ["packages/@tinacms/graphql/tests/util.ts"]}
{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.5901", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 5901, "merge_commit": "c4f0716f84cf06dd94e444b3d6d042057a21d5d7", "problem_statement": "\ud83d\udc1b Fix: content path trailing slash breaks indexer", "patch": "diff --git a/.changeset/eleven-scissors-explode.md b/.changeset/eleven-scissors-explode.md\nnew file mode 100644\nindex 0000000000..9b5099fa21\n--- /dev/null\n+++ b/.changeset/eleven-scissors-explode.md\n@@ -0,0 +1,7 @@\n+---\n+\"@tinacms/cli\": minor\n+---\n+\n+\ud83d\udc1b Fix - Fixes a bug where trailing slash in localContentPath would break database\n+and search indexers, causing \"Unable to find collection for file at (...)\"\n+error.\ndiff --git a/packages/@tinacms/cli/package.json b/packages/@tinacms/cli/package.json\nindex 5ab2e6299e..df7698585c 100644\n--- a/packages/@tinacms/cli/package.json\n+++ b/packages/@tinacms/cli/package.json\n@@ -38,6 +38,7 @@\n \t\t\"@types/listr\": \"catalog:\",\n \t\t\"@types/log4js\": \"catalog:\",\n \t\t\"@types/multer\": \"catalog:\",\n+\t\t\"@types/node\": \"^22.13.1\",\n \t\t\"@types/progress\": \"catalog:\",\n \t\t\"@types/prompts\": \"catalog:\",\n \t\t\"@types/yup\": \"^0.32.0\",\ndiff --git a/packages/@tinacms/cli/src/next/config-manager.ts b/packages/@tinacms/cli/src/next/config-manager.ts\nindex cccce4a57c..9a63ad8c36 100644\n--- a/packages/@tinacms/cli/src/next/config-manager.ts\n+++ b/packages/@tinacms/cli/src/next/config-manager.ts\n@@ -8,6 +8,7 @@ import * as dotenv from 'dotenv';\n import normalizePath from 'normalize-path';\n import chalk from 'chalk';\n import { logger } from '../logger';\n+import { stripNativeTrailingSlash } from '../utils/path';\n \n export const TINA_FOLDER = 'tina';\n export const LEGACY_TINA_FOLDER = '.tina';\n@@ -234,9 +235,8 @@ export class ConfigManager {\n     this.outputHTMLFilePath = path.join(this.outputFolderPath, 'index.html');\n     this.outputGitignorePath = path.join(this.outputFolderPath, '.gitignore');\n \n-    const fullLocalContentPath = path.join(\n-      this.tinaFolderPath,\n-      this.config.localContentPath || ''\n+    const fullLocalContentPath = stripNativeTrailingSlash(\n+      path.join(this.tinaFolderPath, this.config.localContentPath || '')\n     );\n \n     if (this.config.localContentPath) {\ndiff --git a/packages/@tinacms/cli/src/utils/path.test.ts b/packages/@tinacms/cli/src/utils/path.test.ts\nnew file mode 100644\nindex 0000000000..e393db0318\n--- /dev/null\n+++ b/packages/@tinacms/cli/src/utils/path.test.ts\n@@ -0,0 +1,83 @@\n+/// <reference types=\"node\" />\n+import type { stripNativeTrailingSlash as StripFn } from './path';\n+\n+describe('stripNativeTrailingSlash under Windows', () => {\n+  let stripNativeTrailingSlash: typeof StripFn;\n+\n+  beforeAll(() => {\n+    const winPath = require('path').win32;\n+    jest.doMock('path', () => ({\n+      __esModule: true,\n+      default: winPath,\n+    }));\n+\n+    stripNativeTrailingSlash = require('./path').stripNativeTrailingSlash;\n+  });\n+\n+  afterAll(() => {\n+    jest.resetModules();\n+    jest.unmock('path');\n+  });\n+\n+  it('strips single trailing backslash \"\\\\\"', () => {\n+    expect(stripNativeTrailingSlash('C:\\\\development\\\\tina\\\\')).toBe(\n+      'C:\\\\development\\\\tina'\n+    );\n+  });\n+  it('strips multiple trailing backslashes \"\\\\\"', () => {\n+    expect(stripNativeTrailingSlash('C:\\\\development\\\\tina\\\\\\\\\\\\\\\\\\\\\\\\')).toBe(\n+      'C:\\\\development\\\\tina'\n+    );\n+  });\n+  it('doesn\\'t strip a forward slash \"/\"', () => {\n+    expect(stripNativeTrailingSlash('C:\\\\development\\\\tina/')).toBe(\n+      'C:\\\\development\\\\tina/'\n+    );\n+  });\n+  it('doesn\\'t strip the \"C:\\\\\" root', () => {\n+    expect(stripNativeTrailingSlash('C:\\\\')).toBe('C:\\\\');\n+  });\n+  it('returns empty string on empty path', () => {\n+    expect(stripNativeTrailingSlash('')).toBe('');\n+  });\n+});\n+\n+describe('stripNativeTrailingSlash under POSIX/UNIX', () => {\n+  let stripNativeTrailingSlash: typeof StripFn;\n+\n+  beforeAll(() => {\n+    const posixPath = require('path').posix;\n+    jest.doMock('path', () => ({\n+      __esModule: true,\n+      default: posixPath,\n+    }));\n+    stripNativeTrailingSlash = require('./path').stripNativeTrailingSlash;\n+  });\n+\n+  afterAll(() => {\n+    jest.resetModules();\n+    jest.unmock('path');\n+  });\n+\n+  it('strips single trailing forward slash \"/\"', () => {\n+    expect(stripNativeTrailingSlash('/home/user/development/tina/')).toBe(\n+      '/home/user/development/tina'\n+    );\n+  });\n+  it('strips multiple trailing forward slashes \"/\"', () => {\n+    expect(stripNativeTrailingSlash('/home/user/development/tina//////')).toBe(\n+      '/home/user/development/tina'\n+    );\n+  });\n+  it('doesn\\'t strip a backslash \"\\\\\"', () => {\n+    expect(stripNativeTrailingSlash('/home/user/development/tina\\\\')).toBe(\n+      '/home/user/development/tina\\\\'\n+    );\n+  });\n+  it('doesn\\'t strip the \"/\" root', () => {\n+    expect(stripNativeTrailingSlash('/')).toBe('/');\n+  });\n+  it('returns empty string on empty path', () => {\n+    expect(stripNativeTrailingSlash('')).toBe('');\n+  });\n+});\ndiff --git a/packages/@tinacms/cli/src/utils/path.ts b/packages/@tinacms/cli/src/utils/path.ts\nnew file mode 100644\nindex 0000000000..a3a35a1701\n--- /dev/null\n+++ b/packages/@tinacms/cli/src/utils/path.ts\n@@ -0,0 +1,15 @@\n+import path from 'path';\n+\n+/** Removes trailing slash from path. Separator to remove is chosen based on\n+ *  operating system. */\n+export function stripNativeTrailingSlash(p: string) {\n+  const { root } = path.parse(p);\n+  let str = p;\n+\n+  // Remove only the OS-native separator\n+  while (str.length > root.length && str.endsWith(path.sep)) {\n+    str = str.slice(0, -1);\n+  }\n+\n+  return str;\n+}\ndiff --git a/pnpm-lock.yaml b/pnpm-lock.yaml\nindex 400fc8f71d..5328df945d 100644\n--- a/pnpm-lock.yaml\n+++ b/pnpm-lock.yaml\n@@ -811,7 +811,7 @@ importers:\n         version: 2.2.0(react@18.3.1)\n       '@tailwindcss/typography':\n         specifier: ^0.5.16\n-        version: 0.5.16(tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3)))\n+        version: 0.5.16(tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3)))\n       '@tinacms/datalayer':\n         specifier: workspace:*\n         version: link:../../packages/@tinacms/datalayer\n@@ -872,13 +872,13 @@ importers:\n         version: 23.11.1(bufferutil@4.0.9)(typescript@5.7.3)\n       tailwindcss:\n         specifier: ^3.4.17\n-        version: 3.4.17(ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3))\n+        version: 3.4.17(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3))\n       typescript:\n         specifier: ^5.7.3\n         version: 5.7.3\n       vite:\n         specifier: ^4.5.9\n-        version: 4.5.9(@types/node@22.15.32)(lightningcss@1.30.1)(sass@1.89.2)(terser@5.39.0)\n+        version: 4.5.9(@types/node@22.15.17)(lightningcss@1.30.1)(sass@1.89.2)(terser@5.39.0)\n       vitest:\n         specifier: ^0.32.4\n         version: 0.32.4(happy-dom@15.10.2)(jsdom@15.2.1(bufferutil@4.0.9))(lightningcss@1.30.1)(playwright@1.50.1)(sass@1.89.2)(terser@5.39.0)\n@@ -1434,6 +1434,9 @@ importers:\n       '@types/multer':\n         specifier: 'catalog:'\n         version: 1.4.12\n+      '@types/node':\n+        specifier: ^22.13.1\n+        version: 22.15.32\n       '@types/progress':\n         specifier: 'catalog:'\n         version: 2.0.7\n@@ -18537,6 +18540,14 @@ snapshots:\n       postcss-selector-parser: 6.0.10\n       tailwindcss: 3.4.17(ts-node@10.9.2(@types/node@22.13.5)(typescript@5.7.3))\n \n+  '@tailwindcss/typography@0.5.16(tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3)))':\n+    dependencies:\n+      lodash.castarray: 4.4.0\n+      lodash.isplainobject: 4.0.6\n+      lodash.merge: 4.6.2\n+      postcss-selector-parser: 6.0.10\n+      tailwindcss: 3.4.17(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3))\n+\n   '@tailwindcss/typography@0.5.16(tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3)))':\n     dependencies:\n       lodash.castarray: 4.4.0\n@@ -21583,7 +21594,7 @@ snapshots:\n       eslint: 8.24.0\n       eslint-import-resolver-node: 0.3.9\n       eslint-import-resolver-typescript: 3.8.3(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0)\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3)(eslint@8.24.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0)\n       eslint-plugin-jsx-a11y: 6.10.2(eslint@8.24.0)\n       eslint-plugin-react: 7.37.4(eslint@8.24.0)\n       eslint-plugin-react-hooks: 4.6.2(eslint@8.24.0)\n@@ -21645,7 +21656,7 @@ snapshots:\n       stable-hash: 0.0.4\n       tinyglobby: 0.2.12\n     optionalDependencies:\n-      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3)(eslint@8.24.0)\n+      eslint-plugin-import: 2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0)\n     transitivePeerDependencies:\n       - supports-color\n \n@@ -21726,7 +21737,7 @@ snapshots:\n       - eslint-import-resolver-webpack\n       - supports-color\n \n-  eslint-plugin-import@2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3)(eslint@8.24.0):\n+  eslint-plugin-import@2.31.0(@typescript-eslint/parser@5.62.0(eslint@8.24.0)(typescript@5.7.3))(eslint-import-resolver-typescript@3.8.3(eslint-plugin-import@2.31.0(eslint@8.24.0))(eslint@8.24.0))(eslint@8.24.0):\n     dependencies:\n       '@rtsao/scc': 1.1.0\n       array-includes: 3.1.8\n@@ -25561,6 +25572,14 @@ snapshots:\n       postcss: 8.5.3\n       ts-node: 10.9.2(@types/node@22.13.5)(typescript@5.7.3)\n \n+  postcss-load-config@4.0.2(postcss@8.5.3)(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3)):\n+    dependencies:\n+      lilconfig: 3.1.3\n+      yaml: 2.7.0\n+    optionalDependencies:\n+      postcss: 8.5.3\n+      ts-node: 10.9.2(@types/node@22.15.17)(typescript@5.7.3)\n+\n   postcss-load-config@4.0.2(postcss@8.5.3)(ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3)):\n     dependencies:\n       lilconfig: 3.1.3\n@@ -27065,6 +27084,33 @@ snapshots:\n     transitivePeerDependencies:\n       - ts-node\n \n+  tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3)):\n+    dependencies:\n+      '@alloc/quick-lru': 5.2.0\n+      arg: 5.0.2\n+      chokidar: 3.6.0\n+      didyoumean: 1.2.2\n+      dlv: 1.1.3\n+      fast-glob: 3.3.3\n+      glob-parent: 6.0.2\n+      is-glob: 4.0.3\n+      jiti: 1.21.7\n+      lilconfig: 3.1.3\n+      micromatch: 4.0.8\n+      normalize-path: 3.0.0\n+      object-hash: 3.0.0\n+      picocolors: 1.1.1\n+      postcss: 8.5.3\n+      postcss-import: 15.1.0(postcss@8.5.3)\n+      postcss-js: 4.0.1(postcss@8.5.3)\n+      postcss-load-config: 4.0.2(postcss@8.5.3)(ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3))\n+      postcss-nested: 6.2.0(postcss@8.5.3)\n+      postcss-selector-parser: 6.1.2\n+      resolve: 1.22.10\n+      sucrase: 3.35.0\n+    transitivePeerDependencies:\n+      - ts-node\n+\n   tailwindcss@3.4.17(ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3)):\n     dependencies:\n       '@alloc/quick-lru': 5.2.0\n@@ -27313,6 +27359,25 @@ snapshots:\n       v8-compile-cache-lib: 3.0.1\n       yn: 3.1.1\n \n+  ts-node@10.9.2(@types/node@22.15.17)(typescript@5.7.3):\n+    dependencies:\n+      '@cspotcode/source-map-support': 0.8.1\n+      '@tsconfig/node10': 1.0.11\n+      '@tsconfig/node12': 1.0.11\n+      '@tsconfig/node14': 1.0.3\n+      '@tsconfig/node16': 1.0.4\n+      '@types/node': 22.15.17\n+      acorn: 8.14.0\n+      acorn-walk: 8.3.4\n+      arg: 4.1.3\n+      create-require: 1.1.1\n+      diff: 4.0.2\n+      make-error: 1.3.6\n+      typescript: 5.7.3\n+      v8-compile-cache-lib: 3.0.1\n+      yn: 3.1.1\n+    optional: true\n+\n   ts-node@10.9.2(@types/node@22.15.32)(typescript@5.7.3):\n     dependencies:\n       '@cspotcode/source-map-support': 0.8.1\n", "test_files": ["packages/@tinacms/cli/src/utils/path.test.ts"], "code_files": ["packages/@tinacms/cli/src/next/config-manager.ts", "packages/@tinacms/cli/src/utils/path.ts"]}
{"repo": "tinacms/tinacms", "instance_id": "tinacms__tinacms.ac595220.5947", "base_commit": "ac59522053c71c713057c4c2b6ce610617bce85e", "pull_number": 5947, "merge_commit": "b012b6c7fae2674c613fd4c54e1819a86c6d2c3e", "problem_statement": "Sidebar - update tooltips", "patch": "diff --git a/.changeset/old-brooms-lie.md b/.changeset/old-brooms-lie.md\nnew file mode 100644\nindex 0000000000..cb0cda9766\n--- /dev/null\n+++ b/.changeset/old-brooms-lie.md\n@@ -0,0 +1,5 @@\n+---\n+\"tinacms\": patch\n+---\n+\n+Sidebar - updated tooltips, show editing panel is now orange for visibility/branding\ndiff --git a/packages/tinacms/src/toolkit/components/tina-ui.test.tsx b/packages/tinacms/src/toolkit/components/tina-ui.test.tsx\nindex 25044fe201..39892e28b5 100644\n--- a/packages/tinacms/src/toolkit/components/tina-ui.test.tsx\n+++ b/packages/tinacms/src/toolkit/components/tina-ui.test.tsx\n@@ -36,7 +36,7 @@ describe('TinaUI', () => {\n           </TinaCMSProvider>\n         );\n \n-        app.getByLabelText('opens cms sidebar');\n+        app.getByLabelText('Show editing panel');\n       });\n     });\n     describe('when sidebar is false', () => {\n@@ -63,7 +63,7 @@ describe('TinaUI', () => {\n           </TinaCMSProvider>\n         );\n \n-        const sidebarButton = app.queryByLabelText('opens cms sidebar');\n+        const sidebarButton = app.queryByLabelText('Show editing panel');\n         expect(sidebarButton).toBeNull();\n       });\n     });\n@@ -93,7 +93,7 @@ describe('TinaUI', () => {\n           </TinaCMSProvider>\n         );\n \n-        const sidebarButton = app.queryByLabelText('opens cms sidebar');\n+        const sidebarButton = app.queryByLabelText('Show editing panel');\n         expect(sidebarButton).toBeNull();\n       });\n       it('does not remount children when cms is toggled', () => {\n@@ -151,7 +151,7 @@ describe('TinaUI', () => {\n           </TinaCMSProvider>\n         );\n \n-        const sidebarButton = app.queryByLabelText('opens cms sidebar');\n+        const sidebarButton = app.queryByLabelText('Show editing panel');\n         expect(sidebarButton).toBeNull();\n       });\n     });\ndiff --git a/packages/tinacms/src/toolkit/react-sidebar/components/sidebar.tsx b/packages/tinacms/src/toolkit/react-sidebar/components/sidebar.tsx\nindex beb1fea34e..e3d4eaac4b 100644\n--- a/packages/tinacms/src/toolkit/react-sidebar/components/sidebar.tsx\n+++ b/packages/tinacms/src/toolkit/react-sidebar/components/sidebar.tsx\n@@ -243,10 +243,7 @@ const Sidebar = ({\n         <SidebarWrapper>\n           <EditButton />\n           <SidebarBody>\n-            <SidebarHeader\n-              isLocalMode={cms.api?.tina?.isLocalMode}\n-              branchingEnabled={branchingEnabled}\n-            />\n+            <SidebarHeader isLocalMode={cms.api?.tina?.isLocalMode} />\n             <FormsView loadingPlaceholder={sidebar.loadingPlaceholder} />\n             {activeScreen && (\n               <ScreenPluginModal\n@@ -365,7 +362,7 @@ const updateBodyDisplacement = ({\n   }\n };\n \n-const SidebarHeader = ({ branchingEnabled, isLocalMode }) => {\n+const SidebarHeader = ({ isLocalMode }) => {\n   const { toggleSidebarOpen, toggleMenu } = React.useContext(SidebarContext);\n \n   return (\n@@ -395,10 +392,11 @@ const SidebarHeader = ({ branchingEnabled, isLocalMode }) => {\n             <BranchPreviewButton />\n \n             <button\n+              type='button'\n               className='p-2 hover:bg-gray-100 transition-colors duration-150 ease-in-out rounded'\n               onClick={toggleSidebarOpen}\n-              title='Close sidebar'\n-              aria-label='Close sidebar'\n+              title='Hide editing panel'\n+              aria-label='Hide editing panel'\n             >\n               <PiSidebarSimpleLight className='h-6 w-auto text-gray-600' />\n             </button>\n@@ -486,7 +484,7 @@ const EditButton = ({}) => {\n   return (\n     <Button\n       rounded='right'\n-      variant='secondary'\n+      variant='accent'\n       size='custom'\n       onClick={toggleSidebarOpen}\n       className={`z-chrome absolute top-6 right-0 translate-x-full text-sm h-10 px-3 transition-all duration-300 ${\n@@ -494,7 +492,8 @@ const EditButton = ({}) => {\n           ? 'opacity-0 ease-in pointer-events-none'\n           : 'ease-out pointer-events-auto'\n       }`}\n-      aria-label='opens cms sidebar'\n+      title='Show editing panel'\n+      aria-label='Show editing panel'\n     >\n       <PiSidebarSimpleLight className='h-6 w-auto' />\n     </Button>\ndiff --git a/packages/tinacms/src/toolkit/styles/button.tsx b/packages/tinacms/src/toolkit/styles/button.tsx\nindex c73326c418..a5f0f8b56f 100644\n--- a/packages/tinacms/src/toolkit/styles/button.tsx\n+++ b/packages/tinacms/src/toolkit/styles/button.tsx\n@@ -3,7 +3,14 @@ import { cn } from '../../lib/utils';\n \n export interface ButtonProps\n   extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n-  variant?: 'primary' | 'secondary' | 'white' | 'ghost' | 'danger' | 'custom';\n+  variant?:\n+    | 'primary'\n+    | 'secondary'\n+    | 'white'\n+    | 'ghost'\n+    | 'danger'\n+    | 'accent'\n+    | 'custom';\n   as?: React.ElementType;\n   href?: string;\n   target?: string;\n@@ -34,6 +41,7 @@ export const Button = ({\n     white: `shadow text-gray-500 hover:text-blue-500 bg-white hover:bg-gray-50 border border-gray-100`,\n     ghost: `text-gray-500 hover:text-blue-500 hover:shadow border border-transparent border-0 hover:border hover:border-gray-200 bg-transparent`,\n     danger: `shadow text-white bg-red-500 hover:bg-red-600 focus:ring-red-500`,\n+    accent: `shadow text-white bg-orange-500 hover:bg-orange-600 focus:ring-orange-500`,\n     custom: '',\n   };\n   const state = busy ? `busy` : disabled ? `disabled` : `default`;\n@@ -88,6 +96,7 @@ export const IconButton = ({\n     secondary: `shadow text-gray-500 hover:text-blue-500 bg-gray-50 hover:bg-white border border-gray-200`,\n     white: `shadow text-gray-500 hover:text-blue-500 bg-white hover:bg-gray-50 border border-gray-200`,\n     ghost: `text-gray-500 hover:text-blue-500 hover:shadow border border-transparent hover:border-gray-200 bg-transparent`,\n+    accent: `shadow text-white bg-orange-500 hover:bg-orange-600 focus:ring-orange-500`,\n   };\n   const state = busy ? `busy` : disabled ? `disabled` : `default`;\n   const stateClasses = {\n", "test_files": ["packages/tinacms/src/toolkit/components/tina-ui.test.tsx"], "code_files": ["packages/tinacms/src/toolkit/react-sidebar/components/sidebar.tsx", "packages/tinacms/src/toolkit/styles/button.tsx"]}
