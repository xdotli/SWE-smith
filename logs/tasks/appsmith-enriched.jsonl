{"instance_id": "appsmithorg__appsmith.main.41370", "repo": "appsmithorg/appsmith", "base_commit": "f092c5df46c19cf24edebde095e1e6ea19c98c41", "head_commit": "d4cdfb86d62663d5c2e9b0256893f6e816d14263", "title": "fix: make horizontal scroll bar thicker on tables", "merged_at": "2025-11-20T10:55:27Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41370", "test_files": ["app/client/src/widgets/TableWidgetV2/component/TableContext.test.tsx"], "code_files": ["app/client/cypress/e2e/Regression/ClientSide/Widgets/TableV2/scrollbar_spec.ts", "app/client/src/widgets/TableWidgetV2/component/Constants.ts", "app/client/src/widgets/TableWidgetV2/component/TableStyledWrappers.tsx"], "total_changes": 18, "num_files": 4, "pull_number": 41370, "patch": "diff --git a/app/client/cypress/e2e/Regression/ClientSide/Widgets/TableV2/scrollbar_spec.ts b/app/client/cypress/e2e/Regression/ClientSide/Widgets/TableV2/scrollbar_spec.ts\nindex daafb18945e..b15899b2af1 100644\n--- a/app/client/cypress/e2e/Regression/ClientSide/Widgets/TableV2/scrollbar_spec.ts\n+++ b/app/client/cypress/e2e/Regression/ClientSide/Widgets/TableV2/scrollbar_spec.ts\n@@ -24,8 +24,10 @@ describe(\n       });\n \n       cy.get(\".t--draggable-tablewidgetv2 .table .simplebar-content\").then(\n-        ($scrollBox) =>\n-          expect($scrollBox[0].clientHeight).to.be.equal(tableHeight),\n+        ($scrollBox) => {\n+          // +2 is because of the SCROLL_BAR_OFFSET, which got added to the table height in PR: https://github.com/appsmithorg/appsmith/pull/41370\n+          expect($scrollBox[0].clientHeight).to.be.equal(tableHeight + 2);\n+        },\n       );\n     });\n   },\ndiff --git a/app/client/src/widgets/TableWidgetV2/component/Constants.ts b/app/client/src/widgets/TableWidgetV2/component/Constants.ts\nindex 88ad92b6cf1..6896ccb4949 100644\n--- a/app/client/src/widgets/TableWidgetV2/component/Constants.ts\n+++ b/app/client/src/widgets/TableWidgetV2/component/Constants.ts\n@@ -599,7 +599,7 @@ export enum AddNewRowActions {\n export const EDITABLE_CELL_PADDING_OFFSET = 8;\n \n export const TABLE_SCROLLBAR_WIDTH = 10;\n-export const TABLE_SCROLLBAR_HEIGHT = 8;\n+export const TABLE_SCROLLBAR_HEIGHT = 10;\n \n export const POPOVER_ITEMS_TEXT_MAP = {\n   SORT_ASC: \"Sort column ascending\",\ndiff --git a/app/client/src/widgets/TableWidgetV2/component/TableContext.test.tsx b/app/client/src/widgets/TableWidgetV2/component/TableContext.test.tsx\nindex cd657ad4264..6eb798b4b50 100644\n--- a/app/client/src/widgets/TableWidgetV2/component/TableContext.test.tsx\n+++ b/app/client/src/widgets/TableWidgetV2/component/TableContext.test.tsx\n@@ -249,7 +249,7 @@ describe(\"TableContext\", () => {\n         .tableContext;\n \n       expect(context.scrollContainerStyles).toEqual({\n-        height: 352, // 400 - 40 - 8 (height - TABLE_HEADER_HEIGHT - TABLE_SCROLLBAR_HEIGHT)\n+        height: 350, // 400 - 40 - 10 (height - TABLE_HEADER_HEIGHT - TABLE_SCROLLBAR_HEIGHT)\n         width: 800,\n       });\n     });\n@@ -267,7 +267,7 @@ describe(\"TableContext\", () => {\n         .tableContext;\n \n       expect(context.scrollContainerStyles).toEqual({\n-        height: 390, // 400 - 8 - 2 (height - TABLE_SCROLLBAR_HEIGHT - SCROLL_BAR_OFFSET)\n+        height: 388, // 400 - 10 - 2 (height - TABLE_SCROLLBAR_HEIGHT - SCROLL_BAR_OFFSET)\n         width: 800,\n       });\n     });\ndiff --git a/app/client/src/widgets/TableWidgetV2/component/TableStyledWrappers.tsx b/app/client/src/widgets/TableWidgetV2/component/TableStyledWrappers.tsx\nindex d212ac79153..f22db0b4d79 100644\n--- a/app/client/src/widgets/TableWidgetV2/component/TableStyledWrappers.tsx\n+++ b/app/client/src/widgets/TableWidgetV2/component/TableStyledWrappers.tsx\n@@ -64,13 +64,15 @@ export const TableWrapper = styled.div<{\n   .simplebar-track {\n     opacity: 0.7;\n     &.simplebar-horizontal {\n+      /* this height moves the scrollbar up and down */\n       height: ${TABLE_SCROLLBAR_HEIGHT}px;\n       .simplebar-scrollbar {\n-        height: 5px;\n+        /*this actual height of the scrollbar */\n+        height: 8px;\n       }\n       &.simplebar-hover {\n-        height: 10px;\n         & .simplebar-scrollbar {\n+          transition: height 0.15s ease-in-out;\n           height: 8px;\n         }\n       }\n"}
{"instance_id": "appsmithorg__appsmith.main.41217", "repo": "appsmithorg/appsmith", "base_commit": "49dfbd233930187670f70430b5fdefe7351020db", "head_commit": "4d0ff9c41d97c55a94a3d261b962faef492f453a", "title": "fix: updates the logic to not interfere with DSL when infinitescroll is enabled", "merged_at": "2025-09-25T10:31:59Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41217", "test_files": ["app/client/src/widgets/TableWidgetV2/widget/__tests__/propertyUtils.test.ts"], "code_files": ["app/client/src/widgets/TableWidgetV2/component/cellComponents/HeaderCell.tsx", "app/client/src/widgets/TableWidgetV2/widget/index.tsx", "app/client/src/widgets/TableWidgetV2/widget/propertyConfig/PanelConfig/General.ts", "app/client/src/widgets/TableWidgetV2/widget/propertyConfig/contentConfig.ts", "app/client/src/widgets/TableWidgetV2/widget/propertyUtils.ts", "app/client/src/widgets/TableWidgetV2/widget/reactTableUtils/getColumnsPureFn.tsx", "app/client/src/widgets/TableWidgetV2/widget/utilities.ts"], "total_changes": 171, "num_files": 8, "pull_number": 41217, "patch": "diff --git a/app/client/src/widgets/TableWidgetV2/component/cellComponents/HeaderCell.tsx b/app/client/src/widgets/TableWidgetV2/component/cellComponents/HeaderCell.tsx\nindex 9bc73b67ea4..b938f722a96 100644\n--- a/app/client/src/widgets/TableWidgetV2/component/cellComponents/HeaderCell.tsx\n+++ b/app/client/src/widgets/TableWidgetV2/component/cellComponents/HeaderCell.tsx\n@@ -200,7 +200,10 @@ const HeaderCellComponent = (props: HeaderProps) => {\n   const isColumnEditable =\n     props.column.columnProperties.isCellEditable &&\n     props.column.columnProperties.isEditable &&\n-    isColumnTypeEditable(props.column.columnProperties.columnType);\n+    isColumnTypeEditable(\n+      props.column.columnProperties.columnType,\n+      isInfiniteScrollEnabled,\n+    );\n \n   const toggleColumnFreeze = (value: StickyType) => {\n     handleColumnFreeze &&\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/__tests__/propertyUtils.test.ts b/app/client/src/widgets/TableWidgetV2/widget/__tests__/propertyUtils.test.ts\nindex 2d3eb8985b8..160ab69d5f8 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/__tests__/propertyUtils.test.ts\n+++ b/app/client/src/widgets/TableWidgetV2/widget/__tests__/propertyUtils.test.ts\n@@ -10,7 +10,6 @@ import {\n   updateCustomColumnAliasOnLabelChange,\n   selectColumnOptionsValidation,\n   allowedFirstDayOfWeekRange,\n-  updateCellEditabilityOnInfiniteScrollChange,\n   updateSearchSortFilterOnInfiniteScrollChange,\n } from \"../propertyUtils\";\n import _ from \"lodash\";\n@@ -1151,96 +1150,4 @@ describe(\"Infinite Scroll Update Hooks - \", () => {\n       ),\n     ).toBeUndefined();\n   });\n-\n-  it(\"updateCellEditabilityOnInfiniteScrollChange - should disable cell editability when infinite scroll is enabled\", () => {\n-    // Setup mock primary columns\n-    const props = {\n-      primaryColumns: {\n-        column1: {\n-          id: \"column1\",\n-          alias: \"column1\",\n-          isEditable: true,\n-          isCellEditable: true,\n-        },\n-        column2: {\n-          id: \"column2\",\n-          alias: \"column2\",\n-          isEditable: true,\n-          isCellEditable: true,\n-        },\n-      },\n-    } as unknown as TableWidgetProps;\n-\n-    // When infinite scroll is enabled\n-    expect(\n-      updateCellEditabilityOnInfiniteScrollChange(\n-        props,\n-        \"infiniteScrollEnabled\",\n-        true,\n-      ),\n-    ).toEqual([\n-      {\n-        propertyPath: \"primaryColumns.column1.isCellEditable\",\n-        propertyValue: false,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column1.isEditable\",\n-        propertyValue: false,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column2.isCellEditable\",\n-        propertyValue: false,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column2.isEditable\",\n-        propertyValue: false,\n-      },\n-    ]);\n-\n-    // When infinite scroll is disabled\n-    expect(\n-      updateCellEditabilityOnInfiniteScrollChange(\n-        props,\n-        \"infiniteScrollEnabled\",\n-        false,\n-      ),\n-    ).toEqual([\n-      {\n-        propertyPath: \"primaryColumns.column1.isCellEditable\",\n-        propertyValue: true,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column1.isEditable\",\n-        propertyValue: true,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column2.isCellEditable\",\n-        propertyValue: true,\n-      },\n-      {\n-        propertyPath: \"primaryColumns.column2.isEditable\",\n-        propertyValue: true,\n-      },\n-    ]);\n-\n-    // Test with no primary columns\n-    const propsWithoutColumns = {} as TableWidgetProps;\n-\n-    expect(\n-      updateCellEditabilityOnInfiniteScrollChange(\n-        propsWithoutColumns,\n-        \"infiniteScrollEnabled\",\n-        true,\n-      ),\n-    ).toBeUndefined();\n-\n-    // When some other value is passed\n-    expect(\n-      updateCellEditabilityOnInfiniteScrollChange(\n-        props,\n-        \"infiniteScrollEnabled\",\n-        \"some-other-value\",\n-      ),\n-    ).toBeUndefined();\n-  });\n });\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/index.tsx b/app/client/src/widgets/TableWidgetV2/widget/index.tsx\nindex 78a21afa3f4..2e865783bec 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/index.tsx\n+++ b/app/client/src/widgets/TableWidgetV2/widget/index.tsx\n@@ -580,6 +580,7 @@ class TableWidgetV2 extends BaseWidget<TableWidgetProps, WidgetState> {\n   getTableColumns = () => {\n     const {\n       columnWidthMap,\n+      infiniteScrollEnabled,\n       isPreviewMode,\n       orderedTableColumns,\n       renderMode,\n@@ -597,6 +598,7 @@ class TableWidgetV2 extends BaseWidget<TableWidgetProps, WidgetState> {\n       componentWidth,\n       renderMode,\n       isPreviewMode,\n+      infiniteScrollEnabled,\n     );\n   };\n \n@@ -2067,7 +2069,8 @@ class TableWidgetV2 extends BaseWidget<TableWidgetProps, WidgetState> {\n     }\n \n     const isColumnEditable =\n-      column.isEditable && isColumnTypeEditable(column.columnType);\n+      column.isEditable &&\n+      isColumnTypeEditable(column.columnType, this.props.infiniteScrollEnabled);\n     const alias = props.cell.column.columnProperties.alias;\n \n     const isCellEditable = isColumnEditable && cellProperties.isCellEditable;\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/PanelConfig/General.ts b/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/PanelConfig/General.ts\nindex 82ccf971bc5..96210b4dd02 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/PanelConfig/General.ts\n+++ b/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/PanelConfig/General.ts\n@@ -137,7 +137,10 @@ export default {\n         const columnType = get(props, `${baseProperty}.columnType`, \"\");\n         const isDerived = get(props, `${baseProperty}.isDerived`, false);\n \n-        return !isColumnTypeEditable(columnType) || isDerived;\n+        return (\n+          !isColumnTypeEditable(columnType, props.infiniteScrollEnabled) ||\n+          isDerived\n+        );\n       },\n     },\n     {\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/contentConfig.ts b/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/contentConfig.ts\nindex 02de96fffcc..48351f35538 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/contentConfig.ts\n+++ b/app/client/src/widgets/TableWidgetV2/widget/propertyConfig/contentConfig.ts\n@@ -22,7 +22,6 @@ import {\n   totalRecordsCountValidation,\n   uniqueColumnNameValidation,\n   updateAllowAddNewRowOnInfiniteScrollChange,\n-  updateCellEditabilityOnInfiniteScrollChange,\n   updateColumnOrderHook,\n   updateCustomColumnAliasOnLabelChange,\n   updateInlineEditingOptionDropdownVisibilityHook,\n@@ -197,7 +196,6 @@ export default [\n         isTriggerProperty: false,\n         updateHook: composePropertyUpdateHook([\n           updateAllowAddNewRowOnInfiniteScrollChange,\n-          updateCellEditabilityOnInfiniteScrollChange,\n           updateSearchSortFilterOnInfiniteScrollChange,\n         ]),\n         dependencies: [\"primaryColumns\", \"serverSidePaginationEnabled\"],\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/propertyUtils.ts b/app/client/src/widgets/TableWidgetV2/widget/propertyUtils.ts\nindex c92a573664f..bf6bb16960d 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/propertyUtils.ts\n+++ b/app/client/src/widgets/TableWidgetV2/widget/propertyUtils.ts\n@@ -1513,46 +1513,3 @@ export const updateSearchSortFilterOnInfiniteScrollChange = (\n \n   return;\n };\n-\n-// Disable cell editability when infinite scroll is enabled\n-export const updateCellEditabilityOnInfiniteScrollChange = (\n-  props: TableWidgetProps,\n-  propertyPath: string,\n-  propertyValue: unknown,\n-): Array<{ propertyPath: string; propertyValue: unknown }> | undefined => {\n-  if (!props.primaryColumns) return;\n-\n-  const updates: Array<{ propertyPath: string; propertyValue: unknown }> = [];\n-\n-  if (propertyValue === true) {\n-    Object.entries(props.primaryColumns).forEach(([, column]) => {\n-      const columnName = column.alias;\n-\n-      updates.push({\n-        propertyPath: `primaryColumns.${columnName}.isCellEditable`,\n-        propertyValue: false,\n-      });\n-\n-      updates.push({\n-        propertyPath: `primaryColumns.${columnName}.isEditable`,\n-        propertyValue: false,\n-      });\n-    });\n-  } else if (propertyValue === false) {\n-    Object.entries(props.primaryColumns).forEach(([, column]) => {\n-      const columnName = column.alias;\n-\n-      updates.push({\n-        propertyPath: `primaryColumns.${columnName}.isCellEditable`,\n-        propertyValue: true,\n-      });\n-\n-      updates.push({\n-        propertyPath: `primaryColumns.${columnName}.isEditable`,\n-        propertyValue: true,\n-      });\n-    });\n-  }\n-\n-  return updates.length > 0 ? updates : undefined;\n-};\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/reactTableUtils/getColumnsPureFn.tsx b/app/client/src/widgets/TableWidgetV2/widget/reactTableUtils/getColumnsPureFn.tsx\nindex 47e97e27666..769768d68d2 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/reactTableUtils/getColumnsPureFn.tsx\n+++ b/app/client/src/widgets/TableWidgetV2/widget/reactTableUtils/getColumnsPureFn.tsx\n@@ -4,6 +4,7 @@ import { RenderModes } from \"constants/WidgetConstants\";\n import { StickyType } from \"../../component/Constants\";\n import {\n   COLUMN_MIN_WIDTH,\n+  ColumnTypes,\n   DEFAULT_COLUMN_WIDTH,\n   DEFAULT_COLUMN_NAME,\n } from \"../../constants\";\n@@ -21,6 +22,7 @@ export type getColumns = (\n   componentWidth: number,\n   renderMode: RenderMode,\n   isPreviewMode: boolean,\n+  infiniteScrollEnabled?: boolean,\n ) => ReactTableColumnProps[];\n \n //TODO: (Vamsi) need to unit test this function\n@@ -32,6 +34,7 @@ export const getColumnsPureFn: getColumns = (\n   componentWidth,\n   renderMode,\n   isPreviewMode,\n+  infiniteScrollEnabled = false,\n ) => {\n   let columns: ReactTableColumnProps[] = [];\n   const hiddenColumns: ReactTableColumnProps[] = [];\n@@ -42,6 +45,14 @@ export const getColumnsPureFn: getColumns = (\n     // TODO: Fix this the next time the file is edited\n     // eslint-disable-next-line @typescript-eslint/no-explicit-any\n     orderedTableColumns.forEach((column: any) => {\n+      // Skip EDIT_ACTIONS columns when infinite scroll is enabled\n+      if (\n+        infiniteScrollEnabled &&\n+        column.columnType === ColumnTypes.EDIT_ACTIONS\n+      ) {\n+        return;\n+      }\n+\n       const isHidden = !column.isVisible;\n \n       const columnData = {\ndiff --git a/app/client/src/widgets/TableWidgetV2/widget/utilities.ts b/app/client/src/widgets/TableWidgetV2/widget/utilities.ts\nindex c1c17d8160c..5b2cd649cc5 100644\n--- a/app/client/src/widgets/TableWidgetV2/widget/utilities.ts\n+++ b/app/client/src/widgets/TableWidgetV2/widget/utilities.ts\n@@ -540,8 +540,11 @@ const EdtiableColumnTypes: string[] = [\n   ColumnTypes.CURRENCY,\n ];\n \n-export function isColumnTypeEditable(columnType: string) {\n-  return EdtiableColumnTypes.includes(columnType);\n+export function isColumnTypeEditable(\n+  columnType: string,\n+  isInfiniteScrollEnabled = false,\n+) {\n+  return EdtiableColumnTypes.includes(columnType) && !isInfiniteScrollEnabled;\n }\n \n /*\n"}
{"instance_id": "appsmithorg__appsmith.main.41089", "repo": "appsmithorg/appsmith", "base_commit": "2af8ef31f46dd1d0b1d1d9c4c2fe3b0d8ef04912", "head_commit": "ac67b382f16ad4d8223caed946a8122d761e6739", "title": "chore: remove redundant klona used by the reactive action flow", "merged_at": "2025-07-07T12:00:55Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41089", "test_files": ["app/client/src/workers/Evaluation/__tests__/evaluation.test.ts", "app/client/src/workers/Evaluation/evalTreeWithChanges.test.ts", "app/client/src/workers/common/DataTreeEvaluator/dataTreeEvaluator.test.ts"], "code_files": ["app/client/src/workers/Evaluation/evalTreeWithChanges.ts", "app/client/src/workers/Evaluation/handlers/evalTree.ts", "app/client/src/workers/Evaluation/handlers/evalTrigger.ts", "app/client/src/workers/common/DataTreeEvaluator/index.ts"], "total_changes": 54, "num_files": 7, "pull_number": 41089, "patch": "diff --git a/app/client/src/workers/Evaluation/__tests__/evaluation.test.ts b/app/client/src/workers/Evaluation/__tests__/evaluation.test.ts\nindex bde5259b878..c6d2e3e52e4 100644\n--- a/app/client/src/workers/Evaluation/__tests__/evaluation.test.ts\n+++ b/app/client/src/workers/Evaluation/__tests__/evaluation.test.ts\n@@ -634,7 +634,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n \n@@ -674,7 +673,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n \n     const dataTree = evaluator.evalTree;\n@@ -722,7 +720,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n \n@@ -787,7 +784,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n     const updatedDependencies = evaluator.dependencies;\n@@ -832,7 +828,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n     const updatedDependencies = evaluator.dependencies;\n@@ -898,7 +893,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n     const updatedDependencies = evaluator.dependencies;\n@@ -971,7 +965,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree1,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     expect(evaluator.dependencies[\"Api2.config.body\"]).toStrictEqual([\n       \"Api2.config.pluginSpecifiedTemplates[0].value\",\n@@ -1007,7 +1000,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree2,\n       unEvalUpdates2,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n \n@@ -1050,7 +1042,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree3,\n       unEvalUpdates3,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree3 = evaluator.evalTree;\n \n@@ -1094,7 +1085,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     const dataTree = evaluator.evalTree;\n \n@@ -1135,7 +1125,6 @@ describe(\"DataTreeEvaluator\", () => {\n       updatedConfigTree,\n       unEvalUpdates,\n       [],\n-      evaluator.evalTree,\n     );\n     // Hard check to not regress on the number of clone operations. Try to improve this number.\n     // Not a good assertion because in one piece of code im cloning multiple times, however the value im cloning is very small.\ndiff --git a/app/client/src/workers/Evaluation/evalTreeWithChanges.test.ts b/app/client/src/workers/Evaluation/evalTreeWithChanges.test.ts\nindex 791e64071b2..ceff6ba2630 100644\n--- a/app/client/src/workers/Evaluation/evalTreeWithChanges.test.ts\n+++ b/app/client/src/workers/Evaluation/evalTreeWithChanges.test.ts\n@@ -130,7 +130,6 @@ describe(\"evaluateAndPushResponse\", () => {\n       },\n       [],\n       [],\n-      {},\n     );\n     // check if push response has been called\n     expect(pushResponseToMainThreadMock).toHaveBeenCalled();\n@@ -226,7 +225,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n       },\n       [],\n       [],\n-      {},\n     );\n     const parsedUpdates = getParsedUpdatesFromWebWorkerResp(webworkerResponse);\n \n@@ -261,7 +259,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n       },\n       [],\n       [],\n-      {},\n     );\n     const parsedUpdates = getParsedUpdatesFromWebWorkerResp(webworkerResponse);\n \n@@ -301,7 +298,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [],\n-        {},\n       );\n \n       expect(webworkerResponse.workerResponse.dependencies).toEqual({\n@@ -342,7 +338,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [],\n-        {},\n       );\n       const parsedUpdates =\n         getParsedUpdatesFromWebWorkerResp(webworkerResponse);\n@@ -376,7 +371,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [],\n-        {},\n       );\n \n       const parsedUpdates =\n@@ -420,7 +414,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [\"Text1.text\"],\n-        {},\n       );\n       const parsedUpdates =\n         getParsedUpdatesFromWebWorkerResp(webworkerResponse);\n@@ -466,7 +459,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n           response,\n           metaUpdates,\n           [],\n-          {},\n         );\n \n       expect(workerResponse.evalMetaUpdates).toEqual(metaUpdates);\n@@ -497,7 +489,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n           response,\n           metaUpdates,\n           [],\n-          {},\n         );\n \n       // the function properties should be stripped out\n@@ -529,7 +520,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [],\n-        {},\n       );\n \n       const parsedUpdates =\n@@ -568,7 +558,6 @@ describe(\"evaluateAndGenerateResponse\", () => {\n         updateTreeResponse,\n         [],\n         [],\n-        {},\n       );\n       const parsedUpdates =\n         getParsedUpdatesFromWebWorkerResp(webworkerResponse);\ndiff --git a/app/client/src/workers/Evaluation/evalTreeWithChanges.ts b/app/client/src/workers/Evaluation/evalTreeWithChanges.ts\nindex f0a0a562612..e3feaebe177 100644\n--- a/app/client/src/workers/Evaluation/evalTreeWithChanges.ts\n+++ b/app/client/src/workers/Evaluation/evalTreeWithChanges.ts\n@@ -21,7 +21,6 @@ import {\n import type DataTreeEvaluator from \"workers/common/DataTreeEvaluator\";\n import type { Diff } from \"deep-diff\";\n import type { DataTree } from \"entities/DataTree/dataTreeTypes\";\n-import { klona as klonaJson } from \"klona/json\";\n \n const getDefaultEvalResponse = (): EvalTreeResponseData => ({\n   updates: \"[]\",\n@@ -71,10 +70,8 @@ export function evalTreeWithChanges(\n   );\n \n   let setupUpdateTreeResponse = {} as UpdateTreeResponse;\n-  let oldEvalTree: DataTree = {};\n \n   if (dataTreeEvaluator) {\n-    oldEvalTree = klonaJson(dataTreeEvaluator.getEvalTree());\n     setupUpdateTreeResponse = dataTreeEvaluator.setupUpdateTreeWithDifferences(\n       updatedValuePaths,\n       pathsToSkipFromEval,\n@@ -86,7 +83,6 @@ export function evalTreeWithChanges(\n     setupUpdateTreeResponse,\n     metaUpdates,\n     pathsToSkipFromEval,\n-    oldEvalTree,\n   );\n }\n \n@@ -107,14 +103,12 @@ export const evaluateAndPushResponse = (\n   setupUpdateTreeResponse: UpdateTreeResponse,\n   metaUpdates: EvalMetaUpdates,\n   additionalPathsAddedAsUpdates: string[],\n-  oldEvalTree: DataTree,\n ) => {\n   const response = evaluateAndGenerateResponse(\n     dataTreeEvaluator,\n     setupUpdateTreeResponse,\n     metaUpdates,\n     additionalPathsAddedAsUpdates,\n-    oldEvalTree,\n   );\n \n   return pushResponseToMainThread(response);\n@@ -125,7 +119,6 @@ export const evaluateAndGenerateResponse = (\n   setupUpdateTreeResponse: UpdateTreeResponse,\n   metaUpdates: EvalMetaUpdates,\n   additionalPathsAddedAsUpdates: string[],\n-  oldEvalTree: DataTree,\n ): UpdateDataTreeMessageData => {\n   // generate default response first and later add updates to it\n   const defaultResponse = getDefaultEvalResponse();\n@@ -158,7 +151,6 @@ export const evaluateAndGenerateResponse = (\n     dataTreeEvaluator.oldConfigTree,\n     unEvalUpdates,\n     [],\n-    oldEvalTree,\n   );\n \n   const dataTree = updateEvalProps(dataTreeEvaluator) || {};\ndiff --git a/app/client/src/workers/Evaluation/handlers/evalTree.ts b/app/client/src/workers/Evaluation/handlers/evalTree.ts\nindex 1d12dde5887..a26c7c50be4 100644\n--- a/app/client/src/workers/Evaluation/handlers/evalTree.ts\n+++ b/app/client/src/workers/Evaluation/handlers/evalTree.ts\n@@ -33,7 +33,6 @@ import type { CanvasWidgetsReduxState } from \"ee/reducers/entityReducers/canvasW\n import type { MetaWidgetsReduxState } from \"reducers/entityReducers/metaWidgetsReducer\";\n import type { Attributes } from \"instrumentation/types\";\n import { updateActionsToEvalTree } from \"./updateActionData\";\n-import { klona as klonaJSON } from \"klona/json\";\n \n // TODO: Fix this the next time the file is edited\n // eslint-disable-next-line @typescript-eslint/no-explicit-any\n@@ -194,7 +193,6 @@ export async function evalTree(\n       isNewTree = true;\n     } else {\n       const tree = dataTreeEvaluator.getEvalTree();\n-      const oldDataTree = klonaJSON(tree);\n \n       // during update cycles update actions to the dataTree directly\n       // this is useful in cases where we have debounced updateActionData and a regular evaluation\n@@ -243,7 +241,6 @@ export async function evalTree(\n             configTree,\n             unEvalUpdates,\n             Object.keys(metaWidgets),\n-            oldDataTree,\n           ),\n       );\n \ndiff --git a/app/client/src/workers/Evaluation/handlers/evalTrigger.ts b/app/client/src/workers/Evaluation/handlers/evalTrigger.ts\nindex 4da86703b39..992730da7b5 100644\n--- a/app/client/src/workers/Evaluation/handlers/evalTrigger.ts\n+++ b/app/client/src/workers/Evaluation/handlers/evalTrigger.ts\n@@ -2,7 +2,6 @@ import { dataTreeEvaluator } from \"./evalTree\";\n import type { EvalWorkerASyncRequest } from \"../types\";\n import ExecutionMetaData from \"../fns/utils/ExecutionMetaData\";\n import { evaluateAndPushResponse } from \"../evalTreeWithChanges\";\n-import { klona as klonaJson } from \"klona/json\";\n \n export default async function (request: EvalWorkerASyncRequest) {\n   const { data } = request;\n@@ -21,8 +20,6 @@ export default async function (request: EvalWorkerASyncRequest) {\n \n   ExecutionMetaData.setExecutionMetaData({ triggerMeta, eventType });\n \n-  const oldEvalTree = klonaJson(dataTreeEvaluator.getEvalTree());\n-\n   if (!triggerMeta.onPageLoad) {\n     const { evalOrder, unEvalUpdates } = dataTreeEvaluator.setupUpdateTree(\n       unEvalTree.unEvalTree,\n@@ -37,7 +34,6 @@ export default async function (request: EvalWorkerASyncRequest) {\n       { evalOrder, unEvalUpdates, jsUpdates: {} },\n       [],\n       [],\n-      oldEvalTree,\n     );\n   }\n \ndiff --git a/app/client/src/workers/common/DataTreeEvaluator/dataTreeEvaluator.test.ts b/app/client/src/workers/common/DataTreeEvaluator/dataTreeEvaluator.test.ts\nindex e0ad57986d3..f370792e0d1 100644\n--- a/app/client/src/workers/common/DataTreeEvaluator/dataTreeEvaluator.test.ts\n+++ b/app/client/src/workers/common/DataTreeEvaluator/dataTreeEvaluator.test.ts\n@@ -305,7 +305,6 @@ describe(\"DataTreeEvaluator\", () => {\n         configTree as unknown as ConfigTree,\n         unEvalUpdates,\n         [],\n-        dataTreeEvaluator.evalTree,\n       );\n \n       expect(dataTreeEvaluator.dependencies).toStrictEqual({\n@@ -478,7 +477,6 @@ describe(\"DataTreeEvaluator\", () => {\n             arrayAccessorCyclicDependencyConfig.apiSuccessConfigTree,\n             unEvalUpdates,\n             [],\n-            dataTreeEvaluator.evalTree,\n           );\n           expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(\n             undefined,\n@@ -503,7 +501,6 @@ describe(\"DataTreeEvaluator\", () => {\n             arrayAccessorCyclicDependencyConfig.apiFailureConfigTree,\n             unEvalUpdates2,\n             [],\n-            dataTreeEvaluator.evalTree,\n           );\n \n           expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(\n@@ -533,7 +530,6 @@ describe(\"DataTreeEvaluator\", () => {\n           arrayAccessorCyclicDependencyConfig.apiSuccessConfigTree,\n           unEvalUpdates,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n \n         // success: response -> [{...}, {...}]\n@@ -548,7 +544,6 @@ describe(\"DataTreeEvaluator\", () => {\n           arrayAccessorCyclicDependencyConfig.apiSuccessConfigTree2,\n           unEvalUpdates2,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n \n         expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(undefined);\n@@ -577,7 +572,6 @@ describe(\"DataTreeEvaluator\", () => {\n             nestedArrayAccessorCyclicDependencyConfig.apiSuccessConfigTree,\n             unEvalUpdates,\n             [],\n-            dataTreeEvaluator.evalTree,\n           );\n           expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(\n             undefined,\n@@ -605,7 +599,6 @@ describe(\"DataTreeEvaluator\", () => {\n             nestedArrayAccessorCyclicDependencyConfig.apiFailureConfigTree,\n             unEvalUpdates2,\n             [],\n-            dataTreeEvaluator.evalTree,\n           );\n           expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(\n             undefined,\n@@ -637,7 +630,6 @@ describe(\"DataTreeEvaluator\", () => {\n           nestedArrayAccessorCyclicDependencyConfig.apiSuccessConfigTree,\n           unEvalUpdates,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n \n         // success: response -> [ [{...}, {...}, {...}], [{...}, {...}, {...}] ]\n@@ -652,7 +644,6 @@ describe(\"DataTreeEvaluator\", () => {\n           nestedArrayAccessorCyclicDependencyConfig.apiSuccessConfigTree2,\n           unEvalUpdates2,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n \n         expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(undefined);\n@@ -680,7 +671,6 @@ describe(\"DataTreeEvaluator\", () => {\n           nestedArrayAccessorCyclicDependencyConfig.apiSuccessConfigTree,\n           unEvalUpdates,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n \n         // success: response -> [ [{...}, {...}, {...}], [{...}, {...}, {...}], [] ]\n@@ -695,7 +685,6 @@ describe(\"DataTreeEvaluator\", () => {\n           nestedArrayAccessorCyclicDependencyConfig.apiSuccessConfigTree3,\n           unEvalUpdates2,\n           [],\n-          dataTreeEvaluator.evalTree,\n         );\n         expect(dataTreeEvaluator.dependencies[\"Api1\"]).toStrictEqual(undefined);\n         expect(dataTreeEvaluator.dependencies[\"Api1.data\"]).toStrictEqual([]);\ndiff --git a/app/client/src/workers/common/DataTreeEvaluator/index.ts b/app/client/src/workers/common/DataTreeEvaluator/index.ts\nindex 1df173ef3ad..4ea4f13b4bf 100644\n--- a/app/client/src/workers/common/DataTreeEvaluator/index.ts\n+++ b/app/client/src/workers/common/DataTreeEvaluator/index.ts\n@@ -490,7 +490,6 @@ export default class DataTreeEvaluator {\n       evaluationOrder,\n       undefined,\n       this.oldConfigTree,\n-      {},\n     );\n \n     /**\n@@ -960,7 +959,6 @@ export default class DataTreeEvaluator {\n     configTree: ConfigTree,\n     unevalUpdates: DataTreeDiff[],\n     metaWidgetIds: string[] = [],\n-    oldEvalTree: DataTree,\n   ): {\n     evalMetaUpdates: EvalMetaUpdates;\n     staleMetaIds: string[];\n@@ -984,7 +982,6 @@ export default class DataTreeEvaluator {\n         metaWidgets: metaWidgetIds,\n       },\n       configTree,\n-      oldEvalTree,\n     );\n     const evaluationEndTime = performance.now();\n \n@@ -1127,7 +1124,6 @@ export default class DataTreeEvaluator {\n       metaWidgets: [],\n     },\n     oldConfigTree: ConfigTree,\n-    oldEvalTree: DataTree,\n   ): {\n     evaluatedTree: DataTree;\n     evalMetaUpdates: EvalMetaUpdates;\n@@ -1323,7 +1319,7 @@ export default class DataTreeEvaluator {\n         if (!propertyPath) continue;\n \n         // Get old value from oldEvalTree for comparison\n-        const oldValue = get(oldEvalTree, fullPropertyPath);\n+        const oldValue = get(this.getPrevState(), fullPropertyPath);\n \n         switch (entityType) {\n           case ENTITY_TYPE.WIDGET: {\n"}
{"instance_id": "appsmithorg__appsmith.main.41074", "repo": "appsmithorg/appsmith", "base_commit": "b4d5685d21fd757e87cde24c002b5aa79783b528", "head_commit": "8ea04e6bb1312d9f468ed3d74ccc080ed6e9bac9", "title": "feat: implements onPageUnload functionality for the edit app mode page selector", "merged_at": "2025-07-03T06:54:53Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41074", "test_files": ["app/client/src/selectors/__tests__/editorSelectors/pluginActionSelectors.test.ts"], "code_files": ["app/client/src/actions/pageActions.tsx", "app/client/src/pages/AppIDE/components/PageList/PageEntity.tsx", "app/client/src/sagas/ActionExecution/PluginActionSaga.ts", "app/client/src/selectors/editorSelectors.tsx"], "total_changes": 109, "num_files": 5, "pull_number": 41074, "patch": "diff --git a/app/client/src/actions/pageActions.tsx b/app/client/src/actions/pageActions.tsx\nindex 47aa7f95dda..f776940728c 100644\n--- a/app/client/src/actions/pageActions.tsx\n+++ b/app/client/src/actions/pageActions.tsx\n@@ -31,6 +31,7 @@ import type { ApiResponse } from \"api/ApiResponses\";\n import type { EvaluationReduxAction } from \"./EvaluationReduxActionTypes\";\n import { appsmithTelemetry } from \"instrumentation\";\n import type { NavigateToAnotherPagePayload } from \"sagas/ActionExecution/NavigateActionSaga/types\";\n+import type { Path } from \"history\";\n \n export interface FetchPageListPayload {\n   applicationId: string;\n@@ -699,7 +700,7 @@ export const setupPublishedPage = (\n });\n \n export const navigateToAnotherPage = (\n-  payload: NavigateToAnotherPagePayload,\n+  payload: NavigateToAnotherPagePayload | Path,\n ) => ({\n   type: ReduxActionTypes.NAVIGATE_TO_ANOTHER_PAGE,\n   payload,\ndiff --git a/app/client/src/pages/AppIDE/components/PageList/PageEntity.tsx b/app/client/src/pages/AppIDE/components/PageList/PageEntity.tsx\nindex fb71d77ffc7..2d0ac0ab02e 100644\n--- a/app/client/src/pages/AppIDE/components/PageList/PageEntity.tsx\n+++ b/app/client/src/pages/AppIDE/components/PageList/PageEntity.tsx\n@@ -15,11 +15,10 @@ import {\n import { PERMISSION_TYPE, isPermitted } from \"ee/utils/permissionHelpers\";\n import { getCurrentApplication } from \"ee/selectors/applicationSelectors\";\n import type { DefaultRootState } from \"react-redux\";\n-import { updatePageAction } from \"actions/pageActions\";\n+import { navigateToAnotherPage, updatePageAction } from \"actions/pageActions\";\n import { useGetPageFocusUrl } from \"./hooks/useGetPageFocusUrl\";\n import AnalyticsUtil from \"ee/utils/AnalyticsUtil\";\n import { toggleInOnboardingWidgetSelection } from \"actions/onboardingActions\";\n-import history, { NavigationMethod } from \"utils/history\";\n import { EntityItem } from \"@appsmith/ads\";\n import { useNameEditorState } from \"IDE/hooks/useNameEditorState\";\n import { useValidateEntityName } from \"IDE\";\n@@ -90,9 +89,7 @@ export const PageEntity = ({\n       toUrl: navigateToUrl,\n     });\n     dispatch(toggleInOnboardingWidgetSelection(true));\n-    history.push(navigateToUrl, {\n-      invokedBy: NavigationMethod.EntityExplorer,\n-    });\n+    dispatch(navigateToAnotherPage(navigateToUrl));\n \n     if (onClick) {\n       onClick();\ndiff --git a/app/client/src/sagas/ActionExecution/PluginActionSaga.ts b/app/client/src/sagas/ActionExecution/PluginActionSaga.ts\nindex b9856cf37b7..9d748bb7bc2 100644\n--- a/app/client/src/sagas/ActionExecution/PluginActionSaga.ts\n+++ b/app/client/src/sagas/ActionExecution/PluginActionSaga.ts\n@@ -1702,14 +1702,18 @@ export function* executePageUnloadActionsSaga() {\n   const span = startRootSpan(\"executePageUnloadActionsSaga\");\n \n   try {\n-    const pageActions: Action[] = yield select(getLayoutOnUnloadActions);\n-    const actionCount = pageActions.length;\n+    const pageOnUnloadActions: Action[] = yield select(\n+      getLayoutOnUnloadActions,\n+    );\n+    const actionCount = pageOnUnloadActions.length;\n \n     setAttributesToSpan(span, { numActions: actionCount });\n \n     // Execute unload actions in parallel batches\n     yield all(\n-      pageActions.map((action) => call(executeOnPageUnloadJSAction, action)),\n+      pageOnUnloadActions.map((action) =>\n+        call(executeOnPageUnloadJSAction, action),\n+      ),\n     );\n \n     // Publish success event after all actions are executed\ndiff --git a/app/client/src/selectors/__tests__/editorSelectors/pluginActionSelectors.test.ts b/app/client/src/selectors/__tests__/editorSelectors/pluginActionSelectors.test.ts\nnew file mode 100644\nindex 00000000000..31ddc869a9f\n--- /dev/null\n+++ b/app/client/src/selectors/__tests__/editorSelectors/pluginActionSelectors.test.ts\n@@ -0,0 +1,71 @@\n+import type { DefaultRootState } from \"react-redux\";\n+import { getLayoutOnUnloadActions } from \"selectors/editorSelectors\";\n+\n+describe(\"getLayoutOnUnloadActions\", () => {\n+  it(\"should filter actions by current page ID\", () => {\n+    const state = {\n+      entities: {\n+        pageList: { currentPageId: \"page1\" },\n+        jsActions: [\n+          {\n+            isLoading: false,\n+            config: {\n+              id: \"collection1\",\n+              pageId: \"page1\",\n+              actions: [\n+                {\n+                  id: \"action1\",\n+                  pageId: \"page1\",\n+                  runBehaviour: \"ON_PAGE_UNLOAD\",\n+                  name: \"myFun1\",\n+                  fullyQualifiedName: \"JSObject1.myFun1\",\n+                  collectionId: \"collection1\",\n+                },\n+                {\n+                  id: \"action3\",\n+                  pageId: \"page1\",\n+                  runBehaviour: \"ON_PAGE_LOAD\",\n+                  name: \"myFun2\",\n+                  fullyQualifiedName: \"JSObject1.myFun2\",\n+                  collectionId: \"collection1\",\n+                },\n+              ],\n+            },\n+          },\n+          {\n+            isLoading: false,\n+            config: {\n+              id: \"collection2\",\n+              pageId: \"page2\",\n+              actions: [\n+                {\n+                  id: \"action2\",\n+                  pageId: \"page2\",\n+                  runBehaviour: \"ON_PAGE_UNLOAD\",\n+                  name: \"myFun1\",\n+                  fullyQualifiedName: \"JSObject2.myFun1\",\n+                  collectionId: \"collection2\",\n+                },\n+              ],\n+            },\n+          },\n+        ],\n+      },\n+    };\n+\n+    const result = getLayoutOnUnloadActions(\n+      state as unknown as DefaultRootState,\n+    );\n+\n+    expect(result).toEqual([\n+      {\n+        id: \"action1\",\n+        pageId: \"page1\",\n+        runBehaviour: \"ON_PAGE_UNLOAD\",\n+        name: \"myFun1\",\n+        fullyQualifiedName: \"JSObject1.myFun1\",\n+        collectionId: \"collection1\",\n+      },\n+    ]);\n+  });\n+});\ndiff --git a/app/client/src/selectors/editorSelectors.tsx b/app/client/src/selectors/editorSelectors.tsx\nindex b220b6ab771..28614887208 100644\n--- a/app/client/src/selectors/editorSelectors.tsx\n+++ b/app/client/src/selectors/editorSelectors.tsx\n@@ -125,16 +125,21 @@ export const getPageSavingError = (state: DefaultRootState) => {\n   return state.ui.editor.loadingStates.savingError;\n };\n \n+export const getCurrentPageId = (state: DefaultRootState) =>\n+  state.entities.pageList.currentPageId;\n+\n export const getLayoutOnLoadActions = (state: DefaultRootState) =>\n   state.ui.editor.pageActions || [];\n \n export const getLayoutOnUnloadActions = createSelector(\n+  getCurrentPageId,\n   getAllJSCollectionActions,\n-  (jsActions) => {\n-    return jsActions.filter((action) => {\n-      return action.runBehaviour === ActionRunBehaviour.ON_PAGE_UNLOAD;\n-    });\n-  },\n+  (currentPageId, jsActions) =>\n+    jsActions.filter(\n+      (action) =>\n+        action.runBehaviour === ActionRunBehaviour.ON_PAGE_UNLOAD &&\n+        action.pageId === currentPageId,\n+    ),\n );\n \n export const getLayoutOnLoadIssues = (state: DefaultRootState) => {\n@@ -167,9 +172,6 @@ export const getPageByBaseId = (basePageId: string) =>\n     pages.find((page) => page.basePageId === basePageId),\n   );\n \n-export const getCurrentPageId = (state: DefaultRootState) =>\n-  state.entities.pageList.currentPageId;\n-\n export const getCurrentBasePageId = (state: DefaultRootState) =>\n   state.entities.pageList.currentBasePageId;\n \n"}
{"instance_id": "appsmithorg__appsmith.main.41060", "repo": "appsmithorg/appsmith", "base_commit": "f041ba112982a1bf21bdd5387def4b0c91f971ed", "head_commit": "f379f16bdd880788852c9799a48ca86d0ff7a430", "title": "30/06 Daily Promotion", "merged_at": "2025-06-30T09:24:13Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41060", "test_files": ["app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts"], "code_files": ["app/client/src/ce/workers/Evaluation/evaluationUtils.ts", "app/client/src/entities/DependencyMap/DependencyMapUtils.ts", "app/client/src/utils/multiOrgDomains.ts"], "total_changes": 758, "num_files": 5, "pull_number": 41060, "patch": "diff --git a/app/client/src/ce/workers/Evaluation/evaluationUtils.ts b/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\nindex 293fe0a221a..dc7e605d873 100644\n--- a/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\n+++ b/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\n@@ -29,6 +29,7 @@ import type {\n   WidgetEntity,\n   DataTreeEntityConfig,\n   WidgetEntityConfig,\n+  ActionEntityConfig,\n } from \"ee/entities/DataTree/types\";\n import type { EvalProps } from \"workers/common/DataTreeEvaluator\";\n import { validateWidgetProperty } from \"workers/common/DataTreeEvaluator/validationUtils\";\n@@ -403,6 +404,16 @@ export function isAction(\n   );\n }\n \n+export function isActionConfig(\n+  entity: DataTreeEntityConfig,\n+): entity is ActionEntityConfig {\n+  return (\n+    typeof entity === \"object\" &&\n+    \"ENTITY_TYPE\" in entity &&\n+    entity.ENTITY_TYPE === ENTITY_TYPE.ACTION\n+  );\n+}\n+\n export function isAppsmithEntity(\n   entity: DataTreeEntity,\n ): entity is AppsmithEntity {\n@@ -413,7 +424,9 @@ export function isAppsmithEntity(\n   );\n }\n \n-export function isJSAction(entity: DataTreeEntity): entity is JSActionEntity {\n+export function isJSAction(\n+  entity: Partial<DataTreeEntity>,\n+): entity is JSActionEntity {\n   return (\n     typeof entity === \"object\" &&\n     \"ENTITY_TYPE\" in entity &&\ndiff --git a/app/client/src/entities/DependencyMap/DependencyMapUtils.ts b/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\nindex 9e4cb175ad7..e8f703b9779 100644\n--- a/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\n+++ b/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\n@@ -4,9 +4,13 @@ import {\n   entityTypeCheckForPathDynamicTrigger,\n   getEntityNameAndPropertyPath,\n   IMMEDIATE_PARENT_REGEX,\n+  isActionConfig,\n+  isJSActionConfig,\n } from \"ee/workers/Evaluation/evaluationUtils\";\n import type { ConfigTree } from \"entities/DataTree/dataTreeTypes\";\n import { isPathDynamicTrigger } from \"utils/DynamicBindingUtils\";\n+import { WorkerEnv } from \"workers/Evaluation/handlers/workerEnv\";\n+import { ActionRunBehaviour } from \"PluginActionEditor/types/PluginActionTypes\";\n \n type SortDependencies =\n   | {\n@@ -23,6 +27,9 @@ export class DependencyMapUtils {\n   ): SortDependencies {\n     const dependencyTree: Array<[string, string | undefined]> = [];\n     const dependencies = dependencyMap.rawDependencies;\n+    const featureFlags = WorkerEnv.getFeatureFlags();\n+    const isReactiveActionsEnabled =\n+      featureFlags.release_reactive_actions_enabled;\n \n     for (const [node, deps] of dependencies.entries()) {\n       if (deps.size) {\n@@ -38,7 +45,7 @@ export class DependencyMapUtils {\n         .reverse()\n         .filter((edge) => !!edge);\n \n-      if (configTree) {\n+      if (configTree && isReactiveActionsEnabled) {\n         this.detectReactiveDependencyMisuse(dependencyMap, configTree);\n       }\n \n@@ -163,81 +170,86 @@ export class DependencyMapUtils {\n   ) {\n     const dependencies = dependencyMap.rawDependencies;\n \n-    // Helper function to get all transitive dependencies\n-    const getAllTransitiveDependencies = (node: string): Set<string> => {\n-      const allDeps = new Set<string>();\n-      const queue = [node];\n+    for (const node of dependencies.keys()) {\n+      const { entityName: nodeName } = getEntityNameAndPropertyPath(node);\n+      const nodeConfig = configTree[nodeName];\n \n-      while (queue.length > 0) {\n-        const current = queue.shift()!;\n-        const deps = dependencyMap.getDirectDependencies(current) || [];\n+      const isJSActionEntity = isJSActionConfig(nodeConfig);\n+      const isActionEntity = isActionConfig(nodeConfig);\n \n-        for (const dep of deps) {\n-          if (!allDeps.has(dep)) {\n-            allDeps.add(dep);\n-            queue.push(dep);\n-          }\n-        }\n+      if (isJSActionEntity) {\n+        // Only continue if at least one function is automatic\n+        const hasAutomaticFunc = Object.values(nodeConfig.meta).some(\n+          (jsFunction) =>\n+            jsFunction.runBehaviour === ActionRunBehaviour.AUTOMATIC,\n+        );\n+\n+        if (!hasAutomaticFunc) continue;\n+      } else if (isActionEntity) {\n+        // Only continue if runBehaviour is AUTOMATIC\n+        if (nodeConfig.runBehaviour !== ActionRunBehaviour.AUTOMATIC) continue;\n+      } else {\n+        // If not a JSAction, or Action, skip\n+        continue;\n       }\n \n-      return allDeps;\n-    };\n+      // For each entity, check if both .run and a .data path are present\n+      let hasRun = false;\n+      let hasData = false;\n+      let dataPath = \"\";\n+      let runPath = \"\";\n \n-    for (const [node, deps] of dependencies.entries()) {\n-      // Get all dependencies including transitive ones\n-      const allDeps = new Set<string>();\n-      const queue = Array.from(deps);\n+      const transitiveDeps = this.getAllTransitiveDependencies(\n+        dependencyMap,\n+        node,\n+      );\n \n-      while (queue.length > 0) {\n-        const dep = queue.shift()!;\n+      for (const dep of transitiveDeps) {\n+        if (this.isTriggerPath(dep, configTree)) {\n+          hasRun = true;\n+          runPath = dep;\n+        }\n \n-        if (!allDeps.has(dep)) {\n-          allDeps.add(dep);\n-          const depDeps = dependencyMap.getDirectDependencies(dep) || [];\n+        if (this.isDataPath(dep)) {\n+          hasData = true;\n+          dataPath = dep;\n+        }\n \n-          queue.push(...depDeps);\n+        if (hasRun && hasData) {\n+          throw Object.assign(\n+            new Error(\n+              `Reactive dependency misuse: '${node}' depends on both trigger path '${runPath}' and data path '${dataPath}' from the same entity. This can cause unexpected reactivity.`,\n+            ),\n+            { node, triggerPath: runPath, dataPath },\n+          );\n         }\n       }\n+    }\n+  }\n \n-      // Separate dependencies into trigger paths and data paths\n-      const triggerPaths = Array.from(deps).filter((dep) =>\n-        this.isTriggerPath(dep, configTree),\n-      );\n-      const dataPaths = Array.from(deps).filter((dep) => this.isDataPath(dep));\n-\n-      // For each trigger path, check if there's a data path from the same entity\n-      for (const triggerPath of triggerPaths) {\n-        const triggerEntity = triggerPath.split(\".\")[0];\n-\n-        // Find data paths from the same entity\n-        const sameEntityDataPaths = dataPaths.filter((dataPath) => {\n-          const dataEntity = dataPath.split(\".\")[0];\n-\n-          return dataEntity === triggerEntity;\n-        });\n-\n-        if (sameEntityDataPaths.length > 0) {\n-          // Check if any of these data paths depend on the trigger path (directly or indirectly)\n-          for (const dataPath of sameEntityDataPaths) {\n-            const dataPathTransitiveDeps =\n-              getAllTransitiveDependencies(dataPath);\n-\n-            if (dataPathTransitiveDeps.has(triggerPath)) {\n-              const error = new Error(\n-                `Reactive dependency misuse: '${node}' depends on both trigger path '${triggerPath}' and data path '${dataPath}' from the same entity, and '${dataPath}' depends on '${triggerPath}' (directly or indirectly). This can cause unexpected reactivity.`,\n-              );\n-\n-              // Add custom properties\n-              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n-              // @ts-ignore\n-              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-              (error as any).node = node;\n-\n-              throw error;\n-            }\n-          }\n+  /**\n+   * Returns all transitive dependencies (direct and indirect, no duplicates) for a given node.\n+   */\n+  static getAllTransitiveDependencies(\n+    dependencyMap: DependencyMap,\n+    node: string,\n+  ): string[] {\n+    const dependencies = dependencyMap.rawDependencies;\n+    const visited = new Set<string>();\n+\n+    function traverse(current: string) {\n+      const directDeps = dependencies.get(current) || new Set<string>();\n+\n+      for (const dep of directDeps) {\n+        if (!visited.has(dep)) {\n+          visited.add(dep);\n+          traverse(dep);\n         }\n       }\n     }\n+\n+    traverse(node);\n+\n+    return Array.from(visited);\n   }\n }\ndiff --git a/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts b/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts\nnew file mode 100644\nindex 00000000000..74fa30cf7e7\n--- /dev/null\n+++ b/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts\n@@ -0,0 +1,337 @@\n+import DependencyMap from \"../index\";\n+import { DependencyMapUtils } from \"../DependencyMapUtils\";\n+import { PluginType } from \"entities/Plugin\";\n+import {\n+  ENTITY_TYPE,\n+  type DataTreeEntityConfig,\n+  type MetaArgs,\n+} from \"ee/entities/DataTree/types\";\n+import type { ActionRunBehaviourType } from \"PluginActionEditor/types/PluginActionTypes\";\n+\n+describe(\"detectReactiveDependencyMisuse\", () => {\n+  function makeConfigTreeWithAction(\n+    entityName: string,\n+    runBehaviour: ActionRunBehaviourType = \"AUTOMATIC\",\n+  ): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.ACTION,\n+      dynamicTriggerPathList: [{ key: \"run\" }],\n+      dynamicBindingPathList: [],\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      dependencyMap: {},\n+      logBlackList: {},\n+      pluginType: PluginType.API,\n+      pluginId: \"mockPluginId\",\n+      actionId: \"mockActionId\",\n+      name: entityName,\n+      runBehaviour,\n+    };\n+  }\n+\n+  function makeConfigTreeWithJSAction(\n+    entityName: string,\n+    meta: Record<string, MetaArgs> = {},\n+  ): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.JSACTION,\n+      meta,\n+      dynamicBindingPathList: [],\n+      actionNames: new Set([\"myFun1\", \"myFun2\"]),\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      dependencyMap: {},\n+      pluginType: PluginType.JS,\n+      name: entityName,\n+      actionId: \"mockJSActionId\",\n+      dynamicTriggerPathList: [],\n+      variables: [],\n+    };\n+  }\n+\n+  function makeConfigTreeWithWidget(entityName: string): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.WIDGET,\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      triggerPaths: {},\n+      validationPaths: {},\n+      logBlackList: {},\n+      propertyOverrideDependency: {},\n+      overridingPropertyPaths: {},\n+      privateWidgets: {},\n+      widgetId: \"mockWidgetId\",\n+      defaultMetaProps: [],\n+      type: \"MOCK_WIDGET_TYPE\",\n+      dynamicBindingPathList: [],\n+      name: entityName,\n+    };\n+  }\n+\n+  it(\"does not throw for Widget entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      Widget1: true,\n+      \"Widget1.run\": true,\n+      \"Widget1.data\": true,\n+    });\n+    dependencyMap.addDependency(\"Widget1\", [\"Widget1.run\", \"Widget1.data\"]);\n+    const configTree = {\n+      Widget1: makeConfigTreeWithWidget(\"Widget1\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw for MANUAL ACTION entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"Query3.run\": true,\n+      \"Query3.data\": true,\n+    });\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"Query3.run\",\n+      \"Query3.data\",\n+    ]);\n+    const configTree = {\n+      Query3: makeConfigTreeWithAction(\"Query3\", \"MANUAL\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw for JSAction entity with no AUTOMATIC function\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+\n+    // meta has no AUTOMATIC runBehaviour\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"AUTOMATIC\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw if a node depends only on .run or only on .data for AUTOMATIC ACTION\", () => {\n+    const configTree = {\n+      Api1: makeConfigTreeWithAction(\"Api1\", \"AUTOMATIC\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      JSObject2: makeConfigTreeWithJSAction(\"JSObject2\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    // Only .run\n+    const depMapRun = new DependencyMap();\n+\n+    depMapRun.addNodes({ \"JSObject1.myFun1\": true, \"Api1.run\": true });\n+    depMapRun.addDependency(\"JSObject1.myFun1\", [\"Api1.run\"]);\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(depMapRun, configTree);\n+    }).not.toThrow();\n+\n+    // Only .data\n+    const depMapData = new DependencyMap();\n+\n+    depMapData.addNodes({ \"JSObject2.myFun1\": true, \"Api1.data\": true });\n+    depMapData.addDependency(\"JSObject2.myFun1\", [\"Api1.data\"]);\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(depMapData, configTree);\n+    }).not.toThrow();\n+  });\n+\n+  it(\"throws if a node depends on both .run and .data of the same AUTOMATIC ACTION entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    // Add nodes\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"Query1.run\": true,\n+      \"Query1.data\": true,\n+    });\n+    // JSObject1.myFun1 depends on both Query1.run and Query1.data\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"Query1.run\",\n+      \"Query1.data\",\n+    ]);\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query1: makeConfigTreeWithAction(\"Query1\", \"AUTOMATIC\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+\n+  it(\"throws if a node depends on both .run and .data of the same AUTOMATIC ACTION entity via transitive dependency\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+    const configTree = {\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"AUTOMATIC\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+\n+  it(\"throws for JSAction entity with at least one AUTOMATIC function\", () => {\n+    // meta has one AUTOMATIC runBehaviour\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"MANUAL\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+});\ndiff --git a/app/client/src/utils/multiOrgDomains.ts b/app/client/src/utils/multiOrgDomains.ts\nindex 82e271370d4..05b671df609 100644\n--- a/app/client/src/utils/multiOrgDomains.ts\n+++ b/app/client/src/utils/multiOrgDomains.ts\n@@ -16,6 +16,7 @@ function isValidAppsmithDomain(domain: string): boolean {\n     domain.endsWith(\".appsmith.com\") &&\n     !domain.startsWith(\"login.\") &&\n     !domain.startsWith(\"release.\") &&\n+    !domain.startsWith(\"app.\") &&\n     !domain.startsWith(\"dev.\")\n   );\n }\ndiff --git a/app/client/yarn.lock b/app/client/yarn.lock\nindex 53edf6bc76f..87bd38ab6e6 100644\n--- a/app/client/yarn.lock\n+++ b/app/client/yarn.lock\n@@ -14386,10 +14386,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"available-typed-arrays@npm:^1.0.5\":\n-  version: 1.0.5\n-  resolution: \"available-typed-arrays@npm:1.0.5\"\n-  checksum: 20eb47b3cefd7db027b9bbb993c658abd36d4edd3fe1060e83699a03ee275b0c9b216cc076ff3f2db29073225fb70e7613987af14269ac1fe2a19803ccc97f1a\n+\"available-typed-arrays@npm:^1.0.5, available-typed-arrays@npm:^1.0.7\":\n+  version: 1.0.7\n+  resolution: \"available-typed-arrays@npm:1.0.7\"\n+  dependencies:\n+    possible-typed-array-names: ^1.0.0\n+  checksum: 1aa3ffbfe6578276996de660848b6e95669d9a95ad149e3dd0c0cda77db6ee1dbd9d1dd723b65b6d277b882dd0c4b91a654ae9d3cf9e1254b7e93e4908d78fd3\n   languageName: node\n   linkType: hard\n \n@@ -15415,16 +15417,35 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"call-bind@npm:^1.0.2, call-bind@npm:^1.0.7\":\n-  version: 1.0.7\n-  resolution: \"call-bind@npm:1.0.7\"\n+\"call-bind-apply-helpers@npm:^1.0.0, call-bind-apply-helpers@npm:^1.0.1, call-bind-apply-helpers@npm:^1.0.2\":\n+  version: 1.0.2\n+  resolution: \"call-bind-apply-helpers@npm:1.0.2\"\n   dependencies:\n-    es-define-property: ^1.0.0\n     es-errors: ^1.3.0\n     function-bind: ^1.1.2\n+  checksum: b2863d74fcf2a6948221f65d95b91b4b2d90cfe8927650b506141e669f7d5de65cea191bf788838bc40d13846b7886c5bc5c84ab96c3adbcf88ad69a72fcdc6b\n+  languageName: node\n+  linkType: hard\n+\n+\"call-bind@npm:^1.0.2, call-bind@npm:^1.0.7, call-bind@npm:^1.0.8\":\n+  version: 1.0.8\n+  resolution: \"call-bind@npm:1.0.8\"\n+  dependencies:\n+    call-bind-apply-helpers: ^1.0.0\n+    es-define-property: ^1.0.0\n     get-intrinsic: ^1.2.4\n-    set-function-length: ^1.2.1\n-  checksum: 295c0c62b90dd6522e6db3b0ab1ce26bdf9e7404215bda13cfee25b626b5ff1a7761324d58d38b1ef1607fc65aca2d06e44d2e18d0dfc6c14b465b00d8660029\n+    set-function-length: ^1.2.2\n+  checksum: aa2899bce917a5392fd73bd32e71799c37c0b7ab454e0ed13af7f6727549091182aade8bbb7b55f304a5bc436d543241c14090fb8a3137e9875e23f444f4f5a9\n+  languageName: node\n+  linkType: hard\n+\n+\"call-bound@npm:^1.0.3, call-bound@npm:^1.0.4\":\n+  version: 1.0.4\n+  resolution: \"call-bound@npm:1.0.4\"\n+  dependencies:\n+    call-bind-apply-helpers: ^1.0.2\n+    get-intrinsic: ^1.3.0\n+  checksum: 2f6399488d1c272f56306ca60ff696575e2b7f31daf23bc11574798c84d9f2759dceb0cb1f471a85b77f28962a7ac6411f51d283ea2e45319009a19b6ccab3b2\n   languageName: node\n   linkType: hard\n \n@@ -16526,7 +16547,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"create-hash@npm:^1.1.0, create-hash@npm:^1.1.2, create-hash@npm:^1.2.0\":\n+\"create-hash@npm:^1.1.0, create-hash@npm:^1.2.0\":\n   version: 1.2.0\n   resolution: \"create-hash@npm:1.2.0\"\n   dependencies:\n@@ -16539,7 +16560,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"create-hmac@npm:^1.1.4, create-hmac@npm:^1.1.7\":\n+\"create-hash@npm:~1.1.3\":\n+  version: 1.1.3\n+  resolution: \"create-hash@npm:1.1.3\"\n+  dependencies:\n+    cipher-base: ^1.0.1\n+    inherits: ^2.0.1\n+    ripemd160: ^2.0.0\n+    sha.js: ^2.4.0\n+  checksum: 8d7d9bade6ab432f22737bf6f584155bab26d11b5abd98214034dda1e087bd2c395595f6729751b94d37f95f737dddffeb2db198bbbd5717a125906756ed3012\n+  languageName: node\n+  linkType: hard\n+\n+\"create-hmac@npm:^1.1.7\":\n   version: 1.1.7\n   resolution: \"create-hmac@npm:1.1.7\"\n   dependencies:\n@@ -18125,6 +18158,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"dunder-proto@npm:^1.0.1\":\n+  version: 1.0.1\n+  resolution: \"dunder-proto@npm:1.0.1\"\n+  dependencies:\n+    call-bind-apply-helpers: ^1.0.1\n+    es-errors: ^1.3.0\n+    gopd: ^1.2.0\n+  checksum: 149207e36f07bd4941921b0ca929e3a28f1da7bd6b6ff8ff7f4e2f2e460675af4576eeba359c635723dc189b64cdd4787e0255897d5b135ccc5d15cb8685fc90\n+  languageName: node\n+  linkType: hard\n+\n \"duplexer2@npm:^0.1.2, duplexer2@npm:~0.1.0, duplexer2@npm:~0.1.2\":\n   version: 0.1.4\n   resolution: \"duplexer2@npm:0.1.4\"\n@@ -18471,12 +18515,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"es-define-property@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"es-define-property@npm:1.0.0\"\n-  dependencies:\n-    get-intrinsic: ^1.2.4\n-  checksum: f66ece0a887b6dca71848fa71f70461357c0e4e7249696f81bad0a1f347eed7b31262af4a29f5d726dc026426f085483b6b90301855e647aa8e21936f07293c6\n+\"es-define-property@npm:^1.0.0, es-define-property@npm:^1.0.1\":\n+  version: 1.0.1\n+  resolution: \"es-define-property@npm:1.0.1\"\n+  checksum: 0512f4e5d564021c9e3a644437b0155af2679d10d80f21adaf868e64d30efdfbd321631956f20f42d655fedb2e3a027da479fad3fa6048f768eb453a80a5f80a\n   languageName: node\n   linkType: hard\n \n@@ -18533,6 +18575,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"es-object-atoms@npm:^1.0.0, es-object-atoms@npm:^1.1.1\":\n+  version: 1.1.1\n+  resolution: \"es-object-atoms@npm:1.1.1\"\n+  dependencies:\n+    es-errors: ^1.3.0\n+  checksum: 214d3767287b12f36d3d7267ef342bbbe1e89f899cfd67040309fc65032372a8e60201410a99a1645f2f90c1912c8c49c8668066f6bdd954bcd614dda2e3da97\n+  languageName: node\n+  linkType: hard\n+\n \"es-set-tostringtag@npm:^2.0.1\":\n   version: 2.0.1\n   resolution: \"es-set-tostringtag@npm:2.0.1\"\n@@ -20049,12 +20100,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"for-each@npm:^0.3.3\":\n-  version: 0.3.3\n-  resolution: \"for-each@npm:0.3.3\"\n+\"for-each@npm:^0.3.3, for-each@npm:^0.3.5\":\n+  version: 0.3.5\n+  resolution: \"for-each@npm:0.3.5\"\n   dependencies:\n-    is-callable: ^1.1.3\n-  checksum: 6c48ff2bc63362319c65e2edca4a8e1e3483a2fabc72fbe7feaf8c73db94fc7861bd53bc02c8a66a0c1dd709da6b04eec42e0abdd6b40ce47305ae92a25e5d28\n+    is-callable: ^1.2.7\n+  checksum: 3c986d7e11f4381237cc98baa0a2f87eabe74719eee65ed7bed275163082b940ede19268c61d04c6260e0215983b12f8d885e3c8f9aa8c2113bf07c37051745c\n   languageName: node\n   linkType: hard\n \n@@ -20488,16 +20539,21 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"get-intrinsic@npm:^1.1.1, get-intrinsic@npm:^1.1.3, get-intrinsic@npm:^1.2.0, get-intrinsic@npm:^1.2.1, get-intrinsic@npm:^1.2.4\":\n-  version: 1.2.4\n-  resolution: \"get-intrinsic@npm:1.2.4\"\n+\"get-intrinsic@npm:^1.1.1, get-intrinsic@npm:^1.1.3, get-intrinsic@npm:^1.2.0, get-intrinsic@npm:^1.2.1, get-intrinsic@npm:^1.2.4, get-intrinsic@npm:^1.3.0\":\n+  version: 1.3.0\n+  resolution: \"get-intrinsic@npm:1.3.0\"\n   dependencies:\n+    call-bind-apply-helpers: ^1.0.2\n+    es-define-property: ^1.0.1\n     es-errors: ^1.3.0\n+    es-object-atoms: ^1.1.1\n     function-bind: ^1.1.2\n-    has-proto: ^1.0.1\n-    has-symbols: ^1.0.3\n-    hasown: ^2.0.0\n-  checksum: 414e3cdf2c203d1b9d7d33111df746a4512a1aa622770b361dadddf8ed0b5aeb26c560f49ca077e24bfafb0acb55ca908d1f709216ccba33ffc548ec8a79a951\n+    get-proto: ^1.0.1\n+    gopd: ^1.2.0\n+    has-symbols: ^1.1.0\n+    hasown: ^2.0.2\n+    math-intrinsics: ^1.1.0\n+  checksum: 301008e4482bb9a9cb49e132b88fee093bff373b4e6def8ba219b1e96b60158a6084f273ef5cafe832e42cd93462f4accb46a618d35fe59a2b507f2388c5b79d\n   languageName: node\n   linkType: hard\n \n@@ -20522,6 +20578,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"get-proto@npm:^1.0.1\":\n+  version: 1.0.1\n+  resolution: \"get-proto@npm:1.0.1\"\n+  dependencies:\n+    dunder-proto: ^1.0.1\n+    es-object-atoms: ^1.0.0\n+  checksum: 4fc96afdb58ced9a67558698b91433e6b037aaa6f1493af77498d7c85b141382cf223c0e5946f334fb328ee85dfe6edd06d218eaf09556f4bc4ec6005d7f5f7b\n+  languageName: node\n+  linkType: hard\n+\n \"get-stdin@npm:^5.0.1\":\n   version: 5.0.1\n   resolution: \"get-stdin@npm:5.0.1\"\n@@ -20847,12 +20913,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"gopd@npm:^1.0.1\":\n-  version: 1.0.1\n-  resolution: \"gopd@npm:1.0.1\"\n-  dependencies:\n-    get-intrinsic: ^1.1.3\n-  checksum: a5ccfb8806e0917a94e0b3de2af2ea4979c1da920bc381667c260e00e7cafdbe844e2cb9c5bcfef4e5412e8bf73bab837285bc35c7ba73aaaf0134d4583393a6\n+\"gopd@npm:^1.0.1, gopd@npm:^1.2.0\":\n+  version: 1.2.0\n+  resolution: \"gopd@npm:1.2.0\"\n+  checksum: cc6d8e655e360955bdccaca51a12a474268f95bb793fc3e1f2bdadb075f28bfd1fd988dab872daf77a61d78cbaf13744bc8727a17cfb1d150d76047d805375f3\n   languageName: node\n   linkType: hard\n \n@@ -20997,19 +21061,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"has-symbols@npm:^1.0.1, has-symbols@npm:^1.0.2, has-symbols@npm:^1.0.3\":\n-  version: 1.0.3\n-  resolution: \"has-symbols@npm:1.0.3\"\n-  checksum: a054c40c631c0d5741a8285010a0777ea0c068f99ed43e5d6eb12972da223f8af553a455132fdb0801bdcfa0e0f443c0c03a68d8555aa529b3144b446c3f2410\n+\"has-symbols@npm:^1.0.1, has-symbols@npm:^1.0.3, has-symbols@npm:^1.1.0\":\n+  version: 1.1.0\n+  resolution: \"has-symbols@npm:1.1.0\"\n+  checksum: b2316c7302a0e8ba3aaba215f834e96c22c86f192e7310bdf689dd0e6999510c89b00fbc5742571507cebf25764d68c988b3a0da217369a73596191ac0ce694b\n   languageName: node\n   linkType: hard\n \n-\"has-tostringtag@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"has-tostringtag@npm:1.0.0\"\n+\"has-tostringtag@npm:^1.0.0, has-tostringtag@npm:^1.0.2\":\n+  version: 1.0.2\n+  resolution: \"has-tostringtag@npm:1.0.2\"\n   dependencies:\n-    has-symbols: ^1.0.2\n-  checksum: cc12eb28cb6ae22369ebaad3a8ab0799ed61270991be88f208d508076a1e99abe4198c965935ce85ea90b60c94ddda73693b0920b58e7ead048b4a391b502c1c\n+    has-symbols: ^1.0.3\n+  checksum: 999d60bb753ad714356b2c6c87b7fb74f32463b8426e159397da4bde5bca7e598ab1073f4d8d4deafac297f2eb311484cd177af242776bf05f0d11565680468d\n   languageName: node\n   linkType: hard\n \n@@ -21029,6 +21093,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"hash-base@npm:^2.0.0\":\n+  version: 2.0.2\n+  resolution: \"hash-base@npm:2.0.2\"\n+  dependencies:\n+    inherits: ^2.0.1\n+  checksum: e39f3f2bb91679ed350bd2eb81035acb1e1e6e9bb86d9f1197fcfdc3cf39a2c56bf82a1870f000fae651477883b4c107fd6ac0c640a18ab06298b87c39939396\n+  languageName: node\n+  linkType: hard\n+\n \"hash-base@npm:^3.0.0\":\n   version: 3.1.0\n   resolution: \"hash-base@npm:3.1.0\"\n@@ -21070,7 +21143,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"hasown@npm:^2.0.0\":\n+\"hasown@npm:^2.0.2\":\n   version: 2.0.2\n   resolution: \"hasown@npm:2.0.2\"\n   dependencies:\n@@ -22128,7 +22201,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-callable@npm:^1.1.3, is-callable@npm:^1.1.4, is-callable@npm:^1.2.7\":\n+\"is-callable@npm:^1.1.4, is-callable@npm:^1.2.7\":\n   version: 1.2.7\n   resolution: \"is-callable@npm:1.2.7\"\n   checksum: 61fd57d03b0d984e2ed3720fb1c7a897827ea174bd44402878e059542ea8c4aeedee0ea0985998aa5cc2736b2fa6e271c08587addb5b3959ac52cf665173d1ac\n@@ -22534,12 +22607,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-typed-array@npm:^1.1.10, is-typed-array@npm:^1.1.12, is-typed-array@npm:^1.1.3, is-typed-array@npm:^1.1.9\":\n-  version: 1.1.12\n-  resolution: \"is-typed-array@npm:1.1.12\"\n+\"is-typed-array@npm:^1.1.10, is-typed-array@npm:^1.1.12, is-typed-array@npm:^1.1.14, is-typed-array@npm:^1.1.3, is-typed-array@npm:^1.1.9\":\n+  version: 1.1.15\n+  resolution: \"is-typed-array@npm:1.1.15\"\n   dependencies:\n-    which-typed-array: ^1.1.11\n-  checksum: 4c89c4a3be07186caddadf92197b17fda663a9d259ea0d44a85f171558270d36059d1c386d34a12cba22dfade5aba497ce22778e866adc9406098c8fc4771796\n+    which-typed-array: ^1.1.16\n+  checksum: ea7cfc46c282f805d19a9ab2084fd4542fed99219ee9dbfbc26284728bd713a51eac66daa74eca00ae0a43b61322920ba334793607dc39907465913e921e0892\n   languageName: node\n   linkType: hard\n \n@@ -24793,6 +24866,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"math-intrinsics@npm:^1.1.0\":\n+  version: 1.1.0\n+  resolution: \"math-intrinsics@npm:1.1.0\"\n+  checksum: 0e513b29d120f478c85a70f49da0b8b19bc638975eca466f2eeae0071f3ad00454c621bf66e16dd435896c208e719fc91ad79bbfba4e400fe0b372e7c1c9c9a2\n+  languageName: node\n+  linkType: hard\n+\n \"math-log2@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"math-log2@npm:1.0.1\"\n@@ -27378,15 +27458,16 @@ __metadata:\n   linkType: hard\n \n \"pbkdf2@npm:^3.1.2\":\n-  version: 3.1.2\n-  resolution: \"pbkdf2@npm:3.1.2\"\n+  version: 3.1.3\n+  resolution: \"pbkdf2@npm:3.1.3\"\n   dependencies:\n-    create-hash: ^1.1.2\n-    create-hmac: ^1.1.4\n-    ripemd160: ^2.0.1\n-    safe-buffer: ^5.0.1\n-    sha.js: ^2.4.8\n-  checksum: 2c950a100b1da72123449208e231afc188d980177d021d7121e96a2de7f2abbc96ead2b87d03d8fe5c318face097f203270d7e27908af9f471c165a4e8e69c92\n+    create-hash: ~1.1.3\n+    create-hmac: ^1.1.7\n+    ripemd160: =2.0.1\n+    safe-buffer: ^5.2.1\n+    sha.js: ^2.4.11\n+    to-buffer: ^1.2.0\n+  checksum: afd1ec13044343ad877065b806d5b4d7625806139d22bec46cb146d1d52bb8debf4200767e33672b681e024307048e558a16f5997d86838d95552b88fa546530\n   languageName: node\n   linkType: hard\n \n@@ -27696,6 +27777,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"possible-typed-array-names@npm:^1.0.0\":\n+  version: 1.1.0\n+  resolution: \"possible-typed-array-names@npm:1.1.0\"\n+  checksum: cfcd4f05264eee8fd184cd4897a17890561d1d473434b43ab66ad3673d9c9128981ec01e0cb1d65a52cd6b1eebfb2eae1e53e39b2e0eca86afc823ede7a4f41b\n+  languageName: node\n+  linkType: hard\n+\n \"postcss-at-rules-variables@npm:^0.3.0\":\n   version: 0.3.0\n   resolution: \"postcss-at-rules-variables@npm:0.3.0\"\n@@ -31205,6 +31293,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"ripemd160@npm:=2.0.1\":\n+  version: 2.0.1\n+  resolution: \"ripemd160@npm:2.0.1\"\n+  dependencies:\n+    hash-base: ^2.0.0\n+    inherits: ^2.0.1\n+  checksum: 865bcb4be1f04762c4afc9375f9172c326bed7057f388913512850493c22af9092efe21d7a488ec25665530333a1900f2f81d39b3fdfcc37a39f97b8f4ce13d0\n+  languageName: node\n+  linkType: hard\n+\n \"ripemd160@npm:^2.0.0, ripemd160@npm:^2.0.1\":\n   version: 2.0.2\n   resolution: \"ripemd160@npm:2.0.2\"\n@@ -31807,7 +31905,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"set-function-length@npm:^1.2.1\":\n+\"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n   dependencies:\n@@ -31853,7 +31951,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"sha.js@npm:^2.4.0, sha.js@npm:^2.4.8, sha.js@npm:~2.4.4\":\n+\"sha.js@npm:^2.4.0, sha.js@npm:^2.4.11, sha.js@npm:^2.4.8, sha.js@npm:~2.4.4\":\n   version: 2.4.11\n   resolution: \"sha.js@npm:2.4.11\"\n   dependencies:\n@@ -33556,6 +33654,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"to-buffer@npm:^1.2.0\":\n+  version: 1.2.1\n+  resolution: \"to-buffer@npm:1.2.1\"\n+  dependencies:\n+    isarray: ^2.0.5\n+    safe-buffer: ^5.2.1\n+    typed-array-buffer: ^1.0.3\n+  checksum: a683dcf19bea02ed6af477513248d514b7590641170c2d64dd2b235bd9896193b0aea5f46ab64f50b787562aafce421569db6e44230b95beb8fb675a9169464b\n+  languageName: node\n+  linkType: hard\n+\n \"to-camel-case@npm:1.0.0\":\n   version: 1.0.0\n   resolution: \"to-camel-case@npm:1.0.0\"\n@@ -34043,14 +34152,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"typed-array-buffer@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"typed-array-buffer@npm:1.0.0\"\n+\"typed-array-buffer@npm:^1.0.0, typed-array-buffer@npm:^1.0.3\":\n+  version: 1.0.3\n+  resolution: \"typed-array-buffer@npm:1.0.3\"\n   dependencies:\n-    call-bind: ^1.0.2\n-    get-intrinsic: ^1.2.1\n-    is-typed-array: ^1.1.10\n-  checksum: 3e0281c79b2a40cd97fe715db803884301993f4e8c18e8d79d75fd18f796e8cd203310fec8c7fdb5e6c09bedf0af4f6ab8b75eb3d3a85da69328f28a80456bd3\n+    call-bound: ^1.0.3\n+    es-errors: ^1.3.0\n+    is-typed-array: ^1.1.14\n+  checksum: 3fb91f0735fb413b2bbaaca9fabe7b8fc14a3fa5a5a7546bab8a57e755be0e3788d893195ad9c2b842620592de0e68d4c077d4c2c41f04ec25b8b5bb82fa9a80\n   languageName: node\n   linkType: hard\n \n@@ -35364,16 +35473,18 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"which-typed-array@npm:^1.1.11, which-typed-array@npm:^1.1.2, which-typed-array@npm:^1.1.9\":\n-  version: 1.1.11\n-  resolution: \"which-typed-array@npm:1.1.11\"\n+\"which-typed-array@npm:^1.1.11, which-typed-array@npm:^1.1.16, which-typed-array@npm:^1.1.2, which-typed-array@npm:^1.1.9\":\n+  version: 1.1.19\n+  resolution: \"which-typed-array@npm:1.1.19\"\n   dependencies:\n-    available-typed-arrays: ^1.0.5\n-    call-bind: ^1.0.2\n-    for-each: ^0.3.3\n-    gopd: ^1.0.1\n-    has-tostringtag: ^1.0.0\n-  checksum: 711ffc8ef891ca6597b19539075ec3e08bb9b4c2ca1f78887e3c07a977ab91ac1421940505a197758fb5939aa9524976d0a5bbcac34d07ed6faa75cedbb17206\n+    available-typed-arrays: ^1.0.7\n+    call-bind: ^1.0.8\n+    call-bound: ^1.0.4\n+    for-each: ^0.3.5\n+    get-proto: ^1.0.1\n+    gopd: ^1.2.0\n+    has-tostringtag: ^1.0.2\n+  checksum: 162d2a07f68ea323f88ed9419861487ce5d02cb876f2cf9dd1e428d04a63133f93a54f89308f337b27cabd312ee3d027cae4a79002b2f0a85b79b9ef4c190670\n   languageName: node\n   linkType: hard\n \n"}
{"instance_id": "appsmithorg__appsmith.main.41049", "repo": "appsmithorg/appsmith", "base_commit": "7bcd86d87f161926ac10547fbaec993d8ae9355a", "head_commit": "05c9f6481e464dc802b2b556a0eba48c66cc3030", "title": "fix: Updating the function definition for checking reactive cyclic dependencies", "merged_at": "2025-06-27T11:16:45Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41049", "test_files": ["app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts"], "code_files": ["app/client/src/ce/workers/Evaluation/evaluationUtils.ts", "app/client/src/entities/DependencyMap/DependencyMapUtils.ts"], "total_changes": 484, "num_files": 3, "pull_number": 41049, "patch": "diff --git a/app/client/src/ce/workers/Evaluation/evaluationUtils.ts b/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\nindex 293fe0a221a..443fbb318c0 100644\n--- a/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\n+++ b/app/client/src/ce/workers/Evaluation/evaluationUtils.ts\n@@ -413,7 +413,9 @@ export function isAppsmithEntity(\n   );\n }\n \n-export function isJSAction(entity: DataTreeEntity): entity is JSActionEntity {\n+export function isJSAction(\n+  entity: Partial<DataTreeEntity>,\n+): entity is JSActionEntity {\n   return (\n     typeof entity === \"object\" &&\n     \"ENTITY_TYPE\" in entity &&\ndiff --git a/app/client/src/entities/DependencyMap/DependencyMapUtils.ts b/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\nindex 9e4cb175ad7..933343f9e24 100644\n--- a/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\n+++ b/app/client/src/entities/DependencyMap/DependencyMapUtils.ts\n@@ -4,9 +4,13 @@ import {\n   entityTypeCheckForPathDynamicTrigger,\n   getEntityNameAndPropertyPath,\n   IMMEDIATE_PARENT_REGEX,\n+  isAction,\n+  isJSAction,\n } from \"ee/workers/Evaluation/evaluationUtils\";\n import type { ConfigTree } from \"entities/DataTree/dataTreeTypes\";\n import { isPathDynamicTrigger } from \"utils/DynamicBindingUtils\";\n+import { WorkerEnv } from \"workers/Evaluation/handlers/workerEnv\";\n+import { ActionRunBehaviour } from \"PluginActionEditor/types/PluginActionTypes\";\n \n type SortDependencies =\n   | {\n@@ -23,6 +27,9 @@ export class DependencyMapUtils {\n   ): SortDependencies {\n     const dependencyTree: Array<[string, string | undefined]> = [];\n     const dependencies = dependencyMap.rawDependencies;\n+    const featureFlags = WorkerEnv.getFeatureFlags();\n+    const isReactiveActionsEnabled =\n+      featureFlags.release_reactive_actions_enabled;\n \n     for (const [node, deps] of dependencies.entries()) {\n       if (deps.size) {\n@@ -38,7 +45,7 @@ export class DependencyMapUtils {\n         .reverse()\n         .filter((edge) => !!edge);\n \n-      if (configTree) {\n+      if (configTree && isReactiveActionsEnabled) {\n         this.detectReactiveDependencyMisuse(dependencyMap, configTree);\n       }\n \n@@ -163,81 +170,91 @@ export class DependencyMapUtils {\n   ) {\n     const dependencies = dependencyMap.rawDependencies;\n \n-    // Helper function to get all transitive dependencies\n-    const getAllTransitiveDependencies = (node: string): Set<string> => {\n-      const allDeps = new Set<string>();\n-      const queue = [node];\n+    for (const node of dependencies.keys()) {\n+      const { entityName: nodeName } = getEntityNameAndPropertyPath(node);\n+      const nodeConfig = configTree[nodeName];\n \n-      while (queue.length > 0) {\n-        const current = queue.shift()!;\n-        const deps = dependencyMap.getDirectDependencies(current) || [];\n+      const isJSActionEntity = isJSAction(nodeConfig);\n+      const isActionEntity = isAction(nodeConfig);\n \n-        for (const dep of deps) {\n-          if (!allDeps.has(dep)) {\n-            allDeps.add(dep);\n-            queue.push(dep);\n-          }\n-        }\n+      if (isJSActionEntity) {\n+        // Only continue if at least one function is automatic\n+        const hasAutomaticFunc = Object.values(nodeConfig.meta).some(\n+          (jsFunction) =>\n+            jsFunction.runBehaviour === ActionRunBehaviour.AUTOMATIC,\n+        );\n+\n+        if (!hasAutomaticFunc) continue;\n+      } else if (isActionEntity) {\n+        // Only continue if runBehaviour is AUTOMATIC\n+        if (nodeConfig.runBehaviour !== ActionRunBehaviour.AUTOMATIC) continue;\n+      } else {\n+        // If not a JSAction, or Action, skip\n+        continue;\n       }\n \n-      return allDeps;\n-    };\n+      // For each entity, check if both .run and a .data path are present\n+      let hasRun = false;\n+      let hasData = false;\n+      let dataPath = \"\";\n+      let runPath = \"\";\n \n-    for (const [node, deps] of dependencies.entries()) {\n-      // Get all dependencies including transitive ones\n-      const allDeps = new Set<string>();\n-      const queue = Array.from(deps);\n+      const transitiveDeps = this.getAllTransitiveDependencies(\n+        dependencyMap,\n+        node,\n+      );\n \n-      while (queue.length > 0) {\n-        const dep = queue.shift()!;\n+      for (const dep of transitiveDeps) {\n+        const { entityName } = getEntityNameAndPropertyPath(dep);\n+        const entityConfig = configTree[entityName];\n \n-        if (!allDeps.has(dep)) {\n-          allDeps.add(dep);\n-          const depDeps = dependencyMap.getDirectDependencies(dep) || [];\n+        if (entityConfig && entityConfig.ENTITY_TYPE === \"ACTION\") {\n+          if (this.isTriggerPath(dep, configTree)) {\n+            hasRun = true;\n+            runPath = dep;\n+          }\n \n-          queue.push(...depDeps);\n+          if (DependencyMapUtils.isDataPath(dep)) {\n+            hasData = true;\n+            dataPath = dep;\n+          }\n+\n+          if (hasRun && hasData) {\n+            throw Object.assign(\n+              new Error(\n+                `Reactive dependency misuse: '${node}' depends on both trigger path '${runPath}' and data path '${dataPath}' from the same entity. This can cause unexpected reactivity.`,\n+              ),\n+              { node, triggerPath: runPath, dataPath },\n+            );\n+          }\n         }\n       }\n+    }\n+  }\n \n-      // Separate dependencies into trigger paths and data paths\n-      const triggerPaths = Array.from(deps).filter((dep) =>\n-        this.isTriggerPath(dep, configTree),\n-      );\n-      const dataPaths = Array.from(deps).filter((dep) => this.isDataPath(dep));\n-\n-      // For each trigger path, check if there's a data path from the same entity\n-      for (const triggerPath of triggerPaths) {\n-        const triggerEntity = triggerPath.split(\".\")[0];\n-\n-        // Find data paths from the same entity\n-        const sameEntityDataPaths = dataPaths.filter((dataPath) => {\n-          const dataEntity = dataPath.split(\".\")[0];\n-\n-          return dataEntity === triggerEntity;\n-        });\n-\n-        if (sameEntityDataPaths.length > 0) {\n-          // Check if any of these data paths depend on the trigger path (directly or indirectly)\n-          for (const dataPath of sameEntityDataPaths) {\n-            const dataPathTransitiveDeps =\n-              getAllTransitiveDependencies(dataPath);\n-\n-            if (dataPathTransitiveDeps.has(triggerPath)) {\n-              const error = new Error(\n-                `Reactive dependency misuse: '${node}' depends on both trigger path '${triggerPath}' and data path '${dataPath}' from the same entity, and '${dataPath}' depends on '${triggerPath}' (directly or indirectly). This can cause unexpected reactivity.`,\n-              );\n-\n-              // Add custom properties\n-              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n-              // @ts-ignore\n-              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-              (error as any).node = node;\n-\n-              throw error;\n-            }\n-          }\n+  /**\n+   * Returns all transitive dependencies (direct and indirect, no duplicates) for a given node.\n+   */\n+  static getAllTransitiveDependencies(\n+    dependencyMap: DependencyMap,\n+    node: string,\n+  ): string[] {\n+    const dependencies = dependencyMap.rawDependencies;\n+    const visited = new Set<string>();\n+\n+    function traverse(current: string) {\n+      const directDeps = dependencies.get(current) || new Set<string>();\n+\n+      for (const dep of directDeps) {\n+        if (!visited.has(dep)) {\n+          visited.add(dep);\n+          traverse(dep);\n         }\n       }\n     }\n+\n+    traverse(node);\n+\n+    return Array.from(visited);\n   }\n }\ndiff --git a/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts b/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts\nnew file mode 100644\nindex 00000000000..74fa30cf7e7\n--- /dev/null\n+++ b/app/client/src/entities/DependencyMap/__tests__/DependencyMapUtils.test.ts\n@@ -0,0 +1,337 @@\n+import DependencyMap from \"../index\";\n+import { DependencyMapUtils } from \"../DependencyMapUtils\";\n+import { PluginType } from \"entities/Plugin\";\n+import {\n+  ENTITY_TYPE,\n+  type DataTreeEntityConfig,\n+  type MetaArgs,\n+} from \"ee/entities/DataTree/types\";\n+import type { ActionRunBehaviourType } from \"PluginActionEditor/types/PluginActionTypes\";\n+\n+describe(\"detectReactiveDependencyMisuse\", () => {\n+  function makeConfigTreeWithAction(\n+    entityName: string,\n+    runBehaviour: ActionRunBehaviourType = \"AUTOMATIC\",\n+  ): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.ACTION,\n+      dynamicTriggerPathList: [{ key: \"run\" }],\n+      dynamicBindingPathList: [],\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      dependencyMap: {},\n+      logBlackList: {},\n+      pluginType: PluginType.API,\n+      pluginId: \"mockPluginId\",\n+      actionId: \"mockActionId\",\n+      name: entityName,\n+      runBehaviour,\n+    };\n+  }\n+\n+  function makeConfigTreeWithJSAction(\n+    entityName: string,\n+    meta: Record<string, MetaArgs> = {},\n+  ): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.JSACTION,\n+      meta,\n+      dynamicBindingPathList: [],\n+      actionNames: new Set([\"myFun1\", \"myFun2\"]),\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      dependencyMap: {},\n+      pluginType: PluginType.JS,\n+      name: entityName,\n+      actionId: \"mockJSActionId\",\n+      dynamicTriggerPathList: [],\n+      variables: [],\n+    };\n+  }\n+\n+  function makeConfigTreeWithWidget(entityName: string): DataTreeEntityConfig {\n+    return {\n+      ENTITY_TYPE: ENTITY_TYPE.WIDGET,\n+      bindingPaths: {},\n+      reactivePaths: {},\n+      triggerPaths: {},\n+      validationPaths: {},\n+      logBlackList: {},\n+      propertyOverrideDependency: {},\n+      overridingPropertyPaths: {},\n+      privateWidgets: {},\n+      widgetId: \"mockWidgetId\",\n+      defaultMetaProps: [],\n+      type: \"MOCK_WIDGET_TYPE\",\n+      dynamicBindingPathList: [],\n+      name: entityName,\n+    };\n+  }\n+\n+  it(\"does not throw for Widget entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      Widget1: true,\n+      \"Widget1.run\": true,\n+      \"Widget1.data\": true,\n+    });\n+    dependencyMap.addDependency(\"Widget1\", [\"Widget1.run\", \"Widget1.data\"]);\n+    const configTree = {\n+      Widget1: makeConfigTreeWithWidget(\"Widget1\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw for MANUAL ACTION entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"Query3.run\": true,\n+      \"Query3.data\": true,\n+    });\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"Query3.run\",\n+      \"Query3.data\",\n+    ]);\n+    const configTree = {\n+      Query3: makeConfigTreeWithAction(\"Query3\", \"MANUAL\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw for JSAction entity with no AUTOMATIC function\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+\n+    // meta has no AUTOMATIC runBehaviour\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"AUTOMATIC\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).not.toThrow();\n+  });\n+\n+  it(\"does not throw if a node depends only on .run or only on .data for AUTOMATIC ACTION\", () => {\n+    const configTree = {\n+      Api1: makeConfigTreeWithAction(\"Api1\", \"AUTOMATIC\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      JSObject2: makeConfigTreeWithJSAction(\"JSObject2\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    // Only .run\n+    const depMapRun = new DependencyMap();\n+\n+    depMapRun.addNodes({ \"JSObject1.myFun1\": true, \"Api1.run\": true });\n+    depMapRun.addDependency(\"JSObject1.myFun1\", [\"Api1.run\"]);\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(depMapRun, configTree);\n+    }).not.toThrow();\n+\n+    // Only .data\n+    const depMapData = new DependencyMap();\n+\n+    depMapData.addNodes({ \"JSObject2.myFun1\": true, \"Api1.data\": true });\n+    depMapData.addDependency(\"JSObject2.myFun1\", [\"Api1.data\"]);\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(depMapData, configTree);\n+    }).not.toThrow();\n+  });\n+\n+  it(\"throws if a node depends on both .run and .data of the same AUTOMATIC ACTION entity\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    // Add nodes\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"Query1.run\": true,\n+      \"Query1.data\": true,\n+    });\n+    // JSObject1.myFun1 depends on both Query1.run and Query1.data\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"Query1.run\",\n+      \"Query1.data\",\n+    ]);\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query1: makeConfigTreeWithAction(\"Query1\", \"AUTOMATIC\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+\n+  it(\"throws if a node depends on both .run and .data of the same AUTOMATIC ACTION entity via transitive dependency\", () => {\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+    const configTree = {\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"AUTOMATIC\"),\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+\n+  it(\"throws for JSAction entity with at least one AUTOMATIC function\", () => {\n+    // meta has one AUTOMATIC runBehaviour\n+    const dependencyMap = new DependencyMap();\n+\n+    dependencyMap.addNodes({\n+      \"JSObject1.myFun1\": true,\n+      \"JSObject1.myFun2\": true,\n+      \"Query2.run\": true,\n+      \"Query2.data\": true,\n+    });\n+    // JSObject1.myFun2 depends on Query2.run\n+    dependencyMap.addDependency(\"JSObject1.myFun2\", [\"Query2.run\"]);\n+    // JSObject1.myFun1 depends on both JSObject1.myFun2 and and Query2.data (transitive)\n+    dependencyMap.addDependency(\"JSObject1.myFun1\", [\n+      \"JSObject1.myFun2\",\n+      \"Query2.data\",\n+    ]);\n+    const configTree = {\n+      JSObject1: makeConfigTreeWithJSAction(\"JSObject1\", {\n+        myFun1: {\n+          runBehaviour: \"AUTOMATIC\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+        myFun2: {\n+          runBehaviour: \"MANUAL\",\n+          arguments: [],\n+          confirmBeforeExecute: false,\n+        },\n+      }),\n+      Query2: makeConfigTreeWithAction(\"Query2\", \"MANUAL\"),\n+    };\n+\n+    expect(() => {\n+      DependencyMapUtils.detectReactiveDependencyMisuse(\n+        dependencyMap,\n+        configTree,\n+      );\n+    }).toThrow(/Reactive dependency misuse/);\n+  });\n+});\n"}
{"instance_id": "appsmithorg__appsmith.main.41008", "repo": "appsmithorg/appsmith", "base_commit": "1789339e27785386a79722c7550d7f560e04093f", "head_commit": "fe0b50052e7e8a0d1f74f75016657ca78ea25c7d", "title": "feat: add onPageUnload option in UI behind feature flag.", "merged_at": "2025-06-23T08:46:22Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/41008", "test_files": ["app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts"], "code_files": ["app/client/src/PluginActionEditor/types/PluginActionTypes.ts", "app/client/src/ce/entities/FeatureFlag.ts", "app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts", "app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx", "app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts"], "total_changes": 280, "num_files": 6, "pull_number": 41008, "patch": "diff --git a/app/client/src/PluginActionEditor/types/PluginActionTypes.ts b/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\nindex f81d82a2485..735c9652dce 100644\n--- a/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\n+++ b/app/client/src/PluginActionEditor/types/PluginActionTypes.ts\n@@ -6,6 +6,7 @@ export enum ActionRunBehaviour {\n   ON_PAGE_LOAD = \"ON_PAGE_LOAD\",\n   MANUAL = \"MANUAL\",\n   AUTOMATIC = \"AUTOMATIC\",\n+  ON_PAGE_UNLOAD = \"ON_PAGE_UNLOAD\",\n }\n \n export type ActionRunBehaviourType = `${ActionRunBehaviour}`;\ndiff --git a/app/client/src/ce/entities/FeatureFlag.ts b/app/client/src/ce/entities/FeatureFlag.ts\nindex a6d84c60537..120af37c6d6 100644\n--- a/app/client/src/ce/entities/FeatureFlag.ts\n+++ b/app/client/src/ce/entities/FeatureFlag.ts\n@@ -60,6 +60,8 @@ export const FEATURE_FLAG = {\n   release_ai_chat_integrations_enabled: \"release_ai_chat_integrations_enabled\",\n   release_reactive_actions_enabled: \"release_reactive_actions_enabled\",\n   license_ai_agent_instance_enabled: \"license_ai_agent_instance_enabled\",\n+  release_jsobjects_onpageunloadactions_enabled:\n+    \"release_jsobjects_onpageunloadactions_enabled\",\n } as const;\n \n export type FeatureFlag = keyof typeof FEATURE_FLAG;\n@@ -110,6 +112,7 @@ export const DEFAULT_FEATURE_FLAG_VALUE: FeatureFlags = {\n   release_ai_chat_integrations_enabled: false,\n   release_reactive_actions_enabled: false,\n   license_ai_agent_instance_enabled: false,\n+  release_jsobjects_onpageunloadactions_enabled: false,\n };\n \n export const AB_TESTING_EVENT_KEYS = {\ndiff --git a/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts b/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\nindex ff0dfc07892..fb530fa2a7f 100644\n--- a/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\n+++ b/app/client/src/constants/AppsmithActionConstants/formConfig/PluginSettings.ts\n@@ -22,3 +22,13 @@ export const RUN_BEHAVIOR_VALUES = [\n     children: \"Manual\",\n   },\n ];\n+\n+export const JS_OBJECT_RUN_BEHAVIOR_VALUES = [\n+  ...RUN_BEHAVIOR_VALUES,\n+  {\n+    label: \"On page unload\",\n+    subText: \"Query runs when the page unloads or when manually triggered\",\n+    value: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+    children: \"On page unload\",\n+  },\n+];\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\nindex d537ae3cbc7..4f228569896 100644\n--- a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/JSFunctionSettings.tsx\n@@ -1,27 +1,21 @@\n-import React, { useCallback, useState } from \"react\";\n-import {\n-  Flex,\n-  Option,\n-  Select,\n-  Text,\n-  type SelectOptionProps,\n-} from \"@appsmith/ads\";\n-import type { JSAction } from \"entities/JSCollection\";\n+import { Flex, Option, Select, Text } from \"@appsmith/ads\";\n import {\n   createMessage,\n   JS_EDITOR_SETTINGS,\n   NO_JS_FUNCTIONS,\n } from \"ee/constants/messages\";\n+import { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n import AnalyticsUtil from \"ee/utils/AnalyticsUtil\";\n-import type { OnUpdateSettingsProps } from \"../types\";\n-import {\n-  ActionRunBehaviour,\n-  type ActionRunBehaviourType,\n-} from \"PluginActionEditor/types/PluginActionTypes\";\n+import type { JSAction } from \"entities/JSCollection\";\n+import { type ActionRunBehaviourType } from \"PluginActionEditor/types/PluginActionTypes\";\n+import React, { useCallback, useMemo, useState } from \"react\";\n import styled from \"styled-components\";\n-import { RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n import { useFeatureFlag } from \"utils/hooks/useFeatureFlag\";\n-import { FEATURE_FLAG } from \"ee/entities/FeatureFlag\";\n+import type { OnUpdateSettingsProps } from \"../types\";\n+import {\n+  getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled,\n+  getRunBehaviorOptionsBasedOnFeatureFlags,\n+} from \"./utils\";\n \n const OptionLabel = styled(Text)`\n   color: var(--ads-v2-color-fg);\n@@ -61,20 +55,31 @@ const FunctionSettingRow = (props: FunctionSettingsRowProps) => {\n   const isReactiveActionsEnabled = useFeatureFlag(\n     FEATURE_FLAG.release_reactive_actions_enabled,\n   );\n-  const options = RUN_BEHAVIOR_VALUES.filter(\n-    (option) =>\n-      isReactiveActionsEnabled || option.value !== ActionRunBehaviour.AUTOMATIC,\n-  ) as SelectOptionProps[];\n+  const isOnPageUnloadEnabled = useFeatureFlag(\n+    FEATURE_FLAG.release_jsobjects_onpageunloadactions_enabled,\n+  );\n+\n+  const options = useMemo(\n+    () =>\n+      getRunBehaviorOptionsBasedOnFeatureFlags(\n+        isReactiveActionsEnabled,\n+        isOnPageUnloadEnabled,\n+      ),\n+    [isReactiveActionsEnabled, isOnPageUnloadEnabled],\n+  );\n+\n   let selectedValue = options.find((opt) => opt.value === runBehaviour);\n \n-  /* temporary check added to switch from automatic to page load as the run behaviour when feature flag is turned off */\n-  if (\n-    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n-    !isReactiveActionsEnabled\n-  ) {\n-    selectedValue = options.find(\n-      (opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD,\n+  const defaultRunBehaviourOption =\n+    getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled(\n+      runBehaviour,\n+      isReactiveActionsEnabled,\n+      isOnPageUnloadEnabled,\n+      options,\n     );\n+\n+  if (defaultRunBehaviourOption) {\n+    selectedValue = defaultRunBehaviourOption;\n   }\n \n   const onSelectOptions = useCallback(\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts\nnew file mode 100644\nindex 00000000000..3887fa94eb1\n--- /dev/null\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.test.ts\n@@ -0,0 +1,151 @@\n+import {\n+  ActionRunBehaviour,\n+  type ActionRunBehaviourType,\n+} from \"PluginActionEditor/types/PluginActionTypes\";\n+import {\n+  getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled,\n+  getRunBehaviorOptionsBasedOnFeatureFlags,\n+} from \"./utils\";\n+import { JS_OBJECT_RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n+import type { SelectOptionProps } from \"@appsmith/ads\";\n+\n+describe(\"getRunBehaviorOptions\", () => {\n+  it(\"should return the correct options\", () => {\n+    const flagsOutputMatrix: {\n+      isReactiveActionsEnabled: boolean;\n+      isOnPageUnloadEnabled: boolean;\n+      expectedOptions: SelectOptionProps[];\n+    }[] = [\n+      {\n+        isReactiveActionsEnabled: true,\n+        isOnPageUnloadEnabled: true,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES,\n+      },\n+      {\n+        isReactiveActionsEnabled: false,\n+        isOnPageUnloadEnabled: true,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) => option.value !== ActionRunBehaviour.AUTOMATIC,\n+        ),\n+      },\n+      {\n+        isReactiveActionsEnabled: true,\n+        isOnPageUnloadEnabled: false,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) => option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD,\n+        ),\n+      },\n+      {\n+        isReactiveActionsEnabled: false,\n+        isOnPageUnloadEnabled: false,\n+        expectedOptions: JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+          (option) =>\n+            option.value !== ActionRunBehaviour.AUTOMATIC &&\n+            option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD,\n+        ),\n+      },\n+    ];\n+\n+    flagsOutputMatrix.forEach(\n+      ({\n+        expectedOptions,\n+        isOnPageUnloadEnabled,\n+        isReactiveActionsEnabled,\n+      }) => {\n+        const options = getRunBehaviorOptionsBasedOnFeatureFlags(\n+          isReactiveActionsEnabled,\n+          isOnPageUnloadEnabled,\n+        );\n+\n+        expect(options).toEqual(expectedOptions);\n+      },\n+    );\n+  });\n+});\n+\n+describe(\"getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled\", () => {\n+  const onPageLoadOption =\n+    JS_OBJECT_RUN_BEHAVIOR_VALUES.find(\n+      (option) => option.value === ActionRunBehaviour.ON_PAGE_LOAD,\n+    ) ?? null;\n+  const manualOption =\n+    JS_OBJECT_RUN_BEHAVIOR_VALUES.find(\n+      (option) => option.value === ActionRunBehaviour.MANUAL,\n+    ) ?? null;\n+\n+  const flagsOutputMatrix: {\n+    runBehaviour: ActionRunBehaviourType;\n+    isReactiveActionsEnabled: boolean;\n+    isOnPageUnloadEnabled: boolean;\n+    expectedOption: SelectOptionProps | null;\n+  }[] = [\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: onPageLoadOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.AUTOMATIC,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: onPageLoadOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: true,\n+      expectedOption: null,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: true,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: manualOption,\n+    },\n+    {\n+      runBehaviour: ActionRunBehaviour.ON_PAGE_UNLOAD,\n+      isReactiveActionsEnabled: false,\n+      isOnPageUnloadEnabled: false,\n+      expectedOption: manualOption,\n+    },\n+  ];\n+\n+  it(\"should return the correct options\", () => {\n+    flagsOutputMatrix.forEach(\n+      ({\n+        expectedOption,\n+        isOnPageUnloadEnabled,\n+        isReactiveActionsEnabled,\n+        runBehaviour,\n+      }) => {\n+        const option = getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled(\n+          runBehaviour,\n+          isReactiveActionsEnabled,\n+          isOnPageUnloadEnabled,\n+          JS_OBJECT_RUN_BEHAVIOR_VALUES,\n+        );\n+\n+        expect(option).toEqual(expectedOption);\n+      },\n+    );\n+  });\n+});\ndiff --git a/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts\nnew file mode 100644\nindex 00000000000..08a449a86ff\n--- /dev/null\n+++ b/app/client/src/pages/Editor/JSEditor/JSEditorToolbar/components/utils.ts\n@@ -0,0 +1,56 @@\n+import {\n+  ActionRunBehaviour,\n+  type ActionRunBehaviourType,\n+} from \"PluginActionEditor/types/PluginActionTypes\";\n+import { JS_OBJECT_RUN_BEHAVIOR_VALUES } from \"constants/AppsmithActionConstants/formConfig/PluginSettings\";\n+\n+import { type SelectOptionProps } from \"@appsmith/ads\";\n+/**\n+ * Returns the list of run behavior options based on the current feature flags.\n+ * - If reactive actions are disabled, removes AUTOMATIC.\n+ * - If onPageUnload is disabled, removes ON_PAGE_UNLOAD.\n+ */\n+export const getRunBehaviorOptionsBasedOnFeatureFlags = (\n+  isReactiveActionsEnabled: boolean,\n+  isOnPageUnloadEnabled: boolean,\n+) =>\n+  JS_OBJECT_RUN_BEHAVIOR_VALUES.filter(\n+    (option) =>\n+      (isReactiveActionsEnabled ||\n+        option.value !== ActionRunBehaviour.AUTOMATIC) &&\n+      (isOnPageUnloadEnabled ||\n+        option.value !== ActionRunBehaviour.ON_PAGE_UNLOAD),\n+  ) as SelectOptionProps[];\n+\n+/**\n+ * Returns the default run behavior option if the current one is no longer available due to feature flag changes.\n+ * - AUTOMATIC falls back to ON_PAGE_LOAD if reactive actions are disabled.\n+ * - ON_PAGE_UNLOAD falls back to MANUAL if onPageUnload is disabled.\n+ */\n+export const getDefaultRunBehaviorOptionWhenFeatureFlagIsDisabled = (\n+  runBehaviour: ActionRunBehaviourType,\n+  isReactiveActionsEnabled: boolean,\n+  isOnPageUnloadEnabled: boolean,\n+  options: SelectOptionProps[],\n+): SelectOptionProps | null => {\n+  if (\n+    runBehaviour === ActionRunBehaviour.AUTOMATIC &&\n+    !isReactiveActionsEnabled\n+  ) {\n+    return (\n+      options.find((opt) => opt.value === ActionRunBehaviour.ON_PAGE_LOAD) ??\n+      null\n+    );\n+  }\n+\n+  if (\n+    runBehaviour === ActionRunBehaviour.ON_PAGE_UNLOAD &&\n+    !isOnPageUnloadEnabled\n+  ) {\n+    return (\n+      options.find((opt) => opt.value === ActionRunBehaviour.MANUAL) ?? null\n+    );\n+  }\n+\n+  return null;\n+};\n"}
{"instance_id": "appsmithorg__appsmith.main.40936", "repo": "appsmithorg/appsmith", "base_commit": "c17dc3aabc4475bc267ed936cf29f634f6792731", "head_commit": "ba524fe2f769b6f8d2c72e0332560dd5e0c0465e", "title": "chore: Disable anonymous user tracking when feature flag turned on", "merged_at": "2025-07-02T07:20:51Z", "html_url": "https://github.com/appsmithorg/appsmith/pull/40936", "test_files": ["app/client/src/utils/Analytics/segment.test.ts"], "code_files": ["app/client/src/ce/entities/FeatureFlag.ts", "app/client/src/ce/sagas/userSagas.tsx", "app/client/src/ce/utils/AnalyticsUtil.tsx", "app/client/src/utils/Analytics/segment.ts"], "total_changes": 126, "num_files": 8, "pull_number": 40936, "patch": "diff --git a/app/client/src/ce/entities/FeatureFlag.ts b/app/client/src/ce/entities/FeatureFlag.ts\nindex 120af37c6d6..d8efbcae67d 100644\n--- a/app/client/src/ce/entities/FeatureFlag.ts\n+++ b/app/client/src/ce/entities/FeatureFlag.ts\n@@ -62,6 +62,8 @@ export const FEATURE_FLAG = {\n   license_ai_agent_instance_enabled: \"license_ai_agent_instance_enabled\",\n   release_jsobjects_onpageunloadactions_enabled:\n     \"release_jsobjects_onpageunloadactions_enabled\",\n+  configure_block_event_tracking_for_anonymous_users:\n+    \"configure_block_event_tracking_for_anonymous_users\",\n } as const;\n \n export type FeatureFlag = keyof typeof FEATURE_FLAG;\n@@ -113,6 +115,7 @@ export const DEFAULT_FEATURE_FLAG_VALUE: FeatureFlags = {\n   release_reactive_actions_enabled: false,\n   license_ai_agent_instance_enabled: false,\n   release_jsobjects_onpageunloadactions_enabled: false,\n+  configure_block_event_tracking_for_anonymous_users: false,\n };\n \n export const AB_TESTING_EVENT_KEYS = {\ndiff --git a/app/client/src/ce/sagas/userSagas.tsx b/app/client/src/ce/sagas/userSagas.tsx\nindex 874d041f04c..c83357d335a 100644\n--- a/app/client/src/ce/sagas/userSagas.tsx\n+++ b/app/client/src/ce/sagas/userSagas.tsx\n@@ -7,6 +7,7 @@ import {\n   take,\n   type TakeEffect,\n } from \"redux-saga/effects\";\n+import type { SagaIterator } from \"redux-saga\";\n import type {\n   ReduxAction,\n   ReduxActionWithPromise,\n@@ -88,6 +89,7 @@ import {\n   segmentInitUncertain,\n } from \"actions/analyticsActions\";\n import { getSegmentState } from \"selectors/analyticsSelectors\";\n+import { getOrganizationConfig } from \"ee/selectors/organizationSelectors\";\n \n export function* getCurrentUserSaga(action?: {\n   payload?: { userProfile?: ApiResponse };\n@@ -150,7 +152,28 @@ function* getSessionRecordingConfig() {\n   };\n }\n \n-function* initTrackers(currentUser: User) {\n+function shouldTrackUser(\n+  currentUser: User,\n+  licenseActive: boolean,\n+  featureFlag: boolean,\n+): boolean {\n+  try {\n+    const isAnonymous =\n+      currentUser?.isAnonymous || currentUser?.username === \"anonymousUser\";\n+\n+    if (!isAnonymous) {\n+      return true;\n+    }\n+\n+    const telemetryOn = currentUser?.enableTelemetry ?? false;\n+\n+    return isAnonymous && (licenseActive || (telemetryOn && !featureFlag));\n+  } catch (error) {\n+    return true;\n+  }\n+}\n+\n+function* initTrackers(currentUser: User): SagaIterator {\n   try {\n     const isFFFetched: boolean = yield select(getFeatureFlagsFetched);\n \n@@ -162,7 +185,21 @@ function* initTrackers(currentUser: User) {\n       getSessionRecordingConfig,\n     );\n \n-    yield call(AnalyticsUtil.initialize, currentUser, sessionRecordingConfig);\n+    const featureFlags: FeatureFlags = yield select(selectFeatureFlags);\n+    const organizationConfig = yield select(getOrganizationConfig);\n+\n+    const shouldTrack = shouldTrackUser(\n+      currentUser,\n+      organizationConfig.license.active,\n+      featureFlags.configure_block_event_tracking_for_anonymous_users,\n+    );\n+\n+    yield call(\n+      AnalyticsUtil.initialize,\n+      currentUser,\n+      sessionRecordingConfig,\n+      shouldTrack,\n+    );\n     yield put(segmentInitSuccess());\n   } catch (e) {\n     log.error(e);\ndiff --git a/app/client/src/ce/utils/AnalyticsUtil.tsx b/app/client/src/ce/utils/AnalyticsUtil.tsx\nindex bcd16f595d4..1312995a432 100644\n--- a/app/client/src/ce/utils/AnalyticsUtil.tsx\n+++ b/app/client/src/ce/utils/AnalyticsUtil.tsx\n@@ -30,13 +30,14 @@ let segmentAnalytics: SegmentSingleton | null = null;\n async function initialize(\n   user: User,\n   sessionRecordingConfig: SessionRecordingConfig,\n+  shouldTrackUser: boolean,\n ) {\n   // SentryUtil.init();\n   await SmartlookUtil.init();\n \n   segmentAnalytics = SegmentSingleton.getInstance();\n \n-  await segmentAnalytics.init();\n+  await segmentAnalytics.init(shouldTrackUser);\n \n   // Mixpanel needs to be initialized after Segment\n   await MixpanelSingleton.getInstance().init(sessionRecordingConfig);\ndiff --git a/app/client/src/utils/Analytics/segment.test.ts b/app/client/src/utils/Analytics/segment.test.ts\nindex 3a67b1c2a79..274919bc099 100644\n--- a/app/client/src/utils/Analytics/segment.test.ts\n+++ b/app/client/src/utils/Analytics/segment.test.ts\n@@ -58,7 +58,7 @@ describe(\"SegmentSingleton\", () => {\n   describe(\"init\", () => {\n     it(\"should initialize successfully with API key\", async () => {\n       const segment = SegmentSingleton.getInstance();\n-      const result = await segment.init();\n+      const result = await segment.init(true);\n \n       expect(result).toBe(true);\n       expect(mockAnalyticsBrowser.load).toHaveBeenCalledWith(\n@@ -73,7 +73,15 @@ describe(\"SegmentSingleton\", () => {\n       });\n \n       const segment = SegmentSingleton.getInstance();\n-      const result = await segment.init();\n+      const result = await segment.init(true);\n+\n+      expect(result).toBe(true);\n+      expect(mockAnalyticsBrowser.load).not.toHaveBeenCalled();\n+    });\n+\n+    it(\"should not initialize when shouldTrackUser is false\", async () => {\n+      const segment = SegmentSingleton.getInstance();\n+      const result = await segment.init(false);\n \n       expect(result).toBe(true);\n       expect(mockAnalyticsBrowser.load).not.toHaveBeenCalled();\n@@ -89,7 +97,7 @@ describe(\"SegmentSingleton\", () => {\n       });\n \n       const segment = SegmentSingleton.getInstance();\n-      const result = await segment.init();\n+      const result = await segment.init(true);\n \n       expect(result).toBe(true);\n       expect(mockAnalyticsBrowser.load).toHaveBeenCalledWith(\n@@ -119,7 +127,7 @@ describe(\"SegmentSingleton\", () => {\n       const eventData = { test: \"data\" };\n \n       segment.track(\"test-event\", eventData);\n-      await segment.init();\n+      await segment.init(true);\n \n       expect(mockAnalytics.track).toHaveBeenCalledWith(\"test-event\", eventData);\n     });\n@@ -127,7 +135,7 @@ describe(\"SegmentSingleton\", () => {\n     it(\"should track events directly when initialized\", async () => {\n       const segment = SegmentSingleton.getInstance();\n \n-      await segment.init();\n+      await segment.init(true);\n \n       const eventData = { test: \"data\" };\n \n@@ -141,7 +149,7 @@ describe(\"SegmentSingleton\", () => {\n     it(\"should call analytics identify when initialized\", async () => {\n       const segment = SegmentSingleton.getInstance();\n \n-      await segment.init();\n+      await segment.init(true);\n \n       const userId = \"test-user\";\n       const traits = { name: \"Test User\" };\n@@ -156,7 +164,7 @@ describe(\"SegmentSingleton\", () => {\n     it(\"should call analytics reset when initialized\", async () => {\n       const segment = SegmentSingleton.getInstance();\n \n-      await segment.init();\n+      await segment.init(true);\n \n       segment.reset();\n \n@@ -169,7 +177,7 @@ describe(\"SegmentSingleton\", () => {\n       mockAnalyticsBrowser.load.mockRejectedValueOnce(new Error(\"Init failed\"));\n \n       const segment = SegmentSingleton.getInstance();\n-      const result = await segment.init();\n+      const result = await segment.init(true);\n \n       expect(result).toBe(false);\n       expect(log.error).toHaveBeenCalledWith(\n@@ -182,7 +190,7 @@ describe(\"SegmentSingleton\", () => {\n     it(\"should not track events after avoidTracking is called\", async () => {\n       const segment = SegmentSingleton.getInstance();\n \n-      await segment.init();\n+      await segment.init(true);\n \n       // Track an event before calling avoidTracking\n       segment.track(\"pre-avoid-event\", { data: \"value\" });\n@@ -214,7 +222,7 @@ describe(\"SegmentSingleton\", () => {\n       segment.avoidTracking();\n \n       // Initialize\n-      await segment.init();\n+      await segment.init(true);\n \n       // Analytics track should not be called since we're avoiding tracking\n       expect(mockAnalytics.track).not.toHaveBeenCalled();\ndiff --git a/app/client/src/utils/Analytics/segment.ts b/app/client/src/utils/Analytics/segment.ts\nindex d03c89f5fd9..c15055484ca 100644\n--- a/app/client/src/utils/Analytics/segment.ts\n+++ b/app/client/src/utils/Analytics/segment.ts\n@@ -49,7 +49,7 @@ class SegmentSingleton {\n     }\n   }\n \n-  public async init(): Promise<boolean> {\n+  public async init(shouldTrackUser: boolean): Promise<boolean> {\n     const { segment } = getAppsmithConfigs();\n \n     if (!segment.enabled) {\n@@ -58,6 +58,12 @@ class SegmentSingleton {\n       return true;\n     }\n \n+    if (!shouldTrackUser) {\n+      this.avoidTracking();\n+\n+      return true;\n+    }\n+\n     if (this.analytics) {\n       log.warn(\"Segment is already initialized.\");\n \ndiff --git a/app/server/appsmith-interfaces/src/main/java/com/appsmith/external/enums/FeatureFlagEnum.java b/app/server/appsmith-interfaces/src/main/java/com/appsmith/external/enums/FeatureFlagEnum.java\nindex 3d26e6c8f3d..49309885d8f 100644\n--- a/app/server/appsmith-interfaces/src/main/java/com/appsmith/external/enums/FeatureFlagEnum.java\n+++ b/app/server/appsmith-interfaces/src/main/java/com/appsmith/external/enums/FeatureFlagEnum.java\n@@ -15,6 +15,7 @@ public enum FeatureFlagEnum {\n     release_embed_hide_share_settings_enabled,\n     rollout_datasource_test_rate_limit_enabled,\n     release_gs_all_sheets_options_enabled,\n+    configure_block_event_tracking_for_anonymous_users,\n     /**\n      * Feature flag to detect if the git reset optimization is enabled\n      */\ndiff --git a/app/server/appsmith-server/src/main/java/com/appsmith/server/services/AnalyticsServiceImpl.java b/app/server/appsmith-server/src/main/java/com/appsmith/server/services/AnalyticsServiceImpl.java\nindex 22073d5952e..35720c5f4ca 100644\n--- a/app/server/appsmith-server/src/main/java/com/appsmith/server/services/AnalyticsServiceImpl.java\n+++ b/app/server/appsmith-server/src/main/java/com/appsmith/server/services/AnalyticsServiceImpl.java\n@@ -9,6 +9,7 @@\n import com.segment.analytics.Analytics;\n import lombok.extern.slf4j.Slf4j;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Lazy;\n import org.springframework.stereotype.Service;\n \n @Slf4j\n@@ -24,7 +25,8 @@ public AnalyticsServiceImpl(\n             UserUtils userUtils,\n             ProjectProperties projectProperties,\n             UserDataRepository userDataRepository,\n-            DeploymentProperties deploymentProperties) {\n+            DeploymentProperties deploymentProperties,\n+            @Lazy FeatureFlagService featureFlagService) {\n         super(\n                 analytics,\n                 sessionUserService,\n@@ -33,6 +35,7 @@ public AnalyticsServiceImpl(\n                 userUtils,\n                 projectProperties,\n                 deploymentProperties,\n-                userDataRepository);\n+                userDataRepository,\n+                featureFlagService);\n     }\n }\ndiff --git a/app/server/appsmith-server/src/main/java/com/appsmith/server/services/ce/AnalyticsServiceCEImpl.java b/app/server/appsmith-server/src/main/java/com/appsmith/server/services/ce/AnalyticsServiceCEImpl.java\nindex 4fb98dd8a18..92d32e1eb72 100644\n--- a/app/server/appsmith-server/src/main/java/com/appsmith/server/services/ce/AnalyticsServiceCEImpl.java\n+++ b/app/server/appsmith-server/src/main/java/com/appsmith/server/services/ce/AnalyticsServiceCEImpl.java\n@@ -1,6 +1,7 @@\n package com.appsmith.server.services.ce;\n \n import com.appsmith.external.constants.AnalyticsEvents;\n+import com.appsmith.external.enums.FeatureFlagEnum;\n import com.appsmith.external.helpers.Identifiable;\n import com.appsmith.external.models.ActionDTO;\n import com.appsmith.external.models.BaseDomain;\n@@ -15,6 +16,7 @@\n import com.appsmith.server.helpers.UserUtils;\n import com.appsmith.server.repositories.UserDataRepository;\n import com.appsmith.server.services.ConfigService;\n+import com.appsmith.server.services.FeatureFlagService;\n import com.appsmith.server.services.SessionUserService;\n import com.segment.analytics.Analytics;\n import com.segment.analytics.messages.IdentifyMessage;\n@@ -24,6 +26,7 @@\n import org.apache.commons.lang3.ObjectUtils;\n import org.apache.commons.lang3.StringUtils;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Lazy;\n import reactor.core.publisher.Mono;\n \n import java.util.HashMap;\n@@ -48,6 +51,7 @@ public class AnalyticsServiceCEImpl implements AnalyticsServiceCE {\n     private final SessionUserService sessionUserService;\n     private final CommonConfig commonConfig;\n     private final ConfigService configService;\n+    private final FeatureFlagService featureFlagService;\n \n     private final UserUtils userUtils;\n \n@@ -65,11 +69,13 @@ public AnalyticsServiceCEImpl(\n             UserUtils userUtils,\n             ProjectProperties projectProperties,\n             DeploymentProperties deploymentProperties,\n-            UserDataRepository userDataRepository) {\n+            UserDataRepository userDataRepository,\n+            @Lazy FeatureFlagService featureFlagService) {\n         this.analytics = analytics;\n         this.sessionUserService = sessionUserService;\n         this.commonConfig = commonConfig;\n         this.configService = configService;\n+        this.featureFlagService = featureFlagService;\n         this.userUtils = userUtils;\n         this.projectProperties = projectProperties;\n         this.deploymentProperties = deploymentProperties;\n@@ -319,7 +325,26 @@ public <T> Mono<T> sendObjectEvent(AnalyticsEvents event, T object, Map<String,\n \n         Mono<User> userMono = sessionUserService.getCurrentUser().switchIfEmpty(Mono.just(anonymousUser));\n \n-        return userMono.flatMap(user -> Mono.zip(\n+        return userMono.flatMap(user -> {\n+                    // if the user is anonymous, check if the feature flag\n+                    // configure_block_event_tracking_for_anonymous_users is enabled.  If yes, then do not send the\n+                    // analytics event.\n+                    if (user.isAnonymous()) {\n+                        return featureFlagService\n+                                .check(FeatureFlagEnum.configure_block_event_tracking_for_anonymous_users)\n+                                .flatMap(isDisabled -> {\n+                                    if (isDisabled) {\n+                                        log.debug(\"Analytics event {} is not sent for anonymous user\", eventTag);\n+                                        return Mono.empty();\n+                                    } else {\n+                                        return Mono.just(user);\n+                                    }\n+                                });\n+                    }\n+\n+                    return Mono.just(user);\n+                })\n+                .flatMap(user -> Mono.zip(\n                         user.isAnonymous()\n                                 ? ExchangeUtils.getAnonymousUserIdFromCurrentRequest()\n                                 : Mono.just(user.getUsername()),\n@@ -363,8 +388,10 @@ public <T> Mono<T> sendObjectEvent(AnalyticsEvents event, T object, Map<String,\n                         analyticsProperties.remove(FieldName.CLOUD_HOSTED_EXTRA_PROPS);\n                     }\n \n-                    return sendEvent(eventTag, username, analyticsProperties).thenReturn(object);\n-                });\n+                    return sendEvent(eventTag, username, analyticsProperties);\n+                })\n+                // Return the original object after sending the event\n+                .then(Mono.just(object));\n     }\n \n     /**\n"}
