+ cd /testbed
+ : '>>>>> Start Test Output'
+ NODE_OPTIONS=--max-old-space-size=8192
+ pnpm test

> sanity-root@0.0.0 test /testbed
> pnpm test:vitest


> sanity-root@0.0.0 test:vitest /testbed
> vitest --run

Testing types with tsc and vue-tsc is an experimental feature.
Breaking changes might not follow SemVer, please pin Vitest's version when using it.
Testing types with tsc and vue-tsc is an experimental feature.
Breaking changes might not follow SemVer, please pin Vitest's version when using it.
Testing types with tsc and vue-tsc is an experimental feature.
Breaking changes might not follow SemVer, please pin Vitest's version when using it.

 RUN  v3.2.4 /testbed


No SANITY_CI_CLI_AUTH_TOKEN_STAGING set, skipping CLI tests
 âœ“  TS  |@sanity/types| test/options.test-d.ts (2 tests)
(node:129) TimeoutOverflowWarning: 5183999999 does not fit into a 32-bit signed integer.
Timeout duration was set to 1.
(Use `node --trace-warnings ...` to show where the warning was created)
 âœ“ |sanity| src/presentation/machines/__tests__/preview-url.test.ts (72 tests | 2 skipped) 2416ms
   âœ“ Preview URL machine > preview mode > creates preview url secrets > handles secret expiry  1012ms
   âœ“ Preview URL machine > preview mode > creates preview url secrets > only creates a new secret if the permission is granted  1006ms
 âœ“ |sanity| src/core/form/studio/tree-editing/utils/build-tree-editing-state/__tests__/buildArrayStatePTE.test.ts (28 tests) 38ms
 âœ“ |sanity| src/core/form/studio/tree-editing/utils/build-tree-editing-state/__tests__/buildArrayState.test.ts (30 tests) 53ms
 âœ“ |sanity| src/core/studio/copyPaste/__test__/transferValue.test.ts (59 tests) 80ms
 âœ“  TS  |sanity| src/presentation/__tests__/plugin.test-d.tsx (15 tests)
 âœ“ |sanity| src/core/releases/tool/detail/events/buildReleaseEditEvents.test.ts (5 tests) 12ms
 âœ“ |sanity| src/core/form/types/definitionExtensions.test.ts (28 tests) 24ms
 âœ“ |sanity| src/core/releases/store/__tests__/createReleaseOperationsStore.test.ts (31 tests) 116ms
 âœ“ |sanity| test/cli/schema/listSchemasAction.test.ts (13 tests) 79ms
 âœ“ |sanity| test/cli/schema/deploySchemasAction.test.ts (22 tests) 99ms
 âœ“ |sanity| src/core/form/store/__tests__/formState.test.ts (58 tests) 198ms
 âœ“ |sanity| test/cli/schema/deleteSchemasAction.test.ts (13 tests) 35ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/validation.test.ts (6 tests | 4 skipped) 55ms
 âœ“ |sanity| src/core/store/events/utils.test.ts (4 tests) 12ms
 âœ“ |sanity| src/core/search/weighted/createSearchQuery.test.ts (45 tests) 24ms
 âœ“ |sanity| src/core/form/studio/tree-editing/__tests__/buildTreeEditingState.test.ts (5 tests) 140ms
stderr | test/validation/infer.test.ts > schema validation inference > media validation > gives error if media can't be found
The asset could not be found in the Media Library
Asset ID: media-library:abc:def

 âœ“ |sanity| src/core/templates/__tests__/resolve.test.ts (27 tests | 1 skipped) 6999ms
   âœ“ resolveInitialValue > serializes builders  592ms
   âœ“ resolveInitialValue > throws on unknown prop in reference  812ms
   âœ“ resolveInitialValue > throws on unknown props in reference  323ms
   âœ“ resolveInitialValue > allows setting known reference properties  521ms
   âœ“ resolveInitialValue > allows setting _dataset on cross-dataset references  469ms
   âœ“ resolveInitialValue > should call sync value resolvers  359ms
   âœ“ resolveInitialValue > memoizes function calls > caches based on stable JSON stringification  510ms
   âœ“ resolveInitialValue > memoizes function calls > handles null and undefined in parameters correctly  307ms
 âœ“ |sanity| test/validation/infer.test.ts (11 tests) 127ms
 âœ“ |sanity| src/presentation/loader/__tests__/useLiveQueries.test.ts (7 tests) 53ms
 âœ“ |sanity| src/router/__test__/RouterScope.test.tsx (19 tests) 91ms
 âœ“ |sanity| src/router/__test__/RouterProvider.test.tsx (17 tests) 150ms
 âœ“ |sanity| src/core/form/studio/tree-editing/utils/__tests__/hasCustomInputComponent.test.ts (21 tests) 39ms
 âœ“ |sanity| src/core/releases/hooks/__tests__/utils.test.ts (24 tests) 39ms
 âœ“ |sanity| src/core/search/common/__tests__/deriveSearchWeightsFromType.test.ts (8 tests) 7974ms
   âœ“ deriveSearchWeightsFromType > works for schemas that branch out a lot  7932ms
 âœ“ |sanity| src/core/store/_legacy/document/utils/__test__/sequentializeEvents.test.ts (5 tests) 224ms
 âœ“ |sanity| src/core/form/studio/tree-editing/utils/__tests__/isPathTextInPTEField.test.ts (17 tests) 32ms
 âœ“ |sanity| src/core/studio/workspaces/__tests__/validateWorkspaces.test.ts (14 tests) 47ms
 âœ“ |sanity| src/core/releases/tool/detail/documentTable/__tests__/searchDocumentRelease.test.ts (29 tests) 25ms
 âœ“ |sanity| src/core/releases/tool/detail/events/getReleaseEditEvents.test.ts (5 tests) 140ms
 âœ“ |sanity| src/core/search/groq2024/createSearchQuery.test.ts (10 tests) 56ms
 âœ“ |sanity| src/core/store/events/getEditEvents.test.ts (6 tests) 9ms
 âœ“ |sanity| test/cli/schema/schemaStoreValidation.test.ts (44 tests) 30ms
 âœ“ |sanity| src/core/studio/components/navbar/search/contexts/search/reducer.test.ts (31 tests) 144ms
 âœ“ |sanity| src/core/releases/tool/detail/documentTable/__tests__/extractSearchableText.test.ts (24 tests) 33ms
 âœ“ |sanity| src/core/form/studio/tree-editing/utils/__tests__/validateRelativePathExists.test.ts (16 tests) 15ms
 âœ“ |sanity| src/core/util/__tests__/createHookFromObservableFactory.test.tsx (5 tests) 374ms
 âœ“ |sanity| src/core/i18n/__tests__/simpleParser.test.ts (19 tests) 43ms
 âœ“ |sanity| src/core/components/rovingFocus/__tests__/useRovingFocus.test.tsx (5 tests) 331ms
 âœ“ |sanity| test/validation/strings.test.ts (16 tests) 158ms
 âœ“ |sanity| src/structure/panes/document/timeline/utils.test.ts (1 test) 21ms
stderr | src/core/releases/tool/components/releaseCTAButtons/ReleaseRevertButton/__tests__/useDocumentRevertStates.test.ts > useDocumentRevertStates > should return a function
An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/core/releases/tool/components/releaseCTAButtons/ReleaseRevertButton/__tests__/useDocumentRevertStates.test.ts > useDocumentRevertStates > should handle errors gracefully and return undefined
Error in document revert states pipeline: Error: Failed to fetch transactions
    at [90m/testbed/[39mpackages/sanity/src/core/releases/tool/components/releaseCTAButtons/ReleaseRevertButton/__tests__/useDocumentRevertStates.test.ts:161:47
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runFiles [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1787:3[90m)[39m

 âœ“ |sanity| src/core/releases/tool/components/releaseCTAButtons/ReleaseRevertButton/__tests__/useDocumentRevertStates.test.ts (6 tests) 81ms
 âœ“ |sanity| src/core/user-color/__tests__/userColorManager.test.ts (11 tests) 152ms
 âœ“ |sanity| src/core/form/inputs/files/ImageToolInput/imagetool/__tests__/calculateStyles.test.ts (11 tests) 16ms
 âœ“ |sanity| src/core/studio/components/navbar/search/definitions/fields.test.tsx (9 tests) 43ms
 âœ“ |sanity| src/core/components/commandList/__tests__/CommandList.test.tsx (4 tests) 348ms
 â†“ |sanity| src/structure/components/confirmDeleteDialog/__tests__/index.test.tsx (1 test | 1 skipped)
 âœ“ |sanity| src/core/releases/util/util.test.ts (15 tests) 19ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/serverOperations/publish.test.ts (7 tests) 13ms
stderr | src/structure/__tests__/router.test.ts > toState > returns the first ID of the first split pane considering different params, exclusiveParams, and payloads
Unknown pane segment:  - skipping

stderr | src/structure/__tests__/router.test.ts > toState > returns the first ID of the first split pane considering different params, exclusiveParams, payloads and non-URL-safe payloads
Unknown pane segment:  - skipping

 âœ“ |sanity| src/structure/__tests__/router.test.ts (13 tests) 21ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/operations/publish.test.ts (7 tests) 12ms
 âœ“ |sanity| src/core/studio/studioAnnouncements/__tests__/useSeenAnnouncements.test.tsx (7 tests) 54ms
 âœ“ |sanity| src/core/releases/tool/detail/events/getReleaseActivityEvents.test.ts (3 tests) 17ms
 âœ“ |sanity| src/core/form/studio/tree-editing/__tests__/findArrayTypePaths.test.ts (3 tests) 13ms
 âœ“ |sanity| src/core/form/store/utils/__tests__/immutableReconcile.test.ts (11 tests) 19ms
 âœ“ |sanity| src/core/form/studio/inputResolver/helpers.test.ts (32 tests) 12ms
 âœ“ |sanity| src/core/util/__tests__/draftUtils.test.ts (31 tests) 16ms
 âœ“ |sanity| src/core/studio/copyPaste/__test__/resolveSchemaFromPath.test.ts (6 tests) 35ms
 âœ“ |sanity| src/core/templates/__tests__/resolveDeep.test.ts (5 tests) 15ms
 âœ“ |sanity| src/router/__test__/urlSearchParams.test.ts (11 tests) 29ms
 âœ“ |sanity| src/core/form/studio/tree-editing/__tests__/treeEditingSearch.test.ts (5 tests) 9ms
 âœ“ |sanity| src/core/form/store/__tests__/members.hidden.test.ts (3 tests) 28ms
 âœ“ |sanity| src/core/util/releaseUtils.test.ts (8 tests) 11ms
 âœ“ |sanity| src/core/store/_legacy/user/__tests__/userStore.test.ts (8 tests) 200ms
 âœ“ |sanity| test/validation/util/normalizeValidationRules.test.ts (7 tests) 18ms
 âœ“ |sanity| src/core/form/hooks/__tests__/useDidUpdate.test.ts (6 tests) 97ms
 âœ“ |sanity| src/core/search/groq2024/getNextCursor.test.ts (9 tests) 16ms
 âœ“ |sanity| test/validation/dates.test.ts (8 tests) 69ms
 âœ“ |sanity| src/core/studio/studioAnnouncements/__tests__/utils.test.ts (16 tests) 19ms
 âœ“ |sanity| src/core/store/translog/getTransactionsLogs.test.ts (5 tests) 17ms
stderr | src/core/releases/store/__tests__/createReleaseMetadataAggregator.test.ts > createReleaseMetadataAggregator > should handle fetch errors with loading states
Failed to fetch release metadata Error: Fetch failed
    at [90m/testbed/[39mpackages/sanity/src/core/releases/store/__tests__/createReleaseMetadataAggregator.test.ts:67:19
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at runSuite [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 âœ“ |sanity| src/core/releases/store/__tests__/createReleaseMetadataAggregator.test.ts (5 tests) 40ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/operations/duplicate.test.ts (5 tests) 11ms
 âœ“ |sanity| test/validation/children.test.ts (7 tests) 56ms
 âœ“ |sanity| src/core/form/hooks/__tests__/useScrollIntoViewOnFocusWithin.test.ts (4 tests) 58ms
 âœ“ |sanity| test/validation/array.test.ts (9 tests) 57ms
 âœ“ |sanity| src/core/create/studio-app/__tests__/fetchCreateCompatibleAppId.test.ts (4 tests) 20ms
 âœ“ |sanity| src/core/releases/tool/components/releaseCTAButtons/ReleaseRevertButton/__tests__/usePostPublishTransactions.test.ts (6 tests) 208ms
 âœ“ |@sanity/vision| src/hooks/useDatasets.test.ts (5 tests) 50ms
 âœ“ |sanity| src/core/preview/__test__/createObserveDocument.test.ts (3 tests) 334ms
 âœ“ |sanity| src/core/store/_legacy/history/history.test.ts (5 tests) 21ms
 âœ“ |sanity| src/core/validation/util/__tests__/createBatchedGetDocumentExists.test.ts (3 tests) 788ms
 âœ“ |sanity| src/router/__test__/scope.test.ts (4 tests) 26ms
 âœ“ |sanity| src/structure/panes/documentList/sheetList/__tests__/DocumentSheetListSelect.test.tsx (5 tests) 369ms
 âœ“ |sanity| src/core/create/__tests__/createUtils.test.ts (7 tests) 32ms
 âœ“ |sanity| test/validation/numbers.test.ts (9 tests) 48ms
 âœ“ |sanity| src/core/templates/__tests__/prepare.test.ts (9 tests) 15ms
 âœ“ |sanity| src/router/__test__/api.test.ts (5 tests) 26ms
 â†“ |sanity| src/core/form/inputs/PortableText/_legacyDefaultParts/__tests__/BlockExtras.test.tsx (2 tests | 2 skipped)
 âœ“ |sanity| src/core/releases/hooks/__tests__/useDocumentVersions.test.tsx (3 tests) 97ms
 âœ“ |sanity| src/router/IntentLink.test.tsx (3 tests) 60ms
 âœ“ |sanity| src/core/form/store/__tests__/equality.test.ts (1 test) 12ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/serverOperations/restore.test.ts (4 tests) 15ms
 âœ“ |sanity| src/core/studio/activeWorkspaceMatcher/__tests__/matchWorkspace.test.ts (4 tests) 22ms
 âœ“ |sanity| src/core/components/errorActions/useCopyErrorDetails.test.ts (8 tests) 51ms
 âœ“ |sanity| src/core/releases/tool/overview/__tests__/queryParamUtils.test.ts (9 tests) 28ms
 âœ“ |sanity| src/core/tasks/components/activity/helpers/groupChanges.test.ts (3 tests) 13ms
 âœ“ |sanity| src/core/studio/components/navbar/new-document/__tests__/newDocumentFilter.test.ts (4 tests) 33ms
 âœ“ |sanity| src/core/studio/packageVersionStatus/utils.test.ts (9 tests) 77ms
 âœ“ |sanity| src/core/search/common/__tests__/getSearchableTypes.test.ts (6 tests) 18ms
 âœ“ |sanity| src/core/studio/__tests__/colorScheme.test.tsx (3 tests) 405ms
 âœ“ |sanity| src/router/__test__/findMatchingNodes.test.ts (5 tests) 16ms
 âœ“ |sanity| src/router/__test__/resolveStateFromPath.test.ts (9 tests) 26ms
 âœ“ |sanity| src/router/__test__/resolvePathFromState.test.ts (5 tests) 14ms
 âœ“ |sanity| src/core/store/_legacy/document/document-pair/operations/restore.test.ts (4 tests) 15ms
 âœ“ |sanity| src/core/form/studio/tree-editing/__tests__/useNestedObjectDialog.test.tsx (4 tests) 38ms
 âœ“ |sanity| test/validation/generics.test.ts (11 tests) 41ms
 âœ“ |sanity| src/core/environment/importMap.test.ts (8 tests) 12ms
 âœ“ |sanity| src/core/search/common/__tests__/tokens.test.ts (8 tests) 17ms
 âœ“ |sanity| src/core/comments/__tests__/mergeCommentReactions.test.ts (1 test) 5ms
 âœ“ |sanity| src/core/search/weighted/createWeightedSearch.test.ts (3 tests) 27ms
 âœ“ |sanity| src/core/store/_legacy/document/utils/__test__/eventChainUtils.test.ts (2 tests) 6ms
 âœ“ |sanity| src/core/store/_legacy/grants/__tests__/createGrantsStore.test.ts (1 test) 29ms
 âœ“ |sanity| src/core/util/__tests__/interpolateTemplate.test.ts (10 tests) 15ms
 âœ“ |sanity| src/core/search/weighted/applyWeights.test.ts (5 tests) 22ms
 âœ“ |sanity| src/router/__test__/transform.test.ts (2 tests) 22ms
 âœ“ |sanity| src/structure/components/pane/helpers/_calcPaneResize.test.ts (1 test) 4ms
 âœ“ |sanity| src/core/util/__tests__/rxSwr.test.ts (2 tests) 634ms
   âœ“ rxSwr > should discard old cache keys when exceeding maxSize  413ms
 âœ“ |sanity| src/router/__test__/usage.test.ts (6 tests) 32ms
 âœ“ |sanity| src/core/util/userHasRole.test.ts (6 tests) 13ms
 âœ“ |sanity| src/core/studio/__tests__/colorSchemeStore.test.ts (3 tests) 22ms
 âœ“ |sanity| src/core/store/_legacy/document/selectUpstreamVersion.test.ts (1 test) 3ms
 âœ“ |sanity| src/presentation/loader/__tests__/useLiveEvents.test.ts (5 tests) 11ms
stderr | src/core/store/renderingContext/coreUiRenderingContext.test.ts > fails gracefully if the `_context` URL search parameter cannot be parsed
Error parsing rendering context: SyntaxError: Unterminated string in JSON at position 31
    at JSON.parse (<anonymous>)
    at [90m/testbed/[39mpackages/sanity/src/core/store/renderingContext/coreUiRenderingContext.ts:44:36
    at [90m/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/map.ts:57:33
    at OperatorSubscriber._this._next [90m(/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/OperatorSubscriber.ts:70:13[90m)[39m
    at OperatorSubscriber.Subscriber.next [90m(/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/Subscriber.ts:71:12[90m)[39m
    at [90m/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/map.ts:57:20
    at OperatorSubscriber._this._next [90m(/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/OperatorSubscriber.ts:70:13[90m)[39m
    at OperatorSubscriber.Subscriber.next [90m(/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/Subscriber.ts:71:12[90m)[39m
    at [90m/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/distinctUntilChanged.ts:173:22
    at OperatorSubscriber._this._next [90m(/testbed/[39mnode_modules/[4m.pnpm[24m/rxjs@7.8.2/node_modules/[4mrxjs[24m/src/internal/operators/OperatorSubscriber.ts:70:13[90m)[39m

 âœ“ |sanity| src/core/store/renderingContext/coreUiRenderingContext.test.ts (3 tests) 30ms
 âœ“ |sanity| test/cli/graphql/gen2.test.ts (1 test) 54ms
 âœ“ |sanity| src/core/preview/__test__/observeFields.test.ts (1 test) 127ms
 âœ“ |sanity| src/core/util/searchUtils.test.ts (3 tests) 18ms
 âœ“ |sanity| src/core/util/__tests__/formatRelativeLocale.test.ts (3 tests) 62ms
 âœ“ |sanity| src/router/__test__/base64url.test.ts (4 tests) 16ms
 âœ“ |sanity| src/core/preview/utils/shareReplayLatest.test.ts (2 tests) 412ms
   âœ“ replayLatest() replays matching value to new subscribers  312ms
 âœ“ |sanity| src/structure/components/pane/paneLayoutController.test.ts (1 test) 10ms
 âœ“ |sanity| src/core/store/_legacy/document/isNewDocument.test.ts (3 tests) 11ms
 âœ“ |sanity| src/structure/structureResolvers/__tests__/memoBind.test.ts (2 tests) 5ms
 âœ“ |sanity| src/core/templates/util/deepAssign.test.ts (6 tests) 6ms
 â¯ |sanity| src/core/search/common/__tests__/deriveSearchWeightsFromType2024.test.ts (1 test | 1 failed) 7718ms
   Ã— deriveSearchWeightsFromType2024 > works for schemas that branch out a lot 7714ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 âœ“ |sanity| src/core/studio/router/helpers.test.ts (1 test) 9ms
stderr | src/core/create/studio-app/__tests__/appIdCache.test.ts > appIdCache > should suppress error and return undefined
Error: simulated-error
    at [90m/testbed/[39mpackages/sanity/src/core/create/studio-app/__tests__/appIdCache.test.ts:22:13
    at mockCall [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+spy@3.2.4/node_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at appIdFetcher [90m(file:///testbed/[39mnode_modules/[4m.pnpm[24m/tinyspy@4.0.4/node_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at [90m/testbed/[39mpackages/sanity/src/core/create/studio-app/appIdCache.ts:23:26
    at Object.get [90m(/testbed/[39mpackages/sanity/src/core/create/studio-app/appIdCache.ts:29:9[90m)[39m
    at [90m/testbed/[39mpackages/sanity/src/core/create/studio-app/__tests__/appIdCache.test.ts:24:33
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///testbed/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)

 âœ“ |sanity| src/core/create/studio-app/__tests__/appIdCache.test.ts (2 tests) 20ms
 âœ“ |sanity| src/core/releases/store/__tests__/createReleasePermissionsStore.test.ts (2 tests) 10ms
 âœ“ |sanity| test/validation/util/typeString.test.ts (3 tests) 5ms
 âœ“ |sanity| src/core/form/inputs/arrays/ArrayOfPrimitivesInput/utils/nearestIndex.test.ts (2 tests) 5ms
 âœ“ |sanity| src/core/create/__tests__/createDocumentUrl.test.ts (2 tests) 11ms
 âœ“ |sanity| src/core/preview/utils/getPreviewPaths.test.ts (2 tests) 14ms
 âœ“ |sanity| src/router/__test__/factory.test.ts (5 tests) 10ms
 âœ“ |sanity| src/core/store/_legacy/__tests__/createMultiKeyWeakMap.test.ts (1 test) 26ms
 âœ“ |sanity| src/router/__test__/errors.test.ts (2 tests) 8ms
 âœ“ |sanity| src/core/form/inputs/StringInput/StringInputPortableText/packageValue.test.ts (2 tests) 21ms
 âœ“ |sanity| src/core/store/renderingContext/defaultRenderingContext.test.ts (2 tests) 5ms
 âœ“ |sanity| src/core/form/inputs/StringInput/StringInputPortableText/unpackageValue.test.ts (2 tests) 5ms
 âœ“ |sanity| src/structure/structureBuilder/util/__tests__/getStructureNodeId.test.ts (4 tests) 12ms
 âœ“ |sanity| src/core/store/renderingContext/createRenderingContextStore.test.ts (2 tests) 9ms
 âœ“ |sanity| src/core/studio/components/navbar/search/definitions/operators/definedOperators.test.ts (2 tests) 9ms
 âœ“ |sanity| src/structure/structureResolvers/__tests__/assignId.test.ts (1 test) 9ms
 âœ“ |sanity| src/router/__test__/basepath.test.ts (1 test) 10ms
 â†“ |@sanity/cli| test/init.test.ts (30 tests | 30 skipped)
 â†“ |sanity| src/core/config/__tests__/createPlugin.test.ts (2 tests | 2 skipped)
 âœ“ |cli| actions/deploy/__tests__/helpers.test.ts (25 tests) 60ms
 âœ“ |@sanity/codegen| src/typescript/__tests__/typeGenerator.test.ts (24 tests) 60ms
 âœ“ |@sanity/cli| test/projects.test.ts (8 tests) 21ms
 âœ“ |cli| util/__tests__/compareDependencyVersions.test.ts (10 tests) 43ms
 âœ“ |@sanity/schema| test/validation/validateMediaLibraryAssetAspect.test.ts (39 tests) 44ms
 â†“ |@sanity/cli| test/typegen.test.ts (17 tests | 17 skipped)
 âœ“ |@sanity/codegen| src/typescript/__tests__/findQueriesInSource.test.ts (34 tests) 461ms
   âœ“ findQueries with the groq template > should find queries in source > plain string  307ms
 âœ“ |cli| server/__tests__/buildVendorDependencies.test.ts (12 tests) 194ms
 â¯ |sanity| test/exports.test.ts (1 test | 1 failed) 4638ms
   Ã— exports snapshot 4636ms
     â†’ Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
 âœ“ |@sanity/cli| test/blueprints.test.ts (12 tests) 60ms
 âœ“ |@sanity/types| test/document.test.ts (3 tests) 6ms
 âœ“ |@sanity/schema| src/legacy/searchConfig/resolve.test.ts (15 tests) 46ms
 âœ“ |cli| actions/app/__tests__/deployAction.test.ts (8 tests) 25ms
(node:6897) Warning: Closing file descriptor 24 on garbage collection
(Use `node --trace-warnings ...` to show where the warning was created)
(node:6897) [DEP0137] DeprecationWarning: Closing a FileHandle object on garbage collection is deprecated. Please close FileHandle objects explicitly using FileHandle.prototype.close(). In the future, an error will be thrown if a file descriptor is closed during garbage collection.
 âœ“ |cli| actions/deploy/__tests__/undeployAction.test.ts (7 tests) 20ms
 âœ“ |@sanity/migrate| src/fs-webstream/__test__/bufferThroughFile.test.ts (7 tests) 323ms
 âœ“ |@sanity/mutator| test/SquashingBuffer.test.ts (12 tests) 48ms
 âœ“ |@sanity/schema| test/extractSchema/extractSchema.test.ts (20 tests | 7 skipped) 116ms
 âœ“ |cli| server/__tests__/renderDocument.test.tsx (12 tests) 138ms
 âœ“ |cli| actions/deploy/__tests__/deployAction.test.ts (7 tests) 330ms
 âœ“ |@sanity/mutator| test/BufferedDocument.test.ts (10 tests) 39ms
 â†“ |@sanity/cli| test/build.test.ts (6 tests | 6 skipped)
 âœ“ |@sanity/util| src/legacyDateFormat.test.ts (15 tests) 78ms
 âœ“ |@sanity/util| test/PathUtils.test.ts (26 tests) 42ms
 âœ“ |@sanity/cli| test/openapi.test.ts (13 tests) 30ms
 âœ“ |@sanity/cli| test/docs.test.ts (13 tests) 37ms
 âœ“ |@sanity/types| test/array.test.ts (5 tests) 6ms
 âœ“ |@sanity/schema| test/validation/validation.test.ts (5 tests) 35ms
 â†“ |@sanity/cli| test/telemetry.test.ts (8 tests | 8 skipped)
 âœ“ |@sanity/migrate| src/runner/utils/__tests__/batchMutations.test.ts (6 tests) 16ms
 âœ“ |cli| actions/media/importAssetsAction.test.ts (7 tests) 199ms
 âœ“ |@sanity/types| test/file.test.ts (2 tests) 3ms
 âœ“ |@sanity/util| src/datetime-formatter/formatter.test.ts (84 tests) 149ms
 âœ“ |@sanity/types| test/string.test.ts (5 tests) 4ms
 âœ“ |cli| actions/app/__tests__/undeployAction.test.ts (5 tests) 21ms
 â¯ |cli| threads/__tests__/validateDocuments.test.ts (1 test | 1 failed) 4644ms
   Ã— validateDocuments > works 4580ms
     â†’ Cannot find module '/testbed/node_modules/.pnpm/@portabletext+editor@3.2.4_@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@s_53c3c39bd9df7648860fca218000a98a/node_modules/@sanity/types/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+editor@3.2.4_@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@s_53c3c39bd9df7648860fca218000a98a/node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js
Did you mean to import "file:///testbed/packages/@sanity/types/src/index.ts"?
 âœ“ |@sanity/types| test/image.test.ts (2 tests) 3ms
 âœ“ |cli| actions/schema/__tests__/formatSchemaValidation.test.ts (1 test) 27ms
 â†“ |@sanity/cli| test/dev.test.ts (5 tests | 5 skipped)
 âœ“ |@sanity/codegen| src/typescript/__tests__/findQueriesInPath.test.ts (14 tests | 10 skipped) 657ms
   âœ“ findQueriesInPath > Can find queries in path  507ms
 âœ“ |cli| server/__tests__/aliases.test.ts (3 tests) 20ms
 âœ“ |cli| util/__tests__/shouldAutoUpdate.test.ts (11 tests) 30ms
 âœ“ |@sanity/migrate| src/mutations/__tests__/mutate.test.ts (7 tests) 8ms
 âœ“ |@sanity/types| test/object.test.ts (2 tests) 3ms
 âœ“ |@sanity/types| test/block.test.ts (3 tests) 3ms
 âœ“ |cli| util/__tests__/getAutoUpdateImportMap.test.ts (6 tests) 14ms
 âœ“ |@sanity/mutator| test/Document.test.ts (5 tests) 40ms
 âœ“ |@sanity/types| test/reference.test.ts (5 tests) 11ms
 âœ“ |@sanity/mutator| test/Expression.test.ts (4 tests) 27ms
 âœ“ |@sanity/migrate| src/runner/utils/__tests__/toSanityMutations.test.ts (3 tests) 9ms
 âœ“ |@sanity/types| test/alias.test.ts (4 tests) 9ms
 âœ“ |@sanity/mutator| test/parse.test.ts (13 tests) 17ms
 âœ“ |@sanity/types| test/generic.test.tsx (5 tests) 5ms
 â†“ |@sanity/cli| test/tokens.test.ts (3 tests | 3 skipped)
 â†“ |@sanity/cli| test/alias.test.ts (4 tests | 4 skipped)
 âœ“ |@sanity/util| src/client/concurrency-limiter/__test__/createClientConcurrencyLimiter.test.ts (3 tests) 29ms
 â†“ |@sanity/cli| test/graphql.test.ts (3 tests | 3 skipped)
 âœ“ |@sanity/mutator| test/tokenize.test.ts (1 test) 18ms
 âœ“ |@sanity/migrate| src/runner/__tests__/normalizeMigrationDefinition.test.ts (4 tests) 8ms
 â†“ |@sanity/cli| test/preview.test.ts (5 tests | 5 skipped)
 âœ“ |cli| util/__tests__/extractDocumentsFromNdjsonOrTarball.test.ts (2 tests) 58ms
 â†“ |@sanity/cli| test/documents.test.ts (4 tests | 4 skipped)
 â†“ |@sanity/cli| test/exportImport.test.ts (3 tests | 3 skipped)
 âœ“ |@sanity/migrate| src/it-utils/__test__/decodeText.test.ts (1 test) 20ms
 âœ“ |@sanity/types| test/number.test.ts (2 tests) 3ms
 âœ“ |@sanity/mutator| test/Descender.test.ts (6 tests) 19ms
 â†“ |@sanity/cli| test/basics.test.ts (6 tests | 6 skipped)
 âœ“ |@sanity/codegen| src/typescript/__tests__/parseSource.test.ts (4 tests) 100ms
 âœ“ |cli| actions/validation/reporters/prettyReporter/__tests__/formatDocumentValidation.test.ts (2 tests) 9ms
 âœ“ |@sanity/mutator| test/descend.test.ts (6 tests) 20ms
 â†“ |@sanity/cli| test/cors.test.ts (3 tests | 3 skipped)
 âœ“ |@sanity/types| test/datetime.test.ts (2 tests) 6ms
 â†“ |@sanity/cli| test/dataset.test.ts (3 tests | 3 skipped)
 âœ“ |@sanity/migrate| src/fetch-utils/__test__/assert2xx.test.ts (4 tests) 19ms
 âœ“ |@sanity/migrate| src/tar-webstream/__test__/invalid.test.ts (3 tests) 87ms
 âœ“ |@sanity/types| test/date.test.ts (2 tests) 4ms
 âœ“ |@sanity/types| test/text.test.ts (1 test) 8ms
 âœ“ |cli| util/__tests__/importErrorHandler.test.ts (3 tests) 14ms
 âœ“ |@sanity/schema| test/legacy/schemas.test.ts (14 tests) 101ms
 âœ“ |@sanity/migrate| src/tar-webstream/__test__/movies.test.ts (1 test) 156ms
 âœ“ |@sanity/types| test/slug.test.ts (1 test) 5ms
 âœ“ |@sanity/types| src/mediaLibrary/defineAssetAspect.test.ts (3 tests) 41ms
 â†“ |@sanity/cli| test/exec.test.ts (3 tests | 3 skipped)
 âœ“ |cli| actions/media/lib/findNdjsonEntry.test.ts (3 tests) 16ms
 âœ“ |@sanity/migrate| src/tar-webstream/__test__/small.test.ts (1 test) 86ms
 â¯ |cli| util/__tests__/mockBrowserEnvironment.test.ts (2 tests | 2 failed) 1328ms
   Ã— mockBrowserEnvironment > should handle themer.sanity.build imports in worker thread 688ms
     â†’ promise rejected "Error: Cannot find module '/testbed/packaâ€¦ { â€¦(2) }" instead of resolving
   Ã— mockBrowserEnvironment > should still error on non-themer.sanity.build imports in worker thread 636ms
     â†’ promise rejected "Error: Cannot find module '/testbed/packaâ€¦ { â€¦(2) }" instead of resolving
 âœ“ |@sanity/types| test/url.test.ts (1 test) 3ms
 âœ“ |@sanity/mutator| test/Matcher.test.ts (1 test) 14ms
 âœ“ |@sanity/types| test/typeMerge.test.ts (2 tests) 3ms
 âœ“ |@sanity/types| test/geopoint.test.ts (1 test) 5ms
 âœ“ |@sanity/types| test/boolean.test.ts (1 test) 4ms
 âœ“ |@sanity/util| test/util.test.ts (6 tests) 16ms
 âœ“ |@sanity/mutator| test/patch.test.ts (49 tests) 71ms
 âœ“ |@sanity/util| src/content/__test__/isDeepEmpty.test.ts (11 tests) 20ms
 âœ“ |@sanity/migrate| src/it-utils/__test__/split.test.ts (2 tests) 11ms
 âœ“ |@sanity/codegen| src/__tests__/safeParseQuery.test.ts (12 tests) 35ms
 âœ“ |@sanity/util| test/ConcurrencyLimiter.test.ts (1 test) 22ms
 âœ“ |@sanity/types| test/email.test.ts (1 test) 5ms
 âœ“ |@sanity/migrate| src/it-utils/__test__/json.test.ts (2 tests) 6ms
 âœ“ |@sanity/mutator| test/arrayToJSONMatchPath.test.ts (7 tests) 7ms
 â†“ |@sanity/cli| test/datasetCopy.test.ts (1 test | 1 skipped)
 âœ“ |@sanity/mutator| test/Mutation.test.ts (2 tests) 7ms
 âœ“ |@sanity/migrate| src/fetch-utils/__test__/sanityRequestOptions.test.ts (1 test) 7ms
 âœ“ |@sanity/util| test/createSafeJsonParser.test.ts (2 tests) 33ms
 âœ“ |@sanity/mutator| test/toPath.test.ts (7 tests) 11ms
 âœ“ |sanity-perf-tests| runner/__tests__/parseDecoratedRefs.test.ts (1 test) 7ms
 âœ“ |@sanity/migrate| src/sources/__test__/fromExportArchive.test.ts (1 test) 76ms
 âœ“ |cli| actions/graphql/gen3/__tests__/utils.test.ts (2 tests) 14ms
 âœ“ |@sanity/mutator| test/extract.test.ts (1 test) 17ms
 âœ“ |@sanity/mutator| test/extractWithPath.test.ts (1 test) 16ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 126 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  |sanity| src/structure/hasObsoleteDraft.test.ts [ packages/sanity/src/structure/hasObsoleteDraft.test.ts ]
 FAIL  |sanity| src/structure/mustChooseNewDocumentDestination.test.ts [ packages/sanity/src/structure/mustChooseNewDocumentDestination.test.ts ]
 FAIL  |sanity| test/descriptors/extractManifestToSchema.test.ts [ packages/sanity/test/descriptors/extractManifestToSchema.test.ts ]
 FAIL  |sanity| test/descriptors/schema.test.tsx [ packages/sanity/test/descriptors/schema.test.tsx ]
 FAIL  |sanity| test/manifest/extractManifest.test.ts [ packages/sanity/test/manifest/extractManifest.test.ts ]
 FAIL  |sanity| test/manifest/extractManifestRestore.test.ts [ packages/sanity/test/manifest/extractManifestRestore.test.ts ]
 FAIL  |sanity| test/manifest/extractManifestValidation.test.ts [ packages/sanity/test/manifest/extractManifestValidation.test.ts ]
 FAIL  |sanity| test/validation/validateDocument.test.ts [ packages/sanity/test/validation/validateDocument.test.ts ]
 FAIL  |sanity| src/core/components/CapabilityGate.test.tsx [ packages/sanity/src/core/components/CapabilityGate.test.tsx ]
 FAIL  |sanity| src/core/studio/Studio.test.tsx [ packages/sanity/src/core/studio/Studio.test.tsx ]
 FAIL  |sanity| src/presentation/__tests__/useMainDocument.test.ts [ packages/sanity/src/presentation/__tests__/useMainDocument.test.ts ]
 FAIL  |sanity| test/cli/graphql/extract.test.ts [ packages/sanity/test/cli/graphql/extract.test.ts ]
 FAIL  |sanity| test/cli/graphql/gen3.test.ts [ packages/sanity/test/cli/graphql/gen3.test.ts ]
 FAIL  |sanity| src/_internal/manifest/__tests__/Icon.test.tsx [ packages/sanity/src/_internal/manifest/__tests__/Icon.test.tsx ]
 FAIL  |sanity| src/core/comments/__tests__/buildCommentBreadcrumbs.test.ts [ packages/sanity/src/core/comments/__tests__/buildCommentBreadcrumbs.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/transformChildren.test.tsx [ packages/sanity/src/core/comments/__tests__/transformChildren.test.tsx ]
 FAIL  |sanity| src/core/comments/__tests__/weakenReferencesInContentSnapshot.test.ts [ packages/sanity/src/core/comments/__tests__/weakenReferencesInContentSnapshot.test.ts ]
 FAIL  |sanity| src/core/config/__tests__/resolveConfig.test.ts [ packages/sanity/src/core/config/__tests__/resolveConfig.test.ts ]
 FAIL  |sanity| src/core/config/__tests__/resolveConfigProperty.test.ts [ packages/sanity/src/core/config/__tests__/resolveConfigProperty.test.ts ]
 FAIL  |sanity| src/core/error/__tests__/isKnownError.test.ts [ packages/sanity/src/core/error/__tests__/isKnownError.test.ts ]
 FAIL  |sanity| src/core/field/conditional-property/useConditionalProperty.test.tsx [ packages/sanity/src/core/field/conditional-property/useConditionalProperty.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/BooleanInput.test.tsx [ packages/sanity/src/core/form/inputs/BooleanInput.test.tsx ]
 FAIL  |sanity| src/core/form/studio/FormBuilder.test.tsx [ packages/sanity/src/core/form/studio/FormBuilder.test.tsx ]
 FAIL  |sanity| src/core/form/studio/FormBuilderInputErrorBoundary.test.tsx [ packages/sanity/src/core/form/studio/FormBuilderInputErrorBoundary.test.tsx ]
 FAIL  |sanity| src/core/hooks/__tests__/useFormattedDuration.test.tsx [ packages/sanity/src/core/hooks/__tests__/useFormattedDuration.test.tsx ]
 FAIL  |sanity| src/core/hooks/__tests__/useRelativeTime.test.tsx [ packages/sanity/src/core/hooks/__tests__/useRelativeTime.test.tsx ]
 FAIL  |sanity| src/core/hooks/__tests__/useUnitFormatter.test.tsx [ packages/sanity/src/core/hooks/__tests__/useUnitFormatter.test.tsx ]
 FAIL  |sanity| src/core/i18n/__tests__/Translate.test.tsx [ packages/sanity/src/core/i18n/__tests__/Translate.test.tsx ]
 FAIL  |sanity| src/core/scheduledPublishing/contexts/ScheduledPublishingEnabledProvider.test.tsx [ packages/sanity/src/core/scheduledPublishing/contexts/ScheduledPublishingEnabledProvider.test.tsx ]
 FAIL  |sanity| src/core/singleDocRelease/context/SingleDocReleaseEnabledProvider.test.tsx [ packages/sanity/src/core/singleDocRelease/context/SingleDocReleaseEnabledProvider.test.tsx ]
 FAIL  |sanity| src/core/singleDocRelease/hooks/useHasCardinalityOneReleaseVersions.test.tsx [ packages/sanity/src/core/singleDocRelease/hooks/useHasCardinalityOneReleaseVersions.test.tsx ]
 FAIL  |sanity| src/core/singleDocRelease/hooks/useScheduleDraftOperations.test.tsx [ packages/sanity/src/core/singleDocRelease/hooks/useScheduleDraftOperations.test.tsx ]
 FAIL  |sanity| src/core/singleDocRelease/hooks/useScheduledDraftMenuActions.test.tsx [ packages/sanity/src/core/singleDocRelease/hooks/useScheduledDraftMenuActions.test.tsx ]
 FAIL  |sanity| src/core/studio/workspaceLoader/WorkspaceRouterProvider.test.tsx [ packages/sanity/src/core/studio/workspaceLoader/WorkspaceRouterProvider.test.tsx ]
 FAIL  |sanity| src/core/tasks/plugin/TasksFooterOpenTasks.test.tsx [ packages/sanity/src/core/tasks/plugin/TasksFooterOpenTasks.test.tsx ]
 FAIL  |sanity| src/presentation/loader/__tests__/turboChargeResultIfSourceMap.test.ts [ packages/sanity/src/presentation/loader/__tests__/turboChargeResultIfSourceMap.test.ts ]
 FAIL  |sanity| src/structure/structureResolvers/__tests__/resolveIntent.test.ts [ packages/sanity/src/structure/structureResolvers/__tests__/resolveIntent.test.ts ]
 FAIL  |sanity| src/ui-components/errorBoundary/__test__/ErrorBoundary.test.tsx [ packages/sanity/src/ui-components/errorBoundary/__test__/ErrorBoundary.test.tsx ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedBefore.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedBefore.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedInside.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedInside.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedInsideOutside.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/boldedInsideOutside.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/deleteAfterSingleWord.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/deleteAfterSingleWord.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/dramaticallyChanged.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/dramaticallyChanged.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/editInsideSingleWord.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/editInsideSingleWord.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/editOutSideSingleWord.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/editOutSideSingleWord.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/exact.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/exact.test.ts ]
 FAIL  |sanity| src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/similarWordAdded.test.ts [ packages/sanity/src/core/comments/__tests__/buildRangeDecorationSelectionsFromComments/similarWordAdded.test.ts ]
 FAIL  |sanity| src/core/create/studio-app/__tests__/useStudioAppIdStore.test.ts [ packages/sanity/src/core/create/studio-app/__tests__/useStudioAppIdStore.test.ts ]
 FAIL  |sanity| src/core/form/inputs/NumberInput/NumberInput.test.tsx [ packages/sanity/src/core/form/inputs/NumberInput/NumberInput.test.tsx ]
 FAIL  |sanity| src/core/form/store/__tests__/collapsible.test.ts [ packages/sanity/src/core/form/store/__tests__/collapsible.test.ts ]
 FAIL  |sanity| src/core/perspective/navbar/__tests__/ReleasesList.test.tsx [ packages/sanity/src/core/perspective/navbar/__tests__/ReleasesList.test.tsx ]
 FAIL  |sanity| src/core/perspective/navbar/__tests__/ReleasesNav.test.tsx [ packages/sanity/src/core/perspective/navbar/__tests__/ReleasesNav.test.tsx ]
 FAIL  |sanity| src/core/releases/components/__tests__/ReleaseActionsResolver.test.tsx [ packages/sanity/src/core/releases/components/__tests__/ReleaseActionsResolver.test.tsx ]
 FAIL  |sanity| src/core/releases/hooks/__tests__/useCustomReleaseActions.test.tsx [ packages/sanity/src/core/releases/hooks/__tests__/useCustomReleaseActions.test.tsx ]
 FAIL  |sanity| src/core/releases/hooks/__tests__/useDocumentVersionTypeSortedList.test.tsx [ packages/sanity/src/core/releases/hooks/__tests__/useDocumentVersionTypeSortedList.test.tsx ]
 FAIL  |sanity| src/core/releases/hooks/__tests__/useOnlyHasVersions.test.tsx [ packages/sanity/src/core/releases/hooks/__tests__/useOnlyHasVersions.test.tsx ]
 FAIL  |sanity| src/core/releases/hooks/__tests__/useVersionOperations.test.tsx [ packages/sanity/src/core/releases/hooks/__tests__/useVersionOperations.test.tsx ]
 FAIL  |sanity| src/core/releases/store/__tests__/useActiveReleases.test.ts [ packages/sanity/src/core/releases/store/__tests__/useActiveReleases.test.ts ]
 FAIL  |sanity| src/core/studio/copyPaste/__test__/useCopyPaste.test.tsx [ packages/sanity/src/core/studio/copyPaste/__test__/useCopyPaste.test.tsx ]
 FAIL  |sanity| src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsCard.test.tsx [ packages/sanity/src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsCard.test.tsx ]
 FAIL  |sanity| src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsDialog.test.tsx [ packages/sanity/src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsDialog.test.tsx ]
 FAIL  |sanity| src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsMenuItem.test.tsx [ packages/sanity/src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsMenuItem.test.tsx ]
 FAIL  |sanity| src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsProvider.test.tsx [ packages/sanity/src/core/studio/studioAnnouncements/__tests__/StudioAnnouncementsProvider.test.tsx ]
 FAIL  |sanity| src/core/tasks/context/enabled/TasksEnabledProvider.test.tsx [ packages/sanity/src/core/tasks/context/enabled/TasksEnabledProvider.test.tsx ]
 FAIL  |sanity| src/structure/panes/documentList/__tests__/helpers.test.ts [ packages/sanity/src/structure/panes/documentList/__tests__/helpers.test.ts ]
 FAIL  |sanity| src/core/form/inputs/CrossDatasetReferenceInput/__tests__/CrossDatasetReferenceInput.test.tsx [ packages/sanity/src/core/form/inputs/CrossDatasetReferenceInput/__tests__/CrossDatasetReferenceInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/DateInputs/__tests__/CommonDateTimeInput.test.tsx [ packages/sanity/src/core/form/inputs/DateInputs/__tests__/CommonDateTimeInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/DateInputs/__tests__/DateInput.test.tsx [ packages/sanity/src/core/form/inputs/DateInputs/__tests__/DateInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/DateInputs/__tests__/DateTimeInput.test.tsx [ packages/sanity/src/core/form/inputs/DateInputs/__tests__/DateTimeInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/GlobalDocumentReferenceInput/__tests__/GlobalDocumentReferenceInput.test.tsx [ packages/sanity/src/core/form/inputs/GlobalDocumentReferenceInput/__tests__/GlobalDocumentReferenceInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/ObjectInput/__tests__/ObjectFieldset.test.tsx [ packages/sanity/src/core/form/inputs/ObjectInput/__tests__/ObjectFieldset.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/ObjectInput/__tests__/ObjectInput.test.tsx [ packages/sanity/src/core/form/inputs/ObjectInput/__tests__/ObjectInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/ReferenceInput/__tests__/ReferenceInput.test.tsx [ packages/sanity/src/core/form/inputs/ReferenceInput/__tests__/ReferenceInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/StringInput/StringInputBasic/StringInputBasic.test.tsx [ packages/sanity/src/core/form/inputs/StringInput/StringInputBasic/StringInputBasic.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/StringInput/StringInputPortableText/StringInputPortableText.test.tsx [ packages/sanity/src/core/form/inputs/StringInput/StringInputPortableText/StringInputPortableText.test.tsx ]
 FAIL  |sanity| src/core/form/members/object/fields/PrimitiveField.test.tsx [ packages/sanity/src/core/form/members/object/fields/PrimitiveField.test.tsx ]
 FAIL  |sanity| src/core/form/studio/assetSourceMediaLibrary/__tests__/MediaLibrary.test.tsx [ packages/sanity/src/core/form/studio/assetSourceMediaLibrary/__tests__/MediaLibrary.test.tsx ]
 FAIL  |sanity| src/core/releases/components/dialog/__tests__/CreateReleaseDialog.test.tsx [ packages/sanity/src/core/releases/components/dialog/__tests__/CreateReleaseDialog.test.tsx ]
 FAIL  |sanity| src/core/releases/components/dialog/__tests__/ReleaseForm.test.tsx [ packages/sanity/src/core/releases/components/dialog/__tests__/ReleaseForm.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseDashboardFooter.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseDashboardFooter.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseDetail.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseDetail.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseDetailsEditor.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseDetailsEditor.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseStatusItems.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseStatusItems.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseSummary.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseSummary.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/detail/__tests__/ReleaseTypePicker.test.tsx [ packages/sanity/src/core/releases/tool/detail/__tests__/ReleaseTypePicker.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/components/__tests__/ReleaseDocumentPreview.test.tsx [ packages/sanity/src/core/releases/tool/components/__tests__/ReleaseDocumentPreview.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/components/__tests__/ReleaseTime.test.tsx [ packages/sanity/src/core/releases/tool/components/__tests__/ReleaseTime.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/overview/__tests__/ReleasesOverview.test.tsx [ packages/sanity/src/core/releases/tool/overview/__tests__/ReleasesOverview.test.tsx ]
 FAIL  |sanity| src/core/store/_legacy/document/document-pair/checkoutPair.test.ts [ packages/sanity/src/core/store/_legacy/document/document-pair/checkoutPair.test.ts ]
 FAIL  |sanity| src/core/store/_legacy/grants/__tests__/templatePermissions.test.ts [ packages/sanity/src/core/store/_legacy/grants/__tests__/templatePermissions.test.ts ]
 FAIL  |sanity| src/core/tasks/components/form/tasksFormBuilder/TaskNotificationTarget.test.tsx [ packages/sanity/src/core/tasks/components/form/tasksFormBuilder/TaskNotificationTarget.test.tsx ]
 FAIL  |sanity| src/structure/panes/documentList/sheetList/__tests__/ColumnsControl.test.tsx [ packages/sanity/src/structure/panes/documentList/sheetList/__tests__/ColumnsControl.test.tsx ]
 FAIL  |sanity| src/core/components/inputs/DateInputs/calendar/__tests__/Calendar.test.tsx [ packages/sanity/src/core/components/inputs/DateInputs/calendar/__tests__/Calendar.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/common/diff/string/computeStringDiffRangeDecorations.test.tsx [ packages/sanity/src/core/form/inputs/common/diff/string/computeStringDiffRangeDecorations.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/files/FileInput/__tests__/fileInput.test.tsx [ packages/sanity/src/core/form/inputs/files/FileInput/__tests__/fileInput.test.tsx ]
 FAIL  |sanity| src/core/form/inputs/files/ImageInput/__tests__/imageInput.test.tsx [ packages/sanity/src/core/form/inputs/files/ImageInput/__tests__/imageInput.test.tsx ]
 FAIL  |sanity| src/core/releases/components/documentHeader/contextMenu/__tests__/VersionContextMenu.test.tsx [ packages/sanity/src/core/releases/components/documentHeader/contextMenu/__tests__/VersionContextMenu.test.tsx ]
 FAIL  |sanity| src/core/releases/components/documentHeader/contextMenu/__tests__/VersionContextMenuItem.test.tsx [ packages/sanity/src/core/releases/components/documentHeader/contextMenu/__tests__/VersionContextMenuItem.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/components/ReleaseMenuButton/__tests__/ReleaseMenuButton.test.tsx [ packages/sanity/src/core/releases/tool/components/ReleaseMenuButton/__tests__/ReleaseMenuButton.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/overview/__tests__/columnCells/ReleaseDocumentsCounter.test.tsx [ packages/sanity/src/core/releases/tool/overview/__tests__/columnCells/ReleaseDocumentsCounter.test.tsx ]
 FAIL  |sanity| src/core/releases/tool/overview/__tests__/columnCells/ReleaseName.test.tsx [ packages/sanity/src/core/releases/tool/overview/__tests__/columnCells/ReleaseName.test.tsx ]
 FAIL  |sanity| src/core/store/_legacy/document/document-pair/serverOperations/patch.test.ts [ packages/sanity/src/core/store/_legacy/document/document-pair/serverOperations/patch.test.ts ]
 FAIL  |sanity| src/core/store/_legacy/document/hooks/__tests__/useDocumentType.test.tsx [ packages/sanity/src/core/store/_legacy/document/hooks/__tests__/useDocumentType.test.tsx ]
 FAIL  |sanity| src/core/studio/components/navbar/search/datastores/recentSearches.test.tsx [ packages/sanity/src/core/studio/components/navbar/search/datastores/recentSearches.test.tsx ]
 FAIL  |sanity| src/core/studio/components/navbar/search/utils/filterUtils.test.ts [ packages/sanity/src/core/studio/components/navbar/search/utils/filterUtils.test.ts ]
 FAIL  |sanity| src/structure/panes/document/documentPanel/documentViews/__tests__/FormHeader.test.tsx [ packages/sanity/src/structure/panes/document/documentPanel/documentViews/__tests__/FormHeader.test.tsx ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/arrayOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/arrayOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/assetOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/assetOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/booleanOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/booleanOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/dateOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/dateOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/numberOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/numberOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/portableTextOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/portableTextOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/referenceOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/referenceOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/slugOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/slugOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/definitions/operators/stringOperators.test.ts [ packages/sanity/src/core/studio/components/navbar/search/definitions/operators/stringOperators.test.ts ]
 FAIL  |sanity| src/core/studio/components/navbar/search/components/common/__tests__/FilterLabel.test.tsx [ packages/sanity/src/core/studio/components/navbar/search/components/common/__tests__/FilterLabel.test.tsx ]
Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/131]âŽ¯

 FAIL  |sanity| src/core/singleDocRelease/components/DeleteScheduledDraftDialog.test.tsx [ packages/sanity/src/core/singleDocRelease/components/DeleteScheduledDraftDialog.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/core/components/documentStatus/DocumentStatus.tsx:5:1
      3| import {useMemo} from 'react'
      4| 
      5| import {useRelativeTime} from '../../hooks'
       | ^
      6| import {useTranslation} from '../../i18n'
      7| import {
 â¯ src/core/components/documentStatus/index.ts:1:1

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/131]âŽ¯

 FAIL  |sanity| src/structure/components/structureTool/StructureTitle.test.tsx [ packages/sanity/src/structure/components/structureTool/StructureTitle.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/components/structureTool/StructureTitle.test.tsx:3:1
      1| import {render} from '@testing-library/react'
      2| // eslint-disable-next-line no-restricted-imports
      3| import * as SANITY from 'sanity'
       | ^
      4| import {beforeEach, describe, expect, it, type Mock, vi} from 'vitest'
      5| 

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/131]âŽ¯

 FAIL  |sanity| src/structure/panes/documentList/__tests__/PaneContainer.test.tsx [ packages/sanity/src/structure/panes/documentList/__tests__/PaneContainer.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/documentList/__tests__/PaneContainer.test.tsx:2:1
      1| import {act, render, screen} from '@testing-library/react'
      2| import {defineConfig, type PerspectiveContextValue, useSearchState} frâ€¦
       | ^
      3| import {describe, expect, it, type Mock, vi} from 'vitest'
      4| 

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/131]âŽ¯

 FAIL  |sanity| src/structure/panes/document/__tests__/useDocumentTitle.test.tsx [ packages/sanity/src/structure/panes/document/__tests__/useDocumentTitle.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/document/__tests__/useDocumentTitle.test.tsx:2:1
      1| import {renderHook, waitFor} from '@testing-library/react'
      2| import {
       | ^
      3|   defineConfig,
      4|   prepareForPreview,

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/131]âŽ¯

 FAIL  |sanity| src/structure/panes/documentList/sheetList/__tests__/DocumentSheetListPane.test.tsx [ packages/sanity/src/structure/panes/documentList/sheetList/__tests__/DocumentSheetListPane.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/documentList/sheetList/__tests__/DocumentSheetListPane.test.tsx:3:1
      1| import {fireEvent, render, screen, within} from '@testing-library/reacâ€¦
      2| import userEvent from '@testing-library/user-event'
      3| import {defineConfig} from 'sanity'
       | ^
      4| import {describe, expect, it, vi} from 'vitest'
      5| 

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/131]âŽ¯

 FAIL  |sanity| src/structure/panes/documentList/sheetList/__tests__/useDocumentSheetColumns.test.ts [ packages/sanity/src/structure/panes/documentList/sheetList/__tests__/useDocumentSheetColumns.test.ts ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/documentList/sheetList/useDocumentSheetColumns.tsx:14:1
     12| import {useMemo} from 'react'
     13| import {useObservable} from 'react-rx'
     14| import {
       | ^
     15|   type DocumentPreviewStore,
     16|   DocumentStatusIndicator,
 â¯ src/structure/panes/documentList/sheetList/__tests__/useDocumentSheetColumns.test.ts:5:1

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/131]âŽ¯

 FAIL  |sanity| src/structure/panes/document/documentPanel/banners/__tests__/DeletedDocumentBanners.test.tsx [ packages/sanity/src/structure/panes/document/documentPanel/banners/__tests__/DeletedDocumentBanners.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/document/documentPanel/banners/__tests__/DeletedDocumentBanners.test.tsx:2:1
      1| import {render, screen, waitFor} from '@testing-library/react'
      2| import {
       | ^
      3|   LATEST,
      4|   type ReleaseDocument,

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/131]âŽ¯

 FAIL  |sanity| src/structure/panes/document/documentPanel/banners/__tests__/OpenReleaseToEditBanner.test.tsx [ packages/sanity/src/structure/panes/document/documentPanel/banners/__tests__/OpenReleaseToEditBanner.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/document/documentPanel/banners/__tests__/OpenReleaseToEditBanner.test.tsx:2:1
      1| import {render, screen} from '@testing-library/react'
      2| import {
       | ^
      3|   getReleaseIdFromReleaseDocumentId,
      4|   type ReleaseDocument,

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/131]âŽ¯

 FAIL  |sanity| src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentHeaderTitle.test.tsx [ packages/sanity/src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentHeaderTitle.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentHeaderTitle.test.tsx:2:1
      1| import {render, waitFor} from '@testing-library/react'
      2| import {
       | ^
      3|   defineConfig,
      4|   type SanityClient,

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/131]âŽ¯

 FAIL  |sanity| src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentPerspectiveList.test.tsx [ packages/sanity/src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentPerspectiveList.test.tsx ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/structure/panes/document/documentPanel/header/perspective/__tests__/DocumentPerspectiveList.test.tsx:3:1
      1| import {render, screen} from '@testing-library/react'
      2| import {type HTMLProps} from 'react'
      3| import {
       | ^
      4|   getDraftId,
      5|   getVersionId,

Caused by: Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND', url: 'file:///testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/131]âŽ¯


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 5 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  |sanity| test/exports.test.ts > exports snapshot
Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@sanity/schema/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@sanity+schema_@sanity+types@packages+@sanity+types/node_modules/@portabletext/sanity-bridge/dist/index.js
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/131]âŽ¯

 FAIL  |sanity| src/core/search/common/__tests__/deriveSearchWeightsFromType2024.test.ts > deriveSearchWeightsFromType2024 > works for schemas that branch out a lot
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ src/core/search/common/__tests__/deriveSearchWeightsFromType2024.test.ts:8:3
      6| 
      7| describe('deriveSearchWeightsFromType2024', () => {
      8|   it('works for schemas that branch out a lot', () => {
       |   ^
      9|     // schema of 60 "components" with 10 fields each
     10|     const range = [...Array(60).keys()]

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/131]âŽ¯

 FAIL  |cli| threads/__tests__/validateDocuments.test.ts > validateDocuments > works
Error: Cannot find module '/testbed/node_modules/.pnpm/@portabletext+editor@3.2.4_@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@s_53c3c39bd9df7648860fca218000a98a/node_modules/@sanity/types/lib/index.js' imported from /testbed/node_modules/.pnpm/@portabletext+editor@3.2.4_@portabletext+sanity-bridge@1.2.9_@sanity+schema@packages+@s_53c3c39bd9df7648860fca218000a98a/node_modules/@portabletext/editor/lib/_chunks-es/selector.is-at-the-start-of-block.js
Did you mean to import "file:///testbed/packages/@sanity/types/src/index.ts"?
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/131]âŽ¯

 FAIL  |cli| util/__tests__/mockBrowserEnvironment.test.ts > mockBrowserEnvironment > should handle themer.sanity.build imports in worker thread
AssertionError: promise rejected "Error: Cannot find module '/testbed/packaâ€¦ { â€¦(2) }" instead of resolving
 â¯ util/__tests__/mockBrowserEnvironment.test.ts:44:73
     42| describe('mockBrowserEnvironment', () => {
     43|   test('should handle themer.sanity.build imports in worker thread', aâ€¦
     44|     await expect(getImportWorker('https://themer.sanity.build/api/huesâ€¦
       |                                                                         ^
     45|       success: true,
     46|     })

Caused by: Error: Cannot find module '/testbed/packages/sanity/node_modules/@sanity/cli/lib/index.js'
 â¯ Module._resolveFilename ../../../../../node_modules/.pnpm/esbuild-register@3.6.0_esbuild@0.27.0/node_modules/esbuild-register/dist/node.js:4794:36
 â¯ Object.<anonymous> server/getStudioEnvironmentVariables.ts:1:23

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', path: '/testbed/packages/sanity/node_modules/@sanity/cli/package.json' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/131]âŽ¯

 FAIL  |cli| util/__tests__/mockBrowserEnvironment.test.ts > mockBrowserEnvironment > should still error on non-themer.sanity.build imports in worker thread
AssertionError: promise rejected "Error: Cannot find module '/testbed/packaâ€¦ { â€¦(2) }" instead of resolving
 â¯ util/__tests__/mockBrowserEnvironment.test.ts:50:68
     48| 
     49|   test('should still error on non-themer.sanity.build imports in workeâ€¦
     50|     await expect(getImportWorker('https://foobar.official/package')).râ€¦
       |                                                                    ^
     51|       success: false,
     52|       error: expect.stringContaining("Cannot find module 'https://foobâ€¦

Caused by: Error: Cannot find module '/testbed/packages/sanity/node_modules/@sanity/cli/lib/index.js'
 â¯ Module._resolveFilename ../../../../../node_modules/.pnpm/esbuild-register@3.6.0_esbuild@0.27.0/node_modules/esbuild-register/dist/node.js:4794:36
 â¯ Object.<anonymous> server/getStudioEnvironmentVariables.ts:1:23

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', path: '/testbed/packages/sanity/node_modules/@sanity/cli/package.json' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/131]âŽ¯


  Snapshots  1 obsolete
             â†³ packages/sanity/test/exports.test.ts
               Â· exports snapshot 1

 Test Files  130 failed | 240 passed | 19 skipped (389)
      Tests  5 failed | 2104 passed | 130 skipped | 3 todo (2242)
Type Errors  no errors
   Start at  19:04:03
   Duration  184.88s (transform 143.26s, setup 133.49s, collect 180.42s, tests 50.00s, environment 179.01s, prepare 52.23s, typecheck 27.11s)

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
+ : '>>>>> End Test Output'
